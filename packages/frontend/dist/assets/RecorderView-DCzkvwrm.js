import{u as M}from"./recorder-Da96RyiH.js";import{w as L,e as G,f as ee,g as Se,r as h,h as x,i as $e,d as D,j as le,k as B,T as te,l as ne,m as ie,c as p,p as R,a as e,t as y,n as _,q as ce,o as g,s as Ce,v as Re,_ as ue,x as Te,y as j,F as q,z,A as w,b as Ie,B as de,u as Be}from"./index-MXBwyIoC.js";const F=h(!1),O=h(!1);let P=null;function Ae(){const f=M();L(()=>f.status,a=>{F.value=a==="recording"},{immediate:!0});function l(a){if(F.value)return a.preventDefault(),a.returnValue="Recording in progress. Are you sure you want to leave?",a.returnValue}G(()=>{window.addEventListener("beforeunload",l)}),ee(()=>{window.removeEventListener("beforeunload",l)}),Se((a,d,r)=>{F.value?(P=()=>r(),O.value=!0,r(!1)):r()});function o(){O.value=!1,F.value=!1,f.stopRecording().finally(()=>{P&&(P(),P=null)})}function v(){O.value=!1,P=null}return{isGuardActive:F,showLeaveConfirmation:O,confirmLeave:o,cancelLeave:v}}const $=h(null),Q=h(!1),re=h(null),Y=h(null),Ee=10,J=2,De=25;function Le(){const f=x(()=>$.value?$.value.available_gb<J?"critical":$.value.available_gb<Ee?"warning":"ok":"unknown"),l=x(()=>$.value?$.value.available_gb>=J:!0),o=x(()=>{if(!$.value)return null;const i=$.value.available_gb*1024*1024*1024,n=De*1024*1024,s=i/n,t=Math.floor(s/3600),u=Math.floor(s%3600/60);return t>24?`${Math.floor(t/24)}d ${t%24}h`:t>0?`${t}h ${u}m`:`${u}m`}),v=x(()=>{switch(f.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),a=x(()=>$.value?f.value==="critical"?`Disk space critically low (${$.value.available_gb.toFixed(1)} GB). Cannot start recording.`:f.value==="warning"?`Low disk space (${$.value.available_gb.toFixed(1)} GB). Estimated recording time: ${o.value}`:null:null);async function d(){Q.value=!0,Y.value=null;try{const i=await $e.getDegradation();if(i.resources&&i.resources.disk_free_gb!==void 0){const n=i.resources.disk_free_gb,s=n*3;$.value={available_gb:n,total_gb:s,used_percent:100-n/s*100,recording_path:"/opt/r58-app/shared/recordings"}}return re.value=new Date,$.value}catch(i){return Y.value=i.message||"Failed to check disk space",console.error("Failed to check disk space:",i),null}finally{Q.value=!1}}async function r(){return await d(),$.value?f.value==="critical"?{ok:!1,message:`Insufficient disk space (${$.value.available_gb.toFixed(1)} GB). Need at least ${J} GB to start recording.`}:f.value==="warning"?{ok:!0,message:`Low disk space warning: ${$.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${o.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:$,isLoading:Q,lastCheck:re,error:Y,status:f,statusColor:v,canStartRecording:l,estimatedRecordingTime:o,warningMessage:a,checkDiskSpace:d,preflightCheck:r}}const A=h(localStorage.getItem("r58_audio_feedback")!=="false");let X=null;function Me(){return X||(X=new(window.AudioContext||window.webkitAudioContext)),X}function I(f,l,o="sine",v=.3){if(A.value)try{const a=Me();a.state==="suspended"&&a.resume();const d=a.createOscillator(),r=a.createGain();d.connect(r),r.connect(a.destination),d.type=o,d.frequency.value=f;const i=a.currentTime;r.gain.setValueAtTime(0,i),r.gain.linearRampToValueAtTime(v,i+.01),r.gain.linearRampToValueAtTime(0,i+l),d.start(i),d.stop(i+l)}catch(a){console.warn("Audio feedback failed:",a)}}function Ne(){A.value&&(I(440,.1,"sine",.2),setTimeout(()=>I(554,.1,"sine",.2),100),setTimeout(()=>I(659,.15,"sine",.25),200))}function je(){A.value&&(I(880,.08,"sine",.3),setTimeout(()=>I(880,.15,"sine",.3),120))}function Fe(){A.value&&(I(659,.1,"sine",.25),setTimeout(()=>I(554,.1,"sine",.2),100),setTimeout(()=>I(440,.15,"sine",.2),200))}function Pe(){A.value&&(I(200,.15,"square",.15),setTimeout(()=>I(180,.2,"square",.15),180))}function Ge(){A.value&&(I(1e3,.08,"sine",.2),setTimeout(()=>I(1e3,.08,"sine",.2),150))}function oe(){A.value&&I(1200,.03,"sine",.1)}function Ve(f=50){if(A.value&&"vibrate"in navigator)try{navigator.vibrate(f)}catch{}}function fe(){function f(o){A.value=o,localStorage.setItem("r58_audio_feedback",String(o))}function l(){f(!A.value),A.value&&oe()}return{enabled:A,setEnabled:f,toggle:l,playSuccess:Ne,playError:Pe,playWarning:Ge,playClick:oe,playRecordStart:je,playRecordStop:Fe,vibrate:Ve}}const We={class:"bg-r58-bg-secondary rounded-lg shadow-xl max-w-md w-full p-6"},Oe={class:"text-lg font-semibold mb-2"},Ue={class:"text-r58-text-secondary mb-6"},qe={class:"flex justify-end gap-3"},ge=D({__name:"ConfirmDialog",props:{title:{},message:{},confirmText:{},cancelText:{},danger:{type:Boolean}},emits:["confirm","cancel"],setup(f,{expose:l,emit:o}){const v=o,a=h(!1);function d(){a.value=!0}function r(){a.value=!1}function i(){v("confirm"),r()}function n(){v("cancel"),r()}return l({open:d,close:r}),(s,t)=>(g(),le(ie,{to:"body"},[B(te,{name:"fade"},{default:ne(()=>[a.value?(g(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ce(n,["self"])},[e("div",We,[e("h2",Oe,y(f.title),1),e("p",Ue,y(f.message),1),e("div",qe,[e("button",{onClick:n,class:"btn"},y(f.cancelText||"Cancel"),1),e("button",{onClick:i,class:_(["btn",f.danger?"btn-danger":"btn-primary"])},y(f.confirmText||"Confirm"),3)])])])):R("",!0)]),_:1})]))}}),ze={class:"bg-r58-bg-secondary rounded-lg shadow-xl max-w-md w-full p-6"},He=["placeholder"],Ke={class:"text-xs text-r58-text-secondary mt-2"},Qe=D({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(f,{emit:l}){const o=f,v=l,a=h(""),d=h(null),r=x(()=>{const b=new Date,c=b.toLocaleDateString("en-CA"),m=b.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${c}_${m}`}),i=x(()=>o.suggestedName||r.value);L(()=>o.open,b=>{b&&(a.value=i.value,setTimeout(()=>{var c,m;(c=d.value)==null||c.focus(),(m=d.value)==null||m.select()},100))});function n(){v("confirm",a.value.trim()||i.value)}function s(){v("skip")}function t(){v("cancel")}function u(b){b.key==="Enter"?n():b.key==="Escape"&&t()}return(b,c)=>(g(),le(ie,{to:"body"},[B(te,{name:"fade"},{default:ne(()=>[f.open?(g(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ce(t,["self"]),onKeydown:u},[e("div",ze,[c[1]||(c[1]=e("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),c[2]||(c[2]=e("p",{class:"text-r58-text-secondary text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),Ce(e("input",{ref_key:"inputRef",ref:d,"onUpdate:modelValue":c[0]||(c[0]=m=>a.value=m),type:"text",placeholder:i.value,class:"w-full px-4 py-2 bg-r58-bg-tertiary border border-r58-bg-tertiary rounded-lg text-r58-text-primary placeholder-r58-text-secondary focus:outline-none focus:ring-2 focus:ring-r58-accent-primary"},null,8,He),[[Re,a.value]]),e("p",Ke," Suggested: "+y(i.value),1),e("div",{class:"flex justify-between mt-6"},[e("button",{onClick:s,class:"text-sm text-r58-text-secondary hover:text-r58-text-primary transition-colors"}," Skip (use default) "),e("div",{class:"flex gap-3"},[e("button",{onClick:t,class:"btn"}," Cancel "),e("button",{onClick:n,class:"btn btn-primary"}," Start Recording ")])])])],32)):R("",!0)]),_:1})]))}}),Ye=ue(Qe,[["__scopeId","data-v-df8c0a50"]]),Je={class:"flex items-center gap-4"},Xe={key:0,class:"font-mono text-xl text-r58-accent-danger"},Ze=["disabled","title"],et={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},tt={key:0,class:"w-3 h-3 bg-white rounded-sm"},nt={key:1,class:"w-3 h-3 bg-white rounded-full"},st={class:"text-xs text-r58-text-secondary hidden md:inline"},at=D({__name:"RecorderControls",setup(f){const l=M(),{register:o}=Te(),{preflightCheck:v,status:a,canStartRecording:d}=Le(),{playRecordStart:r,playRecordStop:i,playError:n,playWarning:s,vibrate:t}=fe(),u=h(null),b=h(!1),c=h(!1),m=h(!1),k=h(!1),E=h(void 0),S=x(()=>l.status==="recording"),N=x(()=>l.status==="starting"),V=x(()=>l.status==="stopping"),H=x(()=>l.formattedDuration),pe=x(()=>N.value||V.value||c.value),me=x(()=>N.value?"Starting recording...":V.value?"Stopping recording...":c.value?"Checking disk space...":!S.value&&!d.value?"Insufficient disk space":"");let K=null;G(()=>{K=o({key:" ",description:"Toggle Recording",action:be,context:"recorder",enabled:()=>!N.value&&!V.value})}),ee(()=>{K&&K()});async function be(){S.value?ae():await W()}async function W(C){c.value=!0;try{const T=await v();if(!T.ok){n(),t(200),j.error("Cannot start recording",T.message||"Preflight check failed");return}if(T.message&&a.value==="warning"&&(s(),j.warning("Low disk space",T.message)),k.value&&!C){E.value=void 0,m.value=!0;return}await se(C||E.value)}finally{c.value=!1}}async function se(C){try{await l.startRecording(C);const T=C||l.sessionId;r(),t([50,30,50]),j.success("Recording started",`Session: ${T}`)}catch(T){n(),t(200),j.error("Failed to start recording",T.message||"Unknown error",{label:"Retry",onClick:()=>W(C)})}}function he(C){m.value=!1,E.value=C,W(C)}function xe(){m.value=!1,E.value=void 0,W()}function ye(){m.value=!1,c.value=!1}async function _e(){try{await l.stopRecording(),i(),t(100),j.success("Recording stopped",`Duration: ${H.value}`)}catch(C){n(),t(200),j.error("Failed to stop recording",C.message||"Unknown error")}}function ae(){var C;b.value=!1,(C=u.value)==null||C.open(),setTimeout(()=>{b.value=!0},500)}function we(){b.value&&_e()}async function ke(){S.value?ae():await se()}return(C,T)=>(g(),p(q,null,[e("div",Je,[S.value?(g(),p("div",Xe,y(H.value),1)):R("",!0),e("button",{onClick:ke,disabled:pe.value,class:_(["flex items-center gap-2 px-6 py-2 rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",[S.value?"bg-r58-accent-danger hover:bg-red-600 text-white":"bg-r58-accent-success hover:bg-green-600 text-white"]]),title:me.value||(S.value?"Stop Recording (Space)":"Start Recording (Space)")},[N.value||V.value||c.value?(g(),p("span",et)):(g(),p(q,{key:1},[S.value?(g(),p("span",tt)):(g(),p("span",nt))],64)),e("span",null,y(c.value?"Checking...":S.value?"Stop":"Start Recording"),1)],10,Ze),e("span",st,[T[0]||(T[0]=z(" Press ",-1)),T[1]||(T[1]=e("kbd",{class:"px-1 py-0.5 bg-r58-bg-tertiary rounded text-xs font-mono"},"Space",-1)),z(" to "+y(S.value?"stop":"start"),1)])]),B(ge,{ref_key:"stopConfirmDialog",ref:u,title:"Stop Recording?",message:`You have been recording for ${H.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:we},null,8,["message"]),B(Ye,{open:m.value,onConfirm:he,onSkip:xe,onCancel:ye},null,8,["open"])],64))}}),U=h(localStorage.getItem("r58_performance_mode")==="true"),Z=h(localStorage.getItem("r58_performance_mode_auto")!=="false"),rt=3,ot=100,lt=500;function ve(){const f=M(),l=x(()=>U.value?!0:Z.value&&f.isRecording?f.inputs.filter(u=>u.isRecording).length>=rt:!1),o=x(()=>l.value?lt:ot);L(l,t=>{t?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function v(t){U.value=t,localStorage.setItem("r58_performance_mode",String(t))}function a(t){Z.value=t,localStorage.setItem("r58_performance_mode_auto",String(t))}function d(){v(!U.value)}function r(t,u){let b=0,c=null;return(...m)=>{const k=Date.now(),E=u??o.value,S=k-b;S>=E?(b=k,t(...m)):c||(c=window.setTimeout(()=>{b=Date.now(),c=null,t(...m)},E-S))}}function i(t,u){let b=null;return(...c)=>{b&&clearTimeout(b),b=window.setTimeout(()=>{t(...c),b=null},u??o.value)}}function n(t){return l.value?window.setTimeout(()=>t(performance.now()),o.value):requestAnimationFrame(t)}function s(t){l.value?clearTimeout(t):cancelAnimationFrame(t)}return{enabled:U,autoEnable:Z,isActive:l,updateInterval:o,setEnabled:v,setAutoEnable:a,toggle:d,throttle:r,debounce:i,requestFrame:n,cancelFrame:s}}const it=["title"],ct={class:"flex items-center gap-1.5 text-sm"},ut={key:0,class:"flex items-center gap-1.5 text-sm"},dt={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},ft={class:"font-mono"},gt=D({__name:"RecordingHealth",setup(f,{expose:l}){const o=M(),{isActive:v}=ve(),a=h({}),d=h(0),r=h(0),i=h(0);let n=null;function s(){const m={};let k=0;o.inputs.forEach(S=>{m[S.id]=S.bytesWritten;const N=a.value[S.id]||0;k+=S.bytesWritten-N});const E=v.value?2:1;d.value=Math.round(k/(1024*1024)/E*10)/10,a.value=m}L(()=>o.isRecording,m=>{if(m){a.value={},d.value=0,r.value=0,i.value=0;const k=v.value?2e3:1e3;n=window.setInterval(s,k)}else n&&(clearInterval(n),n=null)},{immediate:!0}),L(v,m=>{if(o.isRecording&&n){clearInterval(n);const k=m?2e3:1e3;n=window.setInterval(s,k)}}),ee(()=>{n&&clearInterval(n)});const t=x(()=>o.isRecording?i.value>0||r.value>90?"critical":d.value<1||r.value>70?"warning":"healthy":"idle"),u=x(()=>{switch(t.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});x(()=>{switch(t.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const b=x(()=>{if(!o.isRecording)return"Not recording";const m=[`Write speed: ${d.value} MB/s`,`Buffer: ${r.value}%`];return i.value>0&&m.push(`Frames dropped: ${i.value}`),m.join(`
`)});function c(m){m.buffer_percent!==void 0&&(r.value=m.buffer_percent),m.frames_dropped!==void 0&&(i.value=m.frames_dropped)}return l({updateFromMetrics:c}),(m,k)=>w(o).isRecording?(g(),p("div",{key:0,class:_(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":u.value==="emerald","bg-amber-500/10":u.value==="amber","bg-red-500/10":u.value==="red"}]),title:b.value},[e("span",{class:_(["w-2 h-2 rounded-full",u.value==="emerald"?"bg-emerald-500":"",u.value==="amber"?"bg-amber-500 animate-pulse":"",u.value==="red"?"bg-red-500 animate-pulse":""])},null,2),e("div",ct,[k[0]||(k[0]=e("svg",{class:"w-3.5 h-3.5 text-r58-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),e("span",{class:_(["font-mono",u.value==="emerald"?"text-emerald-400":"",u.value==="amber"?"text-amber-400":"",u.value==="red"?"text-red-400":""])},y(d.value)+" MB/s ",3)]),r.value>0?(g(),p("div",ut,[k[1]||(k[1]=e("span",{class:"text-r58-text-secondary"},"Buf:",-1)),e("span",{class:_(["font-mono",r.value<50?"text-emerald-400":"",r.value>=50&&r.value<80?"text-amber-400":"",r.value>=80?"text-red-400":""])},y(r.value)+"% ",3)])):R("",!0),i.value>0?(g(),p("div",dt,[k[2]||(k[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",ft,y(i.value)+" dropped",1)])):R("",!0)],10,it)):R("",!0)}}),vt={class:"relative w-full h-full bg-black"},pt={key:0,class:"absolute inset-0 flex items-center justify-center bg-black/50"},mt={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/80"},bt={class:"text-center text-r58-text-secondary"},ht={class:"text-sm"},xt=D({__name:"InputPreview",props:{inputId:{},protocol:{}},setup(f){const l=f,o=h(null),v=h(!0),a=h(null);function d(){return`${window.location.origin}/api/v1/whep/${l.inputId}/whep`}let r=null;async function i(){if(o.value){r&&(r.close(),r=null),v.value=!0,a.value=null;try{const n=d(),s=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});r=s,s.ontrack=c=>{o.value&&c.streams[0]&&(o.value.srcObject=c.streams[0],v.value=!1)},s.oniceconnectionstatechange=()=>{(s.iceConnectionState==="failed"||s.iceConnectionState==="disconnected")&&(a.value="Connection lost")},s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const t=await s.createOffer();await s.setLocalDescription(t);const u=await fetch(n,{method:"POST",headers:{"Content-Type":"application/sdp"},body:t.sdp});if(!u.ok)throw new Error(`WHEP request failed: ${u.status}`);const b=await u.text();await s.setRemoteDescription({type:"answer",sdp:b})}catch(n){console.error("WHEP playback error:",n),a.value=n instanceof Error?n.message:"Failed to connect",v.value=!1}}}return G(()=>{i()}),L(()=>l.inputId,()=>{i()}),(n,s)=>(g(),p("div",vt,[e("video",{ref_key:"videoRef",ref:o,autoplay:"",muted:"",playsinline:"",class:"w-full h-full object-contain"},null,512),v.value?(g(),p("div",pt,[...s[0]||(s[0]=[e("div",{class:"animate-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full"},null,-1)])])):R("",!0),a.value?(g(),p("div",mt,[e("div",bt,[e("p",ht,y(a.value),1),e("button",{onClick:i,class:"mt-2 text-xs text-r58-accent-primary hover:underline"}," Retry ")])])):R("",!0)]))}}),yt={key:0,class:"h-full flex items-center justify-center"},_t=["title"],wt={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},kt={class:"flex items-center justify-between"},St={class:"flex items-center gap-2"},$t={class:"font-medium"},Ct={key:0,class:"flex items-center gap-2 text-sm"},Rt={class:"text-r58-text-secondary"},Tt={key:0,class:"mt-2 flex items-center justify-between"},It={class:"text-sm font-mono text-r58-text-secondary"},Bt=D({__name:"InputGrid",setup(f){const l=M(),o=x(()=>l.inputs.filter(n=>n.hasSignal));function v(n){return n.isRecording?"border-r58-accent-danger ring-2 ring-r58-accent-danger/20":n.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-r58-bg-tertiary/50 opacity-60"}function a(n){return n.hasSignal?n.framerate>=29?"excellent":n.framerate>=24?"good":"unstable":"none"}function d(n){switch(a(n)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-r58-text-secondary"}}function r(n){if(n===0)return"0 B";const s=1024,t=["B","KB","MB","GB"],u=Math.floor(Math.log(n)/Math.log(s));return parseFloat((n/Math.pow(s,u)).toFixed(1))+" "+t[u]}function i(n){if(!n.hasSignal)return`${n.label}: No signal detected`;const s=[`${n.label}`,`Resolution: ${n.resolution}`,`Framerate: ${n.framerate} fps`,`Quality: ${a(n)}`];return n.isRecording&&s.push(`Written: ${r(n.bytesWritten)}`),s.join(`
`)}return(n,s)=>o.value.length===0?(g(),p("div",yt,[...s[0]||(s[0]=[Ie('<div class="text-center text-r58-text-secondary"><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><p class="text-lg font-medium">No Video Sources Connected</p><p class="text-sm mt-2">Connect HDMI cables to begin recording</p></div>',1)])])):(g(),p("div",{key:1,class:_(["h-full grid gap-4",o.value.length===1?"grid-cols-1":"grid-cols-2"])},[(g(!0),p(q,null,de(o.value,t=>(g(),p("div",{key:t.id,class:_(["relative rounded-lg overflow-hidden border-2 transition-all cursor-pointer aspect-video bg-black",v(t)]),title:i(t)},[B(xt,{"input-id":t.id,class:"w-full h-full"},null,8,["input-id"]),e("div",wt,[e("div",kt,[e("div",St,[e("span",{class:_(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":a(t)==="excellent"||a(t)==="good","bg-amber-500 animate-pulse":a(t)==="unstable","bg-r58-text-secondary":a(t)==="none"}])},null,2),e("span",$t,y(t.label),1)]),t.hasSignal?(g(),p("div",Ct,[e("span",Rt,y(t.resolution),1),e("span",{class:_(d(t))},y(t.framerate)+"fps",3)])):R("",!0)]),t.isRecording?(g(),p("div",Tt,[s[1]||(s[1]=e("div",{class:"flex items-center gap-2 text-r58-accent-danger"},[e("span",{class:"w-2 h-2 rounded-full bg-r58-accent-danger animate-recording"}),e("span",{class:"text-sm font-medium"},"REC")],-1)),e("span",It,y(r(t.bytesWritten)),1)])):R("",!0)])],10,_t))),128))],2))}}),At={class:"space-y-4"},Et={class:"flex items-center justify-between py-2 cursor-pointer"},Dt=["aria-checked"],Lt={class:"flex items-center justify-between py-2 cursor-pointer"},Mt=["aria-checked"],Nt={class:"flex items-center justify-between py-2 cursor-pointer"},jt={class:"text-xs text-r58-text-secondary"},Ft={key:0,class:"text-amber-400"},Pt=["aria-checked"],Gt={class:"flex items-center justify-between py-2 pl-4 cursor-pointer opacity-80"},Vt=["aria-checked"],Wt=D({__name:"SettingsPanel",setup(f){const{enabled:l,toggle:o,playClick:v}=fe(),{enabled:a,autoEnable:d,isActive:r,setEnabled:i,setAutoEnable:n}=ve(),s=h(!1);function t(){s.value=!s.value,s.value?(document.body.classList.add("touch-mode"),localStorage.setItem("r58_touch_mode","true")):(document.body.classList.remove("touch-mode"),localStorage.setItem("r58_touch_mode","false"))}G(()=>{const b=localStorage.getItem("r58_touch_mode")==="true";s.value=b,b&&document.body.classList.add("touch-mode")});function u(){o(),l.value&&v()}return(b,c)=>(g(),p("div",At,[c[7]||(c[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide"}," Interface Settings ",-1)),e("label",Et,[c[2]||(c[2]=e("div",null,[e("span",{class:"text-r58-text-primary"},"Audio Feedback"),e("p",{class:"text-xs text-r58-text-secondary"},"Play sounds for recording start/stop")],-1)),e("button",{onClick:u,class:_(["relative w-12 h-7 rounded-full transition-colors",w(l)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":w(l)},[e("span",{class:_(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",w(l)?"translate-x-6":"translate-x-1"])},null,2)],10,Dt)]),e("label",Lt,[c[3]||(c[3]=e("div",null,[e("span",{class:"text-r58-text-primary"},"Touch Mode"),e("p",{class:"text-xs text-r58-text-secondary"},"Larger buttons for touchscreen")],-1)),e("button",{onClick:t,class:_(["relative w-12 h-7 rounded-full transition-colors",s.value?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":s.value},[e("span",{class:_(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",s.value?"translate-x-6":"translate-x-1"])},null,2)],10,Mt)]),e("label",Nt,[e("div",null,[c[5]||(c[5]=e("span",{class:"text-r58-text-primary"},"Performance Mode",-1)),e("p",jt,[c[4]||(c[4]=z(" Reduce UI updates during recording ",-1)),w(r)&&!w(a)?(g(),p("span",Ft,"(auto-enabled)")):R("",!0)])]),e("button",{onClick:c[0]||(c[0]=m=>w(i)(!w(a))),class:_(["relative w-12 h-7 rounded-full transition-colors",w(a)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":w(a)},[e("span",{class:_(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",w(a)?"translate-x-6":"translate-x-1"])},null,2)],10,Pt)]),e("label",Gt,[c[6]||(c[6]=e("div",null,[e("span",{class:"text-sm text-r58-text-primary"},"Auto-enable when recording 3+ inputs")],-1)),e("button",{onClick:c[1]||(c[1]=m=>w(n)(!w(d))),class:_(["relative w-10 h-6 rounded-full transition-colors",w(d)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":w(d)},[e("span",{class:_(["absolute top-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform",w(d)?"translate-x-4":"translate-x-0.5"])},null,2)],10,Vt)])]))}}),Ot={class:"space-y-6"},Ut={key:0,class:"card"},qt={class:"space-y-2"},zt={class:"flex justify-between"},Ht={class:"flex justify-between"},Kt={class:"font-mono"},Qt={class:"flex justify-between"},Yt={class:"card"},Jt={class:"space-y-3"},Xt={class:"flex items-center gap-2"},Zt={key:0,class:"text-sm text-r58-text-secondary"},en={key:0,class:"text-r58-accent-danger"},tn={key:1},nn={key:1,class:"text-sm text-r58-text-secondary"},sn={class:"card"},an={class:"space-y-2"},rn=["disabled","title"],on={key:0,class:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-r58-bg-tertiary text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none"},ln={key:0,class:"card"},cn=D({__name:"SessionInfo",setup(f){const l=Be(),o=M(),v=x(()=>o.currentSession),a=x(()=>o.activeInputs),d=x(()=>o.isRecording),r=h(!1);function i(s){if(s===0)return"0 B";const t=1024,u=["B","KB","MB","GB","TB"],b=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,b)).toFixed(2))+" "+u[b]}function n(){l.push({name:"admin",query:{tab:"settings"}})}return(s,t)=>(g(),p("div",Ot,[v.value?(g(),p("div",Ut,[t[4]||(t[4]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Current Session",-1)),e("div",qt,[e("div",zt,[t[1]||(t[1]=e("span",{class:"text-r58-text-secondary"},"Started",-1)),e("span",null,y(v.value.startedAt.toLocaleTimeString()),1)]),e("div",Ht,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"Duration",-1)),e("span",Kt,y(w(o).formattedDuration),1)]),e("div",Qt,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Inputs",-1)),e("span",null,y(a.value.length)+" active",1)])])])):R("",!0),e("div",Yt,[t[5]||(t[5]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Input Status",-1)),e("div",Jt,[(g(!0),p(q,null,de(w(o).inputs,u=>(g(),p("div",{key:u.id,class:"flex items-center justify-between py-2 border-b border-r58-bg-tertiary last:border-0"},[e("div",Xt,[e("span",{class:_(["w-2 h-2 rounded-full",u.hasSignal?"bg-r58-accent-success":"bg-r58-text-secondary"])},null,2),e("span",{class:_(u.hasSignal?"":"text-r58-text-secondary")},y(u.label),3)]),u.hasSignal?(g(),p("div",Zt,[u.isRecording?(g(),p("span",en,y(i(u.bytesWritten)),1)):(g(),p("span",tn,y(u.resolution),1))])):(g(),p("span",nn,"No signal"))]))),128))])]),e("div",sn,[t[7]||(t[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Quick Actions",-1)),e("div",an,[e("button",{onClick:n,class:"btn w-full justify-center disabled:opacity-50 disabled:cursor-not-allowed group relative",disabled:d.value,title:d.value?"Cannot configure while recording":"Open input configuration"},[t[6]||(t[6]=z(" Configure Inputs ",-1)),d.value?(g(),p("span",on," Stop recording first ")):R("",!0)],8,rn),e("button",{onClick:t[0]||(t[0]=u=>r.value=!r.value),class:"btn w-full justify-center"},y(r.value?"Hide Settings":"Interface Settings"),1)])]),B(te,{name:"slide-fade"},{default:ne(()=>[r.value?(g(),p("div",ln,[B(Wt)])):R("",!0)]),_:1})]))}}),un=ue(cn,[["__scopeId","data-v-8910ebdc"]]),dn={class:"h-full flex flex-col"},fn={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},gn={class:"flex items-center gap-4"},vn={class:"flex items-center gap-2"},pn={key:0,class:"badge badge-danger"},mn={class:"flex-1 flex overflow-hidden"},bn={class:"flex-1 p-4"},hn={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},_n=D({__name:"RecorderView",setup(f){const l=M(),{showLeaveConfirmation:o,confirmLeave:v,cancelLeave:a}=Ae(),d=x(()=>l.status==="recording"),r=x(()=>l.formattedDuration);G(async()=>{await l.fetchInputs(),await l.fetchStatus()});const i=h(null);return L(o,n=>{var s,t;n?(s=i.value)==null||s.open():(t=i.value)==null||t.close()}),(n,s)=>(g(),p("div",dn,[e("header",fn,[e("div",gn,[e("div",vn,[e("span",{class:_(["w-3 h-3 rounded-full",d.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),s[0]||(s[0]=e("span",{class:"text-xl font-semibold"},"Recorder",-1))]),d.value?(g(),p("span",pn,"RECORDING")):R("",!0),B(gt)]),B(at)]),e("div",mn,[e("div",bn,[B(Bt)]),e("aside",hn,[B(un)])]),B(ge,{ref_key:"leaveDialog",ref:i,title:"Recording in Progress",message:`You are currently recording (${r.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:w(v),onCancel:w(a)},null,8,["message","onConfirm","onCancel"])]))}});export{_n as default};
