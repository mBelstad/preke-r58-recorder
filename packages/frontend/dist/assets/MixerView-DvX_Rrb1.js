import{C as Z,r as w,h as L,e as X,f as K,d as j,w as z,c as d,p as C,a as s,A as y,n as k,o as m,F as H,B as U,t as $,D as ee,x as te,y as I,k as R}from"./index-CRKRyH5F.js";import{u as se}from"./recorder-71VjDfD7.js";const T=Z("mixer",()=>{const f=w(!1),t=w(null),o=w(null),a=w(null),r=w([]),e=L(()=>r.value.filter(n=>n.hasVideo||n.hasAudio));function g(){f.value=!f.value}function v(n){t.value=n}function b(n){o.value=n}function S(n){a.value=n}function u(n){r.value=n}function i(n,h){const _=r.value.find(V=>V.id===n);_&&(_.muted=h)}function c(n,h){const _=r.value.find(V=>V.id===n);_&&(_.audioLevel=h)}return{isLive:f,activeScene:t,programSource:o,previewSource:a,sources:r,activeSources:e,toggleLive:g,setScene:v,setProgram:b,setPreview:S,updateSourcesFromVdo:u,setSourceMute:i,updateAudioLevel:c}});function E(){return"r58-vdo.itagenten.no"}function A(){return"https"}const P="studio",re={director:{params:{director:P,hidesolo:!0,hideheader:!0,cleanoutput:!0,darkmode:!0,nologo:!0}},scene:{params:{scene:!0,room:P,cover:!0,fadein:500,animated:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0}},multiview:{params:{room:P,scene:!0,grid:!0,autoadd:"*",cleanoutput:!0,hideheader:!0,nologo:!0}},cameraContribution:{params:{room:P,videodevice:0,audiodevice:0,autostart:!0,noaudio:!1}},guestInvite:{params:{room:P,webcam:!0,mic:!0,quality:1,effects:!0}},soloView:{params:{room:P,cover:!0,cleanoutput:!0}},programOutput:{params:{scene:!0,room:P,cover:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0,autostart:!0}}};function B(){return`${window.location.origin}/static/css/vdo-theme.css`}function oe(f,t={}){const o=E(),a=A(),r=re[f],e=new URL(`${a}://${o}/`);e.searchParams.set("css",B());for(const[g,v]of Object.entries(r.params))if(typeof v=="boolean")v&&e.searchParams.set(g,"");else if(typeof v=="number")e.searchParams.set(g,v.toString());else if(typeof v=="string"){let b=v;for(const[S,u]of Object.entries(t))b=b.replace(`{${S}}`,u);b.includes("{")||e.searchParams.set(g,b)}return t.push_id&&e.searchParams.set("push",t.push_id),t.view_id&&e.searchParams.set("view",t.view_id),t.source_ids&&e.searchParams.set("autoadd",t.source_ids),t.whep_url&&e.searchParams.set("whepshare",encodeURIComponent(t.whep_url)),t.label&&e.searchParams.set("label",t.label),e.toString()}function q(f,t,o){const a=E(),r=A(),e=new URL(`${r}://${a}/`);return e.searchParams.set("push",f),e.searchParams.set("room",P),e.searchParams.set("whepshare",t),e.searchParams.set("label",o),e.searchParams.set("videodevice","0"),e.searchParams.set("audiodevice","0"),e.searchParams.set("autostart",""),e.searchParams.set("css",B()),e.toString()}function ne(f){const t=E(),o=A(),a=new URL(`${o}://${t}/`);return a.searchParams.set("scene",""),a.searchParams.set("room",P),a.searchParams.set("cover",""),a.searchParams.set("quality","2"),a.searchParams.set("cleanoutput",""),a.searchParams.set("hideheader",""),a.searchParams.set("nologo",""),a.searchParams.set("whipout",f),a.searchParams.set("autostart",""),a.searchParams.set("videodevice","0"),a.searchParams.set("audiodevice","0"),a.searchParams.set("css",B()),a.toString()}function ae(f){const t=w(!1),o=w(new Map),a=w(null),r=E();function e(l,x,p){var M;if(!((M=f.value)!=null&&M.contentWindow)){console.warn("VDO.ninja iframe not ready");return}const O={action:l};x&&(O.target=x),p!==void 0&&(O.value=p),f.value.contentWindow.postMessage(O,"*")}function g(l){e("changeScene",void 0,l),a.value=l}function v(l){e("soloVideo",l)}function b(l,x){e("pip",l,x?"enable":"disable")}function S(l,x){e("mute",l,x);const p=o.value.get(l);p&&(p.muted=x)}function u(l,x){e("volume",l,Math.max(0,Math.min(100,x)))}function i(l){e("soloChat",l)}function c(l){e("highlight",l)}function n(l,x){e("sendChat",l,x)}function h(l){e("hangup",l),o.value.delete(l)}function _(l){e("requestScreen",l)}function V(){e("record",void 0,!0)}function J(){e("record",void 0,!1)}function Q(l){e("layout",void 0,l)}function Y(l){e("reload",l)}function W(l){var O,M,F,G,N;const x=l.origin;if(!x.includes(r.split(":")[0])&&!x.includes("vdo.ninja")&&!x.includes("localhost"))return;const p=l.data;if(!(!p||typeof p!="object"))switch(p.type){case"director-ready":case"loaded":case"ready":t.value=!0;break;case"new-guest":case"guest-connected":p.streamID&&o.value.set(p.streamID,{id:p.streamID,label:((O=p.data)==null?void 0:O.label)||p.streamID,type:((M=p.data)==null?void 0:M.type)||"guest",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0});break;case"guest-left":case"guest-disconnected":p.streamID&&o.value.delete(p.streamID);break;case"audio-level":if(p.streamID){const D=o.value.get(p.streamID);D&&(D.audioLevel=((F=p.data)==null?void 0:F.level)||0)}break;case"mute-state":if(p.streamID){const D=o.value.get(p.streamID);D&&(D.muted=((G=p.data)==null?void 0:G.muted)||!1)}break;case"scene-changed":a.value=((N=p.data)==null?void 0:N.scene)||null;break;case"error":console.error("[VDO.ninja Error]",p.data);break}}return X(()=>{window.addEventListener("message",W),setTimeout(()=>{!t.value&&f.value&&(t.value=!0)},5e3)}),K(()=>{window.removeEventListener("message",W)}),{isReady:t,sources:o,activeScene:a,setScene:g,setProgram:v,togglePiP:b,setLayout:Q,setMute:S,setVolume:u,soloAudio:i,highlightSource:c,sendToGuest:n,kickGuest:h,requestScreenShare:_,refreshSource:Y,startRecording:V,stopRecording:J,sendCommand:e}}const ie={class:"vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden"},ce={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10"},le=["src"],ue=j({__name:"VdoNinjaEmbed",props:{profile:{},sources:{}},setup(f,{expose:t}){const o=f,a=w(null),r=T(),{isReady:e,sources:g,setScene:v,setMute:b,setVolume:S}=ae(a),u=L(()=>{const i={};return o.sources&&(i.source_ids=o.sources.join(",")),oe(o.profile,i)});return z(g,i=>{r.updateSourcesFromVdo(Array.from(i.values()))},{deep:!0}),t({isReady:e,setScene:v,setMute:b,setVolume:S}),(i,c)=>(m(),d("div",ie,[y(e)?C("",!0):(m(),d("div",ce,[...c[0]||(c[0]=[s("div",{class:"text-center"},[s("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"}),s("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja..."),s("p",{class:"text-xs text-r58-text-secondary mt-2"},"Local mixer on R58")],-1)])])),s("iframe",{ref_key:"iframeRef",ref:a,src:u.value,class:k(["w-full h-full border-0",{"opacity-0":!y(e)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:""},null,10,le)]))}}),de={class:"space-y-6"},me={class:"card"},pe={key:0,class:"text-center py-8 text-r58-text-secondary"},fe={key:1,class:"space-y-2"},ve={class:"flex items-center gap-3"},ge={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},he={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},be={key:2,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xe={class:"font-medium"},ye={class:"text-xs text-r58-text-secondary capitalize"},we={class:"flex items-center gap-2"},_e={class:"w-16 h-2 bg-r58-bg-primary rounded-full overflow-hidden"},Se=["onClick"],ke={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Pe={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$e={class:"card"},Ce={class:"grid grid-cols-2 gap-2"},Oe=j({__name:"SourcePanel",setup(f){const t=T(),o=L(()=>t.sources);return L(()=>t.activeSources),(a,r)=>(m(),d("div",de,[s("div",me,[r[10]||(r[10]=s("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Sources",-1)),o.value.length===0?(m(),d("div",pe,[...r[4]||(r[4]=[s("p",null,"No sources connected",-1),s("p",{class:"text-sm mt-1"},"Sources will appear when they join the room",-1)])])):(m(),d("div",fe,[(m(!0),d(H,null,U(o.value,e=>(m(),d("div",{key:e.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary"},[s("div",ve,[s("div",{class:k(["w-10 h-10 rounded bg-r58-bg-primary flex items-center justify-center",{"ring-2 ring-r58-accent-primary":y(t).programSource===e.id}])},[e.type==="camera"?(m(),d("svg",ge,[...r[5]||(r[5]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):e.type==="guest"?(m(),d("svg",he,[...r[6]||(r[6]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):(m(),d("svg",be,[...r[7]||(r[7]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])]))],2),s("div",null,[s("p",xe,$(e.label),1),s("p",ye,$(e.type),1)])]),s("div",we,[s("div",_e,[s("div",{class:"h-full bg-r58-accent-success rounded-full transition-all duration-100",style:ee({width:`${e.audioLevel}%`})},null,4)]),s("button",{onClick:g=>y(t).setSourceMute(e.id,!e.muted),class:k(["p-2 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":e.muted}])},[e.muted?(m(),d("svg",ke,[...r[8]||(r[8]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(m(),d("svg",Pe,[...r[9]||(r[9]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,Se)])]))),128))]))]),r[12]||(r[12]=s("div",{class:"card"},[s("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Guest Invite"),s("button",{class:"btn w-full justify-center"}," Generate Invite Link ")],-1)),s("div",$e,[r[11]||(r[11]=s("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Scenes",-1)),s("div",Ce,[s("button",{onClick:r[0]||(r[0]=e=>y(t).setScene("scene1")),class:k(["btn",{"btn-primary":y(t).activeScene==="scene1"}])}," Scene 1 ",2),s("button",{onClick:r[1]||(r[1]=e=>y(t).setScene("scene2")),class:k(["btn",{"btn-primary":y(t).activeScene==="scene2"}])}," Scene 2 ",2),s("button",{onClick:r[2]||(r[2]=e=>y(t).setScene("pip")),class:k(["btn",{"btn-primary":y(t).activeScene==="pip"}])}," PiP ",2),s("button",{onClick:r[3]||(r[3]=e=>y(t).setScene("grid")),class:k(["btn",{"btn-primary":y(t).activeScene==="grid"}])}," Grid ",2)])])]))}}),Le={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary"},Ve={class:"flex items-center gap-2"},Me={class:"text-r58-text-secondary"},De={key:0,class:"px-4 pb-3"},je={key:0,class:"flex gap-3 flex-wrap"},Ie={class:"text-sm font-medium"},Re={class:"text-xs text-r58-text-secondary"},Te=["onClick"],Ee={key:1,class:"text-sm text-r58-text-secondary py-2"},He={class:"hidden"},Ue=["src","onLoad","onError"],ze=j({__name:"CameraPushBar",setup(f){const t=se(),o=w(new Map),a=w(!0),r=L(()=>t.inputs.filter(i=>i.hasSignal));function e(i){return`${window.location.origin}/api/v1/whep/${i}/whep`}z(r,i=>{for(const n of i)if(!o.value.has(n.id)){const h=e(n.id),_=q(n.id,h,n.label);o.value.set(n.id,{cameraId:n.id,label:n.label,status:"connecting",iframeSrc:_})}const c=new Set(i.map(n=>n.id));for(const[n]of o.value)c.has(n)||o.value.delete(n)},{immediate:!0});function g(i){const c=o.value.get(i);c&&(c.status="connected",console.log(`[CameraPush] ${i} connected to VDO.ninja`))}function v(i){const c=o.value.get(i);c&&(c.status="error",console.error(`[CameraPush] ${i} failed to connect`))}function b(i){const c=t.inputs.find(_=>_.id===i);if(!c||!c.hasSignal)return;const n=e(i),h=q(i,n,c.label);o.value.set(i,{cameraId:i,label:c.label,status:"connecting",iframeSrc:h+`&_t=${Date.now()}`})}function S(i){switch(i){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function u(i){switch(i){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(i,c)=>(m(),d("div",Le,[s("button",{onClick:c[0]||(c[0]=n=>a.value=!a.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors"},[s("div",Ve,[c[1]||(c[1]=s("span",{class:"font-medium"},"Camera Sources",-1)),s("span",Me,"("+$(r.value.length)+" active)",1)]),(m(),d("svg",{class:k(["w-4 h-4 transition-transform",{"rotate-180":a.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...c[2]||(c[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),a.value?(m(),d("div",De,[o.value.size>0?(m(),d("div",je,[(m(!0),d(H,null,U(o.value,([n,h])=>(m(),d("div",{key:n,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[s("span",{class:k(["w-2 h-2 rounded-full",S(h.status)])},null,2),s("span",Ie,$(h.label),1),s("span",Re,$(u(h.status)),1),h.status==="error"?(m(),d("button",{key:0,onClick:_=>b(n),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,Te)):C("",!0)]))),128))])):(m(),d("div",Ee," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):C("",!0),s("div",He,[(m(!0),d(H,null,U(o.value,([n,h])=>(m(),d("iframe",{key:n,src:h.iframeSrc,onLoad:_=>g(n),onError:_=>v(n),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Ue))),128))])]))}}),Ae={class:"program-output"},Be={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},We={class:"text-xs text-r58-text-secondary"},Fe={class:"hidden"},Ge=["src"],Ne=j({__name:"ProgramOutput",setup(f){const t=T(),o=w(!1),a=w("idle"),r=w("");function e(){return`${window.location.origin}/api/v1/whip/program/whip`}function g(){o.value||(a.value="connecting",r.value=ne(e()),o.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function v(){o.value&&(o.value=!1,r.value="",a.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function b(){o.value&&(a.value="live",console.log("[ProgramOutput] WHIP push connected"))}function S(){a.value="error",console.error("[ProgramOutput] WHIP push failed")}z(()=>t.isLive,c=>{c?g():v()});function u(){switch(a.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function i(){switch(a.value){case"live":return"Program live on MediaMTX";case"connecting":return"Connecting...";case"error":return"Output failed";default:return"Program output off"}}return(c,n)=>(m(),d("div",Ae,[s("div",Be,[s("span",{class:k(["w-2 h-2 rounded-full",u()])},null,2),n[2]||(n[2]=s("span",{class:"text-sm"},"Program Output",-1)),s("span",We,$(i()),1),y(t).isLive?C("",!0):(m(),d("button",{key:0,onClick:n[0]||(n[0]=h=>o.value?v():g()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"},$(o.value?"Stop":"Start"),1)),a.value==="error"?(m(),d("button",{key:1,onClick:n[1]||(n[1]=h=>g()),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ")):C("",!0)]),s("div",Fe,[o.value&&r.value?(m(),d("iframe",{key:0,src:r.value,onLoad:b,onError:S,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Ge)):C("",!0)])]))}}),qe={class:"h-full flex flex-col"},Xe={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},Ke={class:"flex items-center gap-4"},Je={class:"flex items-center gap-2"},Qe={key:0,class:"badge badge-danger"},Ye={class:"flex items-center gap-4"},Ze={class:"flex-1 flex overflow-hidden"},et={class:"flex-1 p-4"},tt={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},st={class:"mt-6 pt-4 border-t border-r58-bg-tertiary"},nt=j({__name:"MixerView",setup(f){const t=T(),{register:o}=te(),a=w(null),r=L(()=>t.isLive),e=[];X(()=>{for(let u=1;u<=9;u++){const i=o({key:String(u),description:`Switch to scene ${u}`,action:()=>g(u),context:"mixer"});e.push(i)}e.push(o({key:"t",description:"Cut to preview (transition)",action:()=>v(),context:"mixer"})),e.push(o({key:"a",description:"Auto-transition with fade",action:()=>b(),context:"mixer"})),e.push(o({key:"Tab",description:"Cycle through sources",action:()=>S(),context:"mixer"})),e.push(o({key:"g",description:"Toggle Go Live",action:()=>{t.toggleLive(),I.info(t.isLive?"Session started":"Session ended")},context:"mixer"}))}),K(()=>{e.forEach(u=>u())});function g(u){const i=`scene-${u}`;t.setScene(i),a.value&&a.value.sendCommand("changeScene",{scene:u}),I.info(`Scene ${u}`)}function v(){t.previewSource&&(t.setProgram(t.previewSource),I.info("Cut"))}function b(){t.previewSource&&(a.value&&a.value.sendCommand("transition",{type:"fade",duration:500}),t.setProgram(t.previewSource),I.info("Fade"))}function S(){const u=t.activeSources;if(u.length===0)return;const c=(u.findIndex(n=>n.id===t.previewSource)+1)%u.length;t.setPreview(u[c].id)}return(u,i)=>(m(),d("div",qe,[s("header",Xe,[s("div",Ke,[s("div",Je,[s("span",{class:k(["w-3 h-3 rounded-full",r.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),i[1]||(i[1]=s("span",{class:"text-xl font-semibold text-r58-mixer"},"Mixer",-1))]),r.value?(m(),d("span",Qe,"ON AIR")):C("",!0)]),s("div",Ye,[s("button",{class:"btn",onClick:i[0]||(i[0]=(...c)=>y(t).toggleLive&&y(t).toggleLive(...c))},$(r.value?"End Session":"Go Live"),1)])]),s("div",Ze,[s("div",et,[R(ue,{ref_key:"vdoEmbedRef",ref:a,profile:"director",class:"h-full"},null,512)]),s("aside",tt,[R(Oe),s("div",st,[i[2]||(i[2]=s("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Program Output",-1)),R(Ne)])])]),R(ze)]))}});export{nt as default};
