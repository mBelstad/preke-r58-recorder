import{r as v,G as ae,H as te,o as re,p as ke,I as Ie,l as $,J as ue,d as ne,K as oe,g as O,T as ve,w as ee,c,f as V,A as $e,e,q as K,B as se,t as x,L as Se,k as s,_ as ie,M as De,j as Y,F as Q,n as U,y as X,N as Re,s as A,u as he,a as Me,z as le,C as Le,O as Be,P as _e,Q as Ve,R as Ae,S as Ne,U as Ee,m as Fe,i as Te,V as ye,b as Ge,v as Ue,W as ze}from"./index-wGeF6xKQ.js";import{u as Oe,C as He,P as We,p as qe,M as Ke}from"./ModeLoadingScreen-DoTbhOnR.js";import{_ as xe}from"./InputPreview.vue_vue_type_script_setup_true_lang-EnX1rqmq.js";import"./AnimatedBackground-DLBv4-kD.js";function Qe(){const R=v(!1),C=v(!1);let n=null;const M=ae();te(()=>M.status,i=>{R.value=i==="recording"},{immediate:!0});function p(i){if(R.value)return i.preventDefault(),i.returnValue="Recording in progress. Are you sure you want to leave?",i.returnValue}re(()=>{window.addEventListener("beforeunload",p)}),ke(()=>{window.removeEventListener("beforeunload",p)}),Ie((i,g,b)=>{R.value?(n=()=>b(),C.value=!0,b(!1)):b()});function f(){C.value=!1,R.value=!1,M.stopRecording().finally(()=>{n&&(n(),n=null)})}function u(){C.value=!1,n=null}return{isGuardActive:R,showLeaveConfirmation:C,confirmLeave:f,cancelLeave:u}}const G=v(null),fe=v(!1),Ce=v(null),pe=v(null),Ze=10,me=2,Ye=25;function Je(){const R=$(()=>G.value?G.value.available_gb<me?"critical":G.value.available_gb<Ze?"warning":"ok":"unknown"),C=$(()=>G.value?G.value.available_gb>=me:!0),n=$(()=>{if(!G.value)return null;const i=G.value.available_gb*1024*1024*1024,g=Ye*1024*1024,b=i/g,r=Math.floor(b/3600),S=Math.floor(b%3600/60);return r>24?`${Math.floor(r/24)}d ${r%24}h`:r>0?`${r}h ${S}m`:`${S}m`}),M=$(()=>{switch(R.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),p=$(()=>G.value?R.value==="critical"?`Disk space critically low (${G.value.available_gb.toFixed(1)} GB). Cannot start recording.`:R.value==="warning"?`Low disk space (${G.value.available_gb.toFixed(1)} GB). Estimated recording time: ${n.value}`:null:null);async function f(){fe.value=!0,pe.value=null;try{const i=await ue.getDegradation();if(i.resources&&i.resources.disk_free_gb!==void 0){const g=i.resources.disk_free_gb,b=g*3;G.value={available_gb:g,total_gb:b,used_percent:100-g/b*100,recording_path:"/opt/r58-app/shared/recordings"}}return Ce.value=new Date,G.value}catch(i){return pe.value=i.message||"Failed to check disk space",console.error("Failed to check disk space:",i),null}finally{fe.value=!1}}async function u(){return await f(),G.value?R.value==="critical"?{ok:!1,message:`Insufficient disk space (${G.value.available_gb.toFixed(1)} GB). Need at least ${me} GB to start recording.`}:R.value==="warning"?{ok:!0,message:`Low disk space warning: ${G.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${n.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:G,isLoading:fe,lastCheck:Ce,error:pe,status:R,statusColor:M,canStartRecording:C,estimatedRecordingTime:n,warningMessage:p,checkDiskSpace:f,preflightCheck:u}}const W=v(localStorage.getItem("r58_audio_feedback")!=="false");let ge=null;function Xe(){return ge||(ge=new(window.AudioContext||window.webkitAudioContext)),ge}function H(R,C,n="sine",M=.3){if(W.value)try{const p=Xe();p.state==="suspended"&&p.resume();const f=p.createOscillator(),u=p.createGain();f.connect(u),u.connect(p.destination),f.type=n,f.frequency.value=R;const i=p.currentTime;u.gain.setValueAtTime(0,i),u.gain.linearRampToValueAtTime(M,i+.01),u.gain.linearRampToValueAtTime(0,i+C),f.start(i),f.stop(i+C)}catch(p){console.warn("Audio feedback failed:",p)}}function et(){W.value&&(H(440,.1,"sine",.2),setTimeout(()=>H(554,.1,"sine",.2),100),setTimeout(()=>H(659,.15,"sine",.25),200))}function tt(){W.value&&(H(880,.08,"sine",.3),setTimeout(()=>H(880,.15,"sine",.3),120))}function at(){W.value&&(H(659,.1,"sine",.25),setTimeout(()=>H(554,.1,"sine",.2),100),setTimeout(()=>H(440,.15,"sine",.2),200))}function nt(){W.value&&(H(200,.15,"square",.15),setTimeout(()=>H(180,.2,"square",.15),180))}function ot(){W.value&&(H(1e3,.08,"sine",.2),setTimeout(()=>H(1e3,.08,"sine",.2),150))}function we(){W.value&&H(1200,.03,"sine",.1)}function st(R=50){if(W.value&&"vibrate"in navigator)try{navigator.vibrate(R)}catch{}}function rt(){function R(n){W.value=n,localStorage.setItem("r58_audio_feedback",String(n))}function C(){R(!W.value),W.value&&we()}return{enabled:W,setEnabled:R,toggle:C,playSuccess:et,playError:nt,playWarning:ot,playClick:we,playRecordStart:tt,playRecordStop:at,vibrate:st}}const lt={class:"bg-preke-bg-elevated rounded-lg shadow-xl max-w-md w-full p-6"},it=["placeholder"],ct={class:"text-xs text-preke-text-dim mt-2"},dt=ne({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(R,{emit:C}){const n=R,M=C,p=v(""),f=v(null),u=$(()=>{const l=new Date,_=l.toLocaleDateString("en-CA"),d=l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${_}_${d}`}),i=$(()=>n.suggestedName||u.value);te(()=>n.open,l=>{l&&(p.value=i.value,setTimeout(()=>{var _,d;(_=f.value)==null||_.focus(),(d=f.value)==null||d.select()},100))});function g(){M("confirm",p.value.trim()||i.value)}function b(){M("skip")}function r(){M("cancel")}function S(l){l.key==="Enter"?g():l.key==="Escape"&&r()}return(l,_)=>(s(),oe(Se,{to:"body"},[O(ve,{name:"fade"},{default:ee(()=>[R.open?(s(),c("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:$e(r,["self"]),onKeydown:S},[e("div",lt,[_[1]||(_[1]=e("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),_[2]||(_[2]=e("p",{class:"text-preke-text-dim text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),K(e("input",{ref_key:"inputRef",ref:f,"onUpdate:modelValue":_[0]||(_[0]=d=>p.value=d),type:"text",placeholder:i.value,class:"w-full px-4 py-2 bg-preke-bg-surface border border-preke-bg-surface rounded-lg text-preke-text placeholder-preke-text-dim focus:outline-none focus:ring-2 focus:ring-preke-gold"},null,8,it),[[se,p.value]]),e("p",ct," Suggested: "+x(i.value),1),e("div",{class:"flex justify-between mt-6"},[e("button",{onClick:b,class:"text-sm text-preke-text-dim hover:text-preke-text transition-colors"}," Skip (use default) "),e("div",{class:"flex gap-3"},[e("button",{onClick:r,class:"btn"}," Cancel "),e("button",{onClick:g,class:"btn btn-primary"}," Start Recording ")])])])],32)):V("",!0)]),_:1})]))}}),ut=ie(dt,[["__scopeId","data-v-2eeca4e8"]]),vt={class:"recorder-controls"},ft={key:0,class:"recorder-controls__duration"},pt=["disabled","title"],mt={key:0,class:"recorder-controls__spinner"},gt={key:0,class:"recorder-controls__icon recorder-controls__icon--stop"},bt={key:1,class:"recorder-controls__icon recorder-controls__icon--record"},_t={class:"recorder-controls__hint"},kt=ne({__name:"RecorderControls",setup(R){const C=ae(),{register:n}=De(),{preflightCheck:M,status:p,canStartRecording:f}=Je(),{playRecordStart:u,playRecordStop:i,playError:g,playWarning:b,vibrate:r}=rt(),S=v(null),l=v(!1),_=v(!1),d=v(!1),w=v(!1),I=v(void 0),h=$(()=>C.status==="recording"),E=$(()=>C.status==="starting"),F=$(()=>C.status==="stopping"),Z=$(()=>C.formattedDuration),m=$(()=>E.value||F.value||_.value),B=$(()=>E.value?"Starting recording...":F.value?"Stopping recording...":_.value?"Checking disk space...":!h.value&&!f.value?"Insufficient disk space":"");let T=null;re(()=>{T=n({key:" ",description:"Toggle Recording",action:z,context:"recorder",enabled:()=>!E.value&&!F.value})}),ke(()=>{T&&T()});async function z(){h.value?j():await q()}async function q(o){_.value=!0;try{const D=await M();if(!D.ok){g(),r(200),Y.error("Cannot start recording",D.message||"Preflight check failed");return}if(D.message&&p.value==="warning"&&(b(),Y.warning("Low disk space",D.message)),w.value&&!o){I.value=void 0,d.value=!0;return}await J(o||I.value)}finally{_.value=!1}}async function J(o){try{await C.startRecording(o);const D=o||C.sessionId;u(),r([50,30,50]),Y.success("Recording started",`Session: ${D}`)}catch(D){g(),r(200),Y.error("Failed to start recording",D.message||"Unknown error",{label:"Retry",onClick:()=>q(o)})}}function L(o){d.value=!1,I.value=o,q(o)}function y(){d.value=!1,I.value=void 0,q()}function a(){d.value=!1,_.value=!1}async function t(){try{await C.stopRecording(),i(),r(100),Y.success("Recording stopped")}catch(o){g(),r(200),Y.error("Failed to stop recording",o.message||"Unknown error")}}function j(){var o;l.value=!1,(o=S.value)==null||o.open(),setTimeout(()=>{l.value=!0},500)}function P(){l.value&&t()}async function k(){h.value?j():await J()}return(o,D)=>(s(),c(Q,null,[e("div",vt,[h.value?(s(),c("div",ft,x(Z.value),1)):V("",!0),e("button",{onClick:k,disabled:m.value,class:U(["recorder-controls__btn",h.value?"recorder-controls__btn--stop":"recorder-controls__btn--start"]),title:B.value||(h.value?"Stop Recording (Space)":"Start Recording (Space)")},[E.value||F.value||_.value?(s(),c("span",mt)):(s(),c(Q,{key:1},[h.value?(s(),c("span",gt)):(s(),c("span",bt))],64)),e("span",null,x(_.value?"Checking...":h.value?"Stop":"Start Recording"),1)],10,pt),e("span",_t,[D[0]||(D[0]=X(" Press ",-1)),D[1]||(D[1]=e("kbd",null,"Space",-1)),X(" to "+x(h.value?"stop":"start"),1)])]),O(Re,{ref_key:"stopConfirmDialog",ref:S,title:"Stop Recording?",message:`You have been recording for ${Z.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:P},null,8,["message"]),O(ut,{open:d.value,onConfirm:L,onSkip:y,onCancel:a},null,8,["open"])],64))}}),ht=ie(kt,[["__scopeId","data-v-1e32920d"]]),de=v(localStorage.getItem("r58_performance_mode")==="true"),be=v(localStorage.getItem("r58_performance_mode_auto")!=="false"),yt=3,xt=100,Ct=500;function wt(){const R=ae(),C=$(()=>de.value?!0:be.value&&R.isRecording?R.inputs.filter(S=>S.isRecording).length>=yt:!1),n=$(()=>C.value?Ct:xt);te(C,r=>{r?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function M(r){de.value=r,localStorage.setItem("r58_performance_mode",String(r))}function p(r){be.value=r,localStorage.setItem("r58_performance_mode_auto",String(r))}function f(){M(!de.value)}function u(r,S){let l=0,_=null;return(...d)=>{const w=Date.now(),I=S??n.value,h=w-l;h>=I?(l=w,r(...d)):_||(_=window.setTimeout(()=>{l=Date.now(),_=null,r(...d)},I-h))}}function i(r,S){let l=null;return(..._)=>{l&&clearTimeout(l),l=window.setTimeout(()=>{r(..._),l=null},S??n.value)}}function g(r){return C.value?window.setTimeout(()=>r(performance.now()),n.value):requestAnimationFrame(r)}function b(r){C.value?clearTimeout(r):cancelAnimationFrame(r)}return{enabled:de,autoEnable:be,isActive:C,updateInterval:n,setEnabled:M,setAutoEnable:p,toggle:f,throttle:u,debounce:i,requestFrame:g,cancelFrame:b}}const $t=["title"],St={class:"flex items-center gap-1.5 text-sm"},Rt={key:0,class:"flex items-center gap-1.5 text-sm"},Mt={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},Bt={class:"font-mono"},Tt=ne({__name:"RecordingHealth",setup(R,{expose:C}){const n=ae(),{isActive:M}=wt(),p=v({}),f=v(0),u=v(0),i=v(0);let g=null;function b(){const d={};let w=0;n.inputs.forEach(h=>{d[h.id]=h.bytesWritten;const E=p.value[h.id]||0;w+=h.bytesWritten-E});const I=M.value?2:1;f.value=Math.round(w/(1024*1024)/I*10)/10,p.value=d}te(()=>n.isRecording,d=>{if(d){p.value={},f.value=0,u.value=0,i.value=0;const w=M.value?2e3:1e3;g=window.setInterval(b,w)}else g&&(clearInterval(g),g=null)},{immediate:!0}),te(M,d=>{if(n.isRecording&&g){clearInterval(g);const w=d?2e3:1e3;g=window.setInterval(b,w)}}),ke(()=>{g&&clearInterval(g)});const r=$(()=>n.isRecording?i.value>0||u.value>90?"critical":f.value<1||u.value>70?"warning":"healthy":"idle"),S=$(()=>{switch(r.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});$(()=>{switch(r.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const l=$(()=>{if(!n.isRecording)return"Not recording";const d=[`Write speed: ${f.value} MB/s`,`Buffer: ${u.value}%`];return i.value>0&&d.push(`Frames dropped: ${i.value}`),d.join(`
`)});function _(d){d.buffer_percent!==void 0&&(u.value=d.buffer_percent),d.frames_dropped!==void 0&&(i.value=d.frames_dropped)}return C({updateFromMetrics:_}),(d,w)=>A(n).isRecording?(s(),c("div",{key:0,class:U(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":S.value==="emerald","bg-amber-500/10":S.value==="amber","bg-red-500/10":S.value==="red"}]),title:l.value},[e("span",{class:U(["w-2 h-2 rounded-full",S.value==="emerald"?"bg-emerald-500":"",S.value==="amber"?"bg-amber-500 animate-pulse":"",S.value==="red"?"bg-red-500 animate-pulse":""])},null,2),e("div",St,[w[0]||(w[0]=e("svg",{class:"w-3.5 h-3.5 text-preke-text-dim",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),e("span",{class:U(["font-mono",S.value==="emerald"?"text-emerald-400":"",S.value==="amber"?"text-amber-400":"",S.value==="red"?"text-red-400":""])},x(f.value)+" MB/s ",3)]),u.value>0?(s(),c("div",Rt,[w[1]||(w[1]=e("span",{class:"text-preke-text-dim"},"Buf:",-1)),e("span",{class:U(["font-mono",u.value<50?"text-emerald-400":"",u.value>=50&&u.value<80?"text-amber-400":"",u.value>=80?"text-red-400":""])},x(u.value)+"% ",3)])):V("",!0),i.value>0?(s(),c("div",Mt,[w[2]||(w[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",Bt,x(i.value)+" dropped",1)])):V("",!0)],10,$t)):V("",!0)}}),Pt={key:0,class:"h-full flex items-center justify-center"},jt={key:1,class:"input-grid"},It={key:0,class:"input-grid__warning"},Dt=["data-count"],Lt=["title","onClick"],Vt={key:1,class:"w-full h-full flex items-center justify-center bg-preke-bg-surface"},At={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},Nt={class:"flex items-center justify-between"},Et={class:"flex items-center gap-2"},Ft={class:"font-medium"},Gt={key:0,class:"flex items-center gap-2 text-sm"},Ut={class:"text-preke-text-dim"},zt={class:"enlarged-modal__info"},Ot={class:"flex items-center gap-3"},Ht={class:"font-semibold text-lg"},Wt={key:0,class:"px-2 py-0.5 text-xs font-bold bg-preke-red/20 text-preke-red rounded"},qt={class:"flex items-center gap-4 text-sm"},Kt={class:"text-preke-text-dim"},Qt=ne({__name:"InputGrid",emits:["allVideosReady"],setup(R,{emit:C}){const n=ae(),M=he(),p=C,f=v(new Set),u=v(null);function i(m){u.value=m}function g(){u.value=null}const b=v({});function r(m){f.value.add(m),console.log(`[InputGrid] Video ready: ${m} (${f.value.size}/${d.value.length})`),f.value.size>=d.value.length&&(console.log("[InputGrid] All videos ready!"),p("allVideosReady"))}function S(m,B){b.value[m]=B,console.log(`[InputGrid] Aspect ratio for ${m}: ${B.toFixed(3)}`)}function l(m){return{aspectRatio:`${b.value[m]||1.7777777777777777}`}}te(()=>d.value.length,()=>{f.value.clear()});const _=$(()=>{var m;return((m=M.capabilities)==null?void 0:m.current_mode)==="recorder"}),d=$(()=>n.inputs.filter(m=>m.hasSignal)),w=$(()=>n.framerateMismatch);function I(m){return m.isRecording?"border-preke-red ring-2 ring-preke-red/20":m.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-preke-bg-surface/50 opacity-60"}function h(m){return m.hasSignal?m.framerate>=29?"excellent":m.framerate>=24?"good":"unstable":"none"}function E(m){switch(h(m)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-preke-text-dim"}}function F(m){if(m===0)return"0 B";const B=1024,T=["B","KB","MB","GB"],z=Math.floor(Math.log(m)/Math.log(B));return parseFloat((m/Math.pow(B,z)).toFixed(1))+" "+T[z]}function Z(m){if(!m.hasSignal)return`${m.label}: No signal detected`;const B=[`${m.label}`,`Resolution: ${m.resolution}`,`Framerate: ${m.framerate} fps`,`Quality: ${h(m)}`];return m.isRecording&&B.push(`Written: ${F(m.bytesWritten)}`),B.join(`
`)}return(m,B)=>d.value.length===0?(s(),c("div",Pt,[...B[1]||(B[1]=[Me('<div class="text-center text-preke-text-dim" data-v-53f60619><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-53f60619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" data-v-53f60619></path></svg><p class="text-lg font-medium" data-v-53f60619>No Video Sources Connected</p><p class="text-sm mt-2" data-v-53f60619>Connect HDMI cables to begin recording</p></div>',1)])])):(s(),c("div",jt,[w.value?(s(),c("div",It,[B[2]||(B[2]=e("svg",{class:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,x(w.value),1)])):V("",!0),e("div",{class:"input-grid__container","data-count":d.value.length},[(s(!0),c(Q,null,le(d.value,T=>(s(),c("div",{key:T.id,class:U(["input-grid__tile",I(T)]),style:Le(l(T.id)),title:Z(T),onClick:z=>i(T)},[_.value?(s(),oe(xe,{key:0,"input-id":T.id,class:"w-full h-full",onVideoReady:z=>r(T.id),onAspectRatio:z=>S(T.id,z)},null,8,["input-id","onVideoReady","onAspectRatio"])):(s(),c("div",Vt,[...B[3]||(B[3]=[e("div",{class:"text-center"},[e("svg",{class:"w-8 h-8 mx-auto mb-2 text-preke-text-dim/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})]),e("span",{class:"text-xs text-preke-text-dim/70"},"Mixer mode")],-1)])])),e("div",At,[e("div",Nt,[e("div",Et,[e("span",{class:U(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":h(T)==="excellent"||h(T)==="good","bg-amber-500 animate-pulse":h(T)==="unstable","bg-preke-text-dim":h(T)==="none"}])},null,2),e("span",Ft,x(T.label),1)]),T.hasSignal?(s(),c("div",Gt,[e("span",Ut,x(T.resolution),1),e("span",{class:U(E(T))},x(T.framerate)+"fps",3)])):V("",!0)])])],14,Lt))),128))],8,Dt),(s(),oe(Se,{to:"body"},[O(ve,{name:"enlarged"},{default:ee(()=>[u.value?(s(),c("div",{key:0,class:"enlarged-modal",onClick:g},[e("div",{class:"enlarged-modal__content",onClick:B[0]||(B[0]=$e(()=>{},["stop"]))},[_.value?(s(),oe(xe,{key:0,"input-id":u.value.id,class:"w-full h-full"},null,8,["input-id"])):V("",!0),e("div",zt,[e("div",Ot,[e("span",{class:U(["w-2.5 h-2.5 rounded-full",{"bg-emerald-500":h(u.value)==="excellent"||h(u.value)==="good","bg-amber-500 animate-pulse":h(u.value)==="unstable","bg-preke-text-dim":h(u.value)==="none"}])},null,2),e("span",Ht,x(u.value.label),1),u.value.isRecording?(s(),c("span",Wt," REC ")):V("",!0)]),e("div",qt,[e("span",Kt,x(u.value.resolution),1),e("span",{class:U(E(u.value))},x(u.value.framerate)+"fps",3)])]),e("button",{class:"enlarged-modal__close",onClick:g,title:"Close (or click outside)"},[...B[4]||(B[4]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):V("",!0)]),_:1})]))]))}}),Zt=ie(Qt,[["__scopeId","data-v-53f60619"]]),Yt={key:0,class:"py-8 text-center text-preke-text-muted"},Jt={key:1,class:"camera-setup"},Xt={class:"camera-list"},ea={class:"list-header"},ta=["disabled"],aa={key:0,class:"empty-state"},na={key:1,class:"camera-items"},oa={class:"camera-item__info"},sa={class:"camera-item__header"},ra={class:"camera-item__name"},la={class:"camera-item__details"},ia={class:"camera-item__type"},ca={class:"camera-item__ip"},da={class:"camera-item__actions"},ua=["onClick","disabled"],va={key:0,class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},fa={key:1,class:"spinner"},pa=["onClick","disabled"],ma=["onClick","disabled"],ga={key:0,class:"camera-form"},ba={class:"form-header"},_a={class:"form-title"},ka={class:"form-content"},ha={class:"form-group"},ya={class:"form-group"},xa=["value"],Ca={class:"form-group"},wa={class:"form-group"},$a=["placeholder"],Sa={class:"form-hint"},Ra={class:"form-group"},Ma={class:"form-checkbox"},Ba={class:"form-actions"},Ta={class:"flex items-center justify-between w-full"},Pa={key:0,class:"text-sm text-amber-400"},ja={key:1,class:"text-sm text-preke-text-muted"},Ia={class:"flex gap-3"},Da=["disabled"],La=ne({__name:"CameraSetupModal",emits:["close","updated"],setup(R,{expose:C,emit:n}){const M=n,p=v(null),f=Be(),u=v(!1),i=v(!1),g=v(null),b=v([]),r=v(null),S=[{value:"blackmagic",label:"Blackmagic Design Studio Camera 4K Pro"},{value:"obsbot_tail2",label:"OBSbot Tail 2"}],l=v({name:"",type:"blackmagic",ip:"",port:void 0,enabled:!0}),_={blackmagic:80,obsbot_tail2:52381},d=$(()=>r.value!==null),w=v(!1);async function I(){u.value=!0;try{const y=await ue.cameras.getConfig();b.value=y.cameras.map(a=>({name:a.name,type:a.type,ip:a.ip,port:a.port,enabled:a.enabled??!0})),w.value=!1}catch(y){console.error("[CameraSetup] Failed to load config:",y),f.error("Failed to load camera configuration")}finally{u.value=!1}}function h(){l.value={name:"",type:"blackmagic",ip:"",port:void 0,enabled:!0},r.value=null}function E(y){r.value=y,l.value={...b.value[y]}}function F(){h()}function Z(){h(),r.value=-1}async function m(y){confirm(`Delete camera "${b.value[y].name}"?`)&&(b.value.splice(y,1),w.value=!0,await q())}async function B(y){g.value=y.name;try{(await ue.cameras.getStatus(y.name)).connected?f.success(`${y.name} is connected!`):f.warning(`${y.name} is not connected`)}catch{try{const t=await fetch(`http://${y.ip}:${y.port||_[y.type]}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(3e3)});f.info(`${y.name}: IP ${y.ip} is reachable`)}catch{f.error(`${y.name}: Cannot reach ${y.ip}`)}}finally{g.value=null}}function T(){return l.value.name.trim()?l.value.ip.trim()?/^(\d{1,3}\.){3}\d{1,3}$/.test(l.value.ip)?b.value.findIndex((t,j)=>t.name===l.value.name&&j!==r.value)>=0?(f.error("Camera name already exists"),!1):!0:(f.error("Invalid IP address format"),!1):(f.error("Camera IP address is required"),!1):(f.error("Camera name is required"),!1)}function z(){T()&&(l.value.port||(l.value.port=_[l.value.type]),r.value===-1?b.value.push({...l.value}):r.value!==null&&r.value>=0&&(b.value[r.value]={...l.value}),w.value=!0,h())}async function q(){i.value=!0;try{await ue.cameras.updateConfig(b.value),f.success("Camera configuration saved!"),w.value=!1,M("updated")}catch(y){console.error("[CameraSetup] Failed to save config:",y),f.error("Failed to save configuration: "+(y.message||"Unknown error"))}finally{i.value=!1}}function J(){var y;(y=p.value)==null||y.open(),I()}function L(){var y;w.value&&!confirm("You have unsaved changes. Close anyway?")||((y=p.value)==null||y.close(),h(),w.value=!1,M("close"))}return C({open:J,close:L}),re(()=>{I()}),(y,a)=>(s(),oe(Ae,{ref_key:"modalRef",ref:p,title:"Camera Setup",size:"xl",onClose:L},{header:ee(()=>[...a[5]||(a[5]=[e("div",{class:"flex items-center justify-between w-full"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-preke-text"},"Camera Setup"),e("p",{class:"text-sm text-preke-text-muted mt-1"}," Configure external cameras for control ")])],-1)])]),footer:ee(()=>[e("div",Ta,[w.value?(s(),c("div",Pa," You have unsaved changes ")):(s(),c("div",ja,x(b.value.length)+" camera"+x(b.value.length!==1?"s":"")+" configured ",1)),e("div",Ia,[e("button",{onClick:L,class:"btn-secondary"}," Close "),e("button",{onClick:q,disabled:!w.value||i.value,class:"btn-primary"},x(i.value?"Saving...":"Save Configuration"),9,Da)])])]),default:ee(()=>[u.value?(s(),c("div",Yt," Loading camera configuration... ")):(s(),c("div",Jt,[e("div",Xt,[e("div",ea,[a[7]||(a[7]=e("h3",{class:"list-title"},"Configured Cameras",-1)),e("button",{onClick:Z,class:"btn-add",disabled:d.value},[...a[6]||(a[6]=[e("svg",{class:"btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),X(" Add Camera ",-1)])],8,ta)]),b.value.length===0&&!d.value?(s(),c("div",aa,[...a[8]||(a[8]=[e("svg",{class:"empty-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"empty-text"},"No cameras configured",-1),e("p",{class:"empty-hint"},'Click "Add Camera" to get started',-1)])])):(s(),c("div",na,[(s(!0),c(Q,null,le(b.value,(t,j)=>{var P;return s(),c("div",{key:j,class:U(["camera-item",{"camera-item--disabled":!t.enabled}])},[e("div",oa,[e("div",sa,[e("span",ra,x(t.name),1),e("span",{class:U(["camera-item__badge",t.enabled?"camera-item__badge--enabled":"camera-item__badge--disabled"])},x(t.enabled?"Enabled":"Disabled"),3)]),e("div",la,[e("span",ia,x(((P=S.find(k=>k.value===t.type))==null?void 0:P.label)||t.type),1),e("span",ca,x(t.ip)+":"+x(t.port||_[t.type]),1)])]),e("div",da,[e("button",{onClick:k=>B(t),disabled:g.value===t.name,class:"btn-test",title:"Test Connection"},[g.value!==t.name?(s(),c("svg",va,[...a[9]||(a[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])])):(s(),c("span",fa))],8,ua),e("button",{onClick:k=>E(j),disabled:d.value,class:"btn-edit",title:"Edit"},[...a[10]||(a[10]=[e("svg",{class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,pa),e("button",{onClick:k=>m(j),disabled:d.value,class:"btn-delete",title:"Delete"},[...a[11]||(a[11]=[e("svg",{class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ma)])],2)}),128))]))]),d.value?(s(),c("div",ga,[e("div",ba,[e("h3",_a,x(r.value===-1?"Add Camera":"Edit Camera"),1),e("button",{onClick:F,class:"btn-cancel-form"},"Cancel")]),e("div",ka,[e("div",ha,[a[12]||(a[12]=e("label",{class:"form-label"},"Camera Name *",-1)),K(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>l.value.name=t),type:"text",class:"form-input",placeholder:"e.g., BMD Cam 1"},null,512),[[se,l.value.name]])]),e("div",ya,[a[13]||(a[13]=e("label",{class:"form-label"},"Camera Type *",-1)),K(e("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.type=t),class:"form-input"},[(s(),c(Q,null,le(S,t=>e("option",{key:t.value,value:t.value},x(t.label),9,xa)),64))],512),[[_e,l.value.type]])]),e("div",Ca,[a[14]||(a[14]=e("label",{class:"form-label"},"IP Address *",-1)),K(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.ip=t),type:"text",class:"form-input",placeholder:"192.168.1.101"},null,512),[[se,l.value.ip]]),a[15]||(a[15]=e("p",{class:"form-hint"},"Camera's network IP address",-1))]),e("div",wa,[a[16]||(a[16]=e("label",{class:"form-label"},"Port",-1)),K(e("input",{"onUpdate:modelValue":a[3]||(a[3]=t=>l.value.port=t),type:"number",class:"form-input",placeholder:String(_[l.value.type])},null,8,$a),[[se,l.value.port,void 0,{number:!0}]]),e("p",Sa,"Default: "+x(_[l.value.type])+" for "+x(l.value.type),1)]),e("div",Ra,[e("label",Ma,[K(e("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>l.value.enabled=t),type:"checkbox",class:"checkbox"},null,512),[[Ve,l.value.enabled]]),a[17]||(a[17]=e("span",null,"Enabled",-1))]),a[18]||(a[18]=e("p",{class:"form-hint"},"Disable to keep configuration but not use the camera",-1))]),e("div",Ba,[e("button",{onClick:z,class:"btn-save-form"},x(r.value===-1?"Add Camera":"Update Camera"),1),e("button",{onClick:F,class:"btn-cancel-form"}," Cancel ")])])])):V("",!0)]))]),_:1},512))}}),Va=ie(La,[["__scopeId","data-v-d42e0adf"]]),Aa={class:"sidebar"},Na={class:"sidebar__card sidebar__card--header"},Ea={class:"connection-row"},Fa={class:"connection-status"},Ga={class:"connection-label"},Ua={key:0,class:"connection-latency"},za=["disabled"],Oa={class:"sidebar__card sidebar__card--recording"},Ha={class:"recording__duration"},Wa={class:"recording__meta"},qa={key:0,class:"sidebar__card sidebar__card--warning"},Ka={class:"warning__text"},Qa={key:1,class:"sidebar__card sidebar__card--davinci"},Za={class:"davinci__buttons"},Ya=["disabled"],Ja=["disabled"],Xa=["disabled"],en={class:"sidebar__card"},tn={key:0,class:"cameras"},an={class:"camera__header"},nn=["onClick","disabled"],on={key:1,class:"cameras-empty"},sn={key:0,class:"sidebar__card"},rn={key:1,class:"sidebar__card"},ln=ne({__name:"SessionInfoV2",setup(R){const C=Te(),n=ae(),M=he(),p=Be(),{state:f,latencyMs:u}=Ne(),{connectionMethod:i}=Ee(),g=$(()=>{const k=f.value==="connected",o=f.value==="connecting",D=f.value==="degraded";if(k){let N="";return i.value==="relay"?N="Relay":i.value==="p2p"?N="P2P":i.value==="local"&&(N="Local"),{status:"online",color:"green",label:N||"Connected",latency:u.value,pulse:!1}}return o?{status:"connecting",color:"amber",label:"Connecting...",latency:null,pulse:!0}:D?{status:"degraded",color:"amber",label:"Slow",latency:u.value,pulse:!1}:{status:"offline",color:"red",label:"Offline",latency:null,pulse:!0}}),b=$(()=>n.currentSession),r=$(()=>n.activeInputs),S=$(()=>n.isRecording),l=$(()=>n.inputs.filter(k=>k.isRecording)),_=v("");re(()=>{const o=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,".");_.value=`Session ${o}`});const{cameras:d,loadCameras:w}=Oe(),I=v(null),h=v(null),E=v(null),F=v(!1);re(async()=>{await w()});function Z(k){var o;I.value=k,(o=h.value)==null||o.open()}function m(){I.value=null}function B(){var k;(k=E.value)==null||k.open()}function T(){w()}const z=$(()=>{const k=M.capabilities;if(!k)return null;const o=k.storage_total_gb||1,D=k.storage_available_gb||0,N=o-D,ce=Math.round(N/o*100),Pe=(r.value.length||1)*8,je=D/Pe;return{freeGB:Math.round(D),totalGB:Math.round(o),percent:ce,hoursRemaining:Math.round(je*10)/10,isLow:ce>85,isCritical:ce>95}});function q(){C.push({name:"admin",query:{tab:"settings"}})}const J=$(()=>Fe()),L=v(!1),y=$(()=>{const k=b.value;return k!=null&&k.id?`Preke_${k.id}`:`Preke_${_.value.replace(/\s+/g,"_")}`}),a=window.electronAPI;async function t(){if(a!=null&&a.davinciOpenProject){L.value=!0,p.info("Opening DaVinci Resolve...");try{const k=await a.davinciOpenProject(y.value);k.success?p.success(`Opened project: ${k.projectName}`):p.error(k.error||"Failed to open DaVinci project")}catch(k){console.error("DaVinci error:",k),p.error("Failed to connect to DaVinci Resolve")}finally{L.value=!1}}}async function j(){if(a!=null&&a.davinciCreateMulticam){L.value=!0;try{a.davinciOpenProject&&await a.davinciOpenProject(y.value);const k=await a.davinciCreateMulticam({projectName:y.value,clipName:`Multicam_${_.value.replace(/\s+/g,"_")}`,syncMethod:"timecode"});k.success?p.success(`Created timeline: ${k.timelineName}`):p.error(k.error||"Failed to create multicam timeline")}catch(k){console.error("DaVinci error:",k),p.error("Failed to create multicam timeline")}finally{L.value=!1}}}async function P(){if(a!=null&&a.davinciRefreshClips){L.value=!0,p.info("Refreshing growing clips...");try{const k=await a.davinciRefreshClips();if(k.success){const o=k.clipsRefreshed||0;p.success(`Refreshed ${o} clip${o!==1?"s":""}`)}else p.error(k.error||"Failed to refresh clips")}catch(k){console.error("DaVinci refresh error:",k),p.error("Failed to refresh clips")}finally{L.value=!1}}}return(k,o)=>{var D;return s(),c("div",Aa,[e("div",Na,[e("div",Ea,[e("div",Fa,[e("span",{class:U(["connection-dot",[`connection-dot--${g.value.color}`,{"connection-dot--pulse":g.value.pulse}]])},null,2),e("span",Ga,x(g.value.label),1),g.value.latency?(s(),c("span",Ua,x(g.value.latency)+"ms ",1)):V("",!0)])]),o[3]||(o[3]=e("div",{class:"sidebar__divider"},null,-1)),o[4]||(o[4]=e("label",{class:"sidebar__label"},"Session Name",-1)),K(e("input",{"onUpdate:modelValue":o[0]||(o[0]=N=>_.value=N),type:"text",class:"sidebar__input",placeholder:"Session 06.01.2026",disabled:S.value},null,8,za),[[se,_.value]])]),S.value?(s(),c(Q,{key:0},[e("div",Oa,[o[5]||(o[5]=e("div",{class:"recording__header"},[e("span",{class:"recording__dot"}),e("span",{class:"recording__label"},"Recording")],-1)),e("div",Ha,x(A(n).formattedDuration),1),e("div",Wa,x(l.value.length)+" camera"+x(l.value.length!==1?"s":"")+" recording ",1)]),(D=z.value)!=null&&D.isLow?(s(),c("div",qa,[o[7]||(o[7]=e("span",{class:"warning__icon"},"⚠️",-1)),e("div",Ka,[o[6]||(o[6]=e("strong",null,"Low storage",-1)),e("span",null,x(z.value.freeGB)+" GB remaining",1)])])):V("",!0),J.value?(s(),c("div",Qa,[o[8]||(o[8]=Me('<div class="davinci__header" data-v-9c962cbb><svg class="davinci__icon" viewBox="0 0 24 24" fill="currentColor" data-v-9c962cbb><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" data-v-9c962cbb></path></svg><span class="davinci__label" data-v-9c962cbb>DaVinci Resolve</span></div><p class="davinci__hint" data-v-9c962cbb>Edit while recording (mount R58 recordings via SMB)</p>',2)),e("div",Za,[e("button",{onClick:t,disabled:L.value,class:"davinci__btn"},x(L.value?"Opening...":"Open Project"),9,Ya),e("button",{onClick:j,disabled:L.value,class:"davinci__btn davinci__btn--secondary"}," Create Multicam ",8,Ja),e("button",{onClick:P,disabled:L.value,class:"davinci__btn davinci__btn--secondary",title:"Refresh growing clips to update duration"},x(L.value?"Refreshing...":"Refresh Clips"),9,Xa)])])):V("",!0)],64)):(s(),c(Q,{key:1},[e("div",en,[e("div",{class:"sidebar__label"},[o[10]||(o[10]=X(" Camera Controls ",-1)),e("button",{onClick:B,class:"camera-setup-btn",title:"Setup Cameras"},[...o[9]||(o[9]=[e("svg",{class:"camera-setup-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])])]),A(d).length>0?(s(),c("div",tn,[(s(!0),c(Q,null,le(A(d),N=>(s(),c("div",{key:N.name,class:"camera"},[e("div",an,[X(x(N.name)+" ",1),e("span",{class:U(["camera__status",N.connected?"camera__status--connected":"camera__status--disconnected"])},x(N.connected?"●":"○"),3)]),e("button",{class:"camera__control-btn",onClick:ce=>Z(N.name),disabled:!N.connected},[...o[11]||(o[11]=[e("svg",{class:"camera__control-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),e("span",null,"Controls",-1)])],8,nn)]))),128))])):(s(),c("div",on,[o[12]||(o[12]=e("p",{class:"cameras-empty__text"},"No cameras configured",-1)),e("button",{onClick:B,class:"cameras-empty__btn"}," Setup Cameras ")]))]),O(He,{ref_key:"cameraModalRef",ref:h,"camera-name":I.value,onClose:m},null,8,["camera-name"]),O(Va,{ref_key:"cameraSetupModalRef",ref:E,onUpdated:T},null,512),F.value?(s(),c("div",sn,[O(We,{"camera-name":I.value,onClose:o[1]||(o[1]=N=>F.value=!1)},null,8,["camera-name"])])):(s(),c("div",rn,[o[14]||(o[14]=e("div",{class:"sidebar__label"},"PTZ Controller",-1)),e("button",{onClick:o[2]||(o[2]=N=>F.value=!0),class:"sidebar__btn",title:"Open PTZ Controller (Gamepad/Joystick)"},[...o[13]||(o[13]=[e("svg",{class:"sidebar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1),X(" Open PTZ Controller ",-1)])])])),e("div",{class:"sidebar__card"},[o[16]||(o[16]=e("div",{class:"sidebar__label"},"Quick Actions",-1)),e("button",{onClick:q,class:"sidebar__btn"},[...o[15]||(o[15]=[e("svg",{class:"sidebar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),X(" Configure Inputs ",-1)])])])],64))])}}}),cn=ie(ln,[["__scopeId","data-v-9c962cbb"]]),dn={class:"h-full flex flex-col"},un={class:"recorder-header"},vn={class:"recorder-header__left"},fn={class:"recorder-header__title"},pn={key:0,class:"recorder-header__badge"},mn={class:"flex-1 flex min-h-0 overflow-hidden"},gn={class:"flex-1 min-h-0 min-w-0 p-3 overflow-hidden"},bn={class:"w-72 flex-shrink-0 border-l border-preke-surface-border bg-preke-surface/80 backdrop-blur-lg p-4 overflow-y-auto"},_n={class:"mb-4"},kn={key:0,class:"mt-2 space-y-3 p-3 bg-preke-bg-base border border-preke-border rounded-lg"},hn=["value"],yn={key:0},xn=["value"],Cn=["value"],wn={key:1,class:"p-3 bg-preke-bg-elevated border border-preke-border-gold rounded"},$n={class:"flex gap-2"},Sn=["disabled"],Rn={key:2,class:"text-xs text-preke-text-muted"},Mn={class:"font-mono"},Bn=ne({__name:"RecorderView",setup(R){const C=Te(),n=ae(),M=he(),{showLeaveConfirmation:p,confirmLeave:f,cancelLeave:u}=Qe(),i=v(!1),g=v(!1),b=v(""),r=v(!1);function S(){C.push("/")}const l=$(()=>n.status==="recording"),_=$(()=>n.formattedDuration),d=v(!0),w=v(!1),I=v(!1),h=v("Starting recorder..."),E=v(void 0),F=v(void 0),Z=$(()=>w.value&&I.value);function m(){d.value=!1}async function B(){var t;if(!ye())return;await M.fetchCapabilities();const a=(t=M.capabilities)==null?void 0:t.current_mode;if(a&&a!=="recorder"){console.log("[Recorder] Not in recorder mode, switching...");try{(await fetch(await Ge("/api/mode/recorder"),{method:"POST"})).ok&&(await M.fetchCapabilities(),Y.success("Switched to Recorder mode"))}catch(j){console.warn("[Recorder] Failed to switch mode:",j)}}}async function T(){if(!ye()){h.value="No device configured";return}h.value="Finding best connection...";const a=await qe(t=>{h.value=t});F.value=a.method.toUpperCase(),h.value=`Connected via ${a.method.toUpperCase()}`}function z(){console.log("[Recorder] All videos ready!"),I.value=!0}async function q(){n.selectedClient?await n.loadProjects(n.selectedClient.id):n.projects=[],n.setProject(null)}async function J(a){const t=a.target.value;if(t==="new")g.value=!0;else if(t){const j=n.projects.find(P=>P.id===parseInt(t));n.setProject(j)}else n.setProject(null)}async function L(){if(!n.selectedClient||!b.value.trim()){Y.error("Please enter a project name");return}r.value=!0;try{const a=await n.createProject(n.selectedClient.id,b.value.trim(),n.recordingType||"podcast");await n.loadProjects(n.selectedClient.id),n.setProject(a),g.value=!1,b.value="",Y.success("Project created")}catch(a){Y.error(a.message||"Failed to create project")}finally{r.value=!1}}re(async()=>{const a=performance.now(),t=T();await Promise.all([t,B(),n.fetchInputs(),n.fetchStatus(),n.loadClients()]);const j=n.inputs.filter(P=>P.hasSignal).length;console.log(`[Recorder] Data loaded: ${n.inputs.length} inputs, ${j} with signal (${Math.round(performance.now()-a)}ms)`),w.value=!0,j===0&&(I.value=!0)});const y=v(null);return te(p,a=>{var t,j;a?(t=y.value)==null||t.open():(j=y.value)==null||j.close()}),(a,t)=>(s(),c(Q,null,[O(ve,{name:"fade"},{default:ee(()=>[d.value?(s(),oe(Ke,{key:0,mode:"recorder","content-ready":Z.value,"min-time":1500,"max-time":12e3,"show-cancel":!0,"status-text":h.value,progress:E.value,"connection-method":F.value,onReady:m,onCancel:S},null,8,["content-ready","status-text","progress","connection-method"])):V("",!0)]),_:1}),O(ve,{name:"content-fade"},{default:ee(()=>{var j;return[K(e("div",dn,[e("header",un,[e("div",vn,[e("div",fn,[e("span",{class:U(["recorder-header__indicator",{"recorder-header__indicator--active":l.value}])},null,2),t[6]||(t[6]=e("span",{class:"recorder-header__label"},"Recorder",-1))]),l.value?(s(),c("span",pn," REC ")):V("",!0),O(Tt)]),O(ht)]),e("div",mn,[e("div",gn,[O(Zt,{onAllVideosReady:z})]),e("aside",bn,[e("div",_n,[e("button",{onClick:t[0]||(t[0]=P=>i.value=!i.value),class:"w-full flex items-center justify-between p-3 bg-preke-bg-elevated border border-preke-border rounded-lg hover:border-preke-border-gold transition-colors"},[t[8]||(t[8]=e("span",{class:"text-sm font-medium text-preke-text-dim"},"Project (Optional)",-1)),(s(),c("svg",{class:U(["w-4 h-4 text-preke-text-muted transition-transform",{"rotate-180":i.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[7]||(t[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),i.value?(s(),c("div",kn,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Recording Type",-1)),K(e("select",{"onUpdate:modelValue":t[1]||(t[1]=P=>A(n).recordingType=P),onChange:t[2]||(t[2]=P=>A(n).setRecordingType(P.target.value)),class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[...t[9]||(t[9]=[e("option",{value:null},"Select type...",-1),e("option",{value:"podcast"},"Podcast",-1),e("option",{value:"recording"},"Talking Head",-1),e("option",{value:"course"},"Course",-1),e("option",{value:"webinar"},"Webinar",-1)])],544),[[_e,A(n).recordingType]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Client",-1)),K(e("select",{"onUpdate:modelValue":t[3]||(t[3]=P=>A(n).selectedClient=P),onChange:q,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[t[11]||(t[11]=e("option",{value:null},"Select client...",-1)),(s(!0),c(Q,null,le(A(n).clients,P=>(s(),c("option",{key:P.id,value:P},x(P.name),9,hn))),128))],544),[[_e,A(n).selectedClient]])]),A(n).selectedClient?(s(),c("div",yn,[t[15]||(t[15]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Project",-1)),e("select",{value:((j=A(n).selectedProject)==null?void 0:j.id)||"",onChange:J,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[t[13]||(t[13]=e("option",{value:""},"Select project...",-1)),(s(!0),c(Q,null,le(A(n).projects,P=>(s(),c("option",{key:P.id,value:P.id},x(P.name),9,Cn))),128)),t[14]||(t[14]=e("option",{value:"new"},"+ Create New Project",-1))],40,xn)])):V("",!0),g.value?(s(),c("div",wn,[t[16]||(t[16]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"New Project Name",-1)),K(e("input",{"onUpdate:modelValue":t[4]||(t[4]=P=>b.value=P),type:"text",placeholder:"Project name",class:"w-full px-3 py-2 bg-preke-bg-base border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold mb-2",onKeyup:ze(L,["enter"])},null,544),[[se,b.value]]),e("div",$n,[e("button",{onClick:L,disabled:r.value||!b.value.trim(),class:"flex-1 px-3 py-1.5 bg-preke-gold text-preke-bg-base rounded text-xs font-medium hover:bg-preke-gold-hover disabled:opacity-50 disabled:cursor-not-allowed"},x(r.value?"Creating...":"Create"),9,Sn),e("button",{onClick:t[5]||(t[5]=P=>{g.value=!1,b.value=""}),class:"flex-1 px-3 py-1.5 bg-preke-bg-base border border-preke-border rounded text-xs font-medium hover:bg-preke-bg-elevated"}," Cancel ")])])):V("",!0),A(n).selectedClient&&A(n).selectedProject?(s(),c("div",Rn,[e("span",Mn,x(A(n).recordingPath),1)])):V("",!0)])):V("",!0)]),O(cn)])]),O(Re,{ref_key:"leaveDialog",ref:y,title:"Recording in Progress",message:`You are currently recording (${_.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:A(f),onCancel:A(u)},null,8,["message","onConfirm","onCancel"])],512),[[Ue,!d.value]])]}),_:1})],64))}}),Ln=ie(Bn,[["__scopeId","data-v-b00d3d6c"]]);export{Ln as default};
