import{J as Ie,r as S,h as j,j as se,k as ie,d as J,K as re,B as oe,c as o,n as V,b as E,a as e,I as H,t as b,p as Q,o as s,_ as me,A as ge,F as B,q as G,w as ce,x as de,L as ye,y as Te,g as U,E as ue,G as Ce,M as he,H as Re,e as Ve,l as X,m as Ue,T as Pe}from"./index-Cg8QGdhC.js";import{g as He,b as Ae,a as ke,c as Be,d as Ne}from"./vdoninja-D8mLQF_b.js";import{M as Fe}from"./ModeLoadingScreen-CTl3phkA.js";const te=[{id:"youtube",name:"YouTube Live",icon:"‚ñ∂Ô∏è",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"üì∫",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"üìò",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"üîÑ",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"‚öôÔ∏è",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],ve=Ie("streaming",()=>{const l=S([]),g=S(!1),n=S(null),i=S({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),c=j(()=>l.value.find(r=>r.id===n.value)),f=j(()=>l.value.filter(r=>r.enabled)),x=j(()=>te),y=j(()=>{const r=window.location.hostname,D=r==="localhost"||r==="127.0.0.1"?"localhost":r.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${D}:1935/mixer_program`,rtsp:`rtsp://${D}:8554/mixer_program`,srt:`srt://${D}:8890?streamid=read:mixer_program`,hls:`https://${r}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function u(r,a){const D=te.find(C=>C.id===r);if(!D)throw new Error(`Unknown platform: ${r}`);const K={id:`dest-${Date.now()}`,platformId:r,name:a||D.name,streamKey:"",enabled:!1};return l.value.push(K),K}function M(r,a){const D=l.value.findIndex(K=>K.id===r);D!==-1&&(l.value[D]={...l.value[D],...a})}function I(r){const a=l.value.findIndex(D=>D.id===r);a!==-1&&l.value.splice(a,1),n.value===r&&(n.value=null)}function k(r){n.value=r}function w(r){i.value.enabled=r}function $(r){i.value={...i.value,...r}}function O(){g.value=!0}function _(){g.value=!1}function d(r){const a=te.find(D=>D.id===r.platformId);return a?r.platformId==="custom"?`${r.name}${r.streamKey}`:`${a.rtmpBaseUrl}${r.streamKey}`:""}function p(){const r=window.location.hostname;return`srt://${r==="localhost"||r==="127.0.0.1"?"localhost":r.replace("r58-api","r58-mediamtx")}:${i.value.port}?streamid=read:${i.value.streamId}`}function h(){try{const r=localStorage.getItem("r58-streaming-destinations");if(r){const a=JSON.parse(r);l.value=a.destinations||[],a.srtOutput&&(i.value={...i.value,...a.srtOutput})}}catch(r){console.warn("Failed to load saved streaming destinations:",r)}}function t(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:l.value,srtOutput:i.value}))}catch(r){console.warn("Failed to save streaming destinations:",r)}}return h(),{destinations:l,isStreaming:g,activeDestinationId:n,srtOutput:i,activeDestination:c,enabledDestinations:f,platforms:x,programOutputUrls:y,addDestination:u,updateDestination:M,removeDestination:I,setActiveDestination:k,toggleSrtOutput:w,updateSrtConfig:$,startStreaming:O,stopStreaming:_,buildRtmpUrl:d,getSrtOutputUrl:p,saveDestinations:t,loadSavedDestinations:h}}),ne=S(null),ae=S(!1),le=S(null);function we(){const l=window.location.hostname;return l==="localhost"||l==="127.0.0.1"||l==="0.0.0.0"||l.startsWith("192.168.")}function ze(){const l=navigator.userAgent.toLowerCase();return l.includes("linux")&&l.includes("aarch64")||l.includes("linux")&&l.includes("arm")}async function Ke(){try{const l=await fetch("/api/system/info");if(l.ok)return(await l.json()).hostname||null}catch{}return null}const Ge=["linaro-alip","preke-r58","r58-"];function We(l){if(!l)return!1;const g=l.toLowerCase();return Ge.some(n=>g.includes(n))}function Je(){const l=j(()=>ne.value!==null?ne.value:we()),g=j(()=>l.value),n=j(()=>l.value?"Local Device Mode":"Remote Mode");async function i(){if(!ae.value){if(!we()){ne.value=!1,ae.value=!0;return}if(ze()){ne.value=!0,ae.value=!0,console.log("[LocalDeviceMode] Detected ARM Linux - enabling Lite Mode");return}le.value=await Ke(),We(le.value)?(ne.value=!0,console.log(`[LocalDeviceMode] Detected R58 hostname: ${le.value} - enabling Lite Mode`)):(ne.value=!1,console.log("[LocalDeviceMode] localhost but not R58 - staying in Remote Mode")),ae.value=!0}}return se(()=>{i()}),{isOnDevice:l,isLiteMode:g,modeLabel:n,deviceHostname:le,detectionComplete:ae,detect:i}}const fe="vdo-debug",Ye=500,W=[];let xe=typeof localStorage<"u"&&localStorage.getItem(fe)==="true";function _e(l){xe=l,typeof localStorage<"u"&&(l?localStorage.setItem(fe,"true"):localStorage.removeItem(fe)),console.log(`[VDO.ninja Debug] ${l?"Enabled":"Disabled"}`)}function pe(l){if(W.push(l),W.length>Ye&&W.shift(),xe){const g=new Date(l.timestamp).toISOString().split("T")[1].slice(0,-1),n=l.direction==="outgoing"?"‚û°Ô∏è OUT":"‚¨ÖÔ∏è IN",i=l.direction==="outgoing"?"color: #3b82f6; font-weight: bold":"color: #22c55e; font-weight: bold";console.groupCollapsed(`%c[VDO.ninja ${n}] %c${l.type}`,i,"color: inherit"),console.log("Time:",g),l.target&&console.log("Target:",l.target),console.log("Data:",l.data),l.raw&&l.raw!==l.data&&console.log("Raw:",l.raw),console.groupEnd()}}function Me(){return[...W]}function qe(){W.length=0,console.log("[VDO.ninja Debug] Event history cleared")}function De(){const l={total:W.length,incoming:0,outgoing:0,byType:{},lastActivity:W.length>0?W[W.length-1].timestamp:null};for(const g of W)g.direction==="incoming"?l.incoming++:l.outgoing++,l.byType[g.type]=(l.byType[g.type]||0)+1;return l}typeof window<"u"&&(window.__VDO_DEBUG__={getHistory:Me,clearHistory:qe,getStats:De,enable:()=>_e(!0),disable:()=>_e(!1),isEnabled:()=>xe});function Xe(l){const g=S(!1),n=S(new Map),i=S(null),c=S(!1),f=S("disconnected"),x=S(null),y=He();function u(m,L,T,q){var P;if(!((P=l.value)!=null&&P.contentWindow)){console.warn("[VDO.ninja] Cannot send command - iframe not ready"),x.value="iframe not ready";return}const A={action:m};L&&(A.target=L),T!==void 0&&(A.value=T),q!==void 0&&(A.value2=q),pe({timestamp:Date.now(),direction:"outgoing",type:m,target:L,data:{action:m,target:L,value:T,value2:q},raw:A});try{l.value.contentWindow.postMessage(A,"*")}catch(F){console.error("[VDO.ninja] Failed to send command:",F),x.value=String(F)}}function M(m,L){var q;if(!((q=l.value)!=null&&q.contentWindow)){console.warn("[VDO.ninja] Cannot send DOM command - iframe not ready");return}const T={action:"",target:m,...L};pe({timestamp:Date.now(),direction:"outgoing",type:"dom-manipulation",target:m,data:L,raw:T});try{l.value.contentWindow.postMessage(T,"*")}catch(A){console.error("[VDO.ninja] Failed to send DOM command:",A)}}function I(m,L=1){u("addScene",m,L),i.value=L}function k(m,L=1){u("addScene",m,0)}function w(m){M(m,{replace:!0})}function $(m){M(m,{add:!0})}function O(m){M(m,{remove:!0})}function _(m,L){u("mic",m,!L);const T=n.value.get(m);T&&(T.muted=L)}function d(m){u("mic",m,"toggle");const L=n.value.get(m);L&&(L.muted=!L.muted)}function p(m,L){u("volume",m,Math.max(0,Math.min(200,L)))}function h(m){u("soloChat",m)}function t(m){u("soloChatBidirectional",m)}function r(m,L){u("sendChat",m,L)}function a(m,L){u("sendDirectorChat",m,L)}function D(m){u("hangup",m),n.value.delete(m)}function K(m){m?u("togglescreenshare",m):u("togglescreenshare")}function C(m,L){u("forward",m,L)}function v(m="guests"){u("getGuestList",void 0,void 0)}function R(){u("record",void 0,!0),c.value=!0}function z(){u("record",void 0,!1),c.value=!1}function N(m){u("layout",void 0,m)}function ee(m){m?u("reload",m):u("reload")}function Y(m,L){u("mixorder",m,L==="up"?-1:1)}function Z(m){u("camera",void 0,m)}function Le(m,L){u("camera",m,L)}function Ee(m,L=!1){L?u("zoom",void 0,m,"abs"):u("zoom",void 0,m)}function Oe(m){u("pan",void 0,m)}function je(m){u("tilt",void 0,m)}function be(m){const L=m.origin;if(!L.includes(y.split(":")[0])&&!L.includes("vdo.ninja")&&!L.includes("vdo.itagenten")&&!L.includes("localhost"))return;const T=m.data;if(!T||typeof T!="object")return;const q=T.type||T.action||"unknown",A=T.streamID||T.UUID||T.streamId;switch(pe({timestamp:Date.now(),direction:"incoming",type:q,target:A,data:T.data||T.value,raw:T}),q){case"director-ready":case"loaded":case"ready":case"started":g.value=!0,f.value="connected",x.value=null;break;case"new-guest":case"guest-connected":case"push":case"view":case"joined":{if(A){const P=T.data,F={id:A,label:(P==null?void 0:P.label)||T.label||A,type:(P==null?void 0:P.type)||"guest",hasVideo:(P==null?void 0:P.video)!==!1,hasAudio:(P==null?void 0:P.audio)!==!1,muted:!1,audioLevel:0};n.value.set(A,F)}break}case"guest-left":case"guest-disconnected":case"left":case"disconnect":A&&n.value.delete(A);break;case"audio-level":case"loudness":{if(A){const P=n.value.get(A);if(P){const F=T.data;P.audioLevel=(F==null?void 0:F.level)||T.value||0}}break}case"mute-state":case"muted":{if(A){const P=n.value.get(A);if(P){const F=T.data;P.muted=(F==null?void 0:F.muted)??T.value??!1}}break}case"scene-changed":case"scene":{const P=T.data,F=(P==null?void 0:P.scene)||T.value;i.value=typeof F=="number"?F:null;break}case"recording-started":c.value=!0;break;case"recording-stopped":c.value=!1;break;case"error":console.error("[VDO.ninja Error]",T.data),x.value=String(T.data);break}}return se(()=>{f.value="connecting",window.addEventListener("message",be),setTimeout(()=>{!g.value&&l.value&&(g.value=!0,f.value="connected")},5e3)}),ie(()=>{window.removeEventListener("message",be),f.value="disconnected"}),{isReady:g,sources:n,activeScene:i,isRecording:c,connectionState:f,lastError:x,addToScene:I,removeFromScene:k,setProgram:w,addSource:$,removeSource:O,setLayout:N,changeMixOrder:Y,setMute:_,toggleMute:d,setVolume:p,soloAudio:h,soloChatBidirectional:t,sendToGuest:r,sendDirectorMessage:a,kickGuest:D,toggleScreenShare:K,transferGuest:C,getGuestList:v,refreshSource:ee,setCamera:Z,setGuestCamera:Le,zoom:Ee,pan:Oe,tilt:je,startRecording:R,stopRecording:z,sendCommand:u,sendDomCommand:M,getEventHistory:Me,getEventStats:De}}const Qe={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10","data-testid":"vdo-loading"},Ze={class:"text-center"},et={class:"text-xs text-r58-text-secondary mt-2"},tt={key:1,class:"absolute bottom-4 left-4 right-4 bg-red-500/90 text-white px-4 py-2 rounded-lg text-sm z-20"},st=["src","title"],nt=J({__name:"VdoNinjaEmbed",props:{profile:{},sources:{},room:{},password:{}},setup(l,{expose:g}){const n=l,i=S(null),c=re(),f=Xe(i),{isReady:x,sources:y,addToScene:u,removeFromScene:M,setMute:I,toggleMute:k,setVolume:w,sendCommand:$,sendDomCommand:O,isRecording:_,connectionState:d,lastError:p,startRecording:h,stopRecording:t,kickGuest:r,toggleScreenShare:a,setLayout:D,setProgram:K,addSource:C,removeSource:v,getEventHistory:R,getEventStats:z}=f,N=j(()=>{const Y={};return n.sources&&(Y.source_ids=n.sources.join(",")),n.room&&(Y.room=n.room),n.password&&(Y.password=n.password),Ae(n.profile,Y)}),ee=j(()=>n.profile==="mixer");return oe(y,Y=>{c.updateSourcesFromVdo(Array.from(Y.values()))},{deep:!0}),g({isReady:x,isRecording:_,connectionState:d,lastError:p,addToScene:u,removeFromScene:M,setLayout:D,setProgram:K,addSource:C,removeSource:v,setMute:I,toggleMute:k,setVolume:w,startRecording:h,stopRecording:t,kickGuest:r,toggleScreenShare:a,sendCommand:$,sendDomCommand:O,getEventHistory:R,getEventStats:z}),(Y,Z)=>(s(),o("div",{class:V(["vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden",{"mixer-mode":ee.value}]),"data-testid":"vdo-embed-container"},[H(x)?E("",!0):(s(),o("div",Qe,[e("div",Ze,[Z[0]||(Z[0]=e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"},null,-1)),Z[1]||(Z[1]=e("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja...",-1)),e("p",et,b(ee.value?"Loading mixer controls...":"Local mixer on R58"),1)])])),H(p)?(s(),o("div",tt,[Z[2]||(Z[2]=e("strong",null,"Error:",-1)),Q(" "+b(H(p)),1)])):E("",!0),e("iframe",{ref_key:"iframeRef",ref:i,src:N.value,class:V(["w-full h-full border-0",{"opacity-0":!H(x)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:"","data-testid":"vdo-iframe",title:ee.value?"VDO.ninja Mixer":"VDO.ninja"},null,10,st)],2))}}),ot=me(nt,[["__scopeId","data-v-4a9e915e"]]),rt={class:"space-y-4","data-testid":"source-panel"},at={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide","data-testid":"sources-heading"},it={key:0,class:"ml-2 text-r58-accent-primary"},lt={key:0,class:"px-3 py-2 bg-amber-500/10 border border-amber-500/30 rounded-lg text-xs text-amber-400"},ct={key:1,class:"text-center py-6 text-r58-text-secondary"},dt={key:2,class:"space-y-2"},ut={class:"flex items-center gap-3 min-w-0"},mt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},gt={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vt={key:2,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},pt={key:3,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ft={class:"min-w-0"},xt={key:0,class:"flex items-center gap-1"},bt=["onDblclick"],yt={class:"text-xs text-r58-text-secondary"},ht={class:"flex items-center gap-2 flex-shrink-0"},kt={key:0,class:"w-12 h-1.5 bg-r58-bg-primary rounded-full overflow-hidden"},wt=["onClick","data-testid","title"],_t={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},St={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Se="preke-source-names",$t=J({__name:"SourcePanel",props:{vdoEmbed:{}},setup(l){function g(){try{const t=localStorage.getItem(Se);return t?JSON.parse(t):{}}catch{return{}}}function n(t,r){const a=g();a[t]=r,localStorage.setItem(Se,JSON.stringify(a))}const i=S(g()),c=S(null),f=S(""),x=l,y=re(),u=ge(),M=j(()=>y.sources.map(t=>{let r=t.label,a="VDO.ninja";const D=t.id.match(/cam(\d+)/i)||t.id.match(/hdmi[_-]?(\d+)/i);return D?(r=`HDMI ${parseInt(D[1])+1}`,a="Connected to device"):t.type==="guest"?(a="Remote guest",(!t.label||t.label.length>20||t.label.match(/^[a-z0-9]{8,}$/i))&&(r="Guest")):t.type==="screen"&&(a="Screen share"),{...t,label:r,subtitle:a}})),I={cam0:{name:"HDMI 1",subtitle:"Connected to device"},cam1:{name:"HDMI 2",subtitle:"Connected to device"},cam2:{name:"HDMI 3",subtitle:"Connected to device"},cam3:{name:"HDMI 4",subtitle:"Connected to device"}},k=j(()=>u.inputs.filter(t=>t.hasSignal).map(t=>{const r=I[t.id]||{name:t.label,subtitle:"HDMI Input"};return{id:t.id,label:r.name,subtitle:r.subtitle,type:"camera",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0}})),w=j(()=>M.value.length>0?M.value:k.value),$=j(()=>M.value.length===0&&k.value.length>0);function O(t){x.vdoEmbed&&x.vdoEmbed.toggleMute(t.id),y.setSourceMute(t.id,!t.muted)}function _(t){return i.value[t.id]||t.label}function d(t){c.value=t.id,f.value=i.value[t.id]||t.label}function p(){c.value&&f.value.trim()&&(n(c.value,f.value.trim()),i.value=g()),c.value=null}function h(){c.value=null,f.value=""}return(t,r)=>(s(),o("div",rt,[e("h3",at,[r[1]||(r[1]=Q(" Sources ",-1)),w.value.length>0?(s(),o("span",it,"("+b(w.value.length)+")",1)):E("",!0)]),$.value?(s(),o("div",lt," Showing HDMI cameras. VDO.ninja sources will appear when guests join. ")):E("",!0),w.value.length===0?(s(),o("div",ct,[...r[2]||(r[2]=[e("svg",{class:"w-8 h-8 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"text-sm"},"No sources connected",-1),e("p",{class:"text-xs mt-1 opacity-75"},"Connect HDMI sources or have guests join",-1)])])):(s(),o("div",dt,[(s(!0),o(B,null,G(w.value,a=>(s(),o("div",{key:a.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary hover:bg-r58-bg-tertiary/80 transition-colors"},[e("div",ut,[e("div",{class:V(["w-8 h-8 rounded bg-r58-bg-primary flex items-center justify-center flex-shrink-0",{"ring-2 ring-r58-accent-primary":H(y).programSource===a.id}])},[a.type==="camera"?(s(),o("svg",mt,[...r[3]||(r[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):a.type==="guest"?(s(),o("svg",gt,[...r[4]||(r[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):a.type==="screen"?(s(),o("svg",vt,[...r[5]||(r[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])])):(s(),o("svg",pt,[...r[6]||(r[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"},null,-1)])]))],2),e("div",ft,[c.value===a.id?(s(),o("div",xt,[ce(e("input",{"onUpdate:modelValue":r[0]||(r[0]=D=>f.value=D),onKeyup:[ye(p,["enter"]),ye(h,["escape"])],onBlur:p,class:"input text-sm py-0.5 px-1 w-24",autofocus:""},null,544),[[de,f.value]])])):(s(),o("p",{key:1,onDblclick:D=>d(a),class:"font-medium text-sm truncate cursor-pointer hover:text-r58-accent-primary",title:"Double-click to rename"},b(_(a)),41,bt)),e("p",yt,b(a.subtitle||a.type),1)])]),e("div",ht,[a.hasAudio?(s(),o("div",kt,[e("div",{class:V(["h-full rounded-full transition-all duration-100",a.muted?"bg-r58-accent-danger":"bg-r58-accent-success"]),style:Te({width:`${a.audioLevel||0}%`})},null,6)])):E("",!0),a.hasAudio?(s(),o("button",{key:1,onClick:D=>O(a),class:V(["p-1.5 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":a.muted}]),"data-testid":`mute-button-${a.id}`,title:a.muted?"Unmute "+a.label:"Mute "+a.label},[a.muted?(s(),o("svg",_t,[...r[7]||(r[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(s(),o("svg",St,[...r[8]||(r[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,wt)):E("",!0)])]))),128))])),r[9]||(r[9]=e("p",{class:"text-xs text-r58-text-secondary text-center pt-2"}," Full guest/source management available in the mixer above ",-1))]))}}),Ct={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"camera-push-bar"},Rt={class:"flex items-center gap-2"},Mt={class:"text-r58-text-secondary"},Dt={key:0,class:"px-4 pb-3"},Lt={key:0,class:"flex gap-3 flex-wrap"},Et={class:"text-sm font-medium"},Ot={class:"text-xs text-r58-text-secondary"},jt=["onClick"],It={key:1,class:"text-sm text-r58-text-secondary py-2"},Tt={class:"hidden"},Vt=["src","onLoad","onError"],Ut=J({__name:"CameraPushBar",setup(l){const g=ge(),n=S(new Map),i=S(!0),c=j(()=>g.inputs.filter(k=>k.hasSignal));function f(k){return Be(k)}oe(c,k=>{for(const $ of k)if(!n.value.has($.id)){const O=f($.id),_=ke($.id,O,$.label);n.value.set($.id,{cameraId:$.id,label:$.label,status:"connecting",iframeSrc:_})}const w=new Set(k.map($=>$.id));for(const[$]of n.value)w.has($)||n.value.delete($)},{immediate:!0});function x(k){const w=n.value.get(k);w&&(w.status="connected",console.log(`[CameraPush] ${k} connected to VDO.ninja`))}function y(k){const w=n.value.get(k);w&&(w.status="error",console.error(`[CameraPush] ${k} failed to connect`))}function u(k){const w=g.inputs.find(_=>_.id===k);if(!w||!w.hasSignal)return;const $=f(k),O=ke(k,$,w.label);n.value.set(k,{cameraId:k,label:w.label,status:"connecting",iframeSrc:O+`&_t=${Date.now()}`})}function M(k){switch(k){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function I(k){switch(k){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(k,w)=>(s(),o("div",Ct,[e("button",{onClick:w[0]||(w[0]=$=>i.value=!i.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[e("div",Rt,[w[1]||(w[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",Mt,"("+b(c.value.length)+" active)",1)]),(s(),o("svg",{class:V(["w-4 h-4 transition-transform",{"rotate-180":i.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...w[2]||(w[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),i.value?(s(),o("div",Dt,[n.value.size>0?(s(),o("div",Lt,[(s(!0),o(B,null,G(n.value,([$,O])=>(s(),o("div",{key:$,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[e("span",{class:V(["w-2 h-2 rounded-full",M(O.status)])},null,2),e("span",Et,b(O.label),1),e("span",Ot,b(I(O.status)),1),O.status==="error"?(s(),o("button",{key:0,onClick:_=>u($),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,jt)):E("",!0)]))),128))])):(s(),o("div",It," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):E("",!0),e("div",Tt,[(s(!0),o(B,null,G(n.value,([$,O])=>(s(),o("iframe",{key:$,src:O.iframeSrc,onLoad:_=>x($),onError:_=>y($),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Vt))),128))])]))}}),Pt={class:"program-output space-y-3","data-testid":"program-output"},Ht={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg","data-testid":"program-output-status"},At={class:"text-sm font-medium","data-testid":"program-output-text"},Bt={key:0,class:"space-y-2"},Nt={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},Ft={class:"flex-1 text-xs truncate text-r58-text-secondary"},zt={key:0,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},Kt={class:"text-xs text-r58-text-secondary"},Gt={key:1,class:"text-xs text-r58-text-secondary px-3"},Wt={class:"hidden"},Jt=["src"],Yt=J({__name:"ProgramOutput",setup(l){const g=re(),n=ve(),i=S(!1),c=S("idle"),f=S("");function x(){return`${window.location.origin}/api/v1/whip/program/whip`}function y(){i.value||(c.value="connecting",f.value=Ne(x()),i.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function u(){i.value&&(i.value=!1,f.value="",c.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function M(){i.value&&(c.value="live",console.log("[ProgramOutput] WHIP push connected"))}function I(){c.value="error",console.error("[ProgramOutput] WHIP push failed")}function k(){u(),setTimeout(()=>y(),500)}oe(()=>g.isLive,_=>{_?y():u()});function w(){switch(c.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function $(){switch(c.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function O(){const _=n.programOutputUrls.srt;navigator.clipboard.writeText(_),U.success("SRT URL copied")}return(_,d)=>(s(),o("div",Pt,[e("div",Ht,[e("span",{class:V(["w-2 h-2 rounded-full",w()]),"data-testid":"program-output-indicator"},null,2),e("span",At,b($()),1),c.value==="error"?(s(),o("button",{key:0,onClick:d[0]||(d[0]=p=>k()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"}," Retry ")):E("",!0)]),c.value==="live"?(s(),o("div",Bt,[e("div",Nt,[d[1]||(d[1]=e("span",{class:"text-xs text-r58-text-secondary"},"üî¥ SRT:",-1)),e("code",Ft,b(H(n).programOutputUrls.srt),1),e("button",{onClick:O,class:"text-xs text-r58-accent-primary hover:underline"},"Copy")]),H(n).enabledDestinations.length>0?(s(),o("div",zt,[d[2]||(d[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",Kt,b(H(n).enabledDestinations.length)+" streaming destination"+b(H(n).enabledDestinations.length>1?"s":"")+" active ",1)])):E("",!0)])):E("",!0),c.value==="idle"?(s(),o("p",Gt," Program output will start automatically when you go live. ")):E("",!0),e("div",Wt,[i.value&&f.value?(s(),o("iframe",{key:0,src:f.value,onLoad:M,onError:I,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Jt)):E("",!0)])]))}}),qt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Xt={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},Qt={class:"p-6 overflow-y-auto max-h-[60vh]"},Zt={class:"mb-8"},es={class:"flex items-center justify-between mb-4"},ts={key:0,class:"mb-4 p-4 bg-r58-bg-tertiary rounded-lg"},ss={class:"grid grid-cols-2 gap-2"},ns=["onClick"],os={class:"text-xl"},rs={key:1,class:"space-y-3"},as=["onClick"],is={class:"text-xl"},ls={class:"flex-1"},cs={class:"font-medium"},ds={class:"text-xs text-r58-text-secondary"},us=["onClick"],ms=["onClick"],gs={key:2,class:"text-r58-text-secondary text-sm"},vs={key:0,class:"mb-8 p-4 bg-r58-bg-tertiary rounded-lg"},ps={class:"text-lg font-medium mb-4"},fs={class:"space-y-4"},xs=["placeholder"],bs={key:0},ys={class:"flex gap-2"},hs={class:"mb-8"},ks={class:"space-y-3"},ws={class:"p-3 bg-r58-bg-tertiary rounded-lg"},_s={class:"flex items-center justify-between mb-1"},Ss={class:"text-xs text-r58-text-secondary break-all"},$s={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Cs={class:"flex items-center justify-between mb-1"},Rs={class:"text-xs text-r58-text-secondary break-all"},Ms={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Ds={class:"flex items-center justify-between mb-1"},Ls={class:"text-xs text-r58-text-secondary break-all"},Es={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Os={class:"flex items-center justify-between mb-1"},js={class:"text-xs text-r58-text-secondary break-all"},Is={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Ts={class:"flex items-center justify-between mb-1"},Vs={class:"text-xs text-r58-text-secondary break-all"},Us={class:"p-4 bg-r58-bg-tertiary rounded-lg"},Ps={class:"flex items-center gap-3 mb-4"},Hs=J({__name:"StreamingSettings",setup(l,{expose:g}){const n=ve(),i=S(!1),c=S(null),f=S(!1);S(""),S("");const x=j(()=>n.destinations),y=j(()=>te),u=j(()=>n.programOutputUrls);function M(){i.value=!0}function I(){i.value=!1,c.value=null,f.value=!1}function k(h){const t=n.addDestination(h);c.value=t,f.value=!1,n.saveDestinations()}function w(){c.value&&(n.updateDestination(c.value.id,c.value),n.saveDestinations(),c.value=null,U.success("Streaming destination saved"))}function $(h){n.removeDestination(h),n.saveDestinations(),U.info("Destination removed")}function O(h){n.updateDestination(h.id,{enabled:!h.enabled}),n.saveDestinations()}function _(h,t){navigator.clipboard.writeText(h),U.success(`${t} copied to clipboard`)}function d(h){const t=te.find(r=>r.id===h);return(t==null?void 0:t.icon)||"üì°"}function p(h){const t=te.find(r=>r.id===h);return(t==null?void 0:t.name)||"Unknown"}return g({open:M}),(h,t)=>{var r;return s(),ue(Ce,{to:"body"},[i.value?(s(),o("div",qt,[e("div",{class:"absolute inset-0 bg-black/60",onClick:I}),e("div",Xt,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:I,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," √ó ")]),e("div",Qt,[e("section",Zt,[e("div",es,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[0]||(t[0]=a=>f.value=!f.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),f.value?(s(),o("div",ts,[t[13]||(t[13]=e("p",{class:"text-sm text-r58-text-secondary mb-3"},"Select a streaming platform:",-1)),e("div",ss,[(s(!0),o(B,null,G(y.value,a=>(s(),o("button",{key:a.id,onClick:D=>k(a.id),class:"flex items-center gap-2 p-3 bg-r58-bg-secondary hover:bg-r58-accent-primary/20 rounded-lg transition-colors text-left"},[e("span",os,b(a.icon),1),e("span",null,b(a.name),1)],8,ns))),128))])])):E("",!0),x.value.length>0?(s(),o("div",rs,[(s(!0),o(B,null,G(x.value,a=>(s(),o("div",{key:a.id,class:"flex items-center gap-3 p-3 bg-r58-bg-tertiary rounded-lg"},[e("button",{onClick:D=>O(a),class:V(["w-10 h-6 rounded-full transition-colors relative",a.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:V(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",a.enabled?"left-5":"left-1"])},null,2)],10,as),e("span",is,b(d(a.platformId)),1),e("div",ls,[e("div",cs,b(a.name),1),e("div",ds,b(a.streamKey?"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"+a.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:D=>c.value={...a},class:"text-r58-accent-primary hover:underline text-sm"}," Edit ",8,us),e("button",{onClick:D=>$(a.id),class:"text-r58-accent-danger hover:underline text-sm"}," Remove ",8,ms)]))),128))])):(s(),o("p",gs," No streaming destinations configured. Add a platform above. "))]),c.value?(s(),o("section",vs,[e("h3",ps," Edit "+b(p(c.value.platformId)),1),e("div",fs,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Display Name",-1)),ce(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>c.value.name=a),type:"text",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none"},null,512),[[de,c.value.name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Stream Key",-1)),ce(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>c.value.streamKey=a),type:"password",placeholder:(r=H(te).find(a=>a.id===c.value.platformId))==null?void 0:r.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,8,xs),[[de,c.value.streamKey]]),t[16]||(t[16]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),c.value.platformId==="custom"?(s(),o("div",bs,[t[17]||(t[17]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"RTMP URL",-1)),ce(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>c.value.name=a),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,512),[[de,c.value.name]])])):E("",!0),e("div",ys,[e("button",{onClick:w,class:"btn btn-primary"}," Save "),e("button",{onClick:t[4]||(t[4]=a=>c.value=null),class:"btn"}," Cancel ")])])])):E("",!0),e("section",hs,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[27]||(t[27]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",ks,[e("div",ws,[e("div",_s,[t[18]||(t[18]=e("span",{class:"font-medium"},"üî¥ SRT Output",-1)),e("button",{onClick:t[5]||(t[5]=a=>_(u.value.srt,"SRT URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Ss,b(u.value.srt),1),t[19]||(t[19]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",$s,[e("div",Cs,[t[20]||(t[20]=e("span",{class:"font-medium"},"üì∫ RTMP Output",-1)),e("button",{onClick:t[6]||(t[6]=a=>_(u.value.rtmp,"RTMP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Rs,b(u.value.rtmp),1)]),e("div",Ms,[e("div",Ds,[t[21]||(t[21]=e("span",{class:"font-medium"},"üé¨ RTSP Output",-1)),e("button",{onClick:t[7]||(t[7]=a=>_(u.value.rtsp,"RTSP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Ls,b(u.value.rtsp),1)]),e("div",Es,[e("div",Os,[t[22]||(t[22]=e("span",{class:"font-medium"},"üåê HLS Output",-1)),e("button",{onClick:t[8]||(t[8]=a=>_(u.value.hls,"HLS URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",js,b(u.value.hls),1),t[23]||(t[23]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",Is,[e("div",Ts,[t[24]||(t[24]=e("span",{class:"font-medium"},"‚ö° WebRTC (WHEP)",-1)),e("button",{onClick:t[9]||(t[9]=a=>_(u.value.whep,"WHEP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Vs,b(u.value.whep),1),t[25]||(t[25]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[30]||(t[30]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",Us,[e("div",Ps,[e("button",{onClick:t[10]||(t[10]=a=>H(n).toggleSrtOutput(!H(n).srtOutput.enabled)),class:V(["w-10 h-6 rounded-full transition-colors relative",H(n).srtOutput.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:V(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",H(n).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[28]||(t[28]=e("span",null,"Enable SRT Output",-1))]),t[29]||(t[29]=e("div",{class:"text-sm text-r58-text-secondary"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-r58-bg-tertiary"},[e("button",{onClick:I,class:"btn"},"Close")])])])):E("",!0)])}}}),As={class:"recording-controls space-y-3","data-testid":"recording-controls"},Bs={class:"flex items-center gap-3 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},Ns={class:"text-sm font-medium flex-1","data-testid":"recording-status"},Fs={key:0,class:"text-lg font-mono font-bold text-r58-accent-danger","data-testid":"recording-duration"},zs=["disabled"],Ks={key:0,class:"px-3 py-2 bg-r58-accent-success/10 border border-r58-accent-success/30 rounded-lg"},Gs={class:"flex items-center justify-between"},Ws=["href"],Js=J({__name:"RecordingControls",props:{vdoEmbed:{}},setup(l){const g=l,n=S(!1),i=S(null),c=S(0),f=S(null),x=S(!1);oe(()=>{var d,p;return(p=(d=g.vdoEmbed)==null?void 0:d.isRecording)==null?void 0:p.value},d=>{d!==void 0&&(n.value=d,d&&!i.value?i.value=Date.now():!d&&i.value&&(i.value=null))});let y=null;function u(){y&&clearInterval(y),y=window.setInterval(()=>{i.value&&(c.value=Date.now()-i.value)},100)}function M(){y&&(clearInterval(y),y=null)}se(()=>{u()}),ie(()=>{M()});const I=j(()=>{const d=Math.floor(c.value/1e3),p=Math.floor(d/3600),h=Math.floor(d%3600/60),t=d%60;return p>0?`${p}:${h.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`:`${h}:${t.toString().padStart(2,"0")}`});async function k(){if(!g.vdoEmbed){U.error("VDO.ninja not connected");return}x.value=!0;try{g.vdoEmbed.startRecording(),n.value=!0,i.value=Date.now(),c.value=0,f.value=null,U.success("Recording started")}catch(d){U.error("Failed to start recording"),console.error("[RecordingControls] Start recording error:",d)}finally{x.value=!1}}async function w(){if(!g.vdoEmbed){U.error("VDO.ninja not connected");return}x.value=!0;try{g.vdoEmbed.stopRecording(),n.value=!1,i.value=null,U.success(`Recording stopped (${I.value})`)}catch(d){U.error("Failed to stop recording"),console.error("[RecordingControls] Stop recording error:",d)}finally{x.value=!1}}function $(){n.value?w():k()}function O(){return n.value?"bg-r58-accent-danger animate-pulse":"bg-r58-bg-tertiary"}function _(){return x.value?"Processing...":n.value?`Recording ‚Ä¢ ${I.value}`:"Ready to record"}return(d,p)=>(s(),o("div",As,[e("div",Bs,[e("span",{class:V(["w-3 h-3 rounded-full",O()]),"data-testid":"recording-indicator"},null,2),e("span",Ns,b(_()),1),n.value?(s(),o("span",Fs,b(I.value),1)):E("",!0)]),e("div",null,[e("button",{onClick:$,disabled:x.value,class:V(["btn w-full justify-center",n.value?"btn-danger":"btn-primary"]),"data-testid":"recording-toggle-button"},[x.value?(s(),o(B,{key:0},[p[0]||(p[0]=e("svg",{class:"animate-spin w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)),p[1]||(p[1]=Q(" Processing... ",-1))],64)):n.value?(s(),o(B,{key:1},[p[2]||(p[2]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})],-1)),p[3]||(p[3]=Q(" Stop Recording ",-1))],64)):(s(),o(B,{key:2},[p[4]||(p[4]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"8"})],-1)),p[5]||(p[5]=Q(" Start Recording ",-1))],64))],10,zs)]),f.value?(s(),o("div",Ks,[e("div",Gs,[p[6]||(p[6]=e("span",{class:"text-sm text-r58-accent-success"},"Recording ready!",-1)),e("a",{href:f.value,download:"",class:"text-sm text-r58-accent-primary hover:underline"}," Download ",8,Ws)])])):E("",!0),p[7]||(p[7]=e("p",{class:"text-xs text-r58-text-secondary px-1"}," Records the mixed output locally in your browser. Recording is saved when stopped. ",-1))]))}}),Ys=me(Js,[["__scopeId","data-v-14707e66"]]),qs={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Xs={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-3xl max-h-[80vh] overflow-hidden shadow-2xl","data-testid":"hotkey-settings-modal"},Qs={class:"flex border-b border-r58-bg-tertiary"},Zs=["onClick"],en={class:"p-6 overflow-y-auto max-h-[55vh]"},tn={key:0,class:"text-center py-12 text-r58-text-secondary"},sn={key:1,class:"space-y-6"},nn={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},on={class:"space-y-2"},rn={class:"flex-1"},an={class:"text-sm"},ln={key:0,class:"ml-2 text-xs text-r58-accent-primary"},cn={class:"flex items-center gap-2"},dn={key:0,class:"flex items-center gap-2"},un={key:0,class:"px-3 py-1 bg-r58-accent-primary text-white rounded text-sm font-mono"},mn={key:1,class:"text-sm text-r58-text-secondary animate-pulse"},gn={class:"px-3 py-1 bg-r58-bg-secondary border border-r58-bg-tertiary rounded text-sm font-mono"},vn=["onClick"],pn=["onClick"],$e="r58-hotkey-customizations",fn=J({__name:"HotkeySettings",setup(l,{expose:g}){const n=[{id:"help",key:"?",modifiers:["shift"],description:"Show keyboard shortcuts",context:"global",category:"Navigation",editable:!1},{id:"goto-recorder",key:"r",description:"Go to Recorder",context:"global",category:"Navigation",editable:!0},{id:"goto-mixer",key:"m",description:"Go to Mixer",context:"global",category:"Navigation",editable:!0},{id:"escape",key:"Escape",description:"Close modal / Cancel",context:"global",category:"Navigation",editable:!1},{id:"scene-1",key:"1",description:"Switch to Scene 1",context:"mixer",category:"Scenes",editable:!0},{id:"scene-2",key:"2",description:"Switch to Scene 2",context:"mixer",category:"Scenes",editable:!0},{id:"scene-3",key:"3",description:"Switch to Scene 3",context:"mixer",category:"Scenes",editable:!0},{id:"scene-4",key:"4",description:"Switch to Scene 4",context:"mixer",category:"Scenes",editable:!0},{id:"scene-5",key:"5",description:"Switch to Scene 5",context:"mixer",category:"Scenes",editable:!0},{id:"scene-6",key:"6",description:"Switch to Scene 6",context:"mixer",category:"Scenes",editable:!0},{id:"scene-7",key:"7",description:"Switch to Scene 7",context:"mixer",category:"Scenes",editable:!0},{id:"scene-8",key:"8",description:"Switch to Scene 8",context:"mixer",category:"Scenes",editable:!0},{id:"scene-9",key:"9",description:"Switch to Scene 9",context:"mixer",category:"Scenes",editable:!0},{id:"cut",key:"t",description:"Cut transition",context:"mixer",category:"Transitions",editable:!0},{id:"fade",key:"a",description:"Auto-transition (fade)",context:"mixer",category:"Transitions",editable:!0},{id:"cycle-sources",key:"Tab",description:"Cycle through sources",context:"mixer",category:"Transitions",editable:!0},{id:"go-live",key:"g",description:"Toggle Go Live",context:"mixer",category:"Control",editable:!0},{id:"toggle-recording",key:"r",modifiers:["ctrl"],description:"Toggle local recording",context:"mixer",category:"Control",editable:!0},{id:"mute-all",key:"m",modifiers:["ctrl"],description:"Mute all sources",context:"mixer",category:"Control",editable:!0},{id:"source-1",key:"F1",description:"Select source 1",context:"mixer",category:"Sources",editable:!0},{id:"source-2",key:"F2",description:"Select source 2",context:"mixer",category:"Sources",editable:!0},{id:"source-3",key:"F3",description:"Select source 3",context:"mixer",category:"Sources",editable:!0},{id:"source-4",key:"F4",description:"Select source 4",context:"mixer",category:"Sources",editable:!0},{id:"start-stop-recording",key:" ",description:"Start/Stop recording",context:"recorder",category:"Recording",editable:!0},{id:"mark-chapter",key:"c",description:"Mark chapter point",context:"recorder",category:"Recording",editable:!0}],i=S(!1),c=S("mixer"),f=S({}),x=S(null),y=S(null);function u(){try{const C=localStorage.getItem($e);C&&(f.value=JSON.parse(C))}catch(C){console.warn("[HotkeySettings] Failed to load customizations:",C)}}function M(){try{localStorage.setItem($e,JSON.stringify(f.value))}catch(C){console.warn("[HotkeySettings] Failed to save customizations:",C)}}function I(C){const v=f.value[C.id];return v?{...C,key:v.key,modifiers:v.modifiers}:C}const k=j(()=>{const C={global:{},mixer:{},recorder:{}};for(const v of n){const R=I(v);C[v.context][R.category]||(C[v.context][R.category]=[]),C[v.context][R.category].push(R)}return C}),w=j(()=>k.value[c.value]||{});function $(C){return he(C.key,C.modifiers)}function O(C){return!!f.value[C]}function _(C){const v=n.find(R=>R.id===C);v!=null&&v.editable&&(x.value=C,y.value=null,document.addEventListener("keydown",d))}function d(C){if(C.preventDefault(),C.stopPropagation(),["Control","Alt","Shift","Meta"].includes(C.key))return;const v=[];C.ctrlKey&&v.push("ctrl"),C.altKey&&v.push("alt"),C.shiftKey&&v.push("shift"),C.metaKey&&v.push("meta"),y.value={key:C.key,modifiers:v},document.removeEventListener("keydown",d)}function p(){!x.value||!y.value||(f.value[x.value]={key:y.value.key,modifiers:y.value.modifiers.length>0?y.value.modifiers:void 0},M(),U.success("Hotkey updated"),x.value=null,y.value=null)}function h(){x.value=null,y.value=null,document.removeEventListener("keydown",d)}function t(C){delete f.value[C],M(),U.info("Hotkey reset to default")}function r(){confirm("Reset all hotkeys to defaults?")&&(f.value={},M(),U.info("All hotkeys reset to defaults"))}function a(){u(),i.value=!0}function D(){h(),i.value=!1}se(()=>{u()});function K(){return{...f.value}}return g({open:a,getCustomBindings:K}),(C,v)=>(s(),ue(Ce,{to:"body"},[i.value?(s(),o("div",qs,[e("div",{class:"absolute inset-0 bg-black/60",onClick:D}),e("div",Xs,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[v[0]||(v[0]=e("h2",{class:"text-xl font-semibold"},"Keyboard Shortcuts",-1)),e("div",{class:"flex items-center gap-4"},[e("button",{onClick:r,class:"text-sm text-r58-text-secondary hover:text-r58-text-primary"}," Reset All "),e("button",{onClick:D,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," √ó ")])]),e("div",Qs,[(s(),o(B,null,G(["mixer","global","recorder"],R=>e("button",{key:R,onClick:z=>c.value=R,class:V(["px-6 py-3 text-sm font-medium capitalize transition-colors",c.value===R?"text-r58-accent-primary border-b-2 border-r58-accent-primary":"text-r58-text-secondary hover:text-r58-text-primary"])},b(R),11,Zs)),64))]),e("div",en,[Object.keys(w.value).length===0?(s(),o("div",tn," No shortcuts defined for this context. ")):(s(),o("div",sn,[(s(!0),o(B,null,G(w.value,(R,z)=>(s(),o("div",{key:z},[e("h3",nn,b(z),1),e("div",on,[(s(!0),o(B,null,G(R,N=>(s(),o("div",{key:N.id,class:V(["flex items-center justify-between p-3 bg-r58-bg-tertiary rounded-lg",{"ring-2 ring-r58-accent-primary":x.value===N.id}])},[e("div",rn,[e("span",an,b(N.description),1),O(N.id)?(s(),o("span",ln,"(customized)")):E("",!0)]),e("div",cn,[x.value===N.id?(s(),o("div",dn,[y.value?(s(),o("kbd",un,b(H(he)(y.value.key,y.value.modifiers)),1)):(s(),o("span",mn," Press a key... ")),y.value?(s(),o("button",{key:2,onClick:p,class:"btn btn-sm btn-primary"}," Save ")):E("",!0),e("button",{onClick:h,class:"btn btn-sm"}," Cancel ")])):(s(),o(B,{key:1},[e("kbd",gn,b($(N)),1),N.editable?(s(),o("button",{key:0,onClick:ee=>_(N.id),class:"text-xs text-r58-accent-primary hover:underline"}," Edit ",8,vn)):E("",!0),O(N.id)?(s(),o("button",{key:1,onClick:ee=>t(N.id),class:"text-xs text-r58-text-secondary hover:text-r58-accent-danger"}," Reset ",8,pn)):E("",!0)],64))])],2))),128))])]))),128))]))]),e("div",{class:"flex items-center justify-between px-6 py-4 border-t border-r58-bg-tertiary"},[v[1]||(v[1]=e("div",{class:"text-sm text-r58-text-secondary"},' Click "Edit" to customize a shortcut. Press any key combination to set. ',-1)),e("button",{onClick:D,class:"btn"},"Close")])])])):E("",!0)]))}}),xn={class:"connection-status","data-testid":"connection-status"},bn={class:"text-xs text-r58-text-secondary"},yn={key:0,class:"text-xs text-r58-accent-danger",title:"Click for details"},hn={key:0,class:"mt-2 p-3 bg-r58-bg-tertiary rounded-lg text-xs space-y-2"},kn={class:"grid grid-cols-2 gap-2"},wn={class:"ml-1 font-medium"},_n={class:"ml-1"},Sn={class:"ml-1"},$n={key:0,class:"p-2 bg-r58-accent-danger/10 border border-r58-accent-danger/30 rounded text-r58-accent-danger"},Cn={class:"flex gap-2 pt-2 border-t border-r58-bg-tertiary"},Rn=["disabled"],Mn={key:1,class:"text-r58-text-secondary text-center"},Dn=J({__name:"ConnectionStatus",props:{vdoEmbed:{}},setup(l){const g=l;re();const n=S(!1),i=S("never"),c=S(0),f=S(!1),x=j(()=>{var h,t;return((t=(h=g.vdoEmbed)==null?void 0:h.connectionState)==null?void 0:t.value)||"disconnected"}),y=j(()=>{var h,t;return((t=(h=g.vdoEmbed)==null?void 0:h.isReady)==null?void 0:t.value)||!1}),u=j(()=>{var h,t;return((t=(h=g.vdoEmbed)==null?void 0:h.lastError)==null?void 0:t.value)||null}),M=j(()=>x.value==="disconnected"||!y.value?"disconnected":u.value?"error":x.value==="connecting"?"degraded":"healthy"),I=j(()=>{switch(M.value){case"healthy":return"bg-r58-accent-success";case"degraded":return"bg-amber-500";case"error":return"bg-r58-accent-danger";case"disconnected":return"bg-r58-text-secondary";default:return"bg-r58-text-secondary"}}),k=j(()=>{switch(M.value){case"healthy":return"Connected";case"degraded":return"Connecting...";case"error":return"Error";case"disconnected":return"Disconnected";default:return"Unknown"}});let w=null;function $(){if(g.vdoEmbed){const h=g.vdoEmbed.getEventStats();if(h.lastActivity){const t=Date.now()-h.lastActivity;t<1e3?i.value="just now":t<6e4?i.value=`${Math.floor(t/1e3)}s ago`:t<36e5?i.value=`${Math.floor(t/6e4)}m ago`:i.value="over 1h ago"}}}se(()=>{$(),w=window.setInterval($,1e3)}),ie(()=>{w&&clearInterval(w)});async function O(){if(!f.value){f.value=!0,c.value++,U.info("Attempting to reconnect...");try{g.vdoEmbed&&g.vdoEmbed.sendCommand("ping"),await new Promise(h=>setTimeout(h,2e3)),y.value&&!u.value?(U.success("Reconnected successfully"),c.value=0):U.error("Reconnection failed. Try refreshing the page.")}catch(h){U.error("Reconnection error"),console.error("[ConnectionStatus] Reconnect error:",h)}finally{f.value=!1}}}function _(){confirm("This will refresh the page and may interrupt active streams. Continue?")&&window.location.reload()}function d(){n.value=!n.value}const p=j(()=>g.vdoEmbed?g.vdoEmbed.getEventStats():{total:0,incoming:0,outgoing:0,lastActivity:null});return(h,t)=>(s(),o("div",xn,[e("div",{class:"flex items-center gap-2 cursor-pointer",onClick:d},[e("span",{class:V(["w-2 h-2 rounded-full",[I.value,{"animate-pulse":M.value==="degraded"}]]),"data-testid":"status-indicator"},null,2),e("span",bn,b(k.value),1),u.value?(s(),o("span",yn," ‚ö†Ô∏è ")):E("",!0),(s(),o("svg",{class:V(["w-3 h-3 text-r58-text-secondary transition-transform",{"rotate-180":n.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[0]||(t[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),n.value?(s(),o("div",hn,[e("div",kn,[e("div",null,[t[1]||(t[1]=e("span",{class:"text-r58-text-secondary"},"VDO.ninja:",-1)),e("span",{class:V(["ml-1 font-medium",y.value?"text-r58-accent-success":"text-r58-accent-danger"])},b(y.value?"Ready":"Not Ready"),3)]),e("div",null,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"State:",-1)),e("span",wn,b(x.value),1)]),e("div",null,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Last activity:",-1)),e("span",_n,b(i.value),1)]),e("div",null,[t[4]||(t[4]=e("span",{class:"text-r58-text-secondary"},"Events:",-1)),e("span",Sn,b(p.value.total),1)])]),u.value?(s(),o("div",$n,[t[5]||(t[5]=e("strong",null,"Error:",-1)),Q(" "+b(u.value),1)])):E("",!0),e("div",Cn,[e("button",{onClick:O,disabled:f.value,class:V(["btn btn-sm flex-1",{"opacity-50":f.value}])},b(f.value?"Reconnecting...":"üîÑ Reconnect"),11,Rn),e("button",{onClick:_,class:"btn btn-sm",title:"Refresh the page (last resort)"}," üîÉ Refresh ")]),c.value>0?(s(),o("div",Mn," Reconnect attempts: "+b(c.value),1)):E("",!0)])):E("",!0)]))}}),Ln={class:"h-full flex flex-col bg-r58-bg-primary"},En={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},On={class:"flex items-center gap-4"},jn={class:"flex items-center gap-2"},In={key:0,class:"badge badge-danger"},Tn={class:"flex items-center gap-4"},Vn={class:"flex-1 p-6 overflow-auto"},Un={class:"grid grid-cols-1 lg:grid-cols-2 gap-6"},Pn={class:"card p-6"},Hn={class:"grid grid-cols-4 gap-3"},An=["onClick"],Bn={class:"card p-6"},Nn={class:"text-lg font-semibold mb-4"},Fn={class:"text-sm font-normal text-r58-text-secondary"},zn={class:"space-y-3"},Kn={class:"flex items-center gap-3"},Gn={class:"font-medium"},Wn={key:0,class:"text-xs text-r58-text-secondary ml-2"},Jn={key:0,class:"text-sm text-r58-text-secondary"},Yn={class:"card p-6"},qn={class:"flex items-center gap-4"},Xn={key:0,class:"w-2 h-2 rounded-full bg-white animate-pulse mr-2"},Qn={key:0,class:"mt-3 text-sm text-r58-text-secondary"},Zn={class:"card p-6"},eo={class:"grid grid-cols-2 gap-4"},to={class:"text-2xl font-bold text-r58-text-primary"},so=J({__name:"MixerLiteView",emits:["enable-full-mode"],setup(l,{emit:g}){const n=g,i=ge(),c=re(),f=ve(),{register:x}=Re(),y=j(()=>c.isLive),u=j(()=>i.inputs),M=j(()=>u.value.filter(_=>_.hasSignal));let I=null;se(()=>{i.fetchInputs(),I=window.setInterval(()=>{i.fetchInputs()},5e3);for(let _=1;_<=4;_++)x({key:String(_),description:`Switch to scene ${_}`,action:()=>k(_),context:"mixer-lite"})}),ie(()=>{I&&clearInterval(I)});function k(_){c.setScene(`scene-${_}`),U.info(`Scene ${_}`)}function w(){c.isLive?(c.toggleLive(),f.stopStreaming(),U.info("Session ended")):(c.toggleLive(),f.startStreaming(),U.success("Going live!"))}async function $(){try{i.isRecording?(await i.stopRecording(),U.info("Recording stopped")):(await i.startRecording(),U.success("Recording started"))}catch{U.error("Recording action failed")}}function O(){confirm("Full Mixer mode loads VDO.ninja which uses significant CPU/GPU resources. This may cause lag on the device. Continue?")&&n("enable-full-mode")}return(_,d)=>(s(),o("div",Ln,[e("header",En,[e("div",On,[e("div",jn,[e("span",{class:V(["w-3 h-3 rounded-full",y.value?"bg-r58-accent-danger animate-pulse":"bg-r58-bg-tertiary"])},null,2),d[0]||(d[0]=e("span",{class:"text-xl font-semibold text-r58-mixer"},"Mixer",-1)),d[1]||(d[1]=e("span",{class:"text-xs px-2 py-0.5 rounded bg-amber-500/20 text-amber-400 font-medium"}," LITE MODE ",-1))]),y.value?(s(),o("span",In,"ON AIR")):E("",!0)]),e("div",Tn,[e("button",{class:"btn btn-sm btn-secondary",onClick:O,title:"Enable full VDO.ninja mixer (high CPU usage)"},[...d[2]||(d[2]=[e("svg",{class:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})],-1),Q(" Full Mode ",-1)])]),e("button",{class:V(["btn",y.value?"btn-danger":"btn-primary"]),onClick:w},b(y.value?"End Session":"Go Live"),3)])]),e("main",Vn,[d[10]||(d[10]=Ve('<div class="mb-6 p-4 rounded-lg bg-amber-500/10 border border-amber-500/30" data-v-6d9e9096><div class="flex items-start gap-3" data-v-6d9e9096><svg class="w-5 h-5 text-amber-400 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-6d9e9096><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" data-v-6d9e9096></path></svg><div data-v-6d9e9096><h3 class="font-medium text-amber-400" data-v-6d9e9096>Local Device Mode</h3><p class="text-sm text-r58-text-secondary mt-1" data-v-6d9e9096> VDO.ninja previews are disabled to save CPU. Scene switching and guest management should be done from a remote browser or the Electron app. </p></div></div></div>',1)),e("div",Un,[e("div",Pn,[d[3]||(d[3]=e("h2",{class:"text-lg font-semibold mb-4"},"Scene Control",-1)),e("div",Hn,[(s(),o(B,null,G(4,p=>e("button",{key:p,class:V(["aspect-video flex items-center justify-center text-2xl font-bold rounded-lg transition-all",H(c).currentScene===`scene-${p}`?"bg-r58-mixer text-white ring-2 ring-r58-mixer ring-offset-2 ring-offset-r58-bg-primary":"bg-r58-bg-tertiary hover:bg-r58-bg-secondary text-r58-text-primary"]),onClick:h=>k(p)},b(p),11,An)),64))]),d[4]||(d[4]=e("p",{class:"text-xs text-r58-text-secondary mt-3"}," Press 1-4 to switch scenes. Full transitions require VDO.ninja (Full Mode). ",-1))]),e("div",Bn,[e("h2",Nn,[d[5]||(d[5]=Q(" Inputs ",-1)),e("span",Fn,"("+b(M.value.length)+"/"+b(u.value.length)+" active)",1)]),e("div",zn,[(s(!0),o(B,null,G(u.value,p=>(s(),o("div",{key:p.id,class:V(["flex items-center justify-between p-3 rounded-lg",p.hasSignal?"bg-r58-bg-tertiary":"bg-r58-bg-secondary opacity-50"])},[e("div",Kn,[e("div",{class:V(["w-2 h-2 rounded-full",p.hasSignal?"bg-green-500":"bg-gray-500"])},null,2),e("div",null,[e("span",Gn,b(p.name),1),p.resolution?(s(),o("span",Wn,b(p.resolution),1)):E("",!0)])]),p.framerate?(s(),o("div",Jn,b(p.framerate.toFixed(1))+" fps ",1)):E("",!0)],2))),128))])]),e("div",Yn,[d[6]||(d[6]=e("h2",{class:"text-lg font-semibold mb-4"},"Device Recording",-1)),e("div",qn,[e("button",{class:V(["btn flex-1",H(i).isRecording?"btn-danger":"btn-primary"]),onClick:$},[H(i).isRecording?(s(),o("span",Xn)):E("",!0),Q(" "+b(H(i).isRecording?"Stop Recording":"Start Recording"),1)],2)]),H(i).isRecording?(s(),o("div",Qn," Duration: "+b(H(i).formattedDuration),1)):E("",!0)]),e("div",Zn,[d[9]||(d[9]=e("h2",{class:"text-lg font-semibold mb-4"},"System Status",-1)),e("div",eo,[e("div",null,[e("div",to,b(M.value.length),1),d[7]||(d[7]=e("div",{class:"text-sm text-r58-text-secondary"},"Active Inputs",-1))]),e("div",null,[e("div",{class:V(["text-2xl font-bold",y.value?"text-red-500":"text-r58-text-primary"])},b(y.value?"LIVE":"Offline"),3),d[8]||(d[8]=e("div",{class:"text-sm text-r58-text-secondary"},"Stream Status",-1))])])])])])]))}}),no=me(so,[["__scopeId","data-v-6d9e9096"]]),oo={class:"h-full flex flex-col"},ro={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"mixer-header"},ao={class:"flex items-center gap-4"},io={class:"flex items-center gap-2"},lo={key:0,class:"badge badge-danger","data-testid":"on-air-badge"},co={key:1,class:"text-xs text-r58-text-secondary"},uo={class:"flex items-center gap-4"},mo={class:"flex-1 flex overflow-hidden"},go={class:"flex-1 p-4"},vo={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},po={class:"mb-6"},fo={class:"grid grid-cols-4 gap-2"},xo=["onClick","data-testid"],bo={class:"mb-6 pt-4 border-t border-r58-bg-tertiary"},yo={class:"mb-6 pt-4 border-t border-r58-bg-tertiary"},ho={class:"pt-4 border-t border-r58-bg-tertiary"},ko=J({__name:"MixerView",setup(l){const g=re(),n=ge(),i=ve(),{register:c}=Re(),{isLiteMode:f}=Je(),x=S(null),y=S(null),u=S(null),M=j(()=>g.isLive),I=j(()=>i.enabledDestinations.length),k=S(!1),w=j(()=>!f.value||k.value),$=S(!0),O=S(!1);function _(){$.value=!1}oe(()=>{var v,R;return(R=(v=x.value)==null?void 0:v.isReady)==null?void 0:R.value},v=>{v&&(console.log("[Mixer] VDO.ninja iframe ready, dismissing loading screen"),O.value=!0)},{immediate:!0});let d=null;function p(){return n.isRecording?1e4:3e4}function h(){d&&clearInterval(d),d=window.setInterval(()=>{n.fetchInputs()},p())}const t=[];oe(()=>n.isRecording,()=>{h()}),se(async()=>{await n.fetchInputs(),h();for(let v=1;v<=4;v++){const R=c({key:String(v),description:`Switch to scene ${v}`,action:()=>r(v),context:"mixer"});t.push(R)}t.push(c({key:"g",description:"Toggle Go Live",action:()=>D(),context:"mixer"})),t.push(c({key:"r",description:"Toggle recording",action:()=>a(),context:"mixer"}))}),ie(()=>{t.forEach(v=>v()),d&&(clearInterval(d),d=null)});function r(v){x.value&&x.value.sendCommand("addScene","*",v),g.setScene(`scene-${v}`),U.info(`Scene ${v}`)}function a(){var v;x.value&&((v=x.value.isRecording)!=null&&v.value?(x.value.stopRecording(),U.info("Recording stopped")):(x.value.startRecording(),U.success("Recording started")))}function D(){if(g.isLive)g.toggleLive(),i.stopStreaming(),U.info("Session ended");else{g.toggleLive(),i.startStreaming();const v=i.enabledDestinations.length;v>0?U.success(`Live! Streaming to ${v} destination${v>1?"s":""}`):U.info("Live! (No streaming destinations configured)")}}function K(){var v;(v=y.value)==null||v.open()}function C(){var v;(v=u.value)==null||v.open()}return(v,R)=>w.value?(s(),o(B,{key:1},[X(Pe,{name:"fade"},{default:Ue(()=>[$.value?(s(),ue(Fe,{key:0,mode:"mixer","content-ready":O.value,"min-time":2e3,"max-time":15e3,onReady:_},null,8,["content-ready"])):E("",!0)]),_:1}),e("div",oo,[e("header",ro,[e("div",ao,[e("div",io,[e("span",{class:V(["w-3 h-3 rounded-full",M.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"]),"data-testid":"live-indicator"},null,2),R[1]||(R[1]=e("span",{class:"text-xl font-semibold text-r58-mixer","data-testid":"mixer-title"},"Mixer",-1))]),M.value?(s(),o("span",lo,"ON AIR")):E("",!0),M.value&&I.value>0?(s(),o("span",co," Streaming to "+b(I.value)+" platform"+b(I.value>1?"s":""),1)):E("",!0),X(Dn,{"vdo-embed":x.value},null,8,["vdo-embed"])]),e("div",uo,[e("button",{class:"btn btn-sm",onClick:C,title:"Keyboard Shortcuts (Shift+?)","data-testid":"hotkey-settings-button"},[...R[2]||(R[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)])]),e("button",{class:"btn btn-sm",onClick:K,title:"Streaming Settings","data-testid":"streaming-settings-button"},[...R[3]||(R[3]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),e("button",{class:V(["btn",M.value?"btn-danger":"btn-primary"]),onClick:D,"data-testid":"go-live-button"},b(M.value?"End Session":"Go Live"),3)])]),e("div",mo,[e("div",go,[X(ot,{ref_key:"vdoEmbedRef",ref:x,profile:"director",class:"h-full"},null,512)]),e("aside",vo,[e("div",po,[R[4]||(R[4]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Quick Scenes",-1)),e("div",fo,[(s(),o(B,null,G(4,z=>e("button",{key:z,class:V(["btn btn-sm",H(g).currentScene===`scene-${z}`?"btn-primary":""]),onClick:N=>r(z),"data-testid":`scene-btn-${z}`},b(z),11,xo)),64))]),R[5]||(R[5]=e("p",{class:"text-xs text-r58-text-secondary mt-2"}," Press 1-4 for quick switch. Full layout control is in the mixer above. ",-1))]),e("div",bo,[X($t,{"vdo-embed":x.value},null,8,["vdo-embed"])]),e("div",yo,[R[6]||(R[6]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Program Output",-1)),X(Yt)]),e("div",ho,[R[7]||(R[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Local Recording",-1)),X(Ys,{"vdo-embed":x.value},null,8,["vdo-embed"])])])]),X(Ut),X(Hs,{ref_key:"streamingSettingsRef",ref:y},null,512),X(fn,{ref_key:"hotkeySettingsRef",ref:u},null,512)])],64)):(s(),ue(no,{key:0,onEnableFullMode:R[0]||(R[0]=z=>k.value=!0)}))}}),$o=me(ko,[["__scopeId","data-v-1208ebb3"]]);export{$o as default};
