import{r as b,l as L,J as Z,d as ae,o as q,c as d,e,f as $,y as W,t as g,F as R,z as H,n as M,s as w,k as u,_ as ne,H as se,K as Ce,w as ie,q as G,B as O,g as re,R as xe,p as le,P as we,j as D,C as ee,a as ke}from"./index-51tLXJEQ.js";import{A as $e}from"./AnimatedBackground-7lCWB0G6.js";function te(){const p=b([]),P=b(!1),k=b(null),m=b(null);async function S(){P.value=!0,k.value=null;try{const i=await Z.cameras.list();p.value=await Promise.all(i.map(async c=>{try{const s=await Z.cameras.getStatus(c);return{name:s.name,type:s.type,connected:s.connected,settings:s.settings}}catch{return{name:c,type:"blackmagic",connected:!1}}}))}catch(i){k.value=i.message||"Failed to load cameras",console.error("[CameraControls] Failed to load cameras:",i)}finally{P.value=!1}}const N=L(()=>i=>p.value.find(c=>c.name===i));function r(i,c){const s=N.value(i);if(!s)return!1;const t=["focus","iris","whiteBalance","gain","iso","shutter","colorCorrection"],n=["focus","exposure","whiteBalance","ptz"],E=["focus","exposure","whiteBalance","iso","shutter","ptz"];return s.type==="blackmagic"?t.includes(c):s.type==="obsbot_tail2"?n.includes(c):s.type==="sony_fx30"?E.includes(c):!1}async function C(i,c,s){try{await Z.cameras.setFocus(i,c,s),await x(i)}catch(t){throw new Error(t.message||"Failed to set focus")}}async function y(i,c,s){try{await Z.cameras.setWhiteBalance(i,c,s),await x(i)}catch(t){throw new Error(t.message||"Failed to set white balance")}}async function v(i,c,s){try{await Z.cameras.setExposure(i,c,s),await x(i)}catch(t){throw new Error(t.message||"Failed to set exposure")}}async function o(i,c){try{await Z.cameras.setISO(i,c),await x(i)}catch(s){throw new Error(s.message||"Failed to set ISO")}}async function l(i,c){try{await Z.cameras.setShutter(i,c),await x(i)}catch(s){throw new Error(s.message||"Failed to set shutter")}}async function h(i,c,s){try{await Z.cameras.setIris(i,c,s),await x(i)}catch(t){throw new Error(t.message||"Failed to set iris")}}async function F(i,c){try{await Z.cameras.setGain(i,c),await x(i)}catch(s){throw new Error(s.message||"Failed to set gain")}}async function B(i,c,s,t){try{await Z.cameras.setPTZ(i,c,s,t)}catch(n){throw new Error(n.message||"Failed to move PTZ")}}async function z(i,c){try{await Z.cameras.recallPTZPreset(i,c)}catch(s){throw new Error(s.message||"Failed to recall preset")}}async function I(i,c){try{await Z.cameras.setColorCorrection(i,c),await x(i)}catch(s){throw new Error(s.message||"Failed to set color correction")}}async function x(i){try{const c=await Z.cameras.getStatus(i),s=p.value.findIndex(t=>t.name===i);s>=0&&(p.value[s]={name:c.name,type:c.type,connected:c.connected,settings:c.settings})}catch(c){console.error(`[CameraControls] Failed to refresh status for ${i}:`,c)}}return{cameras:p,loading:P,error:k,selectedCamera:m,getCamera:N,supportsFeature:r,loadCameras:S,setFocus:C,setWhiteBalance:y,setExposure:v,setISO:o,setShutter:l,setIris:h,setGain:F,setPTZ:B,recallPTZPreset:z,setColorCorrection:I,refreshCameraStatus:x}}const Te={class:"companion-panel"},ze={class:"panel-header"},Se=["aria-label"],Pe={key:0,class:"help-section"},Ne={class:"help-text"},Fe={class:"camera-list"},Be={class:"camera-header"},Me={class:"camera-info"},Ie={class:"camera-name"},Ue={class:"camera-type"},Ze={class:"endpoints-section"},Ge={class:"endpoint-group"},Oe={class:"endpoint-path"},Ee=["onClick"],Ve={class:"quick-actions"},Ae={class:"action-buttons"},Le=["onClick"],Je={key:1,class:"empty-state"},De=ae({__name:"CompanionIntegrationPanel",setup(p){const{cameras:P,loadCameras:k}=te(),m=b(!1),S=L(()=>typeof window<"u"?window.location.origin:"https://app.itagenten.no");function N(v){return{blackmagic:"Blackmagic Studio 4K Pro",obsbot_tail2:"OBSbot Tail 2",sony_fx30:"Sony FX30"}[v]||v}function r(v){const o=`${S.value}/api/v1/cameras/${v.name}`,l=[];return l.push({method:"PUT",path:`${o}/settings/focus`,example:JSON.stringify({mode:"auto"},null,2)}),l.push({method:"PUT",path:`${o}/settings/focus`,example:JSON.stringify({mode:"manual",value:.5},null,2)}),l.push({method:"PUT",path:`${o}/settings/whiteBalance`,example:JSON.stringify({mode:"auto"},null,2)}),l.push({method:"PUT",path:`${o}/settings/whiteBalance`,example:JSON.stringify({mode:"manual",temperature:5600},null,2)}),(v.type==="obsbot_tail2"||v.type==="sony_fx30")&&l.push({method:"PUT",path:`${o}/settings/exposure`,example:JSON.stringify({mode:"auto"},null,2)}),(v.type==="blackmagic"||v.type==="sony_fx30")&&l.push({method:"PUT",path:`${o}/settings/iso`,example:JSON.stringify({value:400},null,2)}),(v.type==="blackmagic"||v.type==="sony_fx30")&&l.push({method:"PUT",path:`${o}/settings/shutter`,example:JSON.stringify({value:.0167},null,2)}),v.type==="blackmagic"&&(l.push({method:"PUT",path:`${o}/settings/iris`,example:JSON.stringify({mode:"auto"},null,2)}),l.push({method:"PUT",path:`${o}/settings/gain`,example:JSON.stringify({value:0},null,2)})),(v.type==="obsbot_tail2"||v.type==="sony_fx30")&&(l.push({method:"PUT",path:`${o}/settings/ptz`,example:JSON.stringify({pan:.5,tilt:-.3,zoom:.2},null,2)}),l.push({method:"PUT",path:`${o}/settings/ptz/preset/1`,example:JSON.stringify({},null,2)})),l}function C(v){const o=`${S.value}/api/v1/cameras/${v.name}`,l=[];return l.push({label:"Focus Auto",example:`PUT ${o}/settings/focus
Content-Type: application/json

{"mode":"auto"}`}),l.push({label:"WB Auto",example:`PUT ${o}/settings/whiteBalance
Content-Type: application/json

{"mode":"auto"}`}),(v.type==="obsbot_tail2"||v.type==="sony_fx30")&&l.push({label:"PTZ Center",example:`PUT ${o}/settings/ptz
Content-Type: application/json

{"pan":0,"tilt":0,"zoom":0}`}),l}async function y(v){try{await navigator.clipboard.writeText(v)}catch(o){console.error("Failed to copy:",o)}}return q(()=>{k()}),(v,o)=>(u(),d("div",Te,[e("div",ze,[o[2]||(o[2]=e("h3",{class:"panel-title"},[e("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2","stroke-width":"2"}),e("path",{d:"M9 9h6v6H9z","stroke-width":"2"})]),W(" Bitfocus Companion Integration ")],-1)),e("button",{class:"info-btn",onClick:o[0]||(o[0]=l=>m.value=!m.value),"aria-label":m.value?"Hide help":"Show help"},[...o[1]||(o[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4M12 8h.01"})],-1)])],8,Se)]),m.value?(u(),d("div",Pe,[e("p",Ne,[o[3]||(o[3]=W(" Control cameras via Bitfocus Companion using HTTP requests. Add an HTTP instance in Companion pointing to ",-1)),e("code",null,g(S.value),1),o[4]||(o[4]=W(" and use the endpoints below. ",-1))])])):$("",!0),e("div",Fe,[(u(!0),d(R,null,H(w(P),l=>(u(),d("div",{key:l.name,class:"camera-card"},[e("div",Be,[e("div",Me,[e("span",Ie,g(l.name),1),e("span",Ue,g(N(l.type)),1),e("span",{class:M(["status-indicator",l.connected?"connected":"disconnected"])},g(l.connected?"● Connected":"○ Disconnected"),3)])]),e("div",Ze,[o[6]||(o[6]=e("h4",{class:"section-title"},"Available Endpoints",-1)),e("div",Ge,[(u(!0),d(R,null,H(r(l),h=>(u(),d("div",{class:"endpoint-item",key:h.method+h.path},[e("div",{class:M(["endpoint-method",h.method.toLowerCase()])},g(h.method),3),e("div",Oe,[e("code",null,g(h.path),1)]),e("button",{class:"copy-btn",onClick:F=>y(h.example),title:"Copy example to clipboard"},[...o[5]||(o[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Ee)]))),128))])]),e("div",Ve,[o[7]||(o[7]=e("h4",{class:"section-title"},"Quick Actions",-1)),e("div",Ae,[(u(!0),d(R,null,H(C(l),h=>(u(),d("button",{key:h.label,class:"action-btn",onClick:F=>y(h.example)},g(h.label),9,Le))),128))])])]))),128))]),w(P).length===0?(u(),d("div",Je,[...o[8]||(o[8]=[e("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e("circle",{cx:"12",cy:"10",r:"3"})],-1),e("p",null,"No external cameras configured",-1),e("p",{class:"empty-hint"},[W("Add cameras in "),e("code",null,"config.yml"),W(" to enable Companion integration")],-1)])])):$("",!0)]))}}),We=ne(De,[["__scopeId","data-v-34a9c8fa"]]),je={class:"flex items-center justify-between w-full"},Re={class:"text-lg font-semibold text-preke-text"},He={key:0,class:"text-sm text-preke-text-muted mt-1"},qe={key:0,class:"py-8 text-center text-preke-text-muted"},Ke={key:1,class:"py-8 text-center text-red-400"},Qe={key:2,class:"py-8 text-center text-preke-text-muted"},Xe={key:3,class:"camera-controls"},Ye={class:"tabs"},et={key:0,class:"tab-content"},tt={key:0,class:"control-group"},at={class:"control-row"},nt={key:0,class:"control-slider"},ot={class:"slider-value"},st=["disabled"],lt={key:1,class:"control-group"},it={class:"control-row"},rt={key:0,class:"control-input"},ct=["disabled"],ut={key:2,class:"control-group"},dt={class:"control-row"},mt={key:0,class:"control-slider"},pt={class:"slider-value"},vt=["disabled"],ft={key:1,class:"tab-content"},bt={key:0,class:"control-group"},gt={class:"control-input"},yt=["disabled"],ht={key:1,class:"control-group"},_t={class:"control-input"},Ct=["disabled"],xt={key:2,class:"control-group"},wt={class:"control-row"},kt={key:0,class:"control-input"},$t=["disabled"],Tt={key:3,class:"control-group"},zt={class:"control-input"},St=["disabled"],Pt={key:2,class:"tab-content"},Nt={class:"control-group"},Ft={class:"ptz-controls"},Bt={class:"ptz-axis"},Mt={class:"slider-value"},It={class:"ptz-axis"},Ut={class:"slider-value"},Zt={class:"ptz-axis"},Gt={class:"slider-value"},Ot={key:3,class:"tab-content"},Et={key:4,class:"tab-content"},Vt=ae({__name:"CameraControlModal",props:{cameraName:{}},emits:["close"],setup(p,{expose:P,emit:k}){const m=p,S=k,N=b(null),{loading:r,error:C,supportsFeature:y,loadCameras:v,getCamera:o}=te(),l=b("basic"),h=L(()=>m.cameraName?o.value(m.cameraName):null),F=b("auto"),B=b(.5),z=b("auto"),I=b(5600),x=b("auto"),i=b(.5),c=b(400),s=b(1/60),t=b("auto"),n=b(2.8),E=b(0),U=b(0),A=b(0),J=b(0),_=b(!1);q(async()=>{await v(),m.cameraName&&h.value&&await K()}),se(()=>m.cameraName,async T=>{T&&h.value&&await K()});async function K(){!m.cameraName||h.value}function oe(){var T;(T=N.value)==null||T.open()}function Q(){var T;(T=N.value)==null||T.close(),S("close")}const{setFocus:V,setWhiteBalance:j,setExposure:X,setISO:Y,setShutter:ce,setIris:ue,setGain:de,setPTZ:me}=te();async function pe(){if(m.cameraName){_.value=!0;try{await V(m.cameraName,F.value,F.value==="manual"?B.value:void 0)}catch(T){alert(`Failed to set focus: ${T.message}`)}finally{_.value=!1}}}async function ve(){if(m.cameraName){_.value=!0;try{await j(m.cameraName,z.value,z.value==="manual"?I.value:void 0)}catch(T){alert(`Failed to set white balance: ${T.message}`)}finally{_.value=!1}}}async function fe(){if(m.cameraName){_.value=!0;try{await X(m.cameraName,x.value,x.value==="manual"?i.value:void 0)}catch(T){alert(`Failed to set exposure: ${T.message}`)}finally{_.value=!1}}}async function be(){if(m.cameraName){_.value=!0;try{await Y(m.cameraName,c.value)}catch(T){alert(`Failed to set ISO: ${T.message}`)}finally{_.value=!1}}}async function ge(){if(m.cameraName){_.value=!0;try{await ce(m.cameraName,s.value)}catch(T){alert(`Failed to set shutter: ${T.message}`)}finally{_.value=!1}}}async function ye(){if(m.cameraName){_.value=!0;try{await ue(m.cameraName,t.value,t.value==="manual"?n.value:void 0)}catch(T){alert(`Failed to set iris: ${T.message}`)}finally{_.value=!1}}}async function he(){if(m.cameraName){_.value=!0;try{await de(m.cameraName,E.value)}catch(T){alert(`Failed to set gain: ${T.message}`)}finally{_.value=!1}}}async function _e(){if(m.cameraName)try{await me(m.cameraName,U.value,A.value,J.value)}catch(T){alert(`Failed to move PTZ: ${T.message}`)}}return P({open:oe,close:Q}),(T,a)=>(u(),Ce(xe,{ref_key:"modalRef",ref:N,title:"Camera Controls",size:"xl",onClose:a[23]||(a[23]=f=>S("close"))},{header:ie(()=>[e("div",je,[e("div",null,[e("h2",Re,g(p.cameraName||"Camera Controls"),1),h.value?(u(),d("p",He,[W(g(h.value.type==="blackmagic"?"Blackmagic Design":h.value.type==="sony_fx30"?"Sony FX30":"OBSbot Tail 2")+" ",1),e("span",{class:M([h.value.connected?"text-green-500":"text-red-500","ml-2"])},g(h.value.connected?"● Connected":"○ Disconnected"),3)])):$("",!0)])])]),default:ie(()=>[w(r)?(u(),d("div",qe," Loading camera settings... ")):w(C)?(u(),d("div",Ke,g(w(C)),1)):h.value?(u(),d("div",Xe,[e("div",Ye,[w(y)(p.cameraName,"focus")||w(y)(p.cameraName,"whiteBalance")||w(y)(p.cameraName,"exposure")?(u(),d("button",{key:0,class:M(["tab",{"tab--active":l.value==="basic"}]),onClick:a[0]||(a[0]=f=>l.value="basic")}," Basic ",2)):$("",!0),w(y)(p.cameraName,"iso")||w(y)(p.cameraName,"shutter")||w(y)(p.cameraName,"iris")||w(y)(p.cameraName,"gain")?(u(),d("button",{key:1,class:M(["tab",{"tab--active":l.value==="advanced"}]),onClick:a[1]||(a[1]=f=>l.value="advanced")}," Advanced ",2)):$("",!0),w(y)(p.cameraName,"ptz")?(u(),d("button",{key:2,class:M(["tab",{"tab--active":l.value==="ptz"}]),onClick:a[2]||(a[2]=f=>l.value="ptz")}," PTZ ",2)):$("",!0),w(y)(p.cameraName,"colorCorrection")?(u(),d("button",{key:3,class:M(["tab",{"tab--active":l.value==="color"}]),onClick:a[3]||(a[3]=f=>l.value="color")}," Color ",2)):$("",!0),e("button",{class:M(["tab",{"tab--active":l.value==="companion"}]),onClick:a[4]||(a[4]=f=>l.value="companion")}," Companion ",2)]),l.value==="basic"?(u(),d("div",et,[w(y)(p.cameraName,"focus")?(u(),d("div",tt,[a[24]||(a[24]=e("label",{class:"control-label"},"Focus",-1)),e("div",at,[e("button",{class:M(["mode-btn",{"mode-btn--active":F.value==="auto"}]),onClick:a[5]||(a[5]=f=>F.value="auto")}," Auto ",2),e("button",{class:M(["mode-btn",{"mode-btn--active":F.value==="manual"}]),onClick:a[6]||(a[6]=f=>F.value="manual")}," Manual ",2)]),F.value==="manual"?(u(),d("div",nt,[G(e("input",{"onUpdate:modelValue":a[7]||(a[7]=f=>B.value=f),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[O,B.value,void 0,{number:!0}]]),e("span",ot,g(Math.round(B.value*100))+"%",1)])):$("",!0),e("button",{onClick:pe,disabled:_.value,class:"save-btn"},g(_.value?"Saving...":"Save Focus"),9,st)])):$("",!0),w(y)(p.cameraName,"whiteBalance")?(u(),d("div",lt,[a[26]||(a[26]=e("label",{class:"control-label"},"White Balance",-1)),e("div",it,[e("button",{class:M(["mode-btn",{"mode-btn--active":z.value==="auto"}]),onClick:a[8]||(a[8]=f=>z.value="auto")}," Auto ",2),e("button",{class:M(["mode-btn",{"mode-btn--active":z.value==="manual"}]),onClick:a[9]||(a[9]=f=>z.value="manual")}," Manual ",2)]),z.value==="manual"?(u(),d("div",rt,[G(e("input",{"onUpdate:modelValue":a[10]||(a[10]=f=>I.value=f),type:"number",min:"2000",max:"10000",step:"100",class:"input"},null,512),[[O,I.value,void 0,{number:!0}]]),a[25]||(a[25]=e("span",{class:"input-unit"},"K",-1))])):$("",!0),e("button",{onClick:ve,disabled:_.value,class:"save-btn"},g(_.value?"Saving...":"Save White Balance"),9,ct)])):$("",!0),w(y)(p.cameraName,"exposure")?(u(),d("div",ut,[a[27]||(a[27]=e("label",{class:"control-label"},"Exposure",-1)),e("div",dt,[e("button",{class:M(["mode-btn",{"mode-btn--active":x.value==="auto"}]),onClick:a[11]||(a[11]=f=>x.value="auto")}," Auto ",2),e("button",{class:M(["mode-btn",{"mode-btn--active":x.value==="manual"}]),onClick:a[12]||(a[12]=f=>x.value="manual")}," Manual ",2)]),x.value==="manual"?(u(),d("div",mt,[G(e("input",{"onUpdate:modelValue":a[13]||(a[13]=f=>i.value=f),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[O,i.value,void 0,{number:!0}]]),e("span",pt,g(Math.round(i.value*100))+"%",1)])):$("",!0),e("button",{onClick:fe,disabled:_.value,class:"save-btn"},g(_.value?"Saving...":"Save Exposure"),9,vt)])):$("",!0)])):$("",!0),l.value==="advanced"?(u(),d("div",ft,[w(y)(p.cameraName,"iso")?(u(),d("div",bt,[a[28]||(a[28]=e("label",{class:"control-label"},"ISO",-1)),e("div",gt,[G(e("input",{"onUpdate:modelValue":a[14]||(a[14]=f=>c.value=f),type:"number",min:"100",max:"25600",step:"100",class:"input"},null,512),[[O,c.value,void 0,{number:!0}]])]),e("button",{onClick:be,disabled:_.value,class:"save-btn"},g(_.value?"Saving...":"Save ISO"),9,yt)])):$("",!0),w(y)(p.cameraName,"shutter")?(u(),d("div",ht,[a[30]||(a[30]=e("label",{class:"control-label"},"Shutter Speed",-1)),e("div",_t,[G(e("input",{"onUpdate:modelValue":a[15]||(a[15]=f=>s.value=f),type:"number",min:"0.0001",max:"1",step:"0.0001",class:"input"},null,512),[[O,s.value,void 0,{number:!0}]]),a[29]||(a[29]=e("span",{class:"input-unit"},"s",-1))]),e("button",{onClick:ge,disabled:_.value,class:"save-btn"},g(_.value?"Saving...":"Save Shutter"),9,Ct)])):$("",!0),w(y)(p.cameraName,"iris")?(u(),d("div",xt,[a[32]||(a[32]=e("label",{class:"control-label"},"Iris",-1)),e("div",wt,[e("button",{class:M(["mode-btn",{"mode-btn--active":t.value==="auto"}]),onClick:a[16]||(a[16]=f=>t.value="auto")}," Auto ",2),e("button",{class:M(["mode-btn",{"mode-btn--active":t.value==="manual"}]),onClick:a[17]||(a[17]=f=>t.value="manual")}," Manual ",2)]),t.value==="manual"?(u(),d("div",kt,[G(e("input",{"onUpdate:modelValue":a[18]||(a[18]=f=>n.value=f),type:"number",min:"1.4",max:"22",step:"0.1",class:"input"},null,512),[[O,n.value,void 0,{number:!0}]]),a[31]||(a[31]=e("span",{class:"input-unit"},"f/",-1))])):$("",!0),e("button",{onClick:ye,disabled:_.value,class:"save-btn"},g(_.value?"Saving...":"Save Iris"),9,$t)])):$("",!0),w(y)(p.cameraName,"gain")?(u(),d("div",Tt,[a[34]||(a[34]=e("label",{class:"control-label"},"Gain",-1)),e("div",zt,[G(e("input",{"onUpdate:modelValue":a[19]||(a[19]=f=>E.value=f),type:"number",min:"-12",max:"36",step:"0.1",class:"input"},null,512),[[O,E.value,void 0,{number:!0}]]),a[33]||(a[33]=e("span",{class:"input-unit"},"dB",-1))]),e("button",{onClick:he,disabled:_.value,class:"save-btn"},g(_.value?"Saving...":"Save Gain"),9,St)])):$("",!0)])):$("",!0),l.value==="ptz"?(u(),d("div",Pt,[e("div",Nt,[a[38]||(a[38]=e("label",{class:"control-label"},"Pan/Tilt/Zoom",-1)),e("div",Ft,[e("div",Bt,[a[35]||(a[35]=e("label",null,"Pan",-1)),G(e("input",{"onUpdate:modelValue":a[20]||(a[20]=f=>U.value=f),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[O,U.value,void 0,{number:!0}]]),e("span",Mt,g(U.value.toFixed(1)),1)]),e("div",It,[a[36]||(a[36]=e("label",null,"Tilt",-1)),G(e("input",{"onUpdate:modelValue":a[21]||(a[21]=f=>A.value=f),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[O,A.value,void 0,{number:!0}]]),e("span",Ut,g(A.value.toFixed(1)),1)]),e("div",Zt,[a[37]||(a[37]=e("label",null,"Zoom",-1)),G(e("input",{"onUpdate:modelValue":a[22]||(a[22]=f=>J.value=f),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[O,J.value,void 0,{number:!0}]]),e("span",Gt,g(J.value.toFixed(1)),1)])]),e("button",{onClick:_e,class:"save-btn"}," Move PTZ ")])])):$("",!0),l.value==="color"?(u(),d("div",Ot,[...a[39]||(a[39]=[e("div",{class:"control-group"},[e("p",{class:"text-preke-text-muted text-sm"}," Color correction controls coming soon ")],-1)])])):$("",!0),l.value==="companion"?(u(),d("div",Et,[re(We)])):$("",!0)])):(u(),d("div",Qe," Camera not found "))]),_:1},512))}}),Ta=ne(Vt,[["__scopeId","data-v-d317ac4a"]]);function At(p=null){const P=b(!1),k=b(!1),m=b(p),S=b(null),N=b(null);let r=null,C=null,y=0;const v=33;let o=null;async function l(){if((r==null?void 0:r.readyState)!==WebSocket.OPEN)try{const t=await Z.buildApiUrl("/api/v1/ptz-controller/ws");r=new WebSocket(t.replace("http","ws").replace("https","wss")),r.onopen=()=>{P.value=!0,m.value&&F(m.value)},r.onerror=n=>{console.error("[PTZController] WebSocket error:",n),P.value=!1},r.onclose=()=>{P.value=!1}}catch(t){console.error("[PTZController] Failed to connect:",t)}}function h(){r&&(r.close(),r=null),P.value=!1,I()}function F(t){m.value=t,(r==null?void 0:r.readyState)===WebSocket.OPEN&&r.send(JSON.stringify({type:"set_camera",camera_name:t}))}function B(t){if(!P.value||!m.value||!r)return;const n=Date.now();n-y<v||(y=n,r.send(JSON.stringify({type:"ptz_command",pan:t.pan,tilt:t.tilt,zoom:t.zoom,focus:t.focus,speed:t.speed||1})))}function z(t=0){if(C)return;S.value=t,k.value=!0;function n(){var X,Y;if(!k.value)return;const U=navigator.getGamepads()[S.value];if(!U){console.log("[PTZController] Gamepad disconnected during polling"),I(),i();return}(!N.value||N.value.index!==U.index)&&(N.value={id:U.id,index:U.index,mapping:U.mapping||"standard"});const A=Array.from(U.axes),J=Array.from(U.buttons),_=x(A[0]||0,.1),K=x(-(A[1]||0),.1),oe=x(A[2]||0,.1),Q=A[3]?x(A[3],.1):void 0;let V=.5;(X=J[6])!=null&&X.value&&(V+=J[6].value*.5),(Y=J[7])!=null&&Y.value&&(V+=J[7].value*.5),V=Math.min(1,V);const j={pan:_*V,tilt:K*V,zoom:oe*V,focus:Q?Q*V:void 0,speed:V};(Math.abs(j.pan)>.01||Math.abs(j.tilt)>.01||Math.abs(j.zoom)>.01)&&B(j),C=requestAnimationFrame(n)}n()}function I(){k.value=!1,S.value=null,C&&(cancelAnimationFrame(C),C=null)}function x(t,n){if(Math.abs(t)<n)return 0;const E=t>=0?1:-1,U=(Math.abs(t)-n)/(1-n);return E*U}function i(){o&&clearTimeout(o),o=window.setTimeout(()=>{const t=navigator.getGamepads();for(let n=0;n<t.length;n++)if(t[n]&&S.value===null){console.log("[PTZController] Gamepad reconnected:",t[n].id),z(n);break}o=null},1e3)}function c(t){const n=t.gamepad,E=n.id.toLowerCase().includes("bluetooth")||n.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${E} gamepad connected:`,n.id,{index:n.index,mapping:n.mapping||"standard",axes:n.axes.length,buttons:n.buttons.length}),S.value===null&&z(n.index)}function s(t){const n=t.gamepad,E=n.id.toLowerCase().includes("bluetooth")||n.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${E} gamepad disconnected:`,n.id),S.value===t.gamepad.index&&(I(),N.value=null,i())}return q(()=>{l(),window.addEventListener("gamepadconnected",c),window.addEventListener("gamepaddisconnected",s);const t=navigator.getGamepads();for(let n=0;n<t.length;n++)if(t[n]){z(n);break}}),le(()=>{h(),I(),o&&clearTimeout(o),window.removeEventListener("gamepadconnected",c),window.removeEventListener("gamepaddisconnected",s)}),{connected:P,active:k,currentCamera:m,gamepadIndex:S,gamepadInfo:N,connect:l,disconnect:h,setCamera:F,sendPTZCommand:B,startGamepad:z,stopGamepad:I}}const Lt={class:"ptz-controller-panel"},Jt={class:"ptz-controller-panel__header"},Dt={class:"ptz-controller-panel__content"},Wt={class:"ptz-controller-panel__section"},jt=["value"],Rt={class:"ptz-controller-panel__section"},Ht={class:"ptz-controller-panel__status"},qt={class:"ptz-controller-panel__status-text"},Kt={class:"ptz-controller-panel__buttons"},Qt=["disabled"],Xt=["disabled"],Yt={key:0,class:"ptz-controller-panel__section"},ea={class:"ptz-controller-panel__status"},ta={class:"ptz-controller-panel__status-text"},aa={class:"ptz-controller-panel__section"},na={class:"ptz-controller-panel__manual-controls"},oa={class:"ptz-controller-panel__axis"},sa={class:"ptz-controller-panel__value"},la={class:"ptz-controller-panel__axis"},ia={class:"ptz-controller-panel__value"},ra={class:"ptz-controller-panel__axis"},ca={class:"ptz-controller-panel__value"},ua=["disabled"],da={class:"ptz-controller-panel__section"},ma={class:"ptz-controller-panel__buttons"},pa=["disabled"],va=["disabled"],fa=ae({__name:"PTZControllerPanel",props:{cameraName:{}},emits:["close"],setup(p,{emit:P}){const k=p,m=P,{cameras:S,loadCameras:N}=te(),r=At(k.cameraName||null),C=b(k.cameraName||null),y=L(()=>r.gamepadInfo.value!==null),v=L(()=>{var s;return((s=r.gamepadInfo.value)==null?void 0:s.id)||""}),o=L(()=>S.value.filter(s=>s.type==="obsbot_tail2"||s.name.toLowerCase().includes("obsbot")));async function l(){if(!C.value){D.error("Please select a camera first");return}await r.connect(),r.connected.value?(r.setCamera(C.value),D.success("PTZ Controller connected")):D.error("Failed to connect PTZ controller")}function h(){r.disconnect(),D.info("PTZ Controller disconnected")}function F(){const s=navigator.getGamepads();let t=null;for(let n=0;n<s.length;n++)if(s[n]){t=n;break}if(t===null){D.error("No gamepad detected. Please connect a gamepad/joystick first.");return}r.startGamepad(t),setTimeout(()=>{r.gamepadInfo.value&&D.success(`Gamepad connected: ${r.gamepadInfo.value.id}`)},100)}function B(){r.stopGamepad(),D.info("Gamepad disconnected")}const z=b(0),I=b(0),x=b(0);function i(){if(!C.value){D.error("Please select a camera first");return}if(!r.connected.value){D.error("PTZ Controller not connected");return}r.sendPTZCommand({pan:z.value,tilt:I.value,zoom:x.value})}function c(){C.value&&r.connected.value&&r.setCamera(C.value)}return q(async()=>{await N(),!C.value&&o.value.length>0&&(C.value=o.value[0].name)}),le(()=>{h(),B()}),se(()=>k.cameraName,s=>{s&&(C.value=s,r.connected.value&&r.setCamera(s))}),(s,t)=>(u(),d("div",Lt,[e("div",Jt,[t[6]||(t[6]=e("h3",{class:"ptz-controller-panel__title"},"PTZ Controller",-1)),e("button",{onClick:t[0]||(t[0]=n=>m("close")),class:"ptz-controller-panel__close",title:"Close"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Dt,[e("div",Wt,[t[8]||(t[8]=e("label",{class:"ptz-controller-panel__label"},"Camera",-1)),G(e("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>C.value=n),class:"ptz-controller-panel__select",onChange:c},[t[7]||(t[7]=e("option",{value:null},"Select camera...",-1)),(u(!0),d(R,null,H(o.value,n=>(u(),d("option",{key:n.name,value:n.name},g(n.name)+" ("+g(n.connected?"Connected":"Disconnected")+") ",9,jt))),128))],544),[[we,C.value]])]),e("div",Rt,[e("div",Ht,[e("span",{class:M(["ptz-controller-panel__status-dot",{"ptz-controller-panel__status-dot--connected":w(r).connected.value,"ptz-controller-panel__status-dot--disconnected":!w(r).connected.value}])},null,2),e("span",qt,g(w(r).connected.value?"Connected":"Disconnected"),1)]),e("div",Kt,[e("button",{onClick:l,disabled:!C.value||w(r).connected.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Connect ",8,Qt),e("button",{onClick:h,disabled:!w(r).connected.value,class:"ptz-controller-panel__btn"}," Disconnect ",8,Xt)])]),y.value?(u(),d("div",Yt,[e("div",ea,[t[9]||(t[9]=e("span",{class:"ptz-controller-panel__status-dot ptz-controller-panel__status-dot--connected"},null,-1)),e("span",ta," Gamepad: "+g(v.value),1)])])):$("",!0),e("div",aa,[t[13]||(t[13]=e("label",{class:"ptz-controller-panel__label"},"Manual Control (Testing)",-1)),e("div",na,[e("div",oa,[t[10]||(t[10]=e("label",null,"Pan",-1)),G(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>z.value=n),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[O,z.value,void 0,{number:!0}]]),e("span",sa,g(z.value.toFixed(1)),1)]),e("div",la,[t[11]||(t[11]=e("label",null,"Tilt",-1)),G(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>I.value=n),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[O,I.value,void 0,{number:!0}]]),e("span",ia,g(I.value.toFixed(1)),1)]),e("div",ra,[t[12]||(t[12]=e("label",null,"Zoom",-1)),G(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>x.value=n),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[O,x.value,void 0,{number:!0}]]),e("span",ca,g(x.value.toFixed(1)),1)]),e("button",{onClick:i,disabled:!w(r).connected.value||!C.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Send Command ",8,ua)])]),e("div",da,[e("div",ma,[e("button",{onClick:F,disabled:y.value,class:"ptz-controller-panel__btn"}," Start Gamepad ",8,pa),e("button",{onClick:B,disabled:!y.value,class:"ptz-controller-panel__btn"}," Stop Gamepad ",8,va)]),t[14]||(t[14]=e("p",{class:"ptz-controller-panel__hint"}," Connect a gamepad/joystick and use left stick for pan/tilt, triggers for zoom ",-1))])])]))}}),za=ne(fa,[["__scopeId","data-v-ebf7148f"]]),ba={class:"loading-screen"},ga={class:"loading-content"},ya={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},ha={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},_a={class:"loading-text"},Ca={class:"loading-tagline"},xa={class:"loading-dots"},wa=ae({__name:"ModeLoadingScreen",props:{mode:{},minTime:{default:1500},maxTime:{default:8e3},contentReady:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1}},emits:["ready","cancel"],setup(p,{emit:P}){const k=p,m=P;function S(){m("cancel")}const N=b(!1);let r=null,C=null;function y(){N.value&&k.contentReady&&m("ready")}se(()=>k.contentReady,F=>{F&&y()});const v=L(()=>k.mode==="recorder"?"#d45a5a":"#7c3aed"),o=L(()=>k.mode==="recorder"?"Recorder":"Mixer"),l=L(()=>k.mode==="recorder"?"Multi-cam ISO Recording":"Live Switching & Streaming"),h=L(()=>k.mode==="recorder"?"red":"purple");return q(()=>{r=setTimeout(()=>{N.value=!0,y()},k.minTime),C=setTimeout(()=>{m("ready")},k.maxTime)}),le(()=>{r&&clearTimeout(r),C&&clearTimeout(C)}),(F,B)=>(u(),d("div",ba,[re($e,{accent:h.value,"show-beams":!0,"show-pattern":!0},null,8,["accent"]),e("div",ga,[e("div",{class:"loading-icon",style:ee({color:v.value})},[p.mode==="recorder"?(u(),d("svg",ya,[...B[0]||(B[0]=[e("rect",{x:"2",y:"5",width:"14",height:"12",rx:"2"},null,-1),e("path",{d:"M16 9l4-2v8l-4-2"},null,-1),e("circle",{cx:"6",cy:"8",r:"2",fill:"currentColor",stroke:"none"},null,-1)])])):(u(),d("svg",ha,[...B[1]||(B[1]=[ke('<rect x="2" y="2" width="9" height="6" rx="1" data-v-e506a0ca></rect><rect x="13" y="2" width="9" height="6" rx="1" data-v-e506a0ca></rect><rect x="2" y="10" width="9" height="6" rx="1" data-v-e506a0ca></rect><rect x="13" y="10" width="9" height="6" rx="1" data-v-e506a0ca></rect><circle cx="12" cy="20" r="2" fill="currentColor" data-v-e506a0ca></circle><path d="M9 19.5a4 4 0 0 1 6 0" stroke-linecap="round" data-v-e506a0ca></path>',6)])])),e("div",{class:"loading-icon__glow",style:ee({background:v.value})},null,4)],4),e("div",_a,[e("h2",{class:"loading-title",style:ee({color:v.value})},g(o.value),5),e("p",Ca,g(l.value),1)]),e("div",xa,[(u(),d(R,null,H(3,z=>e("div",{key:z,class:"loading-dot",style:ee({backgroundColor:v.value,animationDelay:`${(z-1)*.15}s`})},null,4)),64))]),p.showCancel?(u(),d("button",{key:0,onClick:S,class:"loading-cancel"},[...B[2]||(B[2]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),W(" Go back ",-1)])])):$("",!0)])]))}}),Sa=ne(wa,[["__scopeId","data-v-e506a0ca"]]);export{Ta as C,Sa as M,za as P,te as u};
