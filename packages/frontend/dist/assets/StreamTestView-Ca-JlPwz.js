import{d as S,r as p,o as k,l as T,c as i,a as e,t as o,f as P,F as M,y as $,n as g,i as r}from"./index-CfBpj2rW.js";const U={class:"h-full flex flex-col bg-slate-900 text-white overflow-auto"},I={class:"flex items-center justify-between px-6 py-4 border-b border-slate-700 bg-slate-800"},L={class:"flex items-center gap-3"},B={key:0,class:"text-amber-400"},F={key:1,class:"text-red-400"},W={key:2,class:"text-emerald-400"},H={class:"flex-1 p-6 overflow-auto"},O={class:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"},E={class:"px-4 py-3 bg-slate-700/50 border-b border-slate-600 flex items-center justify-between"},A={class:"flex items-center gap-3"},D={class:"font-semibold text-lg"},q={class:"text-xs text-slate-400 font-mono"},V={class:"p-4 space-y-4"},X={class:"flex items-center gap-4 text-sm"},j={class:"text-slate-400"},N={class:"grid grid-cols-2 gap-2 text-xs text-slate-400"},Y={class:"ml-1 text-slate-300"},z={class:"ml-1 text-slate-300"},K=["onClick","disabled"],G={class:"space-y-2 pt-2 border-t border-slate-600"},J={class:"flex items-center gap-2"},Q={class:"flex-1 text-xs bg-slate-700 px-2 py-1 rounded truncate"},Z=["onClick"],ee={class:"flex items-center gap-2"},te={class:"flex-1 text-xs bg-slate-700 px-2 py-1 rounded truncate"},se=["onClick"],ae={class:"flex items-center gap-2"},le={class:"flex-1 text-xs bg-slate-700 px-2 py-1 rounded truncate"},oe=["onClick"],ne={class:"flex items-center gap-2"},ie={class:"flex-1 text-xs bg-slate-700 px-2 py-1 rounded truncate"},re=["onClick"],de={class:"mt-8 bg-gradient-to-r from-emerald-900/30 to-slate-800 rounded-xl border border-emerald-700/50 p-6"},ce={class:"flex flex-wrap gap-3"},m="https://r58-mediamtx.itagenten.no",xe=S({__name:"StreamTestView",setup(pe){const d=p([]);p(null);const f=p(!0),c=p(null);let x=null;async function u(){try{const a=await fetch(`${m}/v3/paths/list`);if(!a.ok)throw new Error(`API error: ${a.status}`);const t=await a.json();t.items&&(d.value=t.items.map(s=>{var l;return{name:s.name,label:s.name.replace("cam","Camera ").replace("mixer_program","Program Output"),available:s.ready||!1,viewers:((l=s.readers)==null?void 0:l.length)||0,bytesReceived:s.bytesReceived||0,bytesSent:s.bytesSent||0}})),c.value=null}catch(a){console.error("[StreamTest] Failed to fetch streams:",a),c.value="Failed to connect to MediaMTX API",d.value=[{name:"cam0",label:"Camera 0 (HDMI-IN0)",available:!1,viewers:0,bytesReceived:0,bytesSent:0},{name:"cam2",label:"Camera 2 (HDMI-IN11)",available:!1,viewers:0,bytesReceived:0,bytesSent:0},{name:"cam3",label:"Camera 3 (HDMI-IN21)",available:!1,viewers:0,bytesReceived:0,bytesSent:0},{name:"mixer_program",label:"Program Output",available:!1,viewers:0,bytesReceived:0,bytesSent:0}]}finally{f.value=!1}}const h=a=>`${m}/${a}/whep`,b=a=>`rtsp://r58-mediamtx.itagenten.no:8554/${a}`,v=a=>`srt://r58-mediamtx.itagenten.no:8890?streamid=read:${a}`,y=a=>`${m}/${a}/index.m3u8`,C=a=>`${m}/${a}/`;async function n(a,t){try{await navigator.clipboard.writeText(a),alert(`Copied ${t} URL to clipboard!`)}catch(s){console.error("Failed to copy:",s);const l=document.createElement("textarea");l.value=a,document.body.appendChild(l),l.select(),document.execCommand("copy"),document.body.removeChild(l),alert(`Copied ${t} URL to clipboard!`)}}function _(a){const t=`https://r58-vdo.itagenten.no/?view=${a}&solo&room=studio&password=preke-r58-2024`;window.open(t,`preview_${a}`,"width=1280,height=720,menubar=no,toolbar=no")}function R(a){const t=C(a);window.open(t,`webrtc_${a}`,"width=1280,height=720,menubar=no,toolbar=no")}function w(a){if(a===0)return"0 B";const t=1024,s=["B","KB","MB","GB"],l=Math.floor(Math.log(a)/Math.log(t));return parseFloat((a/Math.pow(t,l)).toFixed(1))+" "+s[l]}return k(()=>{u(),x=setInterval(u,5e3)}),T(()=>{x&&clearInterval(x)}),(a,t)=>(r(),i("div",U,[e("header",I,[t[4]||(t[4]=e("div",{class:"flex items-center gap-4"},[e("h1",{class:"text-2xl font-bold text-emerald-400"},"Stream Test Page"),e("span",{class:"text-sm text-slate-400"},"MediaMTX Stream Monitor")],-1)),e("div",L,[f.value?(r(),i("span",B,"Loading...")):c.value?(r(),i("span",F,o(c.value),1)):(r(),i("span",W,o(d.value.length)+" streams found",1)),e("button",{onClick:u,class:"px-3 py-1.5 bg-slate-700 hover:bg-slate-600 rounded text-sm transition"}," Refresh ")])]),e("main",H,[e("div",O,[(r(!0),i(M,null,$(d.value,s=>(r(),i("div",{key:s.name,class:"bg-slate-800 rounded-xl border border-slate-700 overflow-hidden shadow-lg"},[e("div",E,[e("div",A,[e("div",{class:g(["w-3 h-3 rounded-full",s.available?"bg-emerald-500 animate-pulse":"bg-slate-500"])},null,2),e("h2",D,o(s.label),1)]),e("span",q,o(s.name),1)]),e("div",V,[e("div",X,[e("span",{class:g(s.available?"text-emerald-400":"text-red-400")},o(s.available?"● Live":"○ Offline"),3),e("span",j,o(s.viewers)+" viewer"+o(s.viewers!==1?"s":""),1)]),e("div",N,[e("div",null,[t[5]||(t[5]=e("span",{class:"text-slate-500"},"↓ Received:",-1)),e("span",Y,o(w(s.bytesReceived)),1)]),e("div",null,[t[6]||(t[6]=e("span",{class:"text-slate-500"},"↑ Sent:",-1)),e("span",z,o(w(s.bytesSent)),1)])]),e("button",{onClick:l=>_(s.name),disabled:!s.available,class:g(["w-full py-2 rounded-lg font-medium transition",s.available?"bg-emerald-600 hover:bg-emerald-500 text-white":"bg-slate-700 text-slate-500 cursor-not-allowed"])},o(s.available?"▶ Watch Preview":"Not Available"),11,K),e("div",G,[t[11]||(t[11]=e("h3",{class:"text-sm font-medium text-slate-300"},"Stream URLs",-1)),e("div",J,[t[7]||(t[7]=e("span",{class:"text-xs text-emerald-400 w-16"},"WHEP:",-1)),e("code",Q,o(h(s.name)),1),e("button",{onClick:l=>n(h(s.name),"WHEP"),class:"px-2 py-1 text-xs bg-slate-600 hover:bg-slate-500 rounded"}," Copy ",8,Z)]),e("div",ee,[t[8]||(t[8]=e("span",{class:"text-xs text-blue-400 w-16"},"RTSP:",-1)),e("code",te,o(b(s.name)),1),e("button",{onClick:l=>n(b(s.name),"RTSP"),class:"px-2 py-1 text-xs bg-slate-600 hover:bg-slate-500 rounded"}," Copy ",8,se)]),e("div",ae,[t[9]||(t[9]=e("span",{class:"text-xs text-amber-400 w-16"},"SRT:",-1)),e("code",le,o(v(s.name)),1),e("button",{onClick:l=>n(v(s.name),"SRT"),class:"px-2 py-1 text-xs bg-slate-600 hover:bg-slate-500 rounded"}," Copy ",8,oe)]),e("div",ne,[t[10]||(t[10]=e("span",{class:"text-xs text-purple-400 w-16"},"HLS:",-1)),e("code",ie,o(y(s.name)),1),e("button",{onClick:l=>n(y(s.name),"HLS"),class:"px-2 py-1 text-xs bg-slate-600 hover:bg-slate-500 rounded"}," Copy ",8,re)])])])]))),128))]),t[14]||(t[14]=P('<div class="mt-8 bg-slate-800 rounded-xl border border-slate-700 p-6"><h2 class="text-xl font-semibold mb-4 text-emerald-400">How to Use These Streams</h2><div class="grid md:grid-cols-2 gap-6"><div><h3 class="font-medium text-slate-200 mb-2">VLC / FFplay</h3><div class="space-y-2 text-sm"><p class="text-slate-400">For RTSP:</p><code class="block bg-slate-700 p-2 rounded text-xs"> vlc rtsp://r58-mediamtx.itagenten.no:8554/cam0 </code><p class="text-slate-400 mt-2">For SRT:</p><code class="block bg-slate-700 p-2 rounded text-xs"> ffplay &quot;srt://r58-mediamtx.itagenten.no:8890?streamid=read:cam0&quot; </code></div></div><div><h3 class="font-medium text-slate-200 mb-2">OBS Studio</h3><div class="space-y-2 text-sm text-slate-400"><p>Add a &quot;Media Source&quot; with these settings:</p><ul class="list-disc list-inside space-y-1 text-slate-300"><li>Uncheck &quot;Local File&quot;</li><li>Input: Use the RTSP or SRT URL</li><li>Network Buffering: 100-300ms</li><li>Restart on activation: ✓</li></ul></div></div><div><h3 class="font-medium text-slate-200 mb-2">Stream to YouTube</h3><div class="space-y-2 text-sm text-slate-400"><p>MediaMTX can relay to YouTube via RTMP. Configure with:</p><code class="block bg-slate-700 p-2 rounded text-xs break-all"> runOnReady: ffmpeg -i rtsp://localhost:8554/mixer_program -c copy -f flv rtmp://a.rtmp.youtube.com/live2/YOUR-KEY </code></div></div><div><h3 class="font-medium text-slate-200 mb-2">Browser Playback</h3><div class="space-y-2 text-sm text-slate-400"><p>Use WHEP URLs with compatible players:</p><ul class="list-disc list-inside space-y-1 text-slate-300"><li>VDO.ninja with &amp;whepshare parameter</li><li>MediaMTX built-in WebRTC player</li><li>Any WHEP-compatible player</li></ul></div></div></div></div>',1)),e("div",de,[t[12]||(t[12]=e("h2",{class:"text-xl font-semibold mb-4 text-emerald-400"},"Program Output (mixer_program)",-1)),t[13]||(t[13]=e("p",{class:"text-slate-300 mb-4"},' This stream contains the mixed output from VDO.ninja. When a camera is "sent to scene" in the mixer, it appears in this program output. ',-1)),e("div",ce,[e("button",{onClick:t[0]||(t[0]=s=>_("mixer_program")),class:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 rounded-lg font-medium transition"}," Watch Program Output "),e("button",{onClick:t[1]||(t[1]=s=>R("mixer_program")),class:"px-4 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg font-medium transition"}," MediaMTX WebRTC Player "),e("button",{onClick:t[2]||(t[2]=s=>n(b("mixer_program"),"Program RTSP")),class:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg transition"}," Copy RTSP URL "),e("button",{onClick:t[3]||(t[3]=s=>n(v("mixer_program"),"Program SRT")),class:"px-4 py-2 bg-slate-600 hover:bg-slate-500 rounded-lg transition"}," Copy SRT URL ")])])])]))}});export{xe as default};
