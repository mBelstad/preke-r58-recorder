import{d as M,A as R,r as p,h as y,B as V,c as l,a as s,b as _,t as m,n as S,F as w,q as k,o,j as D,l as C,m as O,T as U,J as j,E as B,_ as E}from"./index-8SpDcwuL.js";import{b as $,g as N,a as T,V as W,c as L}from"./vdoninja-B8xyOmWt.js";import{M as F}from"./ModeLoadingScreen-7SZDpB1C.js";const z={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"camera-push-bar"},A={class:"flex items-center gap-2"},q={class:"text-r58-text-secondary"},H={key:0,class:"px-4 pb-3"},I={key:0,class:"flex gap-3 flex-wrap"},J={class:"text-sm font-medium"},G={class:"text-xs text-r58-text-secondary"},K=["onClick"],Q={key:1,class:"text-sm text-r58-text-secondary py-2"},X={class:"hidden"},Y=["src","onLoad","onError"],Z=M({__name:"CameraPushBar",setup(P){const f=R(),a=p(new Map),c=p(!0),x=y(()=>f.inputs.filter(e=>e.hasSignal));function h(e){return N(e)}V(x,e=>{for(const t of e)if(!a.value.has(t.id)){const i=h(t.id),u=$(t.id,i,t.label);a.value.set(t.id,{cameraId:t.id,label:t.label,status:"connecting",iframeSrc:u})}const r=new Set(e.map(t=>t.id));for(const[t]of a.value)r.has(t)||a.value.delete(t)},{immediate:!0});function g(e){const r=a.value.get(e);r&&(r.status="connected",console.log(`[CameraPush] ${e} connected to VDO.ninja`))}function b(e){const r=a.value.get(e);r&&(r.status="error",console.error(`[CameraPush] ${e} failed to connect`))}function v(e){const r=f.inputs.find(u=>u.id===e);if(!r||!r.hasSignal)return;const t=h(e),i=$(e,t,r.label);a.value.set(e,{cameraId:e,label:r.label,status:"connecting",iframeSrc:i+`&_t=${Date.now()}`})}function d(e){switch(e){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function n(e){switch(e){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(e,r)=>(o(),l("div",z,[s("button",{onClick:r[0]||(r[0]=t=>c.value=!c.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[s("div",A,[r[1]||(r[1]=s("span",{class:"font-medium"},"Camera Sources",-1)),s("span",q,"("+m(x.value.length)+" active)",1)]),(o(),l("svg",{class:S(["w-4 h-4 transition-transform",{"rotate-180":c.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...r[2]||(r[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),c.value?(o(),l("div",H,[a.value.size>0?(o(),l("div",I,[(o(!0),l(w,null,k(a.value,([t,i])=>(o(),l("div",{key:t,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[s("span",{class:S(["w-2 h-2 rounded-full",d(i.status)])},null,2),s("span",J,m(i.label),1),s("span",G,m(n(i.status)),1),i.status==="error"?(o(),l("button",{key:0,onClick:u=>v(t),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,K)):_("",!0)]))),128))])):(o(),l("div",Q," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):_("",!0),s("div",X,[(o(!0),l(w,null,k(a.value,([t,i])=>(o(),l("iframe",{key:t,src:i.iframeSrc,onLoad:u=>g(t),onError:u=>b(t),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Y))),128))])]))}}),ee={class:"h-full flex flex-col bg-r58-bg-primary"},te={class:"flex items-center justify-between px-4 py-2 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},se={class:"flex items-center gap-3"},re={class:"text-sm text-r58-text-secondary"},ae={class:"flex items-center gap-2 text-xs text-r58-text-secondary"},ne={class:"px-2 py-1 bg-r58-bg-tertiary rounded"},oe={class:"flex-1 relative"},le=["src"],ie={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-primary"},ce=M({__name:"MixerView",setup(P){const f=R(),a=p(!0),c=p(!1),x=p(null),h=y(()=>{const d=T({room:L}),n=new URL(d);return n.searchParams.set("password",W),n.searchParams.set("darkmode",""),n.searchParams.set("nologo",""),n.searchParams.set("hideheader",""),n.searchParams.set("api",""),n.toString()}),g=y(()=>f.inputs.filter(d=>d.hasSignal).length);function b(){console.log("[Mixer] Native mixer iframe loaded"),c.value=!0}function v(){a.value=!1}return D(async()=>{await f.fetchInputs()}),(d,n)=>(o(),l(w,null,[C(U,{name:"fade"},{default:O(()=>[a.value?(o(),B(F,{key:0,mode:"mixer","content-ready":c.value,"min-time":1500,"max-time":1e4,onReady:v},null,8,["content-ready"])):_("",!0)]),_:1}),s("div",ee,[s("header",te,[s("div",se,[n[0]||(n[0]=s("span",{class:"text-lg font-semibold text-r58-mixer"},"Mixer",-1)),s("span",re,m(g.value)+" camera"+m(g.value!==1?"s":"")+" connected ",1)]),s("div",ae,[s("span",ne,"Room: "+m(j(L)),1)])]),s("div",oe,[s("iframe",{ref_key:"iframeRef",ref:x,src:h.value,onLoad:b,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,le),c.value?_("",!0):(o(),l("div",ie,[...n[1]||(n[1]=[s("div",{class:"flex flex-col items-center gap-4"},[s("div",{class:"w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full animate-spin"}),s("span",{class:"text-r58-text-secondary"},"Loading VDO.ninja mixer...")],-1)])]))]),C(Z)])],64))}}),fe=E(ce,[["__scopeId","data-v-b21234ee"]]);export{fe as default};
