import{D as re,a0 as xe,a1 as ke,a2 as $e,r as x,l as L,J as Z,d as ae,o as K,c as m,e,f as T,y as J,t as y,F as j,z as q,n as B,s as P,k as d,_ as ne,H as le,K as Te,w as ce,q as E,B as G,g as ue,R as ze,p as ie,P as Pe,j as D,C as H,a as Se}from"./index-wGeF6xKQ.js";import{A as Ue}from"./AnimatedBackground-DLBv4-kD.js";const se={lan:2e3,tailscale:2e3,frp:3e3};async function Ne(s,C,w){const r=performance.now();try{const b=await fetch(`${C}/health`,{method:"GET",signal:w,cache:"no-store"});if(!b.ok)throw new Error(`HTTP ${b.status}`);const v=performance.now()-r;return{method:s,url:C,latency:v,success:!0}}catch(b){throw{method:s,url:C,error:b}}}async function Fe(){const s={},C=n=>{if(n==="localhost"||n==="127.0.0.1"||n.startsWith("192.168.")||n.startsWith("10."))return!0;if(n.startsWith("172.")){const f=parseInt(n.split(".")[1],10);return f>=16&&f<=31}return!1},w=n=>n.startsWith("100.")||n.endsWith(".ts.net"),r=xe();if(r)try{const n=new URL(r);w(n.hostname)?s.tailscaleUrl=r:C(n.hostname)&&(s.lanUrl=r)}catch{console.warn("[ConnectionProbe] Invalid device URL:",r)}const b=ke();b&&!s.tailscaleUrl&&(s.tailscaleUrl=b);const v=await $e();return v?s.frpUrl=v:s.frpUrl="https://app.itagenten.no",s}async function Za(s){const C=await Fe(),w=[],r=[],b=[];if(C.lanUrl&&b.push({method:"lan",url:C.lanUrl,timeout:se.lan}),C.tailscaleUrl&&b.push({method:"tailscale",url:C.tailscaleUrl,timeout:se.tailscale}),C.frpUrl&&b.push({method:"frp",url:C.frpUrl,timeout:se.frp}),b.length===0)return console.warn("[ConnectionProbe] No connection methods available, using HLS fallback"),{method:"hls",url:"https://app.itagenten.no",latency:0,success:!1};for(const v of b){const n=new AbortController;r.push(n),s==null||s(`Testing ${v.method.toUpperCase()} connection...`);const f=setTimeout(()=>n.abort(),v.timeout);w.push(Ne(v.method,v.url,n.signal).then(g=>(clearTimeout(f),g)).catch(g=>{throw clearTimeout(f),g}))}try{const v=await Promise.any(w);return r.forEach(n=>n.abort()),console.log(`[ConnectionProbe] Winner: ${v.method.toUpperCase()} (${Math.round(v.latency)}ms)`),s==null||s(`Connected via ${v.method.toUpperCase()}`),re(v.url),v}catch{console.warn("[ConnectionProbe] All methods failed, using HLS fallback"),s==null||s("Using HLS fallback");const n=C.frpUrl||"https://app.itagenten.no";return re(n),{method:"hls",url:n,latency:0,success:!1}}}function te(){const s=x([]),C=x(!1),w=x(null),r=x(null);async function b(){C.value=!0,w.value=null;try{const u=await Z.cameras.list();s.value=await Promise.all(u.map(async p=>{try{const i=await Z.cameras.getStatus(p);return{name:i.name,type:i.type,connected:i.connected,settings:i.settings}}catch{return{name:p,type:"blackmagic",connected:!1}}}))}catch(u){w.value=u.message||"Failed to load cameras",console.error("[CameraControls] Failed to load cameras:",u)}finally{C.value=!1}}const v=L(()=>u=>s.value.find(p=>p.name===u));function n(u,p){const i=v.value(u);if(!i)return!1;const t=["focus","iris","whiteBalance","gain","iso","shutter","colorCorrection"],o=["focus","exposure","whiteBalance","ptz"],O=["focus","exposure","whiteBalance","iso","shutter","ptz"];return i.type==="blackmagic"?t.includes(p):i.type==="obsbot_tail2"?o.includes(p):i.type==="sony_fx30"?O.includes(p):!1}async function f(u,p,i){try{await Z.cameras.setFocus(u,p,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set focus")}}async function g(u,p,i){try{await Z.cameras.setWhiteBalance(u,p,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set white balance")}}async function h(u,p,i){try{await Z.cameras.setExposure(u,p,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set exposure")}}async function l(u,p){try{await Z.cameras.setISO(u,p),await z(u)}catch(i){throw new Error(i.message||"Failed to set ISO")}}async function c(u,p){try{await Z.cameras.setShutter(u,p),await z(u)}catch(i){throw new Error(i.message||"Failed to set shutter")}}async function k(u,p,i){try{await Z.cameras.setIris(u,p,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set iris")}}async function N(u,p){try{await Z.cameras.setGain(u,p),await z(u)}catch(i){throw new Error(i.message||"Failed to set gain")}}async function F(u,p,i,t){try{await Z.cameras.setPTZ(u,p,i,t)}catch(o){throw new Error(o.message||"Failed to move PTZ")}}async function U(u,p){try{await Z.cameras.recallPTZPreset(u,p)}catch(i){throw new Error(i.message||"Failed to recall preset")}}async function M(u,p){try{await Z.cameras.setColorCorrection(u,p),await z(u)}catch(i){throw new Error(i.message||"Failed to set color correction")}}async function z(u){try{const p=await Z.cameras.getStatus(u),i=s.value.findIndex(t=>t.name===u);i>=0&&(s.value[i]={name:p.name,type:p.type,connected:p.connected,settings:p.settings})}catch(p){console.error(`[CameraControls] Failed to refresh status for ${u}:`,p)}}return{cameras:s,loading:C,error:w,selectedCamera:r,getCamera:v,supportsFeature:n,loadCameras:b,setFocus:f,setWhiteBalance:g,setExposure:h,setISO:l,setShutter:c,setIris:k,setGain:N,setPTZ:F,recallPTZPreset:U,setColorCorrection:M,refreshCameraStatus:z}}const Be={class:"companion-panel"},Me={class:"panel-header"},Ie=["aria-label"],Ze={key:0,class:"help-section"},Ee={class:"help-text"},Ge={class:"camera-list"},Oe={class:"camera-header"},Ve={class:"camera-info"},Ae={class:"camera-name"},Le={class:"camera-type"},We={class:"endpoints-section"},De={class:"endpoint-group"},Je={class:"endpoint-path"},Re=["onClick"],He={class:"quick-actions"},je={class:"action-buttons"},qe=["onClick"],Ke={key:1,class:"empty-state"},Qe=ae({__name:"CompanionIntegrationPanel",setup(s){const{cameras:C,loadCameras:w}=te(),r=x(!1),b=L(()=>typeof window<"u"?window.location.origin:"https://app.itagenten.no");function v(h){return{blackmagic:"Blackmagic Studio 4K Pro",obsbot_tail2:"OBSbot Tail 2",sony_fx30:"Sony FX30"}[h]||h}function n(h){const l=`${b.value}/api/v1/cameras/${h.name}`,c=[];return c.push({method:"PUT",path:`${l}/settings/focus`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${l}/settings/focus`,example:JSON.stringify({mode:"manual",value:.5},null,2)}),c.push({method:"PUT",path:`${l}/settings/whiteBalance`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${l}/settings/whiteBalance`,example:JSON.stringify({mode:"manual",temperature:5600},null,2)}),(h.type==="obsbot_tail2"||h.type==="sony_fx30")&&c.push({method:"PUT",path:`${l}/settings/exposure`,example:JSON.stringify({mode:"auto"},null,2)}),(h.type==="blackmagic"||h.type==="sony_fx30")&&c.push({method:"PUT",path:`${l}/settings/iso`,example:JSON.stringify({value:400},null,2)}),(h.type==="blackmagic"||h.type==="sony_fx30")&&c.push({method:"PUT",path:`${l}/settings/shutter`,example:JSON.stringify({value:.0167},null,2)}),h.type==="blackmagic"&&(c.push({method:"PUT",path:`${l}/settings/iris`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${l}/settings/gain`,example:JSON.stringify({value:0},null,2)})),(h.type==="obsbot_tail2"||h.type==="sony_fx30")&&(c.push({method:"PUT",path:`${l}/settings/ptz`,example:JSON.stringify({pan:.5,tilt:-.3,zoom:.2},null,2)}),c.push({method:"PUT",path:`${l}/settings/ptz/preset/1`,example:JSON.stringify({},null,2)})),c}function f(h){const l=`${b.value}/api/v1/cameras/${h.name}`,c=[];return c.push({label:"Focus Auto",example:`PUT ${l}/settings/focus
Content-Type: application/json

{"mode":"auto"}`}),c.push({label:"WB Auto",example:`PUT ${l}/settings/whiteBalance
Content-Type: application/json

{"mode":"auto"}`}),(h.type==="obsbot_tail2"||h.type==="sony_fx30")&&c.push({label:"PTZ Center",example:`PUT ${l}/settings/ptz
Content-Type: application/json

{"pan":0,"tilt":0,"zoom":0}`}),c}async function g(h){try{await navigator.clipboard.writeText(h)}catch(l){console.error("Failed to copy:",l)}}return K(()=>{w()}),(h,l)=>(d(),m("div",Be,[e("div",Me,[l[2]||(l[2]=e("h3",{class:"panel-title"},[e("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2","stroke-width":"2"}),e("path",{d:"M9 9h6v6H9z","stroke-width":"2"})]),J(" Bitfocus Companion Integration ")],-1)),e("button",{class:"info-btn",onClick:l[0]||(l[0]=c=>r.value=!r.value),"aria-label":r.value?"Hide help":"Show help"},[...l[1]||(l[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4M12 8h.01"})],-1)])],8,Ie)]),r.value?(d(),m("div",Ze,[e("p",Ee,[l[3]||(l[3]=J(" Control cameras via Bitfocus Companion using HTTP requests. Add an HTTP instance in Companion pointing to ",-1)),e("code",null,y(b.value),1),l[4]||(l[4]=J(" and use the endpoints below. ",-1))])])):T("",!0),e("div",Ge,[(d(!0),m(j,null,q(P(C),c=>(d(),m("div",{key:c.name,class:"camera-card"},[e("div",Oe,[e("div",Ve,[e("span",Ae,y(c.name),1),e("span",Le,y(v(c.type)),1),e("span",{class:B(["status-indicator",c.connected?"connected":"disconnected"])},y(c.connected?"● Connected":"○ Disconnected"),3)])]),e("div",We,[l[6]||(l[6]=e("h4",{class:"section-title"},"Available Endpoints",-1)),e("div",De,[(d(!0),m(j,null,q(n(c),k=>(d(),m("div",{class:"endpoint-item",key:k.method+k.path},[e("div",{class:B(["endpoint-method",k.method.toLowerCase()])},y(k.method),3),e("div",Je,[e("code",null,y(k.path),1)]),e("button",{class:"copy-btn",onClick:N=>g(k.example),title:"Copy example to clipboard"},[...l[5]||(l[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Re)]))),128))])]),e("div",He,[l[7]||(l[7]=e("h4",{class:"section-title"},"Quick Actions",-1)),e("div",je,[(d(!0),m(j,null,q(f(c),k=>(d(),m("button",{key:k.label,class:"action-btn",onClick:N=>g(k.example)},y(k.label),9,qe))),128))])])]))),128))]),P(C).length===0?(d(),m("div",Ke,[...l[8]||(l[8]=[e("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e("circle",{cx:"12",cy:"10",r:"3"})],-1),e("p",null,"No external cameras configured",-1),e("p",{class:"empty-hint"},[J("Add cameras in "),e("code",null,"config.yml"),J(" to enable Companion integration")],-1)])])):T("",!0)]))}}),Xe=ne(Qe,[["__scopeId","data-v-34a9c8fa"]]),Ye={class:"flex items-center justify-between w-full"},et={class:"text-lg font-semibold text-preke-text"},tt={key:0,class:"text-sm text-preke-text-muted mt-1"},at={key:0,class:"py-8 text-center text-preke-text-muted"},nt={key:1,class:"py-8 text-center text-red-400"},ot={key:2,class:"py-8 text-center text-preke-text-muted"},st={key:3,class:"camera-controls"},lt={class:"tabs"},it={key:0,class:"tab-content"},rt={key:0,class:"control-group"},ct={class:"control-row"},ut={key:0,class:"control-slider"},dt={class:"slider-value"},mt=["disabled"],pt={key:1,class:"control-group"},vt={class:"control-row"},ft={key:0,class:"control-input"},gt=["disabled"],bt={key:2,class:"control-group"},ht={class:"control-row"},yt={key:0,class:"control-slider"},Ct={class:"slider-value"},_t=["disabled"],wt={key:1,class:"tab-content"},xt={key:0,class:"control-group"},kt={class:"control-input"},$t=["disabled"],Tt={key:1,class:"control-group"},zt={class:"control-input"},Pt=["disabled"],St={key:2,class:"control-group"},Ut={class:"control-row"},Nt={key:0,class:"control-input"},Ft=["disabled"],Bt={key:3,class:"control-group"},Mt={class:"control-input"},It=["disabled"],Zt={key:2,class:"tab-content"},Et={class:"control-group"},Gt={class:"ptz-controls"},Ot={class:"ptz-axis"},Vt={class:"slider-value"},At={class:"ptz-axis"},Lt={class:"slider-value"},Wt={class:"ptz-axis"},Dt={class:"slider-value"},Jt={key:3,class:"tab-content"},Rt={key:4,class:"tab-content"},Ht=ae({__name:"CameraControlModal",props:{cameraName:{}},emits:["close"],setup(s,{expose:C,emit:w}){const r=s,b=w,v=x(null),{loading:n,error:f,supportsFeature:g,loadCameras:h,getCamera:l}=te(),c=x("basic"),k=L(()=>r.cameraName?l.value(r.cameraName):null),N=x("auto"),F=x(.5),U=x("auto"),M=x(5600),z=x("auto"),u=x(.5),p=x(400),i=x(1/60),t=x("auto"),o=x(2.8),O=x(0),I=x(0),A=x(0),W=x(0),$=x(!1);K(async()=>{await h(),r.cameraName&&k.value&&await Q()}),le(()=>r.cameraName,async S=>{S&&k.value&&await Q()});async function Q(){!r.cameraName||k.value}function oe(){var S;(S=v.value)==null||S.open()}function X(){var S;(S=v.value)==null||S.close(),b("close")}const{setFocus:V,setWhiteBalance:R,setExposure:Y,setISO:ee,setShutter:de,setIris:me,setGain:pe,setPTZ:ve}=te();async function fe(){if(r.cameraName){$.value=!0;try{await V(r.cameraName,N.value,N.value==="manual"?F.value:void 0)}catch(S){alert(`Failed to set focus: ${S.message}`)}finally{$.value=!1}}}async function ge(){if(r.cameraName){$.value=!0;try{await R(r.cameraName,U.value,U.value==="manual"?M.value:void 0)}catch(S){alert(`Failed to set white balance: ${S.message}`)}finally{$.value=!1}}}async function be(){if(r.cameraName){$.value=!0;try{await Y(r.cameraName,z.value,z.value==="manual"?u.value:void 0)}catch(S){alert(`Failed to set exposure: ${S.message}`)}finally{$.value=!1}}}async function he(){if(r.cameraName){$.value=!0;try{await ee(r.cameraName,p.value)}catch(S){alert(`Failed to set ISO: ${S.message}`)}finally{$.value=!1}}}async function ye(){if(r.cameraName){$.value=!0;try{await de(r.cameraName,i.value)}catch(S){alert(`Failed to set shutter: ${S.message}`)}finally{$.value=!1}}}async function Ce(){if(r.cameraName){$.value=!0;try{await me(r.cameraName,t.value,t.value==="manual"?o.value:void 0)}catch(S){alert(`Failed to set iris: ${S.message}`)}finally{$.value=!1}}}async function _e(){if(r.cameraName){$.value=!0;try{await pe(r.cameraName,O.value)}catch(S){alert(`Failed to set gain: ${S.message}`)}finally{$.value=!1}}}async function we(){if(r.cameraName)try{await ve(r.cameraName,I.value,A.value,W.value)}catch(S){alert(`Failed to move PTZ: ${S.message}`)}}return C({open:oe,close:X}),(S,a)=>(d(),Te(ze,{ref_key:"modalRef",ref:v,title:"Camera Controls",size:"xl",onClose:a[23]||(a[23]=_=>b("close"))},{header:ce(()=>[e("div",Ye,[e("div",null,[e("h2",et,y(s.cameraName||"Camera Controls"),1),k.value?(d(),m("p",tt,[J(y(k.value.type==="blackmagic"?"Blackmagic Design":k.value.type==="sony_fx30"?"Sony FX30":"OBSbot Tail 2")+" ",1),e("span",{class:B([k.value.connected?"text-green-500":"text-red-500","ml-2"])},y(k.value.connected?"● Connected":"○ Disconnected"),3)])):T("",!0)])])]),default:ce(()=>[P(n)?(d(),m("div",at," Loading camera settings... ")):P(f)?(d(),m("div",nt,y(P(f)),1)):k.value?(d(),m("div",st,[e("div",lt,[P(g)(s.cameraName,"focus")||P(g)(s.cameraName,"whiteBalance")||P(g)(s.cameraName,"exposure")?(d(),m("button",{key:0,class:B(["tab",{"tab--active":c.value==="basic"}]),onClick:a[0]||(a[0]=_=>c.value="basic")}," Basic ",2)):T("",!0),P(g)(s.cameraName,"iso")||P(g)(s.cameraName,"shutter")||P(g)(s.cameraName,"iris")||P(g)(s.cameraName,"gain")?(d(),m("button",{key:1,class:B(["tab",{"tab--active":c.value==="advanced"}]),onClick:a[1]||(a[1]=_=>c.value="advanced")}," Advanced ",2)):T("",!0),P(g)(s.cameraName,"ptz")?(d(),m("button",{key:2,class:B(["tab",{"tab--active":c.value==="ptz"}]),onClick:a[2]||(a[2]=_=>c.value="ptz")}," PTZ ",2)):T("",!0),P(g)(s.cameraName,"colorCorrection")?(d(),m("button",{key:3,class:B(["tab",{"tab--active":c.value==="color"}]),onClick:a[3]||(a[3]=_=>c.value="color")}," Color ",2)):T("",!0),e("button",{class:B(["tab",{"tab--active":c.value==="companion"}]),onClick:a[4]||(a[4]=_=>c.value="companion")}," Companion ",2)]),c.value==="basic"?(d(),m("div",it,[P(g)(s.cameraName,"focus")?(d(),m("div",rt,[a[24]||(a[24]=e("label",{class:"control-label"},"Focus",-1)),e("div",ct,[e("button",{class:B(["mode-btn",{"mode-btn--active":N.value==="auto"}]),onClick:a[5]||(a[5]=_=>N.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":N.value==="manual"}]),onClick:a[6]||(a[6]=_=>N.value="manual")}," Manual ",2)]),N.value==="manual"?(d(),m("div",ut,[E(e("input",{"onUpdate:modelValue":a[7]||(a[7]=_=>F.value=_),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[G,F.value,void 0,{number:!0}]]),e("span",dt,y(Math.round(F.value*100))+"%",1)])):T("",!0),e("button",{onClick:fe,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Focus"),9,mt)])):T("",!0),P(g)(s.cameraName,"whiteBalance")?(d(),m("div",pt,[a[26]||(a[26]=e("label",{class:"control-label"},"White Balance",-1)),e("div",vt,[e("button",{class:B(["mode-btn",{"mode-btn--active":U.value==="auto"}]),onClick:a[8]||(a[8]=_=>U.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":U.value==="manual"}]),onClick:a[9]||(a[9]=_=>U.value="manual")}," Manual ",2)]),U.value==="manual"?(d(),m("div",ft,[E(e("input",{"onUpdate:modelValue":a[10]||(a[10]=_=>M.value=_),type:"number",min:"2000",max:"10000",step:"100",class:"input"},null,512),[[G,M.value,void 0,{number:!0}]]),a[25]||(a[25]=e("span",{class:"input-unit"},"K",-1))])):T("",!0),e("button",{onClick:ge,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save White Balance"),9,gt)])):T("",!0),P(g)(s.cameraName,"exposure")?(d(),m("div",bt,[a[27]||(a[27]=e("label",{class:"control-label"},"Exposure",-1)),e("div",ht,[e("button",{class:B(["mode-btn",{"mode-btn--active":z.value==="auto"}]),onClick:a[11]||(a[11]=_=>z.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":z.value==="manual"}]),onClick:a[12]||(a[12]=_=>z.value="manual")}," Manual ",2)]),z.value==="manual"?(d(),m("div",yt,[E(e("input",{"onUpdate:modelValue":a[13]||(a[13]=_=>u.value=_),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[G,u.value,void 0,{number:!0}]]),e("span",Ct,y(Math.round(u.value*100))+"%",1)])):T("",!0),e("button",{onClick:be,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Exposure"),9,_t)])):T("",!0)])):T("",!0),c.value==="advanced"?(d(),m("div",wt,[P(g)(s.cameraName,"iso")?(d(),m("div",xt,[a[28]||(a[28]=e("label",{class:"control-label"},"ISO",-1)),e("div",kt,[E(e("input",{"onUpdate:modelValue":a[14]||(a[14]=_=>p.value=_),type:"number",min:"100",max:"25600",step:"100",class:"input"},null,512),[[G,p.value,void 0,{number:!0}]])]),e("button",{onClick:he,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save ISO"),9,$t)])):T("",!0),P(g)(s.cameraName,"shutter")?(d(),m("div",Tt,[a[30]||(a[30]=e("label",{class:"control-label"},"Shutter Speed",-1)),e("div",zt,[E(e("input",{"onUpdate:modelValue":a[15]||(a[15]=_=>i.value=_),type:"number",min:"0.0001",max:"1",step:"0.0001",class:"input"},null,512),[[G,i.value,void 0,{number:!0}]]),a[29]||(a[29]=e("span",{class:"input-unit"},"s",-1))]),e("button",{onClick:ye,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Shutter"),9,Pt)])):T("",!0),P(g)(s.cameraName,"iris")?(d(),m("div",St,[a[32]||(a[32]=e("label",{class:"control-label"},"Iris",-1)),e("div",Ut,[e("button",{class:B(["mode-btn",{"mode-btn--active":t.value==="auto"}]),onClick:a[16]||(a[16]=_=>t.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":t.value==="manual"}]),onClick:a[17]||(a[17]=_=>t.value="manual")}," Manual ",2)]),t.value==="manual"?(d(),m("div",Nt,[E(e("input",{"onUpdate:modelValue":a[18]||(a[18]=_=>o.value=_),type:"number",min:"1.4",max:"22",step:"0.1",class:"input"},null,512),[[G,o.value,void 0,{number:!0}]]),a[31]||(a[31]=e("span",{class:"input-unit"},"f/",-1))])):T("",!0),e("button",{onClick:Ce,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Iris"),9,Ft)])):T("",!0),P(g)(s.cameraName,"gain")?(d(),m("div",Bt,[a[34]||(a[34]=e("label",{class:"control-label"},"Gain",-1)),e("div",Mt,[E(e("input",{"onUpdate:modelValue":a[19]||(a[19]=_=>O.value=_),type:"number",min:"-12",max:"36",step:"0.1",class:"input"},null,512),[[G,O.value,void 0,{number:!0}]]),a[33]||(a[33]=e("span",{class:"input-unit"},"dB",-1))]),e("button",{onClick:_e,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Gain"),9,It)])):T("",!0)])):T("",!0),c.value==="ptz"?(d(),m("div",Zt,[e("div",Et,[a[38]||(a[38]=e("label",{class:"control-label"},"Pan/Tilt/Zoom",-1)),e("div",Gt,[e("div",Ot,[a[35]||(a[35]=e("label",null,"Pan",-1)),E(e("input",{"onUpdate:modelValue":a[20]||(a[20]=_=>I.value=_),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,I.value,void 0,{number:!0}]]),e("span",Vt,y(I.value.toFixed(1)),1)]),e("div",At,[a[36]||(a[36]=e("label",null,"Tilt",-1)),E(e("input",{"onUpdate:modelValue":a[21]||(a[21]=_=>A.value=_),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,A.value,void 0,{number:!0}]]),e("span",Lt,y(A.value.toFixed(1)),1)]),e("div",Wt,[a[37]||(a[37]=e("label",null,"Zoom",-1)),E(e("input",{"onUpdate:modelValue":a[22]||(a[22]=_=>W.value=_),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,W.value,void 0,{number:!0}]]),e("span",Dt,y(W.value.toFixed(1)),1)])]),e("button",{onClick:we,class:"save-btn"}," Move PTZ ")])])):T("",!0),c.value==="color"?(d(),m("div",Jt,[...a[39]||(a[39]=[e("div",{class:"control-group"},[e("p",{class:"text-preke-text-muted text-sm"}," Color correction controls coming soon ")],-1)])])):T("",!0),c.value==="companion"?(d(),m("div",Rt,[ue(Xe)])):T("",!0)])):(d(),m("div",ot," Camera not found "))]),_:1},512))}}),Ea=ne(Ht,[["__scopeId","data-v-d317ac4a"]]);function jt(s=null){const C=x(!1),w=x(!1),r=x(s),b=x(null),v=x(null);let n=null,f=null,g=0;const h=33;let l=null;async function c(){if((n==null?void 0:n.readyState)!==WebSocket.OPEN)try{const t=await Z.buildApiUrl("/api/v1/ptz-controller/ws");n=new WebSocket(t.replace("http","ws").replace("https","wss")),n.onopen=()=>{C.value=!0,r.value&&N(r.value)},n.onerror=o=>{console.error("[PTZController] WebSocket error:",o),C.value=!1},n.onclose=()=>{C.value=!1}}catch(t){console.error("[PTZController] Failed to connect:",t)}}function k(){n&&(n.close(),n=null),C.value=!1,M()}function N(t){r.value=t,(n==null?void 0:n.readyState)===WebSocket.OPEN&&n.send(JSON.stringify({type:"set_camera",camera_name:t}))}function F(t){if(!C.value||!r.value||!n)return;const o=Date.now();o-g<h||(g=o,n.send(JSON.stringify({type:"ptz_command",pan:t.pan,tilt:t.tilt,zoom:t.zoom,focus:t.focus,speed:t.speed||1})))}function U(t=0){if(f)return;b.value=t,w.value=!0;function o(){var Y,ee;if(!w.value)return;const I=navigator.getGamepads()[b.value];if(!I){console.log("[PTZController] Gamepad disconnected during polling"),M(),u();return}(!v.value||v.value.index!==I.index)&&(v.value={id:I.id,index:I.index,mapping:I.mapping||"standard"});const A=Array.from(I.axes),W=Array.from(I.buttons),$=z(A[0]||0,.1),Q=z(-(A[1]||0),.1),oe=z(A[2]||0,.1),X=A[3]?z(A[3],.1):void 0;let V=.5;(Y=W[6])!=null&&Y.value&&(V+=W[6].value*.5),(ee=W[7])!=null&&ee.value&&(V+=W[7].value*.5),V=Math.min(1,V);const R={pan:$*V,tilt:Q*V,zoom:oe*V,focus:X?X*V:void 0,speed:V};(Math.abs(R.pan)>.01||Math.abs(R.tilt)>.01||Math.abs(R.zoom)>.01)&&F(R),f=requestAnimationFrame(o)}o()}function M(){w.value=!1,b.value=null,f&&(cancelAnimationFrame(f),f=null)}function z(t,o){if(Math.abs(t)<o)return 0;const O=t>=0?1:-1,I=(Math.abs(t)-o)/(1-o);return O*I}function u(){l&&clearTimeout(l),l=window.setTimeout(()=>{const t=navigator.getGamepads();for(let o=0;o<t.length;o++)if(t[o]&&b.value===null){console.log("[PTZController] Gamepad reconnected:",t[o].id),U(o);break}l=null},1e3)}function p(t){const o=t.gamepad,O=o.id.toLowerCase().includes("bluetooth")||o.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${O} gamepad connected:`,o.id,{index:o.index,mapping:o.mapping||"standard",axes:o.axes.length,buttons:o.buttons.length}),b.value===null&&U(o.index)}function i(t){const o=t.gamepad,O=o.id.toLowerCase().includes("bluetooth")||o.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${O} gamepad disconnected:`,o.id),b.value===t.gamepad.index&&(M(),v.value=null,u())}return K(()=>{c(),window.addEventListener("gamepadconnected",p),window.addEventListener("gamepaddisconnected",i);const t=navigator.getGamepads();for(let o=0;o<t.length;o++)if(t[o]){U(o);break}}),ie(()=>{k(),M(),l&&clearTimeout(l),window.removeEventListener("gamepadconnected",p),window.removeEventListener("gamepaddisconnected",i)}),{connected:C,active:w,currentCamera:r,gamepadIndex:b,gamepadInfo:v,connect:c,disconnect:k,setCamera:N,sendPTZCommand:F,startGamepad:U,stopGamepad:M}}const qt={class:"ptz-controller-panel"},Kt={class:"ptz-controller-panel__header"},Qt={class:"ptz-controller-panel__content"},Xt={class:"ptz-controller-panel__section"},Yt=["value"],ea={class:"ptz-controller-panel__section"},ta={class:"ptz-controller-panel__status"},aa={class:"ptz-controller-panel__status-text"},na={class:"ptz-controller-panel__buttons"},oa=["disabled"],sa=["disabled"],la={key:0,class:"ptz-controller-panel__section"},ia={class:"ptz-controller-panel__status"},ra={class:"ptz-controller-panel__status-text"},ca={class:"ptz-controller-panel__section"},ua={class:"ptz-controller-panel__manual-controls"},da={class:"ptz-controller-panel__axis"},ma={class:"ptz-controller-panel__value"},pa={class:"ptz-controller-panel__axis"},va={class:"ptz-controller-panel__value"},fa={class:"ptz-controller-panel__axis"},ga={class:"ptz-controller-panel__value"},ba=["disabled"],ha={class:"ptz-controller-panel__section"},ya={class:"ptz-controller-panel__buttons"},Ca=["disabled"],_a=["disabled"],wa=ae({__name:"PTZControllerPanel",props:{cameraName:{}},emits:["close"],setup(s,{emit:C}){const w=s,r=C,{cameras:b,loadCameras:v}=te(),n=jt(w.cameraName||null),f=x(w.cameraName||null),g=L(()=>n.gamepadInfo.value!==null),h=L(()=>{var i;return((i=n.gamepadInfo.value)==null?void 0:i.id)||""}),l=L(()=>b.value.filter(i=>i.type==="obsbot_tail2"||i.name.toLowerCase().includes("obsbot")));async function c(){if(!f.value){D.error("Please select a camera first");return}await n.connect(),n.connected.value?(n.setCamera(f.value),D.success("PTZ Controller connected")):D.error("Failed to connect PTZ controller")}function k(){n.disconnect(),D.info("PTZ Controller disconnected")}function N(){const i=navigator.getGamepads();let t=null;for(let o=0;o<i.length;o++)if(i[o]){t=o;break}if(t===null){D.error("No gamepad detected. Please connect a gamepad/joystick first.");return}n.startGamepad(t),setTimeout(()=>{n.gamepadInfo.value&&D.success(`Gamepad connected: ${n.gamepadInfo.value.id}`)},100)}function F(){n.stopGamepad(),D.info("Gamepad disconnected")}const U=x(0),M=x(0),z=x(0);function u(){if(!f.value){D.error("Please select a camera first");return}if(!n.connected.value){D.error("PTZ Controller not connected");return}n.sendPTZCommand({pan:U.value,tilt:M.value,zoom:z.value})}function p(){f.value&&n.connected.value&&n.setCamera(f.value)}return K(async()=>{await v(),!f.value&&l.value.length>0&&(f.value=l.value[0].name)}),ie(()=>{k(),F()}),le(()=>w.cameraName,i=>{i&&(f.value=i,n.connected.value&&n.setCamera(i))}),(i,t)=>(d(),m("div",qt,[e("div",Kt,[t[6]||(t[6]=e("h3",{class:"ptz-controller-panel__title"},"PTZ Controller",-1)),e("button",{onClick:t[0]||(t[0]=o=>r("close")),class:"ptz-controller-panel__close",title:"Close"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Qt,[e("div",Xt,[t[8]||(t[8]=e("label",{class:"ptz-controller-panel__label"},"Camera",-1)),E(e("select",{"onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o),class:"ptz-controller-panel__select",onChange:p},[t[7]||(t[7]=e("option",{value:null},"Select camera...",-1)),(d(!0),m(j,null,q(l.value,o=>(d(),m("option",{key:o.name,value:o.name},y(o.name)+" ("+y(o.connected?"Connected":"Disconnected")+") ",9,Yt))),128))],544),[[Pe,f.value]])]),e("div",ea,[e("div",ta,[e("span",{class:B(["ptz-controller-panel__status-dot",{"ptz-controller-panel__status-dot--connected":P(n).connected.value,"ptz-controller-panel__status-dot--disconnected":!P(n).connected.value}])},null,2),e("span",aa,y(P(n).connected.value?"Connected":"Disconnected"),1)]),e("div",na,[e("button",{onClick:c,disabled:!f.value||P(n).connected.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Connect ",8,oa),e("button",{onClick:k,disabled:!P(n).connected.value,class:"ptz-controller-panel__btn"}," Disconnect ",8,sa)])]),g.value?(d(),m("div",la,[e("div",ia,[t[9]||(t[9]=e("span",{class:"ptz-controller-panel__status-dot ptz-controller-panel__status-dot--connected"},null,-1)),e("span",ra," Gamepad: "+y(h.value),1)])])):T("",!0),e("div",ca,[t[13]||(t[13]=e("label",{class:"ptz-controller-panel__label"},"Manual Control (Testing)",-1)),e("div",ua,[e("div",da,[t[10]||(t[10]=e("label",null,"Pan",-1)),E(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>U.value=o),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,U.value,void 0,{number:!0}]]),e("span",ma,y(U.value.toFixed(1)),1)]),e("div",pa,[t[11]||(t[11]=e("label",null,"Tilt",-1)),E(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>M.value=o),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,M.value,void 0,{number:!0}]]),e("span",va,y(M.value.toFixed(1)),1)]),e("div",fa,[t[12]||(t[12]=e("label",null,"Zoom",-1)),E(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>z.value=o),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,z.value,void 0,{number:!0}]]),e("span",ga,y(z.value.toFixed(1)),1)]),e("button",{onClick:u,disabled:!P(n).connected.value||!f.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Send Command ",8,ba)])]),e("div",ha,[e("div",ya,[e("button",{onClick:N,disabled:g.value,class:"ptz-controller-panel__btn"}," Start Gamepad ",8,Ca),e("button",{onClick:F,disabled:!g.value,class:"ptz-controller-panel__btn"}," Stop Gamepad ",8,_a)]),t[14]||(t[14]=e("p",{class:"ptz-controller-panel__hint"}," Connect a gamepad/joystick and use left stick for pan/tilt, triggers for zoom ",-1))])])]))}}),Ga=ne(wa,[["__scopeId","data-v-ebf7148f"]]),xa={class:"loading-screen"},ka={class:"loading-content"},$a={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},Ta={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},za={class:"loading-text"},Pa={class:"loading-tagline"},Sa={class:"loading-dots"},Ua={key:0,class:"loading-status"},Na={key:1,class:"loading-progress"},Fa={key:2,class:"loading-method"},Ba=ae({__name:"ModeLoadingScreen",props:{mode:{},minTime:{default:1500},maxTime:{default:8e3},contentReady:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1},statusText:{default:void 0},progress:{default:void 0},connectionMethod:{default:void 0}},emits:["ready","cancel"],setup(s,{emit:C}){const w=s,r=C;function b(){r("cancel")}const v=x(!1);let n=null,f=null;function g(){v.value&&w.contentReady&&r("ready")}le(()=>w.contentReady,N=>{N&&g()});const h=L(()=>w.mode==="recorder"?"#d45a5a":"#7c3aed"),l=L(()=>w.mode==="recorder"?"Recorder":"Mixer"),c=L(()=>w.mode==="recorder"?"Multi-cam ISO Recording":"Live Switching & Streaming"),k=L(()=>w.mode==="recorder"?"red":"purple");return K(()=>{n=setTimeout(()=>{v.value=!0,g()},w.minTime),f=setTimeout(()=>{r("ready")},w.maxTime)}),ie(()=>{n&&clearTimeout(n),f&&clearTimeout(f)}),(N,F)=>(d(),m("div",xa,[ue(Ue,{accent:k.value,"show-beams":!0,"show-pattern":!0},null,8,["accent"]),e("div",ka,[e("div",{class:"loading-icon",style:H({color:h.value})},[s.mode==="recorder"?(d(),m("svg",$a,[...F[0]||(F[0]=[e("rect",{x:"2",y:"5",width:"14",height:"12",rx:"2"},null,-1),e("path",{d:"M16 9l4-2v8l-4-2"},null,-1),e("circle",{cx:"6",cy:"8",r:"2",fill:"currentColor",stroke:"none"},null,-1)])])):(d(),m("svg",Ta,[...F[1]||(F[1]=[Se('<rect x="2" y="2" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="13" y="2" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="2" y="10" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="13" y="10" width="9" height="6" rx="1" data-v-409a3379></rect><circle cx="12" cy="20" r="2" fill="currentColor" data-v-409a3379></circle><path d="M9 19.5a4 4 0 0 1 6 0" stroke-linecap="round" data-v-409a3379></path>',6)])])),e("div",{class:"loading-icon__glow",style:H({background:h.value})},null,4)],4),e("div",za,[e("h2",{class:"loading-title",style:H({color:h.value})},y(l.value),5),e("p",Pa,y(c.value),1)]),e("div",Sa,[(d(),m(j,null,q(3,U=>e("div",{key:U,class:"loading-dot",style:H({backgroundColor:h.value,animationDelay:`${(U-1)*.15}s`})},null,4)),64))]),s.statusText?(d(),m("div",Ua,y(s.statusText),1)):T("",!0),s.progress!==void 0?(d(),m("div",Na,[e("div",{class:"loading-progress__bar",style:H({width:`${s.progress}%`,backgroundColor:h.value})},null,4)])):T("",!0),s.connectionMethod?(d(),m("div",Fa," Connected via "+y(s.connectionMethod),1)):T("",!0),s.showCancel?(d(),m("button",{key:3,onClick:b,class:"loading-cancel"},[...F[2]||(F[2]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),J(" Go back ",-1)])])):T("",!0)])]))}}),Oa=ne(Ba,[["__scopeId","data-v-409a3379"]]);export{Ea as C,Oa as M,Ga as P,Za as p,te as u};
