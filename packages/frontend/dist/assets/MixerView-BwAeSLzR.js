import{H as we,r as S,e as T,f as se,g as re,d as J,y as ae,c as r,n as U,k as E,a as e,G as B,t as $,l as oe,o as n,_ as _e,F as K,m as Y,s as Me,E as V,B as Se,w as le,q as ce,C as $e,I as be,D as Le,h as Q}from"./index-DRWQA2kW.js";import{u as me}from"./recorder-qAqjxP0C.js";const ne=we("mixer",()=>{const u=S(!1),c=S(null),o=S(null),s=S(null),i=S([]),l=T(()=>i.value.filter(f=>f.hasVideo||f.hasAudio));function v(){u.value=!u.value}function h(f){c.value=f}function a(f){o.value=f}function k(f){s.value=f}function y(f){i.value=f}function d(f,D){const R=i.value.find(_=>_.id===f);R&&(R.muted=D)}function w(f,D){const R=i.value.find(_=>_.id===f);R&&(R.audioLevel=D)}return{isLive:u,activeScene:c,programSource:o,previewSource:s,sources:i,activeSources:l,toggleLive:v,setScene:h,setProgram:a,setPreview:k,updateSourcesFromVdo:y,setSourceMute:d,updateAudioLevel:w}}),te=[{id:"youtube",name:"YouTube Live",icon:"‚ñ∂Ô∏è",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"üì∫",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"üìò",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"üîÑ",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"‚öôÔ∏è",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],pe=we("streaming",()=>{const u=S([]),c=S(!1),o=S(null),s=S({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),i=T(()=>u.value.find(x=>x.id===o.value)),l=T(()=>u.value.filter(x=>x.enabled)),v=T(()=>te),h=T(()=>{const x=window.location.hostname,M=x==="localhost"||x==="127.0.0.1"?"localhost":x.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${M}:1935/mixer_program`,rtsp:`rtsp://${M}:8554/mixer_program`,srt:`srt://${M}:8890?streamid=read:mixer_program`,hls:`https://${x}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function a(x,b){const M=te.find(C=>C.id===x);if(!M)throw new Error(`Unknown platform: ${x}`);const F={id:`dest-${Date.now()}`,platformId:x,name:b||M.name,streamKey:"",enabled:!1};return u.value.push(F),F}function k(x,b){const M=u.value.findIndex(F=>F.id===x);M!==-1&&(u.value[M]={...u.value[M],...b})}function y(x){const b=u.value.findIndex(M=>M.id===x);b!==-1&&u.value.splice(b,1),o.value===x&&(o.value=null)}function d(x){o.value=x}function w(x){s.value.enabled=x}function f(x){s.value={...s.value,...x}}function D(){c.value=!0}function R(){c.value=!1}function _(x){const b=te.find(M=>M.id===x.platformId);return b?x.platformId==="custom"?`${x.name}${x.streamKey}`:`${b.rtmpBaseUrl}${x.streamKey}`:""}function m(){const x=window.location.hostname;return`srt://${x==="localhost"||x==="127.0.0.1"?"localhost":x.replace("r58-api","r58-mediamtx")}:${s.value.port}?streamid=read:${s.value.streamId}`}function g(){try{const x=localStorage.getItem("r58-streaming-destinations");if(x){const b=JSON.parse(x);u.value=b.destinations||[],b.srtOutput&&(s.value={...s.value,...b.srtOutput})}}catch(x){console.warn("Failed to load saved streaming destinations:",x)}}function t(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:u.value,srtOutput:s.value}))}catch(x){console.warn("Failed to save streaming destinations:",x)}}return g(),{destinations:u,isStreaming:c,activeDestinationId:o,srtOutput:s,activeDestination:i,enabledDestinations:l,platforms:v,programOutputUrls:h,addDestination:a,updateDestination:k,removeDestination:y,setActiveDestination:d,toggleSrtOutput:w,updateSrtConfig:f,startStreaming:D,stopStreaming:R,buildRtmpUrl:_,getSrtOutputUrl:m,saveDestinations:t,loadSavedDestinations:g}});function ie(){return"r58-vdo.itagenten.no"}function ge(){return"https"}const N="studio",Te={director:{base:"/",params:{director:N,hidesolo:!0,hideheader:!0,cleanoutput:!0,darkmode:!0,nologo:!0}},mixer:{base:"/",params:{director:N,previewmode:!0,hidesolo:!0,darkmode:!0,nologo:!0,api:"r58api"}},scene:{base:"/",params:{scene:!0,room:N,cover:!0,fadein:500,animated:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0}},multiview:{base:"/",params:{room:N,scene:!0,grid:!0,autoadd:"*",cleanoutput:!0,hideheader:!0,nologo:!0}},cameraContribution:{base:"/",params:{room:N,videodevice:0,audiodevice:0,autostart:!0,noaudio:!1}},guestInvite:{base:"/",params:{room:N,webcam:!0,mic:!0,quality:1,effects:!0}},soloView:{base:"/",params:{room:N,cover:!0,cleanoutput:!0}},programOutput:{base:"/",params:{scene:!0,room:N,cover:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0,autostart:!0}}};function ve(){return`${window.location.origin}/static/css/vdo-theme.css`}function je(u,c={}){const o=ie(),s=ge(),i=Te[u],l=i.base||"/",v=new URL(`${s}://${o}${l}`);v.searchParams.set("css",ve());for(const[h,a]of Object.entries(i.params))if(typeof a=="boolean")a&&v.searchParams.set(h,"");else if(typeof a=="number")v.searchParams.set(h,a.toString());else if(typeof a=="string"){let k=a;for(const[y,d]of Object.entries(c))k=k.replace(`{${y}}`,d);k.includes("{")||v.searchParams.set(h,k)}return c.push_id&&v.searchParams.set("push",c.push_id),c.view_id&&v.searchParams.set("view",c.view_id),c.source_ids&&v.searchParams.set("autoadd",c.source_ids),c.whep_url&&v.searchParams.set("whepshare",encodeURIComponent(c.whep_url)),c.label&&v.searchParams.set("label",c.label),v.toString()}function ye(u,c,o){const s=ie(),i=ge(),l=new URL(`${i}://${s}/`);return l.searchParams.set("push",u),l.searchParams.set("room",N),l.searchParams.set("whepshare",c),l.searchParams.set("label",o),l.searchParams.set("videodevice","0"),l.searchParams.set("audiodevice","0"),l.searchParams.set("autostart",""),l.searchParams.set("css",ve()),l.toString()}function Ve(u){const c=ie(),o=ge(),s=new URL(`${o}://${c}/`);return s.searchParams.set("scene",""),s.searchParams.set("room",N),s.searchParams.set("cover",""),s.searchParams.set("quality","2"),s.searchParams.set("cleanoutput",""),s.searchParams.set("hideheader",""),s.searchParams.set("nologo",""),s.searchParams.set("whipout",u),s.searchParams.set("autostart",""),s.searchParams.set("videodevice","0"),s.searchParams.set("audiodevice","0"),s.searchParams.set("css",ve()),s.toString()}const ue="vdo-debug",Ue=500,G=[];let fe=typeof localStorage<"u"&&localStorage.getItem(ue)==="true";function he(u){fe=u,typeof localStorage<"u"&&(u?localStorage.setItem(ue,"true"):localStorage.removeItem(ue)),console.log(`[VDO.ninja Debug] ${u?"Enabled":"Disabled"}`)}function de(u){if(G.push(u),G.length>Ue&&G.shift(),fe){const c=new Date(u.timestamp).toISOString().split("T")[1].slice(0,-1),o=u.direction==="outgoing"?"‚û°Ô∏è OUT":"‚¨ÖÔ∏è IN",s=u.direction==="outgoing"?"color: #3b82f6; font-weight: bold":"color: #22c55e; font-weight: bold";console.groupCollapsed(`%c[VDO.ninja ${o}] %c${u.type}`,s,"color: inherit"),console.log("Time:",c),u.target&&console.log("Target:",u.target),console.log("Data:",u.data),u.raw&&u.raw!==u.data&&console.log("Raw:",u.raw),console.groupEnd()}}function Ce(){return[...G]}function He(){G.length=0,console.log("[VDO.ninja Debug] Event history cleared")}function Re(){const u={total:G.length,incoming:0,outgoing:0,byType:{},lastActivity:G.length>0?G[G.length-1].timestamp:null};for(const c of G)c.direction==="incoming"?u.incoming++:u.outgoing++,u.byType[c.type]=(u.byType[c.type]||0)+1;return u}typeof window<"u"&&(window.__VDO_DEBUG__={getHistory:Ce,clearHistory:He,getStats:Re,enable:()=>he(!0),disable:()=>he(!1),isEnabled:()=>fe});function Ie(u){const c=S(!1),o=S(new Map),s=S(null),i=S(!1),l=S("disconnected"),v=S(null),h=ie();function a(p,O,P,q){var j;if(!((j=u.value)!=null&&j.contentWindow)){console.warn("[VDO.ninja] Cannot send command - iframe not ready"),v.value="iframe not ready";return}const H={action:p};O&&(H.target=O),P!==void 0&&(H.value=P),q!==void 0&&(H.value2=q),de({timestamp:Date.now(),direction:"outgoing",type:p,target:O,data:{action:p,target:O,value:P,value2:q},raw:H});try{u.value.contentWindow.postMessage(H,"*")}catch(A){console.error("[VDO.ninja] Failed to send command:",A),v.value=String(A)}}function k(p,O){var q;if(!((q=u.value)!=null&&q.contentWindow)){console.warn("[VDO.ninja] Cannot send DOM command - iframe not ready");return}const P={action:"",target:p,...O};de({timestamp:Date.now(),direction:"outgoing",type:"dom-manipulation",target:p,data:O,raw:P});try{u.value.contentWindow.postMessage(P,"*")}catch(H){console.error("[VDO.ninja] Failed to send DOM command:",H)}}function y(p,O=1){a("addScene",p,O),s.value=O}function d(p,O=1){a("addScene",p,0)}function w(p){k(p,{replace:!0})}function f(p){k(p,{add:!0})}function D(p){k(p,{remove:!0})}function R(p,O){a("mic",p,!O);const P=o.value.get(p);P&&(P.muted=O)}function _(p){a("mic",p,"toggle");const O=o.value.get(p);O&&(O.muted=!O.muted)}function m(p,O){a("volume",p,Math.max(0,Math.min(200,O)))}function g(p){a("soloChat",p)}function t(p){a("soloChatBidirectional",p)}function x(p,O){a("sendChat",p,O)}function b(p,O){a("sendDirectorChat",p,O)}function M(p){a("hangup",p),o.value.delete(p)}function F(p){p?a("togglescreenshare",p):a("togglescreenshare")}function C(p,O){a("forward",p,O)}function L(p="guests"){a("getGuestList",void 0,void 0)}function I(){a("record",void 0,!0),i.value=!0}function Z(){a("record",void 0,!1),i.value=!1}function z(p){a("layout",void 0,p)}function ee(p){p?a("reload",p):a("reload")}function W(p,O){a("mixorder",p,O==="up"?-1:1)}function X(p){a("camera",void 0,p)}function Oe(p,O){a("camera",p,O)}function De(p,O=!1){O?a("zoom",void 0,p,"abs"):a("zoom",void 0,p)}function Pe(p){a("pan",void 0,p)}function Ee(p){a("tilt",void 0,p)}function xe(p){const O=p.origin;if(!O.includes(h.split(":")[0])&&!O.includes("vdo.ninja")&&!O.includes("vdo.itagenten")&&!O.includes("localhost"))return;const P=p.data;if(!P||typeof P!="object")return;const q=P.type||P.action||"unknown",H=P.streamID||P.UUID||P.streamId;switch(de({timestamp:Date.now(),direction:"incoming",type:q,target:H,data:P.data||P.value,raw:P}),q){case"director-ready":case"loaded":case"ready":case"started":c.value=!0,l.value="connected",v.value=null;break;case"new-guest":case"guest-connected":case"push":case"view":case"joined":{if(H){const j=P.data,A={id:H,label:(j==null?void 0:j.label)||P.label||H,type:(j==null?void 0:j.type)||"guest",hasVideo:(j==null?void 0:j.video)!==!1,hasAudio:(j==null?void 0:j.audio)!==!1,muted:!1,audioLevel:0};o.value.set(H,A)}break}case"guest-left":case"guest-disconnected":case"left":case"disconnect":H&&o.value.delete(H);break;case"audio-level":case"loudness":{if(H){const j=o.value.get(H);if(j){const A=P.data;j.audioLevel=(A==null?void 0:A.level)||P.value||0}}break}case"mute-state":case"muted":{if(H){const j=o.value.get(H);if(j){const A=P.data;j.muted=(A==null?void 0:A.muted)??P.value??!1}}break}case"scene-changed":case"scene":{const j=P.data,A=(j==null?void 0:j.scene)||P.value;s.value=typeof A=="number"?A:null;break}case"recording-started":i.value=!0;break;case"recording-stopped":i.value=!1;break;case"error":console.error("[VDO.ninja Error]",P.data),v.value=String(P.data);break}}return se(()=>{l.value="connecting",window.addEventListener("message",xe),setTimeout(()=>{!c.value&&u.value&&(c.value=!0,l.value="connected")},5e3)}),re(()=>{window.removeEventListener("message",xe),l.value="disconnected"}),{isReady:c,sources:o,activeScene:s,isRecording:i,connectionState:l,lastError:v,addToScene:y,removeFromScene:d,setProgram:w,addSource:f,removeSource:D,setLayout:z,changeMixOrder:W,setMute:R,toggleMute:_,setVolume:m,soloAudio:g,soloChatBidirectional:t,sendToGuest:x,sendDirectorMessage:b,kickGuest:M,toggleScreenShare:F,transferGuest:C,getGuestList:L,refreshSource:ee,setCamera:X,setGuestCamera:Oe,zoom:De,pan:Pe,tilt:Ee,startRecording:I,stopRecording:Z,sendCommand:a,sendDomCommand:k,getEventHistory:Ce,getEventStats:Re}}const Be={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10","data-testid":"vdo-loading"},Ae={class:"text-center"},ze={class:"text-xs text-r58-text-secondary mt-2"},Ke={key:1,class:"absolute bottom-4 left-4 right-4 bg-red-500/90 text-white px-4 py-2 rounded-lg text-sm z-20"},Fe=["src","title"],Ne=J({__name:"VdoNinjaEmbed",props:{profile:{},sources:{},room:{},password:{}},setup(u,{expose:c}){const o=u,s=S(null),i=ne(),l=Ie(s),{isReady:v,sources:h,addToScene:a,removeFromScene:k,setMute:y,toggleMute:d,setVolume:w,sendCommand:f,sendDomCommand:D,isRecording:R,connectionState:_,lastError:m,startRecording:g,stopRecording:t,kickGuest:x,toggleScreenShare:b,setLayout:M,setProgram:F,addSource:C,removeSource:L,getEventHistory:I,getEventStats:Z}=l,z=T(()=>{const W={};return o.sources&&(W.source_ids=o.sources.join(",")),o.room&&(W.room=o.room),o.password&&(W.password=o.password),je(o.profile,W)}),ee=T(()=>o.profile==="mixer");return ae(h,W=>{i.updateSourcesFromVdo(Array.from(W.values()))},{deep:!0}),c({isReady:v,isRecording:R,connectionState:_,lastError:m,addToScene:a,removeFromScene:k,setLayout:M,setProgram:F,addSource:C,removeSource:L,setMute:y,toggleMute:d,setVolume:w,startRecording:g,stopRecording:t,kickGuest:x,toggleScreenShare:b,sendCommand:f,sendDomCommand:D,getEventHistory:I,getEventStats:Z}),(W,X)=>(n(),r("div",{class:U(["vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden",{"mixer-mode":ee.value}]),"data-testid":"vdo-embed-container"},[B(v)?E("",!0):(n(),r("div",Be,[e("div",Ae,[X[0]||(X[0]=e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"},null,-1)),X[1]||(X[1]=e("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja...",-1)),e("p",ze,$(ee.value?"Loading mixer controls...":"Local mixer on R58"),1)])])),B(m)?(n(),r("div",Ke,[X[2]||(X[2]=e("strong",null,"Error:",-1)),oe(" "+$(B(m)),1)])):E("",!0),e("iframe",{ref_key:"iframeRef",ref:s,src:z.value,class:U(["w-full h-full border-0",{"opacity-0":!B(v)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:"","data-testid":"vdo-iframe",title:ee.value?"VDO.ninja Mixer":"VDO.ninja"},null,10,Fe)],2))}}),Ge=_e(Ne,[["__scopeId","data-v-4a9e915e"]]),We={class:"space-y-4","data-testid":"source-panel"},qe={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide","data-testid":"sources-heading"},Ye={key:0,class:"ml-2 text-r58-accent-primary"},Je={key:0,class:"px-3 py-2 bg-amber-500/10 border border-amber-500/30 rounded-lg text-xs text-amber-400"},Xe={key:1,class:"text-center py-6 text-r58-text-secondary"},Qe={key:2,class:"space-y-2"},Ze={class:"flex items-center gap-3 min-w-0"},et={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},tt={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ot={key:2,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},st={key:3,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},nt={class:"min-w-0"},rt={class:"font-medium text-sm truncate"},at={class:"text-xs text-r58-text-secondary capitalize"},it={class:"flex items-center gap-2 flex-shrink-0"},lt={key:0,class:"w-12 h-1.5 bg-r58-bg-primary rounded-full overflow-hidden"},ct=["onClick","data-testid","title"],dt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ut={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},mt=J({__name:"SourcePanel",props:{vdoEmbed:{}},setup(u){const c=u,o=ne(),s=me(),i=T(()=>o.sources),l=T(()=>s.inputs.filter(k=>k.hasSignal).map(k=>({id:k.id,label:k.label,type:"camera",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0}))),v=T(()=>i.value.length>0?i.value:l.value),h=T(()=>i.value.length===0&&l.value.length>0);function a(k){c.vdoEmbed&&c.vdoEmbed.toggleMute(k.id),o.setSourceMute(k.id,!k.muted)}return(k,y)=>(n(),r("div",We,[e("h3",qe,[y[0]||(y[0]=oe(" Sources ",-1)),v.value.length>0?(n(),r("span",Ye,"("+$(v.value.length)+")",1)):E("",!0)]),h.value?(n(),r("div",Je," Showing HDMI cameras. VDO.ninja sources will appear when guests join. ")):E("",!0),v.value.length===0?(n(),r("div",Xe,[...y[1]||(y[1]=[e("svg",{class:"w-8 h-8 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"text-sm"},"No sources connected",-1),e("p",{class:"text-xs mt-1 opacity-75"},"Connect HDMI sources or have guests join",-1)])])):(n(),r("div",Qe,[(n(!0),r(K,null,Y(v.value,d=>(n(),r("div",{key:d.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary hover:bg-r58-bg-tertiary/80 transition-colors"},[e("div",Ze,[e("div",{class:U(["w-8 h-8 rounded bg-r58-bg-primary flex items-center justify-center flex-shrink-0",{"ring-2 ring-r58-accent-primary":B(o).programSource===d.id}])},[d.type==="camera"?(n(),r("svg",et,[...y[2]||(y[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):d.type==="guest"?(n(),r("svg",tt,[...y[3]||(y[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):d.type==="screen"?(n(),r("svg",ot,[...y[4]||(y[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])])):(n(),r("svg",st,[...y[5]||(y[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"},null,-1)])]))],2),e("div",nt,[e("p",rt,$(d.label),1),e("p",at,$(d.type),1)])]),e("div",it,[d.hasAudio?(n(),r("div",lt,[e("div",{class:U(["h-full rounded-full transition-all duration-100",d.muted?"bg-r58-accent-danger":"bg-r58-accent-success"]),style:Me({width:`${d.audioLevel||0}%`})},null,6)])):E("",!0),d.hasAudio?(n(),r("button",{key:1,onClick:w=>a(d),class:U(["p-1.5 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":d.muted}]),"data-testid":`mute-button-${d.id}`,title:d.muted?"Unmute "+d.label:"Mute "+d.label},[d.muted?(n(),r("svg",dt,[...y[6]||(y[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(n(),r("svg",ut,[...y[7]||(y[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,ct)):E("",!0)])]))),128))])),y[8]||(y[8]=e("p",{class:"text-xs text-r58-text-secondary text-center pt-2"}," Full guest/source management available in the mixer above ",-1))]))}}),pt={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"camera-push-bar"},gt={class:"flex items-center gap-2"},vt={class:"text-r58-text-secondary"},ft={key:0,class:"px-4 pb-3"},xt={key:0,class:"flex gap-3 flex-wrap"},bt={class:"text-sm font-medium"},yt={class:"text-xs text-r58-text-secondary"},ht=["onClick"],kt={key:1,class:"text-sm text-r58-text-secondary py-2"},wt={class:"hidden"},_t=["src","onLoad","onError"],St=J({__name:"CameraPushBar",setup(u){const c=me(),o=S(new Map),s=S(!0),i=T(()=>c.inputs.filter(d=>d.hasSignal));function l(d){return`${window.location.origin}/api/v1/whep/${d}/whep`}ae(i,d=>{for(const f of d)if(!o.value.has(f.id)){const D=l(f.id),R=ye(f.id,D,f.label);o.value.set(f.id,{cameraId:f.id,label:f.label,status:"connecting",iframeSrc:R})}const w=new Set(d.map(f=>f.id));for(const[f]of o.value)w.has(f)||o.value.delete(f)},{immediate:!0});function v(d){const w=o.value.get(d);w&&(w.status="connected",console.log(`[CameraPush] ${d} connected to VDO.ninja`))}function h(d){const w=o.value.get(d);w&&(w.status="error",console.error(`[CameraPush] ${d} failed to connect`))}function a(d){const w=c.inputs.find(R=>R.id===d);if(!w||!w.hasSignal)return;const f=l(d),D=ye(d,f,w.label);o.value.set(d,{cameraId:d,label:w.label,status:"connecting",iframeSrc:D+`&_t=${Date.now()}`})}function k(d){switch(d){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function y(d){switch(d){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(d,w)=>(n(),r("div",pt,[e("button",{onClick:w[0]||(w[0]=f=>s.value=!s.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[e("div",gt,[w[1]||(w[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",vt,"("+$(i.value.length)+" active)",1)]),(n(),r("svg",{class:U(["w-4 h-4 transition-transform",{"rotate-180":s.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...w[2]||(w[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),s.value?(n(),r("div",ft,[o.value.size>0?(n(),r("div",xt,[(n(!0),r(K,null,Y(o.value,([f,D])=>(n(),r("div",{key:f,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[e("span",{class:U(["w-2 h-2 rounded-full",k(D.status)])},null,2),e("span",bt,$(D.label),1),e("span",yt,$(y(D.status)),1),D.status==="error"?(n(),r("button",{key:0,onClick:R=>a(f),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,ht)):E("",!0)]))),128))])):(n(),r("div",kt," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):E("",!0),e("div",wt,[(n(!0),r(K,null,Y(o.value,([f,D])=>(n(),r("iframe",{key:f,src:D.iframeSrc,onLoad:R=>v(f),onError:R=>h(f),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,_t))),128))])]))}}),$t={class:"program-output space-y-3","data-testid":"program-output"},Ct={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg","data-testid":"program-output-status"},Rt={class:"text-sm font-medium","data-testid":"program-output-text"},Ot={key:0,class:"space-y-2"},Dt={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},Pt={class:"flex-1 text-xs truncate text-r58-text-secondary"},Et={key:0,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},Mt={class:"text-xs text-r58-text-secondary"},Lt={key:1,class:"text-xs text-r58-text-secondary px-3"},Tt={class:"hidden"},jt=["src"],Vt=J({__name:"ProgramOutput",setup(u){const c=ne(),o=pe(),s=S(!1),i=S("idle"),l=S("");function v(){return`${window.location.origin}/api/v1/whip/program/whip`}function h(){s.value||(i.value="connecting",l.value=Ve(v()),s.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function a(){s.value&&(s.value=!1,l.value="",i.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function k(){s.value&&(i.value="live",console.log("[ProgramOutput] WHIP push connected"))}function y(){i.value="error",console.error("[ProgramOutput] WHIP push failed")}function d(){a(),setTimeout(()=>h(),500)}ae(()=>c.isLive,R=>{R?h():a()});function w(){switch(i.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function f(){switch(i.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function D(){const R=o.programOutputUrls.srt;navigator.clipboard.writeText(R),V.success("SRT URL copied")}return(R,_)=>(n(),r("div",$t,[e("div",Ct,[e("span",{class:U(["w-2 h-2 rounded-full",w()]),"data-testid":"program-output-indicator"},null,2),e("span",Rt,$(f()),1),i.value==="error"?(n(),r("button",{key:0,onClick:_[0]||(_[0]=m=>d()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"}," Retry ")):E("",!0)]),i.value==="live"?(n(),r("div",Ot,[e("div",Dt,[_[1]||(_[1]=e("span",{class:"text-xs text-r58-text-secondary"},"üî¥ SRT:",-1)),e("code",Pt,$(B(o).programOutputUrls.srt),1),e("button",{onClick:D,class:"text-xs text-r58-accent-primary hover:underline"},"Copy")]),B(o).enabledDestinations.length>0?(n(),r("div",Et,[_[2]||(_[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",Mt,$(B(o).enabledDestinations.length)+" streaming destination"+$(B(o).enabledDestinations.length>1?"s":"")+" active ",1)])):E("",!0)])):E("",!0),i.value==="idle"?(n(),r("p",Lt," Program output will start automatically when you go live. ")):E("",!0),e("div",Tt,[s.value&&l.value?(n(),r("iframe",{key:0,src:l.value,onLoad:k,onError:y,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,jt)):E("",!0)])]))}}),Ut={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Ht={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},It={class:"p-6 overflow-y-auto max-h-[60vh]"},Bt={class:"mb-8"},At={class:"flex items-center justify-between mb-4"},zt={key:0,class:"mb-4 p-4 bg-r58-bg-tertiary rounded-lg"},Kt={class:"grid grid-cols-2 gap-2"},Ft=["onClick"],Nt={class:"text-xl"},Gt={key:1,class:"space-y-3"},Wt=["onClick"],qt={class:"text-xl"},Yt={class:"flex-1"},Jt={class:"font-medium"},Xt={class:"text-xs text-r58-text-secondary"},Qt=["onClick"],Zt=["onClick"],eo={key:2,class:"text-r58-text-secondary text-sm"},to={key:0,class:"mb-8 p-4 bg-r58-bg-tertiary rounded-lg"},oo={class:"text-lg font-medium mb-4"},so={class:"space-y-4"},no=["placeholder"],ro={key:0},ao={class:"flex gap-2"},io={class:"mb-8"},lo={class:"space-y-3"},co={class:"p-3 bg-r58-bg-tertiary rounded-lg"},uo={class:"flex items-center justify-between mb-1"},mo={class:"text-xs text-r58-text-secondary break-all"},po={class:"p-3 bg-r58-bg-tertiary rounded-lg"},go={class:"flex items-center justify-between mb-1"},vo={class:"text-xs text-r58-text-secondary break-all"},fo={class:"p-3 bg-r58-bg-tertiary rounded-lg"},xo={class:"flex items-center justify-between mb-1"},bo={class:"text-xs text-r58-text-secondary break-all"},yo={class:"p-3 bg-r58-bg-tertiary rounded-lg"},ho={class:"flex items-center justify-between mb-1"},ko={class:"text-xs text-r58-text-secondary break-all"},wo={class:"p-3 bg-r58-bg-tertiary rounded-lg"},_o={class:"flex items-center justify-between mb-1"},So={class:"text-xs text-r58-text-secondary break-all"},$o={class:"p-4 bg-r58-bg-tertiary rounded-lg"},Co={class:"flex items-center gap-3 mb-4"},Ro=J({__name:"StreamingSettings",setup(u,{expose:c}){const o=pe(),s=S(!1),i=S(null),l=S(!1);S(""),S("");const v=T(()=>o.destinations),h=T(()=>te),a=T(()=>o.programOutputUrls);function k(){s.value=!0}function y(){s.value=!1,i.value=null,l.value=!1}function d(g){const t=o.addDestination(g);i.value=t,l.value=!1,o.saveDestinations()}function w(){i.value&&(o.updateDestination(i.value.id,i.value),o.saveDestinations(),i.value=null,V.success("Streaming destination saved"))}function f(g){o.removeDestination(g),o.saveDestinations(),V.info("Destination removed")}function D(g){o.updateDestination(g.id,{enabled:!g.enabled}),o.saveDestinations()}function R(g,t){navigator.clipboard.writeText(g),V.success(`${t} copied to clipboard`)}function _(g){const t=te.find(x=>x.id===g);return(t==null?void 0:t.icon)||"üì°"}function m(g){const t=te.find(x=>x.id===g);return(t==null?void 0:t.name)||"Unknown"}return c({open:k}),(g,t)=>{var x;return n(),Se($e,{to:"body"},[s.value?(n(),r("div",Ut,[e("div",{class:"absolute inset-0 bg-black/60",onClick:y}),e("div",Ht,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:y,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," √ó ")]),e("div",It,[e("section",Bt,[e("div",At,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[0]||(t[0]=b=>l.value=!l.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),l.value?(n(),r("div",zt,[t[13]||(t[13]=e("p",{class:"text-sm text-r58-text-secondary mb-3"},"Select a streaming platform:",-1)),e("div",Kt,[(n(!0),r(K,null,Y(h.value,b=>(n(),r("button",{key:b.id,onClick:M=>d(b.id),class:"flex items-center gap-2 p-3 bg-r58-bg-secondary hover:bg-r58-accent-primary/20 rounded-lg transition-colors text-left"},[e("span",Nt,$(b.icon),1),e("span",null,$(b.name),1)],8,Ft))),128))])])):E("",!0),v.value.length>0?(n(),r("div",Gt,[(n(!0),r(K,null,Y(v.value,b=>(n(),r("div",{key:b.id,class:"flex items-center gap-3 p-3 bg-r58-bg-tertiary rounded-lg"},[e("button",{onClick:M=>D(b),class:U(["w-10 h-6 rounded-full transition-colors relative",b.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:U(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",b.enabled?"left-5":"left-1"])},null,2)],10,Wt),e("span",qt,$(_(b.platformId)),1),e("div",Yt,[e("div",Jt,$(b.name),1),e("div",Xt,$(b.streamKey?"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"+b.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:M=>i.value={...b},class:"text-r58-accent-primary hover:underline text-sm"}," Edit ",8,Qt),e("button",{onClick:M=>f(b.id),class:"text-r58-accent-danger hover:underline text-sm"}," Remove ",8,Zt)]))),128))])):(n(),r("p",eo," No streaming destinations configured. Add a platform above. "))]),i.value?(n(),r("section",to,[e("h3",oo," Edit "+$(m(i.value.platformId)),1),e("div",so,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Display Name",-1)),le(e("input",{"onUpdate:modelValue":t[1]||(t[1]=b=>i.value.name=b),type:"text",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none"},null,512),[[ce,i.value.name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Stream Key",-1)),le(e("input",{"onUpdate:modelValue":t[2]||(t[2]=b=>i.value.streamKey=b),type:"password",placeholder:(x=B(te).find(b=>b.id===i.value.platformId))==null?void 0:x.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,8,no),[[ce,i.value.streamKey]]),t[16]||(t[16]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),i.value.platformId==="custom"?(n(),r("div",ro,[t[17]||(t[17]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"RTMP URL",-1)),le(e("input",{"onUpdate:modelValue":t[3]||(t[3]=b=>i.value.name=b),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,512),[[ce,i.value.name]])])):E("",!0),e("div",ao,[e("button",{onClick:w,class:"btn btn-primary"}," Save "),e("button",{onClick:t[4]||(t[4]=b=>i.value=null),class:"btn"}," Cancel ")])])])):E("",!0),e("section",io,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[27]||(t[27]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",lo,[e("div",co,[e("div",uo,[t[18]||(t[18]=e("span",{class:"font-medium"},"üî¥ SRT Output",-1)),e("button",{onClick:t[5]||(t[5]=b=>R(a.value.srt,"SRT URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",mo,$(a.value.srt),1),t[19]||(t[19]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",po,[e("div",go,[t[20]||(t[20]=e("span",{class:"font-medium"},"üì∫ RTMP Output",-1)),e("button",{onClick:t[6]||(t[6]=b=>R(a.value.rtmp,"RTMP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",vo,$(a.value.rtmp),1)]),e("div",fo,[e("div",xo,[t[21]||(t[21]=e("span",{class:"font-medium"},"üé¨ RTSP Output",-1)),e("button",{onClick:t[7]||(t[7]=b=>R(a.value.rtsp,"RTSP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",bo,$(a.value.rtsp),1)]),e("div",yo,[e("div",ho,[t[22]||(t[22]=e("span",{class:"font-medium"},"üåê HLS Output",-1)),e("button",{onClick:t[8]||(t[8]=b=>R(a.value.hls,"HLS URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",ko,$(a.value.hls),1),t[23]||(t[23]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",wo,[e("div",_o,[t[24]||(t[24]=e("span",{class:"font-medium"},"‚ö° WebRTC (WHEP)",-1)),e("button",{onClick:t[9]||(t[9]=b=>R(a.value.whep,"WHEP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",So,$(a.value.whep),1),t[25]||(t[25]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[30]||(t[30]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",$o,[e("div",Co,[e("button",{onClick:t[10]||(t[10]=b=>B(o).toggleSrtOutput(!B(o).srtOutput.enabled)),class:U(["w-10 h-6 rounded-full transition-colors relative",B(o).srtOutput.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:U(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",B(o).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[28]||(t[28]=e("span",null,"Enable SRT Output",-1))]),t[29]||(t[29]=e("div",{class:"text-sm text-r58-text-secondary"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-r58-bg-tertiary"},[e("button",{onClick:y,class:"btn"},"Close")])])])):E("",!0)])}}}),Oo={class:"recording-controls space-y-3","data-testid":"recording-controls"},Do={class:"flex items-center gap-3 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},Po={class:"text-sm font-medium flex-1","data-testid":"recording-status"},Eo={key:0,class:"text-lg font-mono font-bold text-r58-accent-danger","data-testid":"recording-duration"},Mo={class:"flex gap-2"},Lo=["disabled"],To={key:0,class:"px-3 py-2 bg-r58-accent-success/10 border border-r58-accent-success/30 rounded-lg"},jo={class:"flex items-center justify-between"},Vo=["href"],Uo=J({__name:"RecordingControls",props:{vdoEmbed:{}},setup(u){const c=u,o=S(!1),s=S(null),i=S(0),l=S(null),v=S(!1);ae(()=>{var _,m;return(m=(_=c.vdoEmbed)==null?void 0:_.isRecording)==null?void 0:m.value},_=>{_!==void 0&&(o.value=_,_&&!s.value?s.value=Date.now():!_&&s.value&&(s.value=null))});let h=null;function a(){h&&clearInterval(h),h=window.setInterval(()=>{s.value&&(i.value=Date.now()-s.value)},100)}function k(){h&&(clearInterval(h),h=null)}se(()=>{a()}),re(()=>{k()});const y=T(()=>{const _=Math.floor(i.value/1e3),m=Math.floor(_/3600),g=Math.floor(_%3600/60),t=_%60;return m>0?`${m}:${g.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`:`${g}:${t.toString().padStart(2,"0")}`});async function d(){if(!c.vdoEmbed){V.error("VDO.ninja not connected");return}v.value=!0;try{c.vdoEmbed.startRecording(),o.value=!0,s.value=Date.now(),i.value=0,l.value=null,V.success("Recording started")}catch(_){V.error("Failed to start recording"),console.error("[RecordingControls] Start recording error:",_)}finally{v.value=!1}}async function w(){if(!c.vdoEmbed){V.error("VDO.ninja not connected");return}v.value=!0;try{c.vdoEmbed.stopRecording(),o.value=!1,s.value=null,V.success(`Recording stopped (${y.value})`)}catch(_){V.error("Failed to stop recording"),console.error("[RecordingControls] Stop recording error:",_)}finally{v.value=!1}}function f(){o.value?w():d()}function D(){return o.value?"bg-r58-accent-danger animate-pulse":"bg-r58-bg-tertiary"}function R(){return v.value?"Processing...":o.value?`Recording ‚Ä¢ ${y.value}`:"Ready to record"}return(_,m)=>(n(),r("div",Oo,[e("div",Do,[e("span",{class:U(["w-3 h-3 rounded-full",D()]),"data-testid":"recording-indicator"},null,2),e("span",Po,$(R()),1),o.value?(n(),r("span",Eo,$(y.value),1)):E("",!0)]),e("div",Mo,[e("button",{onClick:f,disabled:v.value,class:U(["btn flex-1 justify-center",o.value?"btn-danger":"btn-primary"]),"data-testid":"recording-toggle-button"},[v.value?(n(),r(K,{key:0},[m[0]||(m[0]=e("svg",{class:"animate-spin w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)),m[1]||(m[1]=oe(" Processing... ",-1))],64)):o.value?(n(),r(K,{key:1},[m[2]||(m[2]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})],-1)),m[3]||(m[3]=oe(" Stop Recording ",-1))],64)):(n(),r(K,{key:2},[m[4]||(m[4]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"8"})],-1)),m[5]||(m[5]=oe(" Start Recording ",-1))],64))],10,Lo)]),l.value?(n(),r("div",To,[e("div",jo,[m[6]||(m[6]=e("span",{class:"text-sm text-r58-accent-success"},"Recording ready!",-1)),e("a",{href:l.value,download:"",class:"text-sm text-r58-accent-primary hover:underline"}," Download ",8,Vo)])])):E("",!0),m[7]||(m[7]=e("p",{class:"text-xs text-r58-text-secondary px-1"}," Records the mixed output locally in your browser. Recording is saved when stopped. ",-1))]))}}),Ho=_e(Uo,[["__scopeId","data-v-30421222"]]),Io={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Bo={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-3xl max-h-[80vh] overflow-hidden shadow-2xl","data-testid":"hotkey-settings-modal"},Ao={class:"flex border-b border-r58-bg-tertiary"},zo=["onClick"],Ko={class:"p-6 overflow-y-auto max-h-[55vh]"},Fo={key:0,class:"text-center py-12 text-r58-text-secondary"},No={key:1,class:"space-y-6"},Go={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},Wo={class:"space-y-2"},qo={class:"flex-1"},Yo={class:"text-sm"},Jo={key:0,class:"ml-2 text-xs text-r58-accent-primary"},Xo={class:"flex items-center gap-2"},Qo={key:0,class:"flex items-center gap-2"},Zo={key:0,class:"px-3 py-1 bg-r58-accent-primary text-white rounded text-sm font-mono"},es={key:1,class:"text-sm text-r58-text-secondary animate-pulse"},ts={class:"px-3 py-1 bg-r58-bg-secondary border border-r58-bg-tertiary rounded text-sm font-mono"},os=["onClick"],ss=["onClick"],ke="r58-hotkey-customizations",ns=J({__name:"HotkeySettings",setup(u,{expose:c}){const o=[{id:"help",key:"?",modifiers:["shift"],description:"Show keyboard shortcuts",context:"global",category:"Navigation",editable:!1},{id:"goto-recorder",key:"r",description:"Go to Recorder",context:"global",category:"Navigation",editable:!0},{id:"goto-mixer",key:"m",description:"Go to Mixer",context:"global",category:"Navigation",editable:!0},{id:"escape",key:"Escape",description:"Close modal / Cancel",context:"global",category:"Navigation",editable:!1},{id:"scene-1",key:"1",description:"Switch to Scene 1",context:"mixer",category:"Scenes",editable:!0},{id:"scene-2",key:"2",description:"Switch to Scene 2",context:"mixer",category:"Scenes",editable:!0},{id:"scene-3",key:"3",description:"Switch to Scene 3",context:"mixer",category:"Scenes",editable:!0},{id:"scene-4",key:"4",description:"Switch to Scene 4",context:"mixer",category:"Scenes",editable:!0},{id:"scene-5",key:"5",description:"Switch to Scene 5",context:"mixer",category:"Scenes",editable:!0},{id:"scene-6",key:"6",description:"Switch to Scene 6",context:"mixer",category:"Scenes",editable:!0},{id:"scene-7",key:"7",description:"Switch to Scene 7",context:"mixer",category:"Scenes",editable:!0},{id:"scene-8",key:"8",description:"Switch to Scene 8",context:"mixer",category:"Scenes",editable:!0},{id:"scene-9",key:"9",description:"Switch to Scene 9",context:"mixer",category:"Scenes",editable:!0},{id:"cut",key:"t",description:"Cut transition",context:"mixer",category:"Transitions",editable:!0},{id:"fade",key:"a",description:"Auto-transition (fade)",context:"mixer",category:"Transitions",editable:!0},{id:"cycle-sources",key:"Tab",description:"Cycle through sources",context:"mixer",category:"Transitions",editable:!0},{id:"go-live",key:"g",description:"Toggle Go Live",context:"mixer",category:"Control",editable:!0},{id:"toggle-recording",key:"r",modifiers:["ctrl"],description:"Toggle local recording",context:"mixer",category:"Control",editable:!0},{id:"mute-all",key:"m",modifiers:["ctrl"],description:"Mute all sources",context:"mixer",category:"Control",editable:!0},{id:"source-1",key:"F1",description:"Select source 1",context:"mixer",category:"Sources",editable:!0},{id:"source-2",key:"F2",description:"Select source 2",context:"mixer",category:"Sources",editable:!0},{id:"source-3",key:"F3",description:"Select source 3",context:"mixer",category:"Sources",editable:!0},{id:"source-4",key:"F4",description:"Select source 4",context:"mixer",category:"Sources",editable:!0},{id:"start-stop-recording",key:" ",description:"Start/Stop recording",context:"recorder",category:"Recording",editable:!0},{id:"mark-chapter",key:"c",description:"Mark chapter point",context:"recorder",category:"Recording",editable:!0}],s=S(!1),i=S("mixer"),l=S({}),v=S(null),h=S(null);function a(){try{const C=localStorage.getItem(ke);C&&(l.value=JSON.parse(C))}catch(C){console.warn("[HotkeySettings] Failed to load customizations:",C)}}function k(){try{localStorage.setItem(ke,JSON.stringify(l.value))}catch(C){console.warn("[HotkeySettings] Failed to save customizations:",C)}}function y(C){const L=l.value[C.id];return L?{...C,key:L.key,modifiers:L.modifiers}:C}const d=T(()=>{const C={global:{},mixer:{},recorder:{}};for(const L of o){const I=y(L);C[L.context][I.category]||(C[L.context][I.category]=[]),C[L.context][I.category].push(I)}return C}),w=T(()=>d.value[i.value]||{});function f(C){return be(C.key,C.modifiers)}function D(C){return!!l.value[C]}function R(C){const L=o.find(I=>I.id===C);L!=null&&L.editable&&(v.value=C,h.value=null,document.addEventListener("keydown",_))}function _(C){if(C.preventDefault(),C.stopPropagation(),["Control","Alt","Shift","Meta"].includes(C.key))return;const L=[];C.ctrlKey&&L.push("ctrl"),C.altKey&&L.push("alt"),C.shiftKey&&L.push("shift"),C.metaKey&&L.push("meta"),h.value={key:C.key,modifiers:L},document.removeEventListener("keydown",_)}function m(){!v.value||!h.value||(l.value[v.value]={key:h.value.key,modifiers:h.value.modifiers.length>0?h.value.modifiers:void 0},k(),V.success("Hotkey updated"),v.value=null,h.value=null)}function g(){v.value=null,h.value=null,document.removeEventListener("keydown",_)}function t(C){delete l.value[C],k(),V.info("Hotkey reset to default")}function x(){confirm("Reset all hotkeys to defaults?")&&(l.value={},k(),V.info("All hotkeys reset to defaults"))}function b(){a(),s.value=!0}function M(){g(),s.value=!1}se(()=>{a()});function F(){return{...l.value}}return c({open:b,getCustomBindings:F}),(C,L)=>(n(),Se($e,{to:"body"},[s.value?(n(),r("div",Io,[e("div",{class:"absolute inset-0 bg-black/60",onClick:M}),e("div",Bo,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[L[0]||(L[0]=e("h2",{class:"text-xl font-semibold"},"Keyboard Shortcuts",-1)),e("div",{class:"flex items-center gap-4"},[e("button",{onClick:x,class:"text-sm text-r58-text-secondary hover:text-r58-text-primary"}," Reset All "),e("button",{onClick:M,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," √ó ")])]),e("div",Ao,[(n(),r(K,null,Y(["mixer","global","recorder"],I=>e("button",{key:I,onClick:Z=>i.value=I,class:U(["px-6 py-3 text-sm font-medium capitalize transition-colors",i.value===I?"text-r58-accent-primary border-b-2 border-r58-accent-primary":"text-r58-text-secondary hover:text-r58-text-primary"])},$(I),11,zo)),64))]),e("div",Ko,[Object.keys(w.value).length===0?(n(),r("div",Fo," No shortcuts defined for this context. ")):(n(),r("div",No,[(n(!0),r(K,null,Y(w.value,(I,Z)=>(n(),r("div",{key:Z},[e("h3",Go,$(Z),1),e("div",Wo,[(n(!0),r(K,null,Y(I,z=>(n(),r("div",{key:z.id,class:U(["flex items-center justify-between p-3 bg-r58-bg-tertiary rounded-lg",{"ring-2 ring-r58-accent-primary":v.value===z.id}])},[e("div",qo,[e("span",Yo,$(z.description),1),D(z.id)?(n(),r("span",Jo,"(customized)")):E("",!0)]),e("div",Xo,[v.value===z.id?(n(),r("div",Qo,[h.value?(n(),r("kbd",Zo,$(B(be)(h.value.key,h.value.modifiers)),1)):(n(),r("span",es," Press a key... ")),h.value?(n(),r("button",{key:2,onClick:m,class:"btn btn-sm btn-primary"}," Save ")):E("",!0),e("button",{onClick:g,class:"btn btn-sm"}," Cancel ")])):(n(),r(K,{key:1},[e("kbd",ts,$(f(z)),1),z.editable?(n(),r("button",{key:0,onClick:ee=>R(z.id),class:"text-xs text-r58-accent-primary hover:underline"}," Edit ",8,os)):E("",!0),D(z.id)?(n(),r("button",{key:1,onClick:ee=>t(z.id),class:"text-xs text-r58-text-secondary hover:text-r58-accent-danger"}," Reset ",8,ss)):E("",!0)],64))])],2))),128))])]))),128))]))]),e("div",{class:"flex items-center justify-between px-6 py-4 border-t border-r58-bg-tertiary"},[L[1]||(L[1]=e("div",{class:"text-sm text-r58-text-secondary"},' Click "Edit" to customize a shortcut. Press any key combination to set. ',-1)),e("button",{onClick:M,class:"btn"},"Close")])])])):E("",!0)]))}}),rs={class:"connection-status","data-testid":"connection-status"},as={class:"text-xs text-r58-text-secondary"},is={key:0,class:"text-xs text-r58-accent-danger",title:"Click for details"},ls={key:0,class:"mt-2 p-3 bg-r58-bg-tertiary rounded-lg text-xs space-y-2"},cs={class:"grid grid-cols-2 gap-2"},ds={class:"ml-1 font-medium"},us={class:"ml-1"},ms={class:"ml-1"},ps={key:0,class:"p-2 bg-r58-accent-danger/10 border border-r58-accent-danger/30 rounded text-r58-accent-danger"},gs={class:"flex gap-2 pt-2 border-t border-r58-bg-tertiary"},vs=["disabled"],fs={key:1,class:"text-r58-text-secondary text-center"},xs=J({__name:"ConnectionStatus",props:{vdoEmbed:{}},setup(u){const c=u;ne();const o=S(!1),s=S("never"),i=S(0),l=S(!1),v=T(()=>{var g,t;return((t=(g=c.vdoEmbed)==null?void 0:g.connectionState)==null?void 0:t.value)||"disconnected"}),h=T(()=>{var g,t;return((t=(g=c.vdoEmbed)==null?void 0:g.isReady)==null?void 0:t.value)||!1}),a=T(()=>{var g,t;return((t=(g=c.vdoEmbed)==null?void 0:g.lastError)==null?void 0:t.value)||null}),k=T(()=>v.value==="disconnected"||!h.value?"disconnected":a.value?"error":v.value==="connecting"?"degraded":"healthy"),y=T(()=>{switch(k.value){case"healthy":return"bg-r58-accent-success";case"degraded":return"bg-amber-500";case"error":return"bg-r58-accent-danger";case"disconnected":return"bg-r58-text-secondary";default:return"bg-r58-text-secondary"}}),d=T(()=>{switch(k.value){case"healthy":return"Connected";case"degraded":return"Connecting...";case"error":return"Error";case"disconnected":return"Disconnected";default:return"Unknown"}});let w=null;function f(){if(c.vdoEmbed){const g=c.vdoEmbed.getEventStats();if(g.lastActivity){const t=Date.now()-g.lastActivity;t<1e3?s.value="just now":t<6e4?s.value=`${Math.floor(t/1e3)}s ago`:t<36e5?s.value=`${Math.floor(t/6e4)}m ago`:s.value="over 1h ago"}}}se(()=>{f(),w=window.setInterval(f,1e3)}),re(()=>{w&&clearInterval(w)});async function D(){if(!l.value){l.value=!0,i.value++,V.info("Attempting to reconnect...");try{c.vdoEmbed&&c.vdoEmbed.sendCommand("ping"),await new Promise(g=>setTimeout(g,2e3)),h.value&&!a.value?(V.success("Reconnected successfully"),i.value=0):V.error("Reconnection failed. Try refreshing the page.")}catch(g){V.error("Reconnection error"),console.error("[ConnectionStatus] Reconnect error:",g)}finally{l.value=!1}}}function R(){confirm("This will refresh the page and may interrupt active streams. Continue?")&&window.location.reload()}function _(){o.value=!o.value}const m=T(()=>c.vdoEmbed?c.vdoEmbed.getEventStats():{total:0,incoming:0,outgoing:0,lastActivity:null});return(g,t)=>(n(),r("div",rs,[e("div",{class:"flex items-center gap-2 cursor-pointer",onClick:_},[e("span",{class:U(["w-2 h-2 rounded-full",[y.value,{"animate-pulse":k.value==="degraded"}]]),"data-testid":"status-indicator"},null,2),e("span",as,$(d.value),1),a.value?(n(),r("span",is," ‚ö†Ô∏è ")):E("",!0),(n(),r("svg",{class:U(["w-3 h-3 text-r58-text-secondary transition-transform",{"rotate-180":o.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[0]||(t[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),o.value?(n(),r("div",ls,[e("div",cs,[e("div",null,[t[1]||(t[1]=e("span",{class:"text-r58-text-secondary"},"VDO.ninja:",-1)),e("span",{class:U(["ml-1 font-medium",h.value?"text-r58-accent-success":"text-r58-accent-danger"])},$(h.value?"Ready":"Not Ready"),3)]),e("div",null,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"State:",-1)),e("span",ds,$(v.value),1)]),e("div",null,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Last activity:",-1)),e("span",us,$(s.value),1)]),e("div",null,[t[4]||(t[4]=e("span",{class:"text-r58-text-secondary"},"Events:",-1)),e("span",ms,$(m.value.total),1)])]),a.value?(n(),r("div",ps,[t[5]||(t[5]=e("strong",null,"Error:",-1)),oe(" "+$(a.value),1)])):E("",!0),e("div",gs,[e("button",{onClick:D,disabled:l.value,class:U(["btn btn-sm flex-1",{"opacity-50":l.value}])},$(l.value?"Reconnecting...":"üîÑ Reconnect"),11,vs),e("button",{onClick:R,class:"btn btn-sm",title:"Refresh the page (last resort)"}," üîÉ Refresh ")]),i.value>0?(n(),r("div",fs," Reconnect attempts: "+$(i.value),1)):E("",!0)])):E("",!0)]))}}),bs={class:"h-full flex flex-col"},ys={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"mixer-header"},hs={class:"flex items-center gap-4"},ks={class:"flex items-center gap-2"},ws={key:0,class:"badge badge-danger","data-testid":"on-air-badge"},_s={key:1,class:"text-xs text-r58-text-secondary"},Ss={class:"flex items-center gap-4"},$s={class:"flex-1 flex overflow-hidden"},Cs={class:"flex-1 p-4"},Rs={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},Os={class:"mb-6"},Ds={class:"grid grid-cols-4 gap-2"},Ps=["onClick","data-testid"],Es={class:"mb-6 pt-4 border-t border-r58-bg-tertiary"},Ms={class:"mb-6 pt-4 border-t border-r58-bg-tertiary"},Ls={class:"pt-4 border-t border-r58-bg-tertiary"},Vs=J({__name:"MixerView",setup(u){const c=ne(),o=me(),s=pe(),{register:i}=Le(),l=S(null),v=S(null),h=S(null),a=T(()=>c.isLive),k=T(()=>s.enabledDestinations.length);let y=null;const d=[];se(()=>{o.fetchInputs(),y=window.setInterval(()=>{o.fetchInputs()},5e3);for(let m=1;m<=4;m++){const g=i({key:String(m),description:`Switch to scene ${m}`,action:()=>w(m),context:"mixer"});d.push(g)}d.push(i({key:"g",description:"Toggle Go Live",action:()=>D(),context:"mixer"})),d.push(i({key:"r",description:"Toggle recording",action:()=>f(),context:"mixer"}))}),re(()=>{d.forEach(m=>m()),y&&(clearInterval(y),y=null)});function w(m){l.value&&l.value.sendCommand("addScene","*",m),c.setScene(`scene-${m}`),V.info(`Scene ${m}`)}function f(){var m;l.value&&((m=l.value.isRecording)!=null&&m.value?(l.value.stopRecording(),V.info("Recording stopped")):(l.value.startRecording(),V.success("Recording started")))}function D(){if(c.isLive)c.toggleLive(),s.stopStreaming(),V.info("Session ended");else{c.toggleLive(),s.startStreaming();const m=s.enabledDestinations.length;m>0?V.success(`Live! Streaming to ${m} destination${m>1?"s":""}`):V.info("Live! (No streaming destinations configured)")}}function R(){var m;(m=v.value)==null||m.open()}function _(){var m;(m=h.value)==null||m.open()}return(m,g)=>(n(),r("div",bs,[e("header",ys,[e("div",hs,[e("div",ks,[e("span",{class:U(["w-3 h-3 rounded-full",a.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"]),"data-testid":"live-indicator"},null,2),g[0]||(g[0]=e("span",{class:"text-xl font-semibold text-r58-mixer","data-testid":"mixer-title"},"Mixer",-1))]),a.value?(n(),r("span",ws,"ON AIR")):E("",!0),a.value&&k.value>0?(n(),r("span",_s," Streaming to "+$(k.value)+" platform"+$(k.value>1?"s":""),1)):E("",!0),Q(xs,{"vdo-embed":l.value},null,8,["vdo-embed"])]),e("div",Ss,[e("button",{class:"btn btn-sm",onClick:_,title:"Keyboard Shortcuts (Shift+?)","data-testid":"hotkey-settings-button"},[...g[1]||(g[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)])]),e("button",{class:"btn btn-sm",onClick:R,title:"Streaming Settings","data-testid":"streaming-settings-button"},[...g[2]||(g[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),e("button",{class:U(["btn",a.value?"btn-danger":"btn-primary"]),onClick:D,"data-testid":"go-live-button"},$(a.value?"End Session":"Go Live"),3)])]),e("div",$s,[e("div",Cs,[Q(Ge,{ref_key:"vdoEmbedRef",ref:l,profile:"mixer",class:"h-full"},null,512)]),e("aside",Rs,[e("div",Os,[g[3]||(g[3]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Quick Scenes",-1)),e("div",Ds,[(n(),r(K,null,Y(4,t=>e("button",{key:t,class:U(["btn btn-sm",B(c).currentScene===`scene-${t}`?"btn-primary":""]),onClick:x=>w(t),"data-testid":`scene-btn-${t}`},$(t),11,Ps)),64))]),g[4]||(g[4]=e("p",{class:"text-xs text-r58-text-secondary mt-2"}," Press 1-4 for quick switch. Full layout control is in the mixer above. ",-1))]),e("div",Es,[Q(mt,{"vdo-embed":l.value},null,8,["vdo-embed"])]),e("div",Ms,[g[5]||(g[5]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Program Output",-1)),Q(Vt)]),e("div",Ls,[g[6]||(g[6]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Local Recording",-1)),Q(Ho,{"vdo-embed":l.value},null,8,["vdo-embed"])])])]),Q(St),Q(Ro,{ref_key:"streamingSettingsRef",ref:v},null,512),Q(ns,{ref_key:"hotkeySettingsRef",ref:h},null,512)]))}});export{Vs as default};
