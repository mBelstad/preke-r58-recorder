import{P as re,r as p,j as P,b as H,d as A,H as X,c as l,e as _,a as e,w as U,Q as z,y as B,q as Z,F as N,s as W,t as m,n as L,L as T,I as oe,h as w,i,R as ee,D as ne,m as E,T as q,p as Q,S as ae,B as te,C as ie,u as le,o as ue,O as de,v as ce}from"./index-BKUAO3ok.js";import{b as me,o as pe,g as xe,a as ge,V as J,c as fe}from"./vdoninja-CEXRmajt.js";import{M as be}from"./ModeLoadingScreen-CbOL5xOn.js";const R=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],Y=re("streaming",()=>{const y=p([]),S=p(!1),r=p(null),d=p({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),a=P(()=>y.value.find(s=>s.id===r.value)),c=P(()=>y.value.filter(s=>s.enabled)),u=P(()=>R),f=P(()=>{const s=window.location.hostname,n=s==="localhost"||s==="127.0.0.1"?"localhost":s.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${n}:1935/mixer_program`,rtsp:`rtsp://${n}:8554/mixer_program`,srt:`srt://${n}:8890?streamid=read:mixer_program`,hls:`https://${s}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function h(s,t){const n=R.find(M=>M.id===s);if(!n)throw new Error(`Unknown platform: ${s}`);const o={id:`dest-${Date.now()}`,platformId:s,name:t||n.name,streamKey:"",enabled:!1};return y.value.push(o),o}function D(s,t){const n=y.value.findIndex(o=>o.id===s);n!==-1&&(y.value[n]={...y.value[n],...t})}function v(s){const t=y.value.findIndex(n=>n.id===s);t!==-1&&y.value.splice(t,1),r.value===s&&(r.value=null)}function O(s){r.value=s}function C(s){d.value.enabled=s}function x(s){d.value={...d.value,...s}}function b(){S.value=!0}function g(){S.value=!1}function k(s){const t=R.find(n=>n.id===s.platformId);return t?s.platformId==="custom"?`${s.name}${s.streamKey}`:`${t.rtmpBaseUrl}${s.streamKey}`:""}function $(){const s=window.location.hostname;return`srt://${s==="localhost"||s==="127.0.0.1"?"localhost":s.replace("r58-api","r58-mediamtx")}:${d.value.port}?streamid=read:${d.value.streamId}`}function I(){try{const s=localStorage.getItem("r58-streaming-destinations");if(s){const t=JSON.parse(s);y.value=t.destinations||[],t.srtOutput&&(d.value={...d.value,...t.srtOutput})}}catch(s){console.warn("Failed to load saved streaming destinations:",s)}}function K(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:y.value,srtOutput:d.value}))}catch(s){console.warn("Failed to save streaming destinations:",s)}}async function V(){try{const s=c.value;if(s.length===0)return console.warn("[Streaming] No enabled destinations to stream to"),{success:!1,message:"No destinations configured"};const t=s.map(M=>{var G;return{platform:M.platformId,rtmp_url:((G=R.find(se=>se.id===M.platformId))==null?void 0:G.rtmpBaseUrl)||"",stream_key:M.streamKey,enabled:!0}}),n=await fetch(H("/api/streaming/rtmp/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinations:t})}),o=await n.json();if(!n.ok)throw new Error(o.detail||"Failed to start RTMP relay");return console.log("[Streaming] RTMP relay configured via MediaMTX runOnReady:",o),{success:!0,message:o.message||`Streaming to ${s.length} destination(s)`}}catch(s){const t=s instanceof Error?s.message:"Failed to start RTMP relay";return console.error("[Streaming] Failed to start RTMP relay:",s),{success:!1,message:t}}}async function F(){try{const s=await fetch(H("/api/streaming/rtmp/stop"),{method:"POST"}),t=await s.json();if(!s.ok)throw new Error(t.detail||"Failed to stop RTMP relay");return console.log("[Streaming] RTMP relay stopped"),{success:!0,message:"RTMP relay stopped"}}catch(s){const t=s instanceof Error?s.message:"Failed to stop RTMP relay";return console.error("[Streaming] Failed to stop RTMP relay:",s),{success:!1,message:t}}}async function j(){try{const s=await fetch(H("/api/streaming/status"));if(!s.ok)throw new Error("Failed to get streaming status");return await s.json()}catch(s){return console.error("[Streaming] Failed to get streaming status:",s),null}}return I(),{destinations:y,isStreaming:S,activeDestinationId:r,srtOutput:d,activeDestination:a,enabledDestinations:c,platforms:u,programOutputUrls:f,addDestination:h,updateDestination:D,removeDestination:v,setActiveDestination:O,toggleSrtOutput:C,updateSrtConfig:x,startStreaming:b,stopStreaming:g,buildRtmpUrl:k,getSrtOutputUrl:$,saveDestinations:K,loadSavedDestinations:I,startRtmpRelay:V,stopRtmpRelay:F,getStreamingStatus:j}}),ve={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ye={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},he={class:"p-6 overflow-y-auto max-h-[60vh]"},we={key:0,class:"mb-8 p-6 bg-gradient-to-br from-amber-600/20 to-red-600/20 rounded-xl border border-amber-500/30"},_e={class:"flex gap-3 mb-4"},Se=["placeholder"],ke={class:"text-xs text-r58-text-secondary"},$e=["href"],Pe={class:"mb-8"},Re={class:"flex items-center justify-between mb-4"},Ce={key:0,class:"mb-4 p-4 bg-r58-bg-tertiary rounded-lg"},Te={class:"grid grid-cols-2 gap-2"},Oe=["onClick"],De={class:"text-xl"},Me={key:1,class:"space-y-3"},Ue=["onClick"],Le={class:"text-xl"},Ie={class:"flex-1"},Ke={class:"font-medium"},Ee={class:"text-xs text-r58-text-secondary"},Ve=["onClick"],Fe=["onClick"],je={key:2,class:"text-r58-text-secondary text-sm"},Be={key:1,class:"mb-8 p-4 bg-r58-bg-tertiary rounded-lg"},He={class:"text-lg font-medium mb-4"},Ne={class:"space-y-4"},Ae=["placeholder"],We={key:0},qe={class:"flex gap-2"},Qe={class:"mb-8"},Ye={class:"space-y-3"},Ge={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Je={class:"flex items-center justify-between mb-1"},Xe={class:"text-xs text-r58-text-secondary break-all"},ze={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Ze={class:"flex items-center justify-between mb-1"},et={class:"text-xs text-r58-text-secondary break-all"},tt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},st={class:"flex items-center justify-between mb-1"},rt={class:"text-xs text-r58-text-secondary break-all"},ot={class:"p-3 bg-r58-bg-tertiary rounded-lg"},nt={class:"flex items-center justify-between mb-1"},at={class:"text-xs text-r58-text-secondary break-all"},it={class:"p-3 bg-r58-bg-tertiary rounded-lg"},lt={class:"flex items-center justify-between mb-1"},ut={class:"text-xs text-r58-text-secondary break-all"},dt={class:"p-4 bg-r58-bg-tertiary rounded-lg"},ct={class:"flex items-center gap-3 mb-4"},mt=A({__name:"StreamingSettings",setup(y,{expose:S}){const r=Y(),d=p(!1),a=p(null),c=p(!1),u=p("youtube"),f=p("");p(""),p("");const h=P(()=>r.destinations),D=P(()=>R),v=P(()=>r.programOutputUrls);function O(){d.value=!0}function C(){d.value=!1,a.value=null,c.value=!1}function x(s){const t=r.addDestination(s);a.value=t,c.value=!1,r.saveDestinations()}function b(){a.value&&(r.updateDestination(a.value.id,a.value),r.saveDestinations(),a.value=null,w.success("Streaming destination saved"))}function g(s){r.removeDestination(s),r.saveDestinations(),w.info("Destination removed")}function k(s){r.updateDestination(s.id,{enabled:!s.enabled}),r.saveDestinations()}function $(s,t){navigator.clipboard.writeText(s),w.success(`${t} copied to clipboard`)}function I(s){const t=R.find(n=>n.id===s);return(t==null?void 0:t.icon)||"ðŸ“¡"}function K(s){const t=R.find(n=>n.id===s);return(t==null?void 0:t.name)||"Unknown"}function V(){const s=R.find(t=>t.id===u.value);return(s==null?void 0:s.streamKeyPlaceholder)||"Enter stream key"}function F(){switch(u.value){case"youtube":return"https://support.google.com/youtube/answer/2907883";case"twitch":return"https://help.twitch.tv/s/article/twitch-stream-key-faq";case"facebook":return"https://www.facebook.com/help/587160588142067";case"restream":return"https://support.restream.io/en/";default:return"#"}}function j(){if(!f.value.trim()){w.error("Please enter your stream key");return}const s=r.addDestination(u.value);r.updateDestination(s.id,{streamKey:f.value,enabled:!0}),r.saveDestinations(),f.value="",w.success(`${K(u.value)} configured and enabled!`)}return S({open:O}),(s,t)=>{var n;return i(),X(oe,{to:"body"},[d.value?(i(),l("div",ve,[e("div",{class:"absolute inset-0 bg-black/60",onClick:C}),e("div",ye,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[t[13]||(t[13]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:C,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," Ã— ")]),e("div",he,[h.value.length===0?(i(),l("section",we,[t[16]||(t[16]=e("h3",{class:"text-xl font-semibold mb-2 flex items-center gap-2"}," ðŸ”´ Quick Setup: Stream to YouTube ",-1)),t[17]||(t[17]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Get streaming in seconds! Just paste your stream key below. ",-1)),e("div",_e,[U(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>u.value=o),class:"px-4 py-3 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg text-base"},[...t[14]||(t[14]=[e("option",{value:"youtube"},"â–¶ï¸ YouTube Live",-1),e("option",{value:"twitch"},"ðŸ“º Twitch",-1),e("option",{value:"facebook"},"ðŸ“˜ Facebook",-1),e("option",{value:"restream"},"ðŸ”„ Restream",-1)])],512),[[z,u.value]]),U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>f.value=o),type:"password",placeholder:V(),class:"flex-1 px-4 py-3 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg font-mono text-base focus:border-amber-500 focus:outline-none"},null,8,Se),[[B,f.value]]),e("button",{onClick:j,class:"px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg font-semibold transition-colors"}," Save & Enable ")]),e("p",ke,[t[15]||(t[15]=Z(" ðŸ”’ Your stream key is stored locally on this device and never sent to any server. ",-1)),e("a",{href:F(),target:"_blank",class:"text-amber-400 hover:underline ml-2"}," Where do I find my stream key? â†’ ",8,$e)])])):_("",!0),e("section",Pe,[e("div",Re,[t[18]||(t[18]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[2]||(t[2]=o=>c.value=!c.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),c.value?(i(),l("div",Ce,[t[19]||(t[19]=e("p",{class:"text-sm text-r58-text-secondary mb-3"},"Select a streaming platform:",-1)),e("div",Te,[(i(!0),l(N,null,W(D.value,o=>(i(),l("button",{key:o.id,onClick:M=>x(o.id),class:"flex items-center gap-2 p-3 bg-r58-bg-secondary hover:bg-r58-accent-primary/20 rounded-lg transition-colors text-left"},[e("span",De,m(o.icon),1),e("span",null,m(o.name),1)],8,Oe))),128))])])):_("",!0),h.value.length>0?(i(),l("div",Me,[(i(!0),l(N,null,W(h.value,o=>(i(),l("div",{key:o.id,class:"flex items-center gap-3 p-3 bg-r58-bg-tertiary rounded-lg"},[e("button",{onClick:M=>k(o),class:L(["w-10 h-6 rounded-full transition-colors relative",o.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:L(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",o.enabled?"left-5":"left-1"])},null,2)],10,Ue),e("span",Le,m(I(o.platformId)),1),e("div",Ie,[e("div",Ke,m(o.name),1),e("div",Ee,m(o.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+o.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:M=>a.value={...o},class:"text-r58-accent-primary hover:underline text-sm"}," Edit ",8,Ve),e("button",{onClick:M=>g(o.id),class:"text-r58-accent-danger hover:underline text-sm"}," Remove ",8,Fe)]))),128))])):(i(),l("p",je," No streaming destinations configured. Add a platform above. "))]),a.value?(i(),l("section",Be,[e("h3",He," Edit "+m(K(a.value.platformId)),1),e("div",Ne,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Display Name",-1)),U(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>a.value.name=o),type:"text",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none"},null,512),[[B,a.value.name]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Stream Key",-1)),U(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>a.value.streamKey=o),type:"password",placeholder:(n=T(R).find(o=>o.id===a.value.platformId))==null?void 0:n.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,8,Ae),[[B,a.value.streamKey]]),t[22]||(t[22]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),a.value.platformId==="custom"?(i(),l("div",We,[t[23]||(t[23]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"RTMP URL",-1)),U(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>a.value.name=o),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,512),[[B,a.value.name]])])):_("",!0),e("div",qe,[e("button",{onClick:b,class:"btn btn-primary"}," Save "),e("button",{onClick:t[6]||(t[6]=o=>a.value=null),class:"btn"}," Cancel ")])])])):_("",!0),e("section",Qe,[t[32]||(t[32]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[33]||(t[33]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",Ye,[e("div",Ge,[e("div",Je,[t[24]||(t[24]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[7]||(t[7]=o=>$(v.value.srt,"SRT URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Xe,m(v.value.srt),1),t[25]||(t[25]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",ze,[e("div",Ze,[t[26]||(t[26]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[8]||(t[8]=o=>$(v.value.rtmp,"RTMP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",et,m(v.value.rtmp),1)]),e("div",tt,[e("div",st,[t[27]||(t[27]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[9]||(t[9]=o=>$(v.value.rtsp,"RTSP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",rt,m(v.value.rtsp),1)]),e("div",ot,[e("div",nt,[t[28]||(t[28]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[10]||(t[10]=o=>$(v.value.hls,"HLS URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",at,m(v.value.hls),1),t[29]||(t[29]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",it,[e("div",lt,[t[30]||(t[30]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[11]||(t[11]=o=>$(v.value.whep,"WHEP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",ut,m(v.value.whep),1),t[31]||(t[31]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[36]||(t[36]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",dt,[e("div",ct,[e("button",{onClick:t[12]||(t[12]=o=>T(r).toggleSrtOutput(!T(r).srtOutput.enabled)),class:L(["w-10 h-6 rounded-full transition-colors relative",T(r).srtOutput.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:L(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",T(r).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[34]||(t[34]=e("span",null,"Enable SRT Output",-1))]),t[35]||(t[35]=e("div",{class:"text-sm text-r58-text-secondary"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-r58-bg-tertiary"},[e("button",{onClick:C,class:"btn"},"Close")])])])):_("",!0)])}}}),pt={class:"program-output space-y-3","data-testid":"program-output"},xt={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg","data-testid":"program-output-status"},gt={class:"text-sm font-medium","data-testid":"program-output-text"},ft={key:0,class:"space-y-2"},bt={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},vt={class:"flex-1 text-xs truncate text-r58-text-secondary"},yt={key:0,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},ht={class:"text-xs text-r58-text-secondary"},wt={key:1,class:"text-xs text-r58-text-secondary px-3"},_t={class:"hidden"},St=["src"],kt=A({__name:"ProgramOutput",setup(y){const S=ee(),r=Y(),d=p(!1),a=p("idle"),c=p("");function u(){return"https://r58-mediamtx.itagenten.no/mixer_program/whip"}function f(){d.value||(a.value="connecting",c.value=me(u()),d.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function h(){d.value&&(d.value=!1,c.value="",a.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function D(){d.value&&(a.value="live",console.log("[ProgramOutput] WHIP push connected"))}function v(){a.value="error",console.error("[ProgramOutput] WHIP push failed")}function O(){h(),setTimeout(()=>f(),500)}ne(()=>S.isLive,g=>{g?f():h()});function C(){switch(a.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function x(){switch(a.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function b(){const g=r.programOutputUrls.srt;navigator.clipboard.writeText(g),w.success("SRT URL copied")}return(g,k)=>(i(),l("div",pt,[e("div",xt,[e("span",{class:L(["w-2 h-2 rounded-full",C()]),"data-testid":"program-output-indicator"},null,2),e("span",gt,m(x()),1),a.value==="error"?(i(),l("button",{key:0,onClick:k[0]||(k[0]=$=>O()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"}," Retry ")):_("",!0)]),a.value==="live"?(i(),l("div",ft,[e("div",bt,[k[1]||(k[1]=e("span",{class:"text-xs text-r58-text-secondary"},"ðŸ”´ SRT:",-1)),e("code",vt,m(T(r).programOutputUrls.srt),1),e("button",{onClick:b,class:"text-xs text-r58-accent-primary hover:underline"},"Copy")]),T(r).enabledDestinations.length>0?(i(),l("div",yt,[k[2]||(k[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",ht,m(T(r).enabledDestinations.length)+" streaming destination"+m(T(r).enabledDestinations.length>1?"s":"")+" active ",1)])):_("",!0)])):_("",!0),a.value==="idle"?(i(),l("p",wt," Program output will start automatically when you go live. ")):_("",!0),e("div",_t,[d.value&&c.value?(i(),l("iframe",{key:0,src:c.value,onLoad:D,onError:v,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,St)):_("",!0)])]))}}),$t={class:"streaming-control-panel"},Pt={class:"flex items-center gap-3 px-4 py-2 bg-r58-bg-secondary border-b border-r58-bg-tertiary"},Rt={class:"flex items-center gap-2"},Ct={class:"text-sm font-medium"},Tt={key:1,class:"flex items-center gap-2 ml-auto"},Ot={class:"flex items-center gap-1"},Dt=["title"],Mt={key:0,class:"px-4 py-3 bg-r58-bg-tertiary/50 border-b border-r58-bg-tertiary"},Ut={class:"flex items-center gap-4 max-w-4xl"},Lt={class:"flex items-center gap-2"},It={class:"text-2xl"},Kt={class:"flex-1 relative"},Et=["placeholder"],Vt={class:"text-xs text-r58-text-secondary mt-2"},Ft={key:0,href:"https://studio.youtube.com",target:"_blank",class:"text-amber-400 hover:underline"},jt={key:1,href:"https://dashboard.twitch.tv/settings/stream",target:"_blank",class:"text-amber-400 hover:underline"},Bt={key:2,href:"https://facebook.com/live/producer",target:"_blank",class:"text-amber-400 hover:underline"},Ht={key:3,href:"https://app.restream.io",target:"_blank",class:"text-amber-400 hover:underline"},Nt={key:4},At={class:"hidden"},Wt=A({__name:"StreamingControlPanel",setup(y){const S=ee(),r=Y(),d=p(null),a=p(null),c=p(!1),u=p("youtube"),f=p(""),h=P(()=>S.isLive),D=P(()=>r.destinations.length>0),v=P(()=>r.enabledDestinations.length>0),O=P(()=>h.value?"live":"idle");function C(){h.value?b():x()}async function x(){if(S.setLive(!0),r.enabledDestinations.length>0){const s=await r.startRtmpRelay();s.success?w.success(s.message):w.error(`RTMP relay failed: ${s.message}`)}else w.success("Streaming started (no RTMP destinations configured)")}async function b(){if(S.setLive(!1),r.enabledDestinations.length>0){const s=await r.stopRtmpRelay();s.success||w.warning(`Note: ${s.message}`)}w.info("Streaming stopped")}function g(){pe(1)?w.success("Program window opened"):w.error("Popup blocked - please allow popups for this site")}function k(){var s;(s=d.value)==null||s.open()}function $(){c.value=!c.value}function I(){if(!f.value.trim()){w.error("Please enter your stream key");return}if(!R.find(n=>n.id===u.value))return;const t=r.destinations.find(n=>n.platformId===u.value);if(t)r.updateDestination(t.id,{streamKey:f.value,enabled:!0});else{const n=r.addDestination(u.value);r.updateDestination(n.id,{streamKey:f.value,enabled:!0})}r.saveDestinations(),c.value=!1,f.value="",x()}function K(){const s=R.find(t=>t.id===u.value);return(s==null?void 0:s.streamKeyPlaceholder)||"Enter your stream key"}function V(){const s=R.find(t=>t.id===u.value);return(s==null?void 0:s.icon)||"ðŸ“¡"}function F(){switch(O.value){case"live":return"bg-r58-accent-danger";case"connecting":return"bg-r58-accent-warning animate-pulse";case"error":return"bg-r58-accent-danger";default:return"bg-r58-text-secondary"}}function j(){switch(O.value){case"live":return"LIVE";case"connecting":return"Connecting...";case"error":return"Error";default:return"Offline"}}return(s,t)=>(i(),l("div",$t,[e("div",Pt,[e("div",Rt,[e("span",{class:L(["w-2 h-2 rounded-full",F()])},null,2),e("span",Ct,m(j()),1)]),t[4]||(t[4]=e("div",{class:"h-6 w-px bg-r58-bg-tertiary"},null,-1)),e("button",{onClick:C,class:L(["px-4 py-2 rounded-lg font-medium text-sm transition-all",h.value?"bg-r58-accent-danger hover:bg-red-600 text-white":"bg-r58-accent-success hover:bg-green-600 text-white"])},m(h.value?"â¹ Stop Streaming":"â–¶ Start Streaming"),3),D.value?_("",!0):(i(),l("button",{key:0,onClick:$,class:L(["px-4 py-2 rounded-lg font-medium text-sm transition-all border-2 border-dashed",c.value?"bg-amber-600/20 border-amber-500 text-amber-400":"bg-transparent border-r58-bg-tertiary hover:border-amber-500 text-r58-text-secondary hover:text-amber-400"])}," ðŸ”‘ Add Stream Key ",2)),e("button",{onClick:g,class:"px-4 py-2 rounded-lg font-medium text-sm bg-r58-bg-tertiary hover:bg-r58-accent-primary text-r58-text-primary transition-colors",title:"Open program output in new window"}," ðŸ‘ Watch Program "),e("button",{onClick:k,class:"px-4 py-2 rounded-lg font-medium text-sm bg-r58-bg-tertiary hover:bg-r58-accent-primary text-r58-text-primary transition-colors",title:"Configure streaming destinations"}," âš™ï¸ Settings "),v.value?(i(),l("div",Tt,[t[3]||(t[3]=e("span",{class:"text-xs text-r58-text-secondary"}," Streaming to: ",-1)),e("div",Ot,[(i(!0),l(N,null,W(T(r).enabledDestinations,n=>(i(),l("span",{key:n.id,class:"px-2 py-1 bg-r58-bg-tertiary rounded text-xs",title:n.name},m(n.platformId==="youtube"?"â–¶ï¸":n.platformId==="twitch"?"ðŸ“º":"ðŸ”´")+" "+m(n.name),9,Dt))),128))])])):_("",!0)]),E(q,{name:"slide"},{default:Q(()=>[c.value?(i(),l("div",Mt,[e("div",Ut,[e("div",Lt,[e("span",It,m(V()),1),U(e("select",{"onUpdate:modelValue":t[0]||(t[0]=n=>u.value=n),class:"px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg text-sm focus:border-amber-500 focus:outline-none"},[...t[5]||(t[5]=[e("option",{value:"youtube"},"YouTube Live",-1),e("option",{value:"twitch"},"Twitch",-1),e("option",{value:"facebook"},"Facebook Live",-1),e("option",{value:"restream"},"Restream",-1)])],512),[[z,u.value]])]),e("div",Kt,[U(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>f.value=n),type:"password",placeholder:K(),class:"w-full px-4 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg text-sm font-mono focus:border-amber-500 focus:outline-none",onKeyup:ae(I,["enter"])},null,40,Et),[[B,f.value]]),t[6]||(t[6]=e("span",{class:"absolute right-3 top-1/2 -translate-y-1/2 text-xs text-r58-text-secondary"}," ðŸ”’ Stored locally ",-1))]),e("button",{onClick:I,class:"px-6 py-2 bg-red-600 hover:bg-red-500 text-white rounded-lg font-medium text-sm transition-colors flex items-center gap-2"}," ðŸ”´ Go Live "),e("button",{onClick:t[2]||(t[2]=n=>c.value=!1),class:"px-3 py-2 text-r58-text-secondary hover:text-r58-text-primary"}," âœ• ")]),e("p",Vt,[t[7]||(t[7]=Z(" Paste your stream key from ",-1)),u.value==="youtube"?(i(),l("a",Ft,"YouTube Studio â†’ Go Live â†’ Stream Settings")):u.value==="twitch"?(i(),l("a",jt,"Twitch Dashboard â†’ Stream Key")):u.value==="facebook"?(i(),l("a",Bt,"Facebook Live Producer")):u.value==="restream"?(i(),l("a",Ht,"Restream Dashboard")):(i(),l("span",Nt,"your streaming platform"))])])):_("",!0)]),_:1}),e("div",At,[E(kt,{ref_key:"programOutputRef",ref:a},null,512)]),E(mt,{ref_key:"streamingSettingsRef",ref:d},null,512)]))}}),qt=te(Wt,[["__scopeId","data-v-978ceadf"]]),Qt={class:"h-full flex flex-col bg-r58-bg-primary"},Yt={class:"flex items-center justify-between px-4 py-2 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},Gt={class:"flex items-center gap-3"},Jt={class:"text-sm text-r58-text-secondary"},Xt={class:"flex items-center gap-2 text-xs text-r58-text-secondary"},zt={class:"px-2 py-1 bg-r58-bg-tertiary rounded"},Zt={class:"flex-1 relative"},es=["src"],ts={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-primary"},ss=A({__name:"MixerView",setup(y){const S=ie(),r=le(),d=p(!0),a=p(!1),c=p(!1),u=p("Starting mixer..."),f=P(()=>S.inputs.filter(x=>x.hasSignal)),h=P(()=>{const x=ge(),b=xe(),g=new URL(`${b}://${x}/mixer.html`);return g.searchParams.set("room",J),g.searchParams.set("password",fe),g.toString()});function D(){console.log("[Mixer] VDO.ninja mixer iframe loaded"),a.value=!0,u.value="Waiting for cameras..."}function v(){d.value=!1}async function O(){const x=performance.now();u.value="Starting camera bridge...";for(let b=0;b<40;b++){try{if((await(await fetch(H("/api/mode/status"))).json()).current_mode==="mixer"){const $=Math.round((performance.now()-x)/1e3);if($>=5){console.log(`[Mixer] Bridge likely ready after ${$}s`),c.value=!0,u.value="Cameras connecting...";return}}}catch{}await new Promise(g=>setTimeout(g,500)),u.value=`Starting camera bridge... (${Math.round((performance.now()-x)/1e3)}s)`}console.log("[Mixer] Bridge wait timeout - continuing anyway"),c.value=!0}async function C(){var b;if(!de())return;u.value="Checking mode...",await r.fetchCapabilities();const x=(b=r.capabilities)==null?void 0:b.current_mode;if(x&&x!=="mixer"){console.log("[Mixer] Not in mixer mode, switching..."),u.value="Switching to mixer mode...";try{(await fetch(H("/api/mode/mixer"),{method:"POST"})).ok&&(await r.fetchCapabilities(),w.success("Switched to Mixer mode"))}catch(g){console.warn("[Mixer] Failed to switch mode:",g)}}}return ue(async()=>{const x=performance.now();await Promise.all([C(),S.fetchInputs()]),await O(),console.log(`[Mixer] Total load time: ${Math.round(performance.now()-x)}ms`)}),(x,b)=>(i(),l(N,null,[E(q,{name:"fade"},{default:Q(()=>[d.value?(i(),X(be,{key:0,mode:"mixer","content-ready":a.value&&c.value,"min-time":2e3,"max-time":2e4,onReady:v},null,8,["content-ready"])):_("",!0)]),_:1}),E(q,{name:"content-fade"},{default:Q(()=>[U(e("div",Qt,[e("header",Yt,[e("div",Gt,[b[0]||(b[0]=e("span",{class:"text-lg font-semibold text-r58-mixer"},"Mixer",-1)),e("span",Jt,m(f.value.length)+" camera"+m(f.value.length!==1?"s":"")+" detected ",1)]),e("div",Xt,[e("span",zt,"Room: "+m(T(J)),1)])]),E(qt),e("div",Zt,[e("iframe",{src:h.value,onLoad:D,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,es),a.value?_("",!0):(i(),l("div",ts,[...b[1]||(b[1]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-r58-text-secondary"},"Loading VDO.ninja mixer..."),e("span",{class:"text-xs text-r58-text-secondary/60"},"Cameras will appear when bridge is running")],-1)])]))])],512),[[ce,!d.value]])]),_:1})],64))}}),as=te(ss,[["__scopeId","data-v-f3e384b2"]]);export{as as default};
