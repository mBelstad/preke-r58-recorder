import{d as Y,r as n,j as P,k as Z,o as ee,l as te,c as a,a as R,m as se,w as H,p as le,T as ae,v as oe,e as t,q as W,s as q,f as i,F as D,x as m,y as z,t as v,n as I,z as ne,A as ie,B as re,C as de,g as ce,i as o,_ as ve}from"./index-KRz20TQu.js";const ue={class:"setup-page"},we={class:"welcome-content"},pe={class:"welcome-logo-wrap"},me=["src"],_e={class:"setup-page__content"},fe={class:"logo-hero"},ge=["src"],he={class:"setup-card"},ye={class:"discovery-section"},be={class:"discovery-header"},ke={key:0,class:"section-title"},De={key:1,class:"section-title-spacer"},Ce={key:0,class:"scan-indicator"},Ae={class:"soundwave"},Se={key:0,class:"scan-status"},Pe={key:1,class:"device-group"},Ie={class:"device-group__label"},xe={key:0,class:"device-group__count"},Me={key:0,class:"device-selection"},Be={class:"device-item__info"},Ve={class:"device-item__name"},ze={key:0,class:"device-item__version"},Fe={class:"device-item__url"},Ne=["onClick"],Te={key:2,class:"device-group"},Ue={key:0,class:"device-group__label"},$e={class:"device-item__info"},Ee={class:"device-item__name"},Le={key:0,class:"device-item__badge"},Re={class:"device-item__url"},He={class:"device-item__actions"},We=["onClick"],qe={key:3,class:"empty-state"},Oe={class:"manual-section"},je={class:"manual-section__actions"},Ge=["disabled"],Ke={class:"manual-form__row"},Xe=["disabled"],Je={key:0,class:"spinner",viewBox:"0 0 24 24"},Qe={key:0,class:"field-error"},Ye={key:0,class:"electron-warning"},Ze=30,et=Y({__name:"DeviceSetupView",setup(tt){const F=ce(),u=n([]),f=n(null),_=n(!0),N=n(!1),d=n(!1),c=n(!1),r=n([]),y=n(""),C=n(null),A=n(null),x=n(0),b=n(!1),g=n(""),M=n(""),w=n(""),S=n(!1),T=[],h=P(()=>u.value.length>0),O=P(()=>u.value.find(s=>s.id===f.value)),j=P(()=>Z()),p=P(()=>{const s=new Set(u.value.map(l=>l.url.replace(/\/$/,""))),e=r.value.filter(l=>!s.has(l.url.replace(/\/$/,"")));return{saved:u.value,discovered:e}});async function B(){if(window.electronAPI)try{u.value=await window.electronAPI.getDevices();const s=await window.electronAPI.getActiveDevice();f.value=(s==null?void 0:s.id)||null}catch(s){console.error("Failed to load devices:",s)}}function U(s=!1){!window.electronAPI||d.value||(r.value=[],y.value="",s&&(x.value=0,c.value=!1,E()),window.electronAPI.startDiscovery())}function $(){window.electronAPI&&window.electronAPI.stopDiscovery()}function E(){k(),A.value=setTimeout(()=>{C.value=setInterval(()=>{var s;!d.value&&r.value.length===0&&!h.value&&(x.value<Ze?(x.value++,c.value=!0,(s=window.electronAPI)==null||s.startDiscovery()):k())},45e3)},3e4)}function k(){A.value&&(clearTimeout(A.value),A.value=null),C.value&&(clearInterval(C.value),C.value=null)}async function L(s){if(window.electronAPI)try{const e=await window.electronAPI.addDevice(s.name,s.url);await B(),u.value.length===1&&await V(e.id)}catch(e){console.error("Failed to add device:",e)}}async function G(){if(!window.electronAPI)return;if(w.value="",!g.value.trim()){w.value="URL is required";return}let s=g.value.trim();!s.startsWith("http://")&&!s.startsWith("https://")&&(s=`http://${s}`);try{new URL(s)}catch{w.value="Invalid URL format";return}S.value=!0;try{const e=await window.electronAPI.probeDevice(s);if(e)await L(e),g.value="",M.value="",b.value=!1;else{const l=await window.electronAPI.addDevice(M.value.trim()||"Preke Device",s);await B(),u.value.length===1&&await V(l.id),g.value="",M.value="",b.value=!1}}catch{w.value="Failed to add device"}finally{S.value=!1}}async function V(s){if(window.electronAPI)try{await window.electronAPI.setActiveDevice(s),f.value=s;const e=u.value.find(l=>l.id===s);e&&de(e.url),F.push("/")}catch(e){console.error("Failed to select device:",e)}}function K(){O.value&&F.push("/")}function X(){window.electronAPI&&T.push(window.electronAPI.onDiscoveryStarted(()=>{d.value=!0}),window.electronAPI.onDeviceDiscovered(s=>{r.value.find(e=>e.id===s.id)||(r.value.push(s),k(),c.value=!1,_.value&&(_.value=!1))}),window.electronAPI.onScanningSubnet(s=>{c.value||(y.value=s)}),window.electronAPI.onDiscoveryComplete(s=>{d.value=!1,c.value=!1,y.value="";for(const e of s)r.value.find(l=>l.id===e.id)||r.value.push(e);(r.value.length>0||h.value)&&k()}))}function J(){N.value=!0,setTimeout(()=>{_.value=!1},500)}return ee(async()=>{if(await B(),X(),h.value){_.value=!1;return}window.electronAPI&&(U(),E()),setTimeout(()=>{_.value&&r.value.length===0&&J()},2500)}),te(()=>{for(const s of T)s();k(),d.value&&$()}),(s,e)=>(o(),a("div",ue,[e[24]||(e[24]=R('<div class="setup-page__bg" data-v-53775ed1><div class="setup-page__bg-texture" data-v-53775ed1></div><div class="bg-orb bg-orb--1" data-v-53775ed1></div><div class="bg-orb bg-orb--2" data-v-53775ed1></div><div class="bg-highlight bg-highlight--1" data-v-53775ed1></div><div class="bg-highlight bg-highlight--2" data-v-53775ed1></div></div>',1)),se(ae,{name:"welcome-fade"},{default:le(()=>[_.value?(o(),a("div",{key:0,class:I(["welcome-screen",{"welcome-screen--fading":N.value}])},[e[5]||(e[5]=t("div",{class:"welcome-orb welcome-orb--1"},null,-1)),e[6]||(e[6]=t("div",{class:"welcome-orb welcome-orb--2"},null,-1)),e[7]||(e[7]=t("div",{class:"welcome-orb welcome-orb--3"},null,-1)),e[8]||(e[8]=t("div",{class:"welcome-orb welcome-orb--4"},null,-1)),e[9]||(e[9]=t("div",{class:"welcome-beam welcome-beam--1"},null,-1)),e[10]||(e[10]=t("div",{class:"welcome-beam welcome-beam--2"},null,-1)),e[11]||(e[11]=t("div",{class:"welcome-beam welcome-beam--3"},null,-1)),t("div",we,[t("div",pe,[t("img",{src:W(q),alt:"Preke Studio",class:"welcome-logo"},null,8,me),e[4]||(e[4]=t("div",{class:"welcome-glow"},null,-1))])])],2)):i("",!0)]),_:1}),H(t("div",_e,[t("div",fe,[t("img",{src:W(q),alt:"Preke Studio",class:"logo-hero__img"},null,8,ge)]),t("div",he,[t("div",ye,[t("div",be,[d.value&&!c.value||r.value.length>0||h.value?(o(),a("h2",ke,[d.value&&!c.value?(o(),a(D,{key:0},[m("Searching...")],64)):(o(),a(D,{key:1},[m("Devices")],64))])):(o(),a("div",De))]),d.value&&!c.value?(o(),a("div",Ce,[t("div",Ae,[(o(),a(D,null,z(24,l=>t("span",{key:l,class:"soundwave__bar",style:re({"--i":l})},null,4)),64))]),y.value?(o(),a("p",Se,"Scanning "+v(y.value)+".x",1)):i("",!0)])):i("",!0),p.value.discovered.length>0?(o(),a("div",Pe,[t("p",Ie,[e[12]||(e[12]=m(" Found on network ",-1)),p.value.discovered.length>1?(o(),a("span",xe," ("+v(p.value.discovered.length)+" devices) ",1)):i("",!0)]),p.value.discovered.length>1?(o(),a("div",Me,[...e[13]||(e[13]=[t("p",{class:"device-selection__hint"},"Select a device to connect:",-1)])])):i("",!0),(o(!0),a(D,null,z(p.value.discovered,l=>(o(),a("div",{key:l.id,class:"device-item device-item--discovered"},[e[14]||(e[14]=t("div",{class:"device-item__icon device-item__icon--new"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),t("path",{d:"M8 21h8M12 17v4"})])],-1)),t("div",Be,[t("span",Ve,v(l.name),1),l.version?(o(),a("span",ze,"v"+v(l.version),1)):i("",!0),t("span",Fe,v(l.host)+":"+v(l.port),1)]),t("button",{onClick:Q=>L(l),class:"btn btn--primary"}," Connect ",8,Ne)]))),128))])):i("",!0),p.value.saved.length>0?(o(),a("div",Te,[p.value.discovered.length>0?(o(),a("p",Ue,"Saved devices")):i("",!0),(o(!0),a(D,null,z(p.value.saved,l=>(o(),a("div",{key:l.id,class:I(["device-item",{"device-item--active":l.id===f.value}])},[e[15]||(e[15]=t("div",{class:"device-item__icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),t("path",{d:"M8 21h8M12 17v4"})])],-1)),t("div",$e,[t("span",Ee,v(l.name),1),l.id===f.value?(o(),a("span",Le,"Connected")):i("",!0),t("span",Re,v(l.url),1)]),t("div",He,[l.id!==f.value?(o(),a("button",{key:0,onClick:Q=>V(l.id),class:"btn btn--primary"}," Connect ",8,We)):(o(),a("button",{key:1,onClick:K,class:"btn btn--success"}," Open "))])],2))),128))])):i("",!0),(!d.value||c.value)&&r.value.length===0&&!h.value?(o(),a("div",qe,[...e[16]||(e[16]=[R('<div class="empty-state__icon" data-v-53775ed1><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-53775ed1><rect x="2" y="3" width="20" height="14" rx="2" data-v-53775ed1></rect><path d="M8 21h8M12 17v4" data-v-53775ed1></path><path d="M9 9l6 6M15 9l-6 6" stroke-width="1.5" stroke-linecap="round" data-v-53775ed1></path></svg></div><p class="empty-state__title" data-v-53775ed1>No devices found</p><p class="empty-state__hint" data-v-53775ed1>Make sure your Preke device is:</p><ul class="empty-state__checklist" data-v-53775ed1><li data-v-53775ed1>Powered on</li><li data-v-53775ed1>Connected to the same network</li><li data-v-53775ed1>Finished booting up (~30 seconds)</li></ul>',4)])])):i("",!0)]),e[22]||(e[22]=t("div",{class:"divider"},[t("span",null,"or")],-1)),t("div",Oe,[t("div",je,[d.value&&!c.value?(o(),a("button",{key:0,onClick:$,class:"btn-scan btn-scan--stop"}," Stop ")):r.value.length>0||h.value?(o(),a("button",{key:1,onClick:e[0]||(e[0]=l=>U(!0)),disabled:d.value,class:I(["btn-scan",{"btn-scan--spinning":c.value}]),title:"Scan again"},[...e[17]||(e[17]=[t("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"btn-scan__icon"},[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1),m(" Scan ",-1)])],10,Ge)):i("",!0),b.value?(o(),a("form",{key:3,onSubmit:ne(G,["prevent"]),class:"manual-form"},[t("div",Ke,[H(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>g.value=l),type:"text",placeholder:"IP address or URL (e.g., 192.168.1.100)",class:I(["input",{"input--error":w.value}])},null,2),[[ie,g.value]]),t("button",{type:"submit",disabled:S.value,class:"btn btn--primary"},[S.value?(o(),a("svg",Je,[...e[19]||(e[19]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none",opacity:"0.25"},null,-1),t("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",opacity:"0.75"},null,-1)])])):i("",!0),e[20]||(e[20]=m(" Add ",-1))],8,Xe)]),w.value?(o(),a("span",Qe,v(w.value),1)):i("",!0),t("button",{type:"button",onClick:e[3]||(e[3]=l=>{b.value=!1,w.value=""}),class:"btn-cancel"}," Cancel ")],32)):(o(),a("button",{key:2,onClick:e[1]||(e[1]=l=>b.value=!0),class:"btn-manual"},[...e[18]||(e[18]=[t("svg",{viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z","clip-rule":"evenodd"})],-1),m(" Enter address manually ",-1)])]))])]),j.value?i("",!0):(o(),a("div",Ye,[...e[21]||(e[21]=[t("svg",{viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),m(" Auto-discovery requires the ",-1),t("strong",null,"Preke Studio",-1),m(" desktop app. ",-1)])]))]),e[23]||(e[23]=t("footer",{class:"setup-footer"},[t("span",{class:"version"},"v2.0")],-1))],512),[[oe,!_.value]])]))}}),lt=ve(et,[["__scopeId","data-v-53775ed1"]]);export{lt as default};
