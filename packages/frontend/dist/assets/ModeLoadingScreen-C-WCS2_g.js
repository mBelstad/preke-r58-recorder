import{a0 as ue,D as re,a1 as ke,a2 as $e,r as k,k as V,J as L,d as ae,m as q,c as v,b as e,e as T,y as D,t as y,F as H,z as K,n as B,s as U,o as p,_ as ne,H as le,K as Te,w as ce,q as Z,B as E,f as de,R as Pe,p as ie,P as Ue,j as R,C as j,a as ze}from"./index-Cj-qBk1o.js";import{A as Se}from"./AnimatedBackground-D2CUIMrg.js";const se={lan:2e3,tailscale:2e3,frp:3e3};async function Ne(s,C,w){const i=performance.now();try{const b=await fetch(`${C}/health`,{method:"GET",signal:w,cache:"no-store"});if(!b.ok)throw new Error(`HTTP ${b.status}`);const _=performance.now()-i;return{method:s,url:C,latency:_,success:!0}}catch(b){throw{method:s,url:C,error:b}}}async function Fe(){const s={},C=n=>{if(n==="localhost"||n==="127.0.0.1"||n.startsWith("192.168.")||n.startsWith("10."))return!0;if(n.startsWith("172.")){const r=parseInt(n.split(".")[1],10);return r>=16&&r<=31}return!1},w=n=>n.startsWith("100.")||n.endsWith(".ts.net"),i=ue();let b=null;const _=i&&(new URL(i).hostname.startsWith("100.")||new URL(i).hostname.endsWith(".ts.net"));if(i&&!_)try{const n=new AbortController,r=setTimeout(()=>n.abort(),2e3),o=await fetch(`${i}/api/network/info`,{signal:n.signal,cache:"no-store"});if(clearTimeout(r),o.ok){const u=await o.json();if(u.lan_ip){b=u.lan_ip;try{const g=new URL(i),S=`${g.protocol}//${b}:${g.port||8e3}`;s.lanUrl=S,console.log(`[ConnectionProbe] Discovered LAN IP: ${b}, using ${S}`)}catch(g){console.warn("[ConnectionProbe] Failed to build LAN URL:",g)}}}}catch(n){console.debug("[ConnectionProbe] Could not fetch network info:",n)}else _&&console.log("[ConnectionProbe] Connected via Tailscale - skipping LAN discovery (different subnet likely)");if(!s.lanUrl&&i)try{const n=new URL(i);w(n.hostname)?s.tailscaleUrl=i:C(n.hostname)&&(s.lanUrl=i)}catch{console.warn("[ConnectionProbe] Invalid device URL:",i)}const c=ke();if(c&&!s.tailscaleUrl)try{const n=new URL(c);w(n.hostname)&&(s.tailscaleUrl=c)}catch{console.warn("[ConnectionProbe] Invalid fallback URL:",c)}const h=await $e();return h?s.frpUrl=h:s.frpUrl="https://app.itagenten.no",s}async function La(s){const C=await Fe(),w=[],i=[],b=[];if(C.lanUrl&&b.push({method:"lan",url:C.lanUrl,timeout:se.lan}),C.tailscaleUrl&&b.push({method:"tailscale",url:C.tailscaleUrl,timeout:se.tailscale}),C.frpUrl&&b.push({method:"frp",url:C.frpUrl,timeout:se.frp}),b.length===0)return console.warn("[ConnectionProbe] No connection methods available, using HLS fallback"),{method:"hls",url:"https://app.itagenten.no",latency:0,success:!1};for(const h of b){const n=new AbortController;i.push(n),s==null||s(`Testing ${h.method.toUpperCase()} connection...`);const r=setTimeout(()=>n.abort(),h.timeout);w.push(Ne(h.method,h.url,n.signal).then(o=>(clearTimeout(r),o)).catch(o=>{throw clearTimeout(r),o}))}const _=ue(),c=h=>{try{const n=new URL(h);if(n.hostname.startsWith("100.")||n.hostname.endsWith(".ts.net")||n.hostname==="localhost"||n.hostname==="127.0.0.1"||n.hostname.startsWith("192.168.")||n.hostname.startsWith("10."))return!0;if(n.hostname.startsWith("172.")){const r=parseInt(n.hostname.split(".")[1],10);return r>=16&&r<=31}return!1}catch{return!1}};try{const h=await Promise.allSettled(w);i.forEach(o=>o.abort());const n=[];for(const o of h)o.status==="fulfilled"&&n.push(o.value);if(n.length===0)throw new Error("All probes failed");n.sort((o,u)=>{const g={lan:1,tailscale:2,frp:3,hls:4};return g[o.method]-g[u.method]});const r=n[0];return console.log(`[ConnectionProbe] Winner: ${r.method.toUpperCase()} (${Math.round(r.latency)}ms)`),n.length>1&&console.log(`[ConnectionProbe] Also available: ${n.slice(1).map(o=>o.method.toUpperCase()).join(", ")}`),s==null||s("Connection established"),_&&c(_)&&r.method==="frp"?(console.log("[ConnectionProbe] Keeping direct device URL despite FRP winning:",_),{method:r.method,url:_,latency:r.latency,success:!0}):(re(r.url),r)}catch{if(console.warn("[ConnectionProbe] All methods failed"),_){console.log("[ConnectionProbe] Keeping original device URL:",_),s==null||s("Using existing connection");let r="lan";try{const o=new URL(_);o.hostname.startsWith("100.")||o.hostname.endsWith(".ts.net")?r="tailscale":o.hostname.includes("itagenten.no")&&(r="frp")}catch{}return{method:r,url:_,latency:0,success:!1}}s==null||s("Using HLS fallback");const n=C.frpUrl||"https://app.itagenten.no";return re(n),{method:"hls",url:n,latency:0,success:!1}}}function te(){const s=k([]),C=k(!1),w=k(null),i=k(null);async function b(){C.value=!0,w.value=null;try{const m=await L.cameras.list();s.value=await Promise.all(m.map(async f=>{try{const d=await L.cameras.getStatus(f);return{name:d.name,type:d.type,connected:d.connected,settings:d.settings}}catch{return{name:f,type:"blackmagic",connected:!1}}}))}catch(m){w.value=m.message||"Failed to load cameras",console.error("[CameraControls] Failed to load cameras:",m)}finally{C.value=!1}}const _=V(()=>m=>s.value.find(f=>f.name===m));function c(m,f){const d=_.value(m);if(!d)return!1;const t=["focus","iris","whiteBalance","gain","iso","shutter","colorCorrection"],l=["focus","exposure","whiteBalance","ptz"],A=["focus","exposure","whiteBalance","iso","shutter","ptz"];return d.type==="blackmagic"?t.includes(f):d.type==="obsbot_tail2"?l.includes(f):d.type==="sony_fx30"?A.includes(f):!1}async function h(m,f,d){try{await L.cameras.setFocus(m,f,d),await P(m)}catch(t){throw new Error(t.message||"Failed to set focus")}}async function n(m,f,d){try{await L.cameras.setWhiteBalance(m,f,d),await P(m)}catch(t){throw new Error(t.message||"Failed to set white balance")}}async function r(m,f,d){try{await L.cameras.setExposure(m,f,d),await P(m)}catch(t){throw new Error(t.message||"Failed to set exposure")}}async function o(m,f){try{await L.cameras.setISO(m,f),await P(m)}catch(d){throw new Error(d.message||"Failed to set ISO")}}async function u(m,f){try{await L.cameras.setShutter(m,f),await P(m)}catch(d){throw new Error(d.message||"Failed to set shutter")}}async function g(m,f,d){try{await L.cameras.setIris(m,f,d),await P(m)}catch(t){throw new Error(t.message||"Failed to set iris")}}async function S(m,f){try{await L.cameras.setGain(m,f),await P(m)}catch(d){throw new Error(d.message||"Failed to set gain")}}async function F(m,f,d,t){try{await L.cameras.setPTZ(m,f,d,t)}catch(l){throw new Error(l.message||"Failed to move PTZ")}}async function N(m,f){try{await L.cameras.recallPTZPreset(m,f)}catch(d){throw new Error(d.message||"Failed to recall preset")}}async function I(m,f){try{await L.cameras.setColorCorrection(m,f),await P(m)}catch(d){throw new Error(d.message||"Failed to set color correction")}}async function P(m){try{const f=await L.cameras.getStatus(m),d=s.value.findIndex(t=>t.name===m);d>=0&&(s.value[d]={name:f.name,type:f.type,connected:f.connected,settings:f.settings})}catch(f){console.error(`[CameraControls] Failed to refresh status for ${m}:`,f)}}return{cameras:s,loading:C,error:w,selectedCamera:i,getCamera:_,supportsFeature:c,loadCameras:b,setFocus:h,setWhiteBalance:n,setExposure:r,setISO:o,setShutter:u,setIris:g,setGain:S,setPTZ:F,recallPTZPreset:N,setColorCorrection:I,refreshCameraStatus:P}}const Be={class:"companion-panel"},Ie={class:"panel-header"},Me=["aria-label"],Le={key:0,class:"help-section"},Ze={class:"help-text"},Ee={class:"camera-list"},Ae={class:"camera-header"},Ge={class:"camera-info"},Oe={class:"camera-name"},Ve={class:"camera-type"},We={class:"endpoints-section"},Re={class:"endpoint-group"},De={class:"endpoint-path"},Je=["onClick"],je={class:"quick-actions"},He={class:"action-buttons"},Ke=["onClick"],qe={key:1,class:"empty-state"},Qe=ae({__name:"CompanionIntegrationPanel",setup(s){const{cameras:C,loadCameras:w}=te(),i=k(!1),b=V(()=>typeof window<"u"?window.location.origin:"https://app.itagenten.no");function _(r){return{blackmagic:"Blackmagic Studio 4K Pro",obsbot_tail2:"OBSbot Tail 2",sony_fx30:"Sony FX30"}[r]||r}function c(r){const o=`${b.value}/api/v1/cameras/${r.name}`,u=[];return u.push({method:"PUT",path:`${o}/settings/focus`,example:JSON.stringify({mode:"auto"},null,2)}),u.push({method:"PUT",path:`${o}/settings/focus`,example:JSON.stringify({mode:"manual",value:.5},null,2)}),u.push({method:"PUT",path:`${o}/settings/whiteBalance`,example:JSON.stringify({mode:"auto"},null,2)}),u.push({method:"PUT",path:`${o}/settings/whiteBalance`,example:JSON.stringify({mode:"manual",temperature:5600},null,2)}),(r.type==="obsbot_tail2"||r.type==="sony_fx30")&&u.push({method:"PUT",path:`${o}/settings/exposure`,example:JSON.stringify({mode:"auto"},null,2)}),(r.type==="blackmagic"||r.type==="sony_fx30")&&u.push({method:"PUT",path:`${o}/settings/iso`,example:JSON.stringify({value:400},null,2)}),(r.type==="blackmagic"||r.type==="sony_fx30")&&u.push({method:"PUT",path:`${o}/settings/shutter`,example:JSON.stringify({value:.0167},null,2)}),r.type==="blackmagic"&&(u.push({method:"PUT",path:`${o}/settings/iris`,example:JSON.stringify({mode:"auto"},null,2)}),u.push({method:"PUT",path:`${o}/settings/gain`,example:JSON.stringify({value:0},null,2)})),(r.type==="obsbot_tail2"||r.type==="sony_fx30")&&(u.push({method:"PUT",path:`${o}/settings/ptz`,example:JSON.stringify({pan:.5,tilt:-.3,zoom:.2},null,2)}),u.push({method:"PUT",path:`${o}/settings/ptz/preset/1`,example:JSON.stringify({},null,2)})),u}function h(r){const o=`${b.value}/api/v1/cameras/${r.name}`,u=[];return u.push({label:"Focus Auto",example:`PUT ${o}/settings/focus
Content-Type: application/json

{"mode":"auto"}`}),u.push({label:"WB Auto",example:`PUT ${o}/settings/whiteBalance
Content-Type: application/json

{"mode":"auto"}`}),(r.type==="obsbot_tail2"||r.type==="sony_fx30")&&u.push({label:"PTZ Center",example:`PUT ${o}/settings/ptz
Content-Type: application/json

{"pan":0,"tilt":0,"zoom":0}`}),u}async function n(r){try{await navigator.clipboard.writeText(r)}catch(o){console.error("Failed to copy:",o)}}return q(()=>{w()}),(r,o)=>(p(),v("div",Be,[e("div",Ie,[o[2]||(o[2]=e("h3",{class:"panel-title"},[e("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2","stroke-width":"2"}),e("path",{d:"M9 9h6v6H9z","stroke-width":"2"})]),D(" Bitfocus Companion Integration ")],-1)),e("button",{class:"info-btn",onClick:o[0]||(o[0]=u=>i.value=!i.value),"aria-label":i.value?"Hide help":"Show help"},[...o[1]||(o[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4M12 8h.01"})],-1)])],8,Me)]),i.value?(p(),v("div",Le,[e("p",Ze,[o[3]||(o[3]=D(" Control cameras via Bitfocus Companion using HTTP requests. Add an HTTP instance in Companion pointing to ",-1)),e("code",null,y(b.value),1),o[4]||(o[4]=D(" and use the endpoints below. ",-1))])])):T("",!0),e("div",Ee,[(p(!0),v(H,null,K(U(C),u=>(p(),v("div",{key:u.name,class:"camera-card"},[e("div",Ae,[e("div",Ge,[e("span",Oe,y(u.name),1),e("span",Ve,y(_(u.type)),1),e("span",{class:B(["status-indicator",u.connected?"connected":"disconnected"])},y(u.connected?"● Connected":"○ Disconnected"),3)])]),e("div",We,[o[6]||(o[6]=e("h4",{class:"section-title"},"Available Endpoints",-1)),e("div",Re,[(p(!0),v(H,null,K(c(u),g=>(p(),v("div",{class:"endpoint-item",key:g.method+g.path},[e("div",{class:B(["endpoint-method",g.method.toLowerCase()])},y(g.method),3),e("div",De,[e("code",null,y(g.path),1)]),e("button",{class:"copy-btn",onClick:S=>n(g.example),title:"Copy example to clipboard"},[...o[5]||(o[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Je)]))),128))])]),e("div",je,[o[7]||(o[7]=e("h4",{class:"section-title"},"Quick Actions",-1)),e("div",He,[(p(!0),v(H,null,K(h(u),g=>(p(),v("button",{key:g.label,class:"action-btn",onClick:S=>n(g.example)},y(g.label),9,Ke))),128))])])]))),128))]),U(C).length===0?(p(),v("div",qe,[...o[8]||(o[8]=[e("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e("circle",{cx:"12",cy:"10",r:"3"})],-1),e("p",null,"No external cameras configured",-1),e("p",{class:"empty-hint"},[D("Add cameras in "),e("code",null,"config.yml"),D(" to enable Companion integration")],-1)])])):T("",!0)]))}}),Xe=ne(Qe,[["__scopeId","data-v-34a9c8fa"]]),Ye={class:"flex items-center justify-between w-full"},et={class:"text-lg font-semibold text-preke-text"},tt={key:0,class:"text-sm text-preke-text-muted mt-1"},at={key:0,class:"py-8 text-center text-preke-text-muted"},nt={key:1,class:"py-8 text-center text-red-400"},ot={key:2,class:"py-8 text-center text-preke-text-muted"},st={key:3,class:"camera-controls"},lt={class:"tabs"},it={key:0,class:"tab-content"},rt={key:0,class:"control-group"},ct={class:"control-row"},ut={key:0,class:"control-slider"},dt={class:"slider-value"},mt=["disabled"],pt={key:1,class:"control-group"},vt={class:"control-row"},ft={key:0,class:"control-input"},ht=["disabled"],gt={key:2,class:"control-group"},bt={class:"control-row"},yt={key:0,class:"control-slider"},Ct={class:"slider-value"},wt=["disabled"],_t={key:1,class:"tab-content"},xt={key:0,class:"control-group"},kt={class:"control-input"},$t=["disabled"],Tt={key:1,class:"control-group"},Pt={class:"control-input"},Ut=["disabled"],zt={key:2,class:"control-group"},St={class:"control-row"},Nt={key:0,class:"control-input"},Ft=["disabled"],Bt={key:3,class:"control-group"},It={class:"control-input"},Mt=["disabled"],Lt={key:2,class:"tab-content"},Zt={class:"control-group"},Et={class:"ptz-controls"},At={class:"ptz-axis"},Gt={class:"slider-value"},Ot={class:"ptz-axis"},Vt={class:"slider-value"},Wt={class:"ptz-axis"},Rt={class:"slider-value"},Dt={key:3,class:"tab-content"},Jt={key:4,class:"tab-content"},jt=ae({__name:"CameraControlModal",props:{cameraName:{}},emits:["close"],setup(s,{expose:C,emit:w}){const i=s,b=w,_=k(null),{loading:c,error:h,supportsFeature:n,loadCameras:r,getCamera:o}=te(),u=k("basic"),g=V(()=>i.cameraName?o.value(i.cameraName):null),S=k("auto"),F=k(.5),N=k("auto"),I=k(5600),P=k("auto"),m=k(.5),f=k(400),d=k(1/60),t=k("auto"),l=k(2.8),A=k(0),M=k(0),O=k(0),W=k(0),$=k(!1);q(async()=>{await r(),i.cameraName&&g.value&&await Q()}),le(()=>i.cameraName,async z=>{z&&g.value&&await Q()});async function Q(){!i.cameraName||g.value}function oe(){var z;(z=_.value)==null||z.open()}function X(){var z;(z=_.value)==null||z.close(),b("close")}const{setFocus:G,setWhiteBalance:J,setExposure:Y,setISO:ee,setShutter:me,setIris:pe,setGain:ve,setPTZ:fe}=te();async function he(){if(i.cameraName){$.value=!0;try{await G(i.cameraName,S.value,S.value==="manual"?F.value:void 0)}catch(z){alert(`Failed to set focus: ${z.message}`)}finally{$.value=!1}}}async function ge(){if(i.cameraName){$.value=!0;try{await J(i.cameraName,N.value,N.value==="manual"?I.value:void 0)}catch(z){alert(`Failed to set white balance: ${z.message}`)}finally{$.value=!1}}}async function be(){if(i.cameraName){$.value=!0;try{await Y(i.cameraName,P.value,P.value==="manual"?m.value:void 0)}catch(z){alert(`Failed to set exposure: ${z.message}`)}finally{$.value=!1}}}async function ye(){if(i.cameraName){$.value=!0;try{await ee(i.cameraName,f.value)}catch(z){alert(`Failed to set ISO: ${z.message}`)}finally{$.value=!1}}}async function Ce(){if(i.cameraName){$.value=!0;try{await me(i.cameraName,d.value)}catch(z){alert(`Failed to set shutter: ${z.message}`)}finally{$.value=!1}}}async function we(){if(i.cameraName){$.value=!0;try{await pe(i.cameraName,t.value,t.value==="manual"?l.value:void 0)}catch(z){alert(`Failed to set iris: ${z.message}`)}finally{$.value=!1}}}async function _e(){if(i.cameraName){$.value=!0;try{await ve(i.cameraName,A.value)}catch(z){alert(`Failed to set gain: ${z.message}`)}finally{$.value=!1}}}async function xe(){if(i.cameraName)try{await fe(i.cameraName,M.value,O.value,W.value)}catch(z){alert(`Failed to move PTZ: ${z.message}`)}}return C({open:oe,close:X}),(z,a)=>(p(),Te(Pe,{ref_key:"modalRef",ref:_,title:"Camera Controls",size:"xl",onClose:a[23]||(a[23]=x=>b("close"))},{header:ce(()=>[e("div",Ye,[e("div",null,[e("h2",et,y(s.cameraName||"Camera Controls"),1),g.value?(p(),v("p",tt,[D(y(g.value.type==="blackmagic"?"Blackmagic Design":g.value.type==="sony_fx30"?"Sony FX30":"OBSbot Tail 2")+" ",1),e("span",{class:B([g.value.connected?"text-green-500":"text-red-500","ml-2"])},y(g.value.connected?"● Connected":"○ Disconnected"),3)])):T("",!0)])])]),default:ce(()=>[U(c)?(p(),v("div",at," Loading camera settings... ")):U(h)?(p(),v("div",nt,y(U(h)),1)):g.value?(p(),v("div",st,[e("div",lt,[U(n)(s.cameraName,"focus")||U(n)(s.cameraName,"whiteBalance")||U(n)(s.cameraName,"exposure")?(p(),v("button",{key:0,class:B(["tab",{"tab--active":u.value==="basic"}]),onClick:a[0]||(a[0]=x=>u.value="basic")}," Basic ",2)):T("",!0),U(n)(s.cameraName,"iso")||U(n)(s.cameraName,"shutter")||U(n)(s.cameraName,"iris")||U(n)(s.cameraName,"gain")?(p(),v("button",{key:1,class:B(["tab",{"tab--active":u.value==="advanced"}]),onClick:a[1]||(a[1]=x=>u.value="advanced")}," Advanced ",2)):T("",!0),U(n)(s.cameraName,"ptz")?(p(),v("button",{key:2,class:B(["tab",{"tab--active":u.value==="ptz"}]),onClick:a[2]||(a[2]=x=>u.value="ptz")}," PTZ ",2)):T("",!0),U(n)(s.cameraName,"colorCorrection")?(p(),v("button",{key:3,class:B(["tab",{"tab--active":u.value==="color"}]),onClick:a[3]||(a[3]=x=>u.value="color")}," Color ",2)):T("",!0),e("button",{class:B(["tab",{"tab--active":u.value==="companion"}]),onClick:a[4]||(a[4]=x=>u.value="companion")}," Companion ",2)]),u.value==="basic"?(p(),v("div",it,[U(n)(s.cameraName,"focus")?(p(),v("div",rt,[a[24]||(a[24]=e("label",{class:"control-label"},"Focus",-1)),e("div",ct,[e("button",{class:B(["mode-btn",{"mode-btn--active":S.value==="auto"}]),onClick:a[5]||(a[5]=x=>S.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":S.value==="manual"}]),onClick:a[6]||(a[6]=x=>S.value="manual")}," Manual ",2)]),S.value==="manual"?(p(),v("div",ut,[Z(e("input",{"onUpdate:modelValue":a[7]||(a[7]=x=>F.value=x),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[E,F.value,void 0,{number:!0}]]),e("span",dt,y(Math.round(F.value*100))+"%",1)])):T("",!0),e("button",{onClick:he,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Focus"),9,mt)])):T("",!0),U(n)(s.cameraName,"whiteBalance")?(p(),v("div",pt,[a[26]||(a[26]=e("label",{class:"control-label"},"White Balance",-1)),e("div",vt,[e("button",{class:B(["mode-btn",{"mode-btn--active":N.value==="auto"}]),onClick:a[8]||(a[8]=x=>N.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":N.value==="manual"}]),onClick:a[9]||(a[9]=x=>N.value="manual")}," Manual ",2)]),N.value==="manual"?(p(),v("div",ft,[Z(e("input",{"onUpdate:modelValue":a[10]||(a[10]=x=>I.value=x),type:"number",min:"2000",max:"10000",step:"100",class:"input"},null,512),[[E,I.value,void 0,{number:!0}]]),a[25]||(a[25]=e("span",{class:"input-unit"},"K",-1))])):T("",!0),e("button",{onClick:ge,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save White Balance"),9,ht)])):T("",!0),U(n)(s.cameraName,"exposure")?(p(),v("div",gt,[a[27]||(a[27]=e("label",{class:"control-label"},"Exposure",-1)),e("div",bt,[e("button",{class:B(["mode-btn",{"mode-btn--active":P.value==="auto"}]),onClick:a[11]||(a[11]=x=>P.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":P.value==="manual"}]),onClick:a[12]||(a[12]=x=>P.value="manual")}," Manual ",2)]),P.value==="manual"?(p(),v("div",yt,[Z(e("input",{"onUpdate:modelValue":a[13]||(a[13]=x=>m.value=x),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[E,m.value,void 0,{number:!0}]]),e("span",Ct,y(Math.round(m.value*100))+"%",1)])):T("",!0),e("button",{onClick:be,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Exposure"),9,wt)])):T("",!0)])):T("",!0),u.value==="advanced"?(p(),v("div",_t,[U(n)(s.cameraName,"iso")?(p(),v("div",xt,[a[28]||(a[28]=e("label",{class:"control-label"},"ISO",-1)),e("div",kt,[Z(e("input",{"onUpdate:modelValue":a[14]||(a[14]=x=>f.value=x),type:"number",min:"100",max:"25600",step:"100",class:"input"},null,512),[[E,f.value,void 0,{number:!0}]])]),e("button",{onClick:ye,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save ISO"),9,$t)])):T("",!0),U(n)(s.cameraName,"shutter")?(p(),v("div",Tt,[a[30]||(a[30]=e("label",{class:"control-label"},"Shutter Speed",-1)),e("div",Pt,[Z(e("input",{"onUpdate:modelValue":a[15]||(a[15]=x=>d.value=x),type:"number",min:"0.0001",max:"1",step:"0.0001",class:"input"},null,512),[[E,d.value,void 0,{number:!0}]]),a[29]||(a[29]=e("span",{class:"input-unit"},"s",-1))]),e("button",{onClick:Ce,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Shutter"),9,Ut)])):T("",!0),U(n)(s.cameraName,"iris")?(p(),v("div",zt,[a[32]||(a[32]=e("label",{class:"control-label"},"Iris",-1)),e("div",St,[e("button",{class:B(["mode-btn",{"mode-btn--active":t.value==="auto"}]),onClick:a[16]||(a[16]=x=>t.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":t.value==="manual"}]),onClick:a[17]||(a[17]=x=>t.value="manual")}," Manual ",2)]),t.value==="manual"?(p(),v("div",Nt,[Z(e("input",{"onUpdate:modelValue":a[18]||(a[18]=x=>l.value=x),type:"number",min:"1.4",max:"22",step:"0.1",class:"input"},null,512),[[E,l.value,void 0,{number:!0}]]),a[31]||(a[31]=e("span",{class:"input-unit"},"f/",-1))])):T("",!0),e("button",{onClick:we,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Iris"),9,Ft)])):T("",!0),U(n)(s.cameraName,"gain")?(p(),v("div",Bt,[a[34]||(a[34]=e("label",{class:"control-label"},"Gain",-1)),e("div",It,[Z(e("input",{"onUpdate:modelValue":a[19]||(a[19]=x=>A.value=x),type:"number",min:"-12",max:"36",step:"0.1",class:"input"},null,512),[[E,A.value,void 0,{number:!0}]]),a[33]||(a[33]=e("span",{class:"input-unit"},"dB",-1))]),e("button",{onClick:_e,disabled:$.value,class:"save-btn"},y($.value?"Saving...":"Save Gain"),9,Mt)])):T("",!0)])):T("",!0),u.value==="ptz"?(p(),v("div",Lt,[e("div",Zt,[a[38]||(a[38]=e("label",{class:"control-label"},"Pan/Tilt/Zoom",-1)),e("div",Et,[e("div",At,[a[35]||(a[35]=e("label",null,"Pan",-1)),Z(e("input",{"onUpdate:modelValue":a[20]||(a[20]=x=>M.value=x),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[E,M.value,void 0,{number:!0}]]),e("span",Gt,y(M.value.toFixed(1)),1)]),e("div",Ot,[a[36]||(a[36]=e("label",null,"Tilt",-1)),Z(e("input",{"onUpdate:modelValue":a[21]||(a[21]=x=>O.value=x),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[E,O.value,void 0,{number:!0}]]),e("span",Vt,y(O.value.toFixed(1)),1)]),e("div",Wt,[a[37]||(a[37]=e("label",null,"Zoom",-1)),Z(e("input",{"onUpdate:modelValue":a[22]||(a[22]=x=>W.value=x),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[E,W.value,void 0,{number:!0}]]),e("span",Rt,y(W.value.toFixed(1)),1)])]),e("button",{onClick:xe,class:"save-btn"}," Move PTZ ")])])):T("",!0),u.value==="color"?(p(),v("div",Dt,[...a[39]||(a[39]=[e("div",{class:"control-group"},[e("p",{class:"text-preke-text-muted text-sm"}," Color correction controls coming soon ")],-1)])])):T("",!0),u.value==="companion"?(p(),v("div",Jt,[de(Xe)])):T("",!0)])):(p(),v("div",ot," Camera not found "))]),_:1},512))}}),Za=ne(jt,[["__scopeId","data-v-d317ac4a"]]);function Ht(s=null){const C=k(!1),w=k(!1),i=k(s),b=k(null),_=k(null);let c=null,h=null,n=0;const r=33;let o=null;async function u(){if((c==null?void 0:c.readyState)!==WebSocket.OPEN)try{const t=await L.buildApiUrl("/api/v1/ptz-controller/ws");c=new WebSocket(t.replace("http","ws").replace("https","wss")),c.onopen=()=>{C.value=!0,i.value&&S(i.value)},c.onerror=l=>{console.error("[PTZController] WebSocket error:",l),C.value=!1},c.onclose=()=>{C.value=!1}}catch(t){console.error("[PTZController] Failed to connect:",t)}}function g(){c&&(c.close(),c=null),C.value=!1,I()}function S(t){i.value=t,(c==null?void 0:c.readyState)===WebSocket.OPEN&&c.send(JSON.stringify({type:"set_camera",camera_name:t}))}function F(t){if(!C.value||!i.value||!c)return;const l=Date.now();l-n<r||(n=l,c.send(JSON.stringify({type:"ptz_command",pan:t.pan,tilt:t.tilt,zoom:t.zoom,focus:t.focus,speed:t.speed||1})))}function N(t=0){if(h)return;b.value=t,w.value=!0;function l(){var Y,ee;if(!w.value)return;const M=navigator.getGamepads()[b.value];if(!M){console.log("[PTZController] Gamepad disconnected during polling"),I(),m();return}(!_.value||_.value.index!==M.index)&&(_.value={id:M.id,index:M.index,mapping:M.mapping||"standard"});const O=Array.from(M.axes),W=Array.from(M.buttons),$=P(O[0]||0,.1),Q=P(-(O[1]||0),.1),oe=P(O[2]||0,.1),X=O[3]?P(O[3],.1):void 0;let G=.5;(Y=W[6])!=null&&Y.value&&(G+=W[6].value*.5),(ee=W[7])!=null&&ee.value&&(G+=W[7].value*.5),G=Math.min(1,G);const J={pan:$*G,tilt:Q*G,zoom:oe*G,focus:X?X*G:void 0,speed:G};(Math.abs(J.pan)>.01||Math.abs(J.tilt)>.01||Math.abs(J.zoom)>.01)&&F(J),h=requestAnimationFrame(l)}l()}function I(){w.value=!1,b.value=null,h&&(cancelAnimationFrame(h),h=null)}function P(t,l){if(Math.abs(t)<l)return 0;const A=t>=0?1:-1,M=(Math.abs(t)-l)/(1-l);return A*M}function m(){o&&clearTimeout(o),o=window.setTimeout(()=>{const t=navigator.getGamepads();for(let l=0;l<t.length;l++)if(t[l]&&b.value===null){console.log("[PTZController] Gamepad reconnected:",t[l].id),N(l);break}o=null},1e3)}function f(t){const l=t.gamepad,A=l.id.toLowerCase().includes("bluetooth")||l.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${A} gamepad connected:`,l.id,{index:l.index,mapping:l.mapping||"standard",axes:l.axes.length,buttons:l.buttons.length}),b.value===null&&N(l.index)}function d(t){const l=t.gamepad,A=l.id.toLowerCase().includes("bluetooth")||l.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${A} gamepad disconnected:`,l.id),b.value===t.gamepad.index&&(I(),_.value=null,m())}return q(()=>{u(),window.addEventListener("gamepadconnected",f),window.addEventListener("gamepaddisconnected",d);const t=navigator.getGamepads();for(let l=0;l<t.length;l++)if(t[l]){N(l);break}}),ie(()=>{g(),I(),o&&clearTimeout(o),window.removeEventListener("gamepadconnected",f),window.removeEventListener("gamepaddisconnected",d)}),{connected:C,active:w,currentCamera:i,gamepadIndex:b,gamepadInfo:_,connect:u,disconnect:g,setCamera:S,sendPTZCommand:F,startGamepad:N,stopGamepad:I}}const Kt={class:"ptz-controller-panel"},qt={class:"ptz-controller-panel__header"},Qt={class:"ptz-controller-panel__content"},Xt={class:"ptz-controller-panel__section"},Yt=["value"],ea={class:"ptz-controller-panel__section"},ta={class:"ptz-controller-panel__status"},aa={class:"ptz-controller-panel__status-text"},na={class:"ptz-controller-panel__buttons"},oa=["disabled"],sa=["disabled"],la={key:0,class:"ptz-controller-panel__section"},ia={class:"ptz-controller-panel__status"},ra={class:"ptz-controller-panel__status-text"},ca={class:"ptz-controller-panel__section"},ua={class:"ptz-controller-panel__manual-controls"},da={class:"ptz-controller-panel__axis"},ma={class:"ptz-controller-panel__value"},pa={class:"ptz-controller-panel__axis"},va={class:"ptz-controller-panel__value"},fa={class:"ptz-controller-panel__axis"},ha={class:"ptz-controller-panel__value"},ga=["disabled"],ba={class:"ptz-controller-panel__section"},ya={class:"ptz-controller-panel__buttons"},Ca=["disabled"],wa=["disabled"],_a=ae({__name:"PTZControllerPanel",props:{cameraName:{}},emits:["close"],setup(s,{emit:C}){const w=s,i=C,{cameras:b,loadCameras:_}=te(),c=Ht(w.cameraName||null),h=k(w.cameraName||null),n=V(()=>c.gamepadInfo.value!==null),r=V(()=>{var d;return((d=c.gamepadInfo.value)==null?void 0:d.id)||""}),o=V(()=>b.value.filter(d=>d.type==="obsbot_tail2"||d.name.toLowerCase().includes("obsbot")));async function u(){if(!h.value){R.error("Please select a camera first");return}await c.connect(),c.connected.value?(c.setCamera(h.value),R.success("PTZ Controller connected")):R.error("Failed to connect PTZ controller")}function g(){c.disconnect(),R.info("PTZ Controller disconnected")}function S(){const d=navigator.getGamepads();let t=null;for(let l=0;l<d.length;l++)if(d[l]){t=l;break}if(t===null){R.error("No gamepad detected. Please connect a gamepad/joystick first.");return}c.startGamepad(t),setTimeout(()=>{c.gamepadInfo.value&&R.success(`Gamepad connected: ${c.gamepadInfo.value.id}`)},100)}function F(){c.stopGamepad(),R.info("Gamepad disconnected")}const N=k(0),I=k(0),P=k(0);function m(){if(!h.value){R.error("Please select a camera first");return}if(!c.connected.value){R.error("PTZ Controller not connected");return}c.sendPTZCommand({pan:N.value,tilt:I.value,zoom:P.value})}function f(){h.value&&c.connected.value&&c.setCamera(h.value)}return q(async()=>{await _(),!h.value&&o.value.length>0&&(h.value=o.value[0].name)}),ie(()=>{g(),F()}),le(()=>w.cameraName,d=>{d&&(h.value=d,c.connected.value&&c.setCamera(d))}),(d,t)=>(p(),v("div",Kt,[e("div",qt,[t[6]||(t[6]=e("h3",{class:"ptz-controller-panel__title"},"PTZ Controller",-1)),e("button",{onClick:t[0]||(t[0]=l=>i("close")),class:"ptz-controller-panel__close",title:"Close"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Qt,[e("div",Xt,[t[8]||(t[8]=e("label",{class:"ptz-controller-panel__label"},"Camera",-1)),Z(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>h.value=l),class:"ptz-controller-panel__select",onChange:f},[t[7]||(t[7]=e("option",{value:null},"Select camera...",-1)),(p(!0),v(H,null,K(o.value,l=>(p(),v("option",{key:l.name,value:l.name},y(l.name)+" ("+y(l.connected?"Connected":"Disconnected")+") ",9,Yt))),128))],544),[[Ue,h.value]])]),e("div",ea,[e("div",ta,[e("span",{class:B(["ptz-controller-panel__status-dot",{"ptz-controller-panel__status-dot--connected":U(c).connected.value,"ptz-controller-panel__status-dot--disconnected":!U(c).connected.value}])},null,2),e("span",aa,y(U(c).connected.value?"Connected":"Disconnected"),1)]),e("div",na,[e("button",{onClick:u,disabled:!h.value||U(c).connected.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Connect ",8,oa),e("button",{onClick:g,disabled:!U(c).connected.value,class:"ptz-controller-panel__btn"}," Disconnect ",8,sa)])]),n.value?(p(),v("div",la,[e("div",ia,[t[9]||(t[9]=e("span",{class:"ptz-controller-panel__status-dot ptz-controller-panel__status-dot--connected"},null,-1)),e("span",ra," Gamepad: "+y(r.value),1)])])):T("",!0),e("div",ca,[t[13]||(t[13]=e("label",{class:"ptz-controller-panel__label"},"Manual Control (Testing)",-1)),e("div",ua,[e("div",da,[t[10]||(t[10]=e("label",null,"Pan",-1)),Z(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>N.value=l),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[E,N.value,void 0,{number:!0}]]),e("span",ma,y(N.value.toFixed(1)),1)]),e("div",pa,[t[11]||(t[11]=e("label",null,"Tilt",-1)),Z(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>I.value=l),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[E,I.value,void 0,{number:!0}]]),e("span",va,y(I.value.toFixed(1)),1)]),e("div",fa,[t[12]||(t[12]=e("label",null,"Zoom",-1)),Z(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>P.value=l),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[E,P.value,void 0,{number:!0}]]),e("span",ha,y(P.value.toFixed(1)),1)]),e("button",{onClick:m,disabled:!U(c).connected.value||!h.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Send Command ",8,ga)])]),e("div",ba,[e("div",ya,[e("button",{onClick:S,disabled:n.value,class:"ptz-controller-panel__btn"}," Start Gamepad ",8,Ca),e("button",{onClick:F,disabled:!n.value,class:"ptz-controller-panel__btn"}," Stop Gamepad ",8,wa)]),t[14]||(t[14]=e("p",{class:"ptz-controller-panel__hint"}," Connect a gamepad/joystick and use left stick for pan/tilt, triggers for zoom ",-1))])])]))}}),Ea=ne(_a,[["__scopeId","data-v-ebf7148f"]]),xa={class:"loading-screen"},ka={class:"loading-content"},$a={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},Ta={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},Pa={class:"loading-text"},Ua={class:"loading-tagline"},za={class:"loading-dots"},Sa={key:0,class:"loading-status"},Na={key:1,class:"loading-progress"},Fa={key:2,class:"loading-method"},Ba=ae({__name:"ModeLoadingScreen",props:{mode:{},minTime:{default:1500},maxTime:{default:8e3},contentReady:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1},statusText:{default:void 0},progress:{default:void 0},connectionMethod:{default:void 0}},emits:["ready","cancel"],setup(s,{emit:C}){const w=s,i=C;function b(){i("cancel")}const _=k(!1);let c=null,h=null;function n(){_.value&&w.contentReady&&i("ready")}le(()=>w.contentReady,S=>{S&&n()});const r=V(()=>w.mode==="recorder"?"#d45a5a":"#7c3aed"),o=V(()=>w.mode==="recorder"?"Recorder":"Mixer"),u=V(()=>w.mode==="recorder"?"Multi-cam ISO Recording":"Live Switching & Streaming"),g=V(()=>w.mode==="recorder"?"red":"purple");return q(()=>{c=setTimeout(()=>{_.value=!0,n()},w.minTime),h=setTimeout(()=>{i("ready")},w.maxTime)}),ie(()=>{c&&clearTimeout(c),h&&clearTimeout(h)}),(S,F)=>(p(),v("div",xa,[de(Se,{accent:g.value,"show-beams":!0,"show-pattern":!0},null,8,["accent"]),e("div",ka,[e("div",{class:"loading-icon",style:j({color:r.value})},[s.mode==="recorder"?(p(),v("svg",$a,[...F[0]||(F[0]=[e("rect",{x:"2",y:"5",width:"14",height:"12",rx:"2"},null,-1),e("path",{d:"M16 9l4-2v8l-4-2"},null,-1),e("circle",{cx:"6",cy:"8",r:"2",fill:"currentColor",stroke:"none"},null,-1)])])):(p(),v("svg",Ta,[...F[1]||(F[1]=[ze('<rect x="2" y="2" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="13" y="2" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="2" y="10" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="13" y="10" width="9" height="6" rx="1" data-v-409a3379></rect><circle cx="12" cy="20" r="2" fill="currentColor" data-v-409a3379></circle><path d="M9 19.5a4 4 0 0 1 6 0" stroke-linecap="round" data-v-409a3379></path>',6)])])),e("div",{class:"loading-icon__glow",style:j({background:r.value})},null,4)],4),e("div",Pa,[e("h2",{class:"loading-title",style:j({color:r.value})},y(o.value),5),e("p",Ua,y(u.value),1)]),e("div",za,[(p(),v(H,null,K(3,N=>e("div",{key:N,class:"loading-dot",style:j({backgroundColor:r.value,animationDelay:`${(N-1)*.15}s`})},null,4)),64))]),s.statusText?(p(),v("div",Sa,y(s.statusText),1)):T("",!0),s.progress!==void 0?(p(),v("div",Na,[e("div",{class:"loading-progress__bar",style:j({width:`${s.progress}%`,backgroundColor:r.value})},null,4)])):T("",!0),s.connectionMethod?(p(),v("div",Fa," Connected via "+y(s.connectionMethod),1)):T("",!0),s.showCancel?(p(),v("button",{key:3,onClick:b,class:"loading-cancel"},[...F[2]||(F[2]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),D(" Go back ",-1)])])):T("",!0)])]))}}),Aa=ne(Ba,[["__scopeId","data-v-409a3379"]]);export{Za as C,Aa as M,Ea as P,La as p,te as u};
