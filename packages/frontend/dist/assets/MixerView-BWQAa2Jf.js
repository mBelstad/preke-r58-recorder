import{Z as Ue,r as f,l as K,b as se,d as ae,J as le,c as p,f as M,e,q as Y,R as ke,B as ne,y as ee,F as Q,z as te,t as C,n as W,s as q,K as Le,j as V,k as i,$ as ye,G as we,g as Z,T as ue,w as ce,Y as Ve,_ as me,o as pe,p as je,E as Ie,u as Ee,X as Be,v as He,i as Fe}from"./index-DC_9t8hQ.js";import{b as he,o as Ke,a as Ae,V as re,g as _e,c as We,d as qe,e as ze,f as Ne}from"./vdoninja-Cxrlf7fm.js";import{u as Ge,P as Xe,C as Ye,M as Qe}from"./ModeLoadingScreen-549TjedK.js";const N=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],ge=Ue("streaming",()=>{const c=f([]),y=f(!1),r=f(null),d=f({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),u=K(()=>c.value.find(n=>n.id===r.value)),_=K(()=>c.value.filter(n=>n.enabled)),b=K(()=>N),k=K(()=>{const n=window.location.hostname,t=n==="localhost"||n==="127.0.0.1",l=t?"localhost":"app.itagenten.no";return{rtmp:t?"rtmp://localhost:1935/mixer_program":"rtmp://app.itagenten.no:1935/mixer_program",rtsp:t?"rtsp://localhost:8554/mixer_program":"rtsp://app.itagenten.no:8554/mixer_program",srt:t?"srt://localhost:8890?streamid=read:mixer_program":"srt://app.itagenten.no:8890?streamid=read:mixer_program",hls:`https://${l}/hls/mixer_program/index.m3u8`,whep:`https://${l}/mixer_program/whep`}});function h(n,t){const l=N.find(s=>s.id===n);if(!l)throw new Error(`Unknown platform: ${n}`);const o={id:`dest-${Date.now()}`,platformId:n,name:t||l.name,streamKey:"",enabled:!1};return c.value.push(o),o}function D(n,t){const l=c.value.findIndex(o=>o.id===n);l!==-1&&(c.value[l]={...c.value[l],...t})}function m(n){const t=c.value.findIndex(l=>l.id===n);t!==-1&&c.value.splice(t,1),r.value===n&&(r.value=null)}function I(n){r.value=n}function U(n){d.value.enabled=n}function E(n){d.value={...d.value,...n}}function H(){y.value=!0}function $(){y.value=!1}function j(n){const t=N.find(l=>l.id===n.platformId);return t?n.platformId==="custom"?`${n.name}${n.streamKey}`:`${t.rtmpBaseUrl}${n.streamKey}`:""}function O(){const n=window.location.hostname;return`srt://${n==="localhost"||n==="127.0.0.1"?"localhost":"app.itagenten.no"}:${d.value.port}?streamid=read:${d.value.streamId}`}function R(){try{const n=localStorage.getItem("r58-streaming-destinations");if(n){const t=JSON.parse(n);c.value=t.destinations||[],t.srtOutput&&(d.value={...d.value,...t.srtOutput})}}catch(n){console.warn("Failed to load saved streaming destinations:",n)}}function S(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:c.value,srtOutput:d.value}))}catch(n){console.warn("Failed to save streaming destinations:",n)}}async function L(){try{const n=_.value;if(n.length===0)return console.warn("[Streaming] No enabled destinations to stream to"),{success:!1,message:"No destinations configured"};const t=n.map(s=>{var w;return{platform:s.platformId,rtmp_url:((w=N.find(J=>J.id===s.platformId))==null?void 0:w.rtmpBaseUrl)||"",stream_key:s.streamKey,enabled:!0}}),l=await fetch(await se("/api/streaming/rtmp/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinations:t})}),o=await l.json();if(!l.ok)throw new Error(o.detail||"Failed to start RTMP relay");return console.log("[Streaming] RTMP relay configured via MediaMTX runOnReady:",o),{success:!0,message:o.message||`Streaming to ${n.length} destination(s)`}}catch(n){const t=n instanceof Error?n.message:"Failed to start RTMP relay";return console.error("[Streaming] Failed to start RTMP relay:",n),{success:!1,message:t}}}async function A(){try{const n=await fetch(await se("/api/streaming/rtmp/stop"),{method:"POST"}),t=await n.json();if(!n.ok)throw new Error(t.detail||"Failed to stop RTMP relay");return console.log("[Streaming] RTMP relay stopped"),{success:!0,message:"RTMP relay stopped"}}catch(n){const t=n instanceof Error?n.message:"Failed to stop RTMP relay";return console.error("[Streaming] Failed to stop RTMP relay:",n),{success:!1,message:t}}}async function B(){try{const n=await fetch(await se("/api/streaming/status"));if(!n.ok)throw new Error("Failed to get streaming status");return await n.json()}catch(n){return console.error("[Streaming] Failed to get streaming status:",n),null}}return R(),{destinations:c,isStreaming:y,activeDestinationId:r,srtOutput:d,activeDestination:u,enabledDestinations:_,platforms:b,programOutputUrls:k,addDestination:h,updateDestination:D,removeDestination:m,setActiveDestination:I,toggleSrtOutput:U,updateSrtConfig:E,startStreaming:H,stopStreaming:$,buildRtmpUrl:j,getSrtOutputUrl:O,saveDestinations:S,loadSavedDestinations:R,startRtmpRelay:L,stopRtmpRelay:A,getStreamingStatus:B}}),Ze={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Je={class:"relative bg-preke-bg-elevated border border-preke-bg-surface rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},et={class:"p-6 overflow-y-auto max-h-[60vh]"},tt={key:0,class:"mb-8 p-6 bg-gradient-to-br from-amber-600/20 to-red-600/20 rounded-xl border border-amber-500/30"},ot={class:"flex gap-3 mb-4"},nt=["placeholder"],st={class:"text-xs text-preke-text-dim"},at=["href"],rt={class:"mb-8"},lt={class:"flex items-center justify-between mb-4"},it={key:0,class:"mb-4 p-4 bg-preke-bg-surface rounded-lg"},ut={class:"grid grid-cols-2 gap-2"},ct=["onClick"],dt={class:"text-xl"},mt={key:1,class:"space-y-3"},pt=["onClick"],gt={class:"text-xl"},vt={class:"flex-1"},ft={class:"font-medium"},bt={class:"text-xs text-preke-text-dim"},xt=["onClick"],kt=["onClick"],yt={key:2,class:"text-preke-text-dim text-sm"},wt={key:1,class:"mb-8 p-4 bg-preke-bg-surface rounded-lg"},ht={class:"text-lg font-medium mb-4"},_t={class:"space-y-4"},St=["placeholder"],Ct={key:0},Mt={class:"flex gap-2"},$t={class:"mb-8"},Rt={class:"space-y-3"},Pt={class:"p-3 bg-preke-bg-surface rounded-lg"},Dt={class:"flex items-center justify-between mb-1"},Ot={class:"text-xs text-preke-text-dim break-all"},Tt={class:"p-3 bg-preke-bg-surface rounded-lg"},Ut={class:"flex items-center justify-between mb-1"},Lt={class:"text-xs text-preke-text-dim break-all"},Vt={class:"p-3 bg-preke-bg-surface rounded-lg"},jt={class:"flex items-center justify-between mb-1"},It={class:"text-xs text-preke-text-dim break-all"},Et={class:"p-3 bg-preke-bg-surface rounded-lg"},Bt={class:"flex items-center justify-between mb-1"},Ht={class:"text-xs text-preke-text-dim break-all"},Ft={class:"p-3 bg-preke-bg-surface rounded-lg"},Kt={class:"flex items-center justify-between mb-1"},At={class:"text-xs text-preke-text-dim break-all"},Wt={class:"p-4 bg-preke-bg-surface rounded-lg"},qt={class:"flex items-center gap-3 mb-4"},zt=ae({__name:"StreamingSettings",setup(c,{expose:y}){const r=ge(),d=f(!1),u=f(null),_=f(!1),b=f("youtube"),k=f("");f(""),f("");const h=K(()=>r.destinations),D=K(()=>N),m=K(()=>r.programOutputUrls);function I(){d.value=!0}function U(){d.value=!1,u.value=null,_.value=!1}function E(n){const t=r.addDestination(n);u.value=t,_.value=!1,r.saveDestinations()}function H(){u.value&&(r.updateDestination(u.value.id,u.value),r.saveDestinations(),u.value=null,V.success("Streaming destination saved"))}function $(n){r.removeDestination(n),r.saveDestinations(),V.info("Destination removed")}function j(n){r.updateDestination(n.id,{enabled:!n.enabled}),r.saveDestinations()}function O(n,t){navigator.clipboard.writeText(n),V.success(`${t} copied to clipboard`)}function R(n){const t=N.find(l=>l.id===n);return(t==null?void 0:t.icon)||"ðŸ“¡"}function S(n){const t=N.find(l=>l.id===n);return(t==null?void 0:t.name)||"Unknown"}function L(){const n=N.find(t=>t.id===b.value);return(n==null?void 0:n.streamKeyPlaceholder)||"Enter stream key"}function A(){switch(b.value){case"youtube":return"https://support.google.com/youtube/answer/2907883";case"twitch":return"https://help.twitch.tv/s/article/twitch-stream-key-faq";case"facebook":return"https://www.facebook.com/help/587160588142067";case"restream":return"https://support.restream.io/en/";default:return"#"}}function B(){if(!k.value.trim()){V.error("Please enter your stream key");return}const n=r.addDestination(b.value);r.updateDestination(n.id,{streamKey:k.value,enabled:!0}),r.saveDestinations(),k.value="",V.success(`${S(b.value)} configured and enabled!`)}return y({open:I}),(n,t)=>{var l;return i(),le(Le,{to:"body"},[d.value?(i(),p("div",Ze,[e("div",{class:"absolute inset-0 bg-black/60",onClick:U}),e("div",Je,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-preke-bg-surface"},[t[13]||(t[13]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:U,class:"text-preke-text-dim hover:text-preke-text text-2xl"}," Ã— ")]),e("div",et,[h.value.length===0?(i(),p("section",tt,[t[16]||(t[16]=e("h3",{class:"text-xl font-semibold mb-2 flex items-center gap-2"}," ðŸ”´ Quick Setup: Stream to YouTube ",-1)),t[17]||(t[17]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Get streaming in seconds! Just paste your stream key below. ",-1)),e("div",ot,[Y(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>b.value=o),class:"px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg text-base"},[...t[14]||(t[14]=[e("option",{value:"youtube"},"â–¶ï¸ YouTube Live",-1),e("option",{value:"twitch"},"ðŸ“º Twitch",-1),e("option",{value:"facebook"},"ðŸ“˜ Facebook",-1),e("option",{value:"restream"},"ðŸ”„ Restream",-1)])],512),[[ke,b.value]]),Y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>k.value=o),type:"password",placeholder:L(),class:"flex-1 px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg font-mono text-base focus:border-amber-500 focus:outline-none"},null,8,nt),[[ne,k.value]]),e("button",{onClick:B,class:"px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg font-semibold transition-colors"}," Save & Enable ")]),e("p",st,[t[15]||(t[15]=ee(" ðŸ”’ Your stream key is stored locally on this device and never sent to any server. ",-1)),e("a",{href:A(),target:"_blank",class:"text-amber-400 hover:underline ml-2"}," Where do I find my stream key? â†’ ",8,at)])])):M("",!0),e("section",rt,[e("div",lt,[t[18]||(t[18]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[2]||(t[2]=o=>_.value=!_.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),_.value?(i(),p("div",it,[t[19]||(t[19]=e("p",{class:"text-sm text-preke-text-dim mb-3"},"Select a streaming platform:",-1)),e("div",ut,[(i(!0),p(Q,null,te(D.value,o=>(i(),p("button",{key:o.id,onClick:s=>E(o.id),class:"flex items-center gap-2 p-3 bg-preke-bg-elevated hover:bg-preke-gold/20 rounded-lg transition-colors text-left"},[e("span",dt,C(o.icon),1),e("span",null,C(o.name),1)],8,ct))),128))])])):M("",!0),h.value.length>0?(i(),p("div",mt,[(i(!0),p(Q,null,te(h.value,o=>(i(),p("div",{key:o.id,class:"flex items-center gap-3 p-3 bg-preke-bg-surface rounded-lg"},[e("button",{onClick:s=>j(o),class:W(["w-10 h-6 rounded-full transition-colors relative",o.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:W(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",o.enabled?"left-5":"left-1"])},null,2)],10,pt),e("span",gt,C(R(o.platformId)),1),e("div",vt,[e("div",ft,C(o.name),1),e("div",bt,C(o.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+o.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:s=>u.value={...o},class:"text-preke-gold hover:underline text-sm"}," Edit ",8,xt),e("button",{onClick:s=>$(o.id),class:"text-preke-red hover:underline text-sm"}," Remove ",8,kt)]))),128))])):(i(),p("p",yt," No streaming destinations configured. Add a platform above. "))]),u.value?(i(),p("section",wt,[e("h3",ht," Edit "+C(S(u.value.platformId)),1),e("div",_t,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Display Name",-1)),Y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>u.value.name=o),type:"text",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none"},null,512),[[ne,u.value.name]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Stream Key",-1)),Y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>u.value.streamKey=o),type:"password",placeholder:(l=q(N).find(o=>o.id===u.value.platformId))==null?void 0:l.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,8,St),[[ne,u.value.streamKey]]),t[22]||(t[22]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),u.value.platformId==="custom"?(i(),p("div",Ct,[t[23]||(t[23]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"RTMP URL",-1)),Y(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>u.value.name=o),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,512),[[ne,u.value.name]])])):M("",!0),e("div",Mt,[e("button",{onClick:H,class:"btn btn-primary"}," Save "),e("button",{onClick:t[6]||(t[6]=o=>u.value=null),class:"btn"}," Cancel ")])])])):M("",!0),e("section",$t,[t[32]||(t[32]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[33]||(t[33]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",Rt,[e("div",Pt,[e("div",Dt,[t[24]||(t[24]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[7]||(t[7]=o=>O(m.value.srt,"SRT URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Ot,C(m.value.srt),1),t[25]||(t[25]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",Tt,[e("div",Ut,[t[26]||(t[26]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[8]||(t[8]=o=>O(m.value.rtmp,"RTMP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Lt,C(m.value.rtmp),1)]),e("div",Vt,[e("div",jt,[t[27]||(t[27]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[9]||(t[9]=o=>O(m.value.rtsp,"RTSP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",It,C(m.value.rtsp),1)]),e("div",Et,[e("div",Bt,[t[28]||(t[28]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[10]||(t[10]=o=>O(m.value.hls,"HLS URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Ht,C(m.value.hls),1),t[29]||(t[29]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",Ft,[e("div",Kt,[t[30]||(t[30]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[11]||(t[11]=o=>O(m.value.whep,"WHEP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",At,C(m.value.whep),1),t[31]||(t[31]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[36]||(t[36]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",Wt,[e("div",qt,[e("button",{onClick:t[12]||(t[12]=o=>q(r).toggleSrtOutput(!q(r).srtOutput.enabled)),class:W(["w-10 h-6 rounded-full transition-colors relative",q(r).srtOutput.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:W(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",q(r).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[34]||(t[34]=e("span",null,"Enable SRT Output",-1))]),t[35]||(t[35]=e("div",{class:"text-sm text-preke-text-dim"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-preke-bg-surface"},[e("button",{onClick:U,class:"btn"},"Close")])])])):M("",!0)])}}}),Nt={class:"program-output space-y-3","data-testid":"program-output"},Gt={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface rounded-lg","data-testid":"program-output-status"},Xt={class:"text-sm font-medium","data-testid":"program-output-text"},Yt={key:0,class:"space-y-2"},Qt={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},Zt={class:"flex-1 text-xs truncate text-preke-text-dim"},Jt={key:0,class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},eo={class:"text-xs text-preke-text-dim"},to={key:1,class:"text-xs text-preke-text-dim px-3"},oo={class:"hidden"},no=["src"],so=ae({__name:"ProgramOutput",setup(c){const y=ye(),r=ge(),d=f(!1),u=f("idle"),_=f("");function b(){return"https://app.itagenten.no/mixer_program/whip"}async function k(){if(d.value)return;u.value="connecting";const $=await he(b());if(!$){u.value="error",console.error("[ProgramOutput] Failed to build VDO.ninja URL - VDO.ninja not configured");return}_.value=$,d.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX:",$)}function h(){d.value&&(d.value=!1,_.value="",u.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function D(){d.value&&(u.value="live",console.log("[ProgramOutput] WHIP push connected"))}function m(){u.value="error",console.error("[ProgramOutput] WHIP push failed")}async function I(){h(),await new Promise($=>setTimeout($,500)),await k()}we(()=>y.isLive,async $=>{$?await k():h()});function U(){switch(u.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function E(){switch(u.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function H(){const $=r.programOutputUrls.srt;navigator.clipboard.writeText($),V.success("SRT URL copied")}return($,j)=>(i(),p("div",Nt,[e("div",Gt,[e("span",{class:W(["w-2 h-2 rounded-full",U()]),"data-testid":"program-output-indicator"},null,2),e("span",Xt,C(E()),1),u.value==="error"?(i(),p("button",{key:0,onClick:j[0]||(j[0]=O=>I()),class:"ml-auto text-xs text-preke-gold hover:underline"}," Retry ")):M("",!0)]),u.value==="live"?(i(),p("div",Yt,[e("div",Qt,[j[1]||(j[1]=e("span",{class:"text-xs text-preke-text-dim"},"ðŸ”´ SRT:",-1)),e("code",Zt,C(q(r).programOutputUrls.srt),1),e("button",{onClick:H,class:"text-xs text-preke-gold hover:underline"},"Copy")]),q(r).enabledDestinations.length>0?(i(),p("div",Jt,[j[2]||(j[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",eo,C(q(r).enabledDestinations.length)+" streaming destination"+C(q(r).enabledDestinations.length>1?"s":"")+" active ",1)])):M("",!0)])):M("",!0),u.value==="idle"?(i(),p("p",to," Program output will start automatically when you go live. ")):M("",!0),e("div",oo,[d.value&&_.value?(i(),p("iframe",{key:0,src:_.value,onLoad:D,onError:m,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,no)):M("",!0)])]))}}),ao={class:"streaming-control-panel"},ro={class:"control-bar"},lo={key:0,class:"control-bar__room"},io={class:"control-bar__room-name"},uo={key:0,class:"control-bar__camera-count"},co={key:1,class:"control-bar__divider"},mo={class:"control-bar__status"},po={class:"control-bar__status-text"},go={key:0,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},vo={key:1,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},fo={key:3,class:"control-bar__destinations"},bo={class:"control-bar__destinations-list"},xo=["title"],ko={key:0,class:"quick-setup"},yo={class:"quick-setup__form"},wo={class:"quick-setup__platform"},ho={class:"quick-setup__platform-icon"},_o={class:"quick-setup__input-wrap"},So=["placeholder"],Co={class:"hidden"},Mo=ae({__name:"StreamingControlPanel",props:{roomName:{default:""},cameraCount:{default:0}},setup(c){const y=c,r=ye(),d=ge(),u=f(null),_=f(null),b=f(!1),k=f("youtube"),h=f(""),D=K(()=>r.isLive),m=K(()=>d.destinations.length>0),I=K(()=>d.enabledDestinations.length>0),U=K(()=>D.value?"live":"idle");function E(){D.value?$():H()}async function H(){if(r.setLive(!0),d.enabledDestinations.length>0){const o=await d.startRtmpRelay();o.success?V.success(o.message):V.error(`RTMP relay failed: ${o.message}`)}else V.success("Streaming started (no RTMP destinations configured)")}async function $(){if(r.setLive(!1),d.enabledDestinations.length>0){const o=await d.stopRtmpRelay();o.success||V.warning(`Note: ${o.message}`)}V.info("Streaming stopped")}function j(){Ke(1)?V.success("Program window opened"):V.error("Popup blocked - please allow popups for this site")}async function O(){const s=await he("https://app.itagenten.no/mixer_program/whip");if(!s){V.error("Failed to build scene output URL");return}window.open(s,"vdo-scene-output","width=1280,height=720,menubar=no,toolbar=no")?V.success("Scene output window opened - streaming to MediaMTX"):V.error("Popup blocked - please allow popups for this site")}async function R(){const o=await Ae(0,{room:y.roomName||re});if(!o){V.error("Failed to build scene view URL");return}await navigator.clipboard.writeText(o),V.success('Scene view link copied! Open this URL, then use "Publishing setup" in the mixer to screen-share it to MediaMTX')}function S(){var o;(o=u.value)==null||o.open()}function L(){b.value=!b.value}function A(){if(!h.value.trim()){V.error("Please enter your stream key");return}if(!N.find(w=>w.id===k.value))return;const s=d.destinations.find(w=>w.platformId===k.value);if(s)d.updateDestination(s.id,{streamKey:h.value,enabled:!0});else{const w=d.addDestination(k.value);d.updateDestination(w.id,{streamKey:h.value,enabled:!0})}d.saveDestinations(),b.value=!1,h.value="",H()}function B(){const o=N.find(s=>s.id===k.value);return(o==null?void 0:o.streamKeyPlaceholder)||"Enter your stream key"}function n(){const o=N.find(s=>s.id===k.value);return(o==null?void 0:o.icon)||"ðŸ“¡"}function t(){switch(U.value){case"live":return"control-bar__dot--live";case"connecting":return"control-bar__dot--connecting";case"error":return"control-bar__dot--error";default:return"control-bar__dot--idle"}}function l(){switch(U.value){case"live":return"LIVE";case"connecting":return"Connecting...";case"error":return"Error";default:return"Offline"}}return(o,s)=>(i(),p("div",ao,[e("div",ro,[y.roomName?(i(),p("div",lo,[s[3]||(s[3]=e("span",{class:"control-bar__room-label"},"Room",-1)),e("span",io,C(y.roomName),1),y.cameraCount>0?(i(),p("span",uo,C(y.cameraCount)+" cam"+C(y.cameraCount!==1?"s":""),1)):M("",!0)])):M("",!0),y.roomName?(i(),p("div",co)):M("",!0),e("div",mo,[e("span",{class:W(["control-bar__dot",t()])},null,2),e("span",po,C(l()),1)]),s[12]||(s[12]=e("div",{class:"control-bar__divider"},null,-1)),e("button",{onClick:E,class:W(["control-bar__btn",D.value?"control-bar__btn--stop":"control-bar__btn--start"])},[D.value?(i(),p("svg",go,[...s[4]||(s[4]=[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"},null,-1)])])):(i(),p("svg",vo,[...s[5]||(s[5]=[e("path",{d:"M8 5.14v14l11-7-11-7z"},null,-1)])])),ee(" "+C(D.value?"Stop":"Start Streaming"),1)],2),m.value?M("",!0):(i(),p("button",{key:2,onClick:L,class:W(["control-bar__btn control-bar__btn--dashed",b.value?"control-bar__btn--active":""])},[...s[6]||(s[6]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})],-1),ee(" Add Stream Key ",-1)])],2)),e("button",{onClick:j,class:"control-bar__btn control-bar__btn--secondary",title:"Open program output in new window"},[...s[7]||(s[7]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),ee(" Watch ",-1)])]),e("button",{onClick:O,class:"control-bar__btn control-bar__btn--secondary",title:"Open scene output window - pushes mixed scene to MediaMTX for streaming (uses &whipout parameter)"},[...s[8]||(s[8]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),ee(" Scene Output ",-1)])]),e("button",{onClick:R,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Copy scene view link - open this URL, then use 'Publishing setup' to screen-share it to MediaMTX"},[...s[9]||(s[9]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})],-1)])]),e("button",{onClick:S,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Configure streaming destinations"},[...s[10]||(s[10]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])]),I.value?(i(),p("div",fo,[s[11]||(s[11]=e("span",{class:"control-bar__destinations-label"},"To:",-1)),e("div",bo,[(i(!0),p(Q,null,te(q(d).enabledDestinations,w=>(i(),p("span",{key:w.id,class:"control-bar__destination",title:w.name},C(w.platformId==="youtube"?"â–¶ï¸":w.platformId==="twitch"?"ðŸ“º":"ðŸ”´"),9,xo))),128))])])):M("",!0)]),Z(ue,{name:"slide"},{default:ce(()=>[b.value?(i(),p("div",ko,[e("div",yo,[e("div",wo,[e("span",ho,C(n()),1),Y(e("select",{"onUpdate:modelValue":s[0]||(s[0]=w=>k.value=w),class:"quick-setup__select"},[...s[13]||(s[13]=[e("option",{value:"youtube"},"YouTube",-1),e("option",{value:"twitch"},"Twitch",-1),e("option",{value:"facebook"},"Facebook",-1),e("option",{value:"restream"},"Restream",-1)])],512),[[ke,k.value]])]),e("div",_o,[Y(e("input",{"onUpdate:modelValue":s[1]||(s[1]=w=>h.value=w),type:"password",placeholder:B(),class:"quick-setup__input",onKeyup:Ve(A,["enter"])},null,40,So),[[ne,h.value]])]),e("button",{onClick:A,class:"quick-setup__go-live"}," ðŸ”´ Go Live "),e("button",{onClick:s[2]||(s[2]=w=>b.value=!1),class:"quick-setup__cancel"},"âœ•")])])):M("",!0)]),_:1}),e("div",Co,[Z(so,{ref_key:"programOutputRef",ref:_},null,512)]),Z(zt,{ref_key:"streamingSettingsRef",ref:u},null,512)]))}}),$o=me(Mo,[["__scopeId","data-v-14999ed3"]]),de="vdo-debug",Ro=500,X=[];let ve=typeof localStorage<"u"&&localStorage.getItem(de)==="true";function xe(c){ve=c,typeof localStorage<"u"&&(c?localStorage.setItem(de,"true"):localStorage.removeItem(de)),console.log(`[VDO.ninja Debug] ${c?"Enabled":"Disabled"}`)}function oe(c){if(X.push(c),X.length>Ro&&X.shift(),ve){const y=new Date(c.timestamp).toISOString().split("T")[1].slice(0,-1),r=c.direction==="outgoing"?"âž¡ï¸ OUT":"â¬…ï¸ IN",d=c.direction==="outgoing"?"color: #3b82f6; font-weight: bold":"color: #22c55e; font-weight: bold";console.groupCollapsed(`%c[VDO.ninja ${r}] %c${c.type}`,d,"color: inherit"),console.log("Time:",y),c.target&&console.log("Target:",c.target),console.log("Data:",c.data),c.raw&&c.raw!==c.data&&console.log("Raw:",c.raw),console.groupEnd()}}function Se(){return[...X]}function Po(){X.length=0,console.log("[VDO.ninja Debug] Event history cleared")}function Ce(){const c={total:X.length,incoming:0,outgoing:0,byType:{},lastActivity:X.length>0?X[X.length-1].timestamp:null};for(const y of X)y.direction==="incoming"?c.incoming++:c.outgoing++,c.byType[y.type]=(c.byType[y.type]||0)+1;return c}typeof window<"u"&&(window.__VDO_DEBUG__={getHistory:Se,clearHistory:Po,getStats:Ce,enable:()=>xe(!0),disable:()=>xe(!1),isEnabled:()=>ve});function Do(c){const y=f(!1),r=f(new Map),d=f(0),u=f(null),_=f(!1),b=f("disconnected"),k=f(null),h=_e(),D=new Map;function m(a,v,g,F){var x;if(!((x=c.value)!=null&&x.contentWindow)){console.warn("[VDO.ninja] Cannot send command - iframe not ready"),k.value="iframe not ready";return}const T={action:a};v&&(T.target=v),g!==void 0&&(T.value=g),F!==void 0&&(T.value2=F),oe({timestamp:Date.now(),direction:"outgoing",type:a,target:v,data:{action:a,target:v,value:g,value2:F},raw:T});try{c.value.contentWindow.postMessage(T,"*")}catch(P){console.error("[VDO.ninja] Failed to send command:",P),k.value=String(P)}}function I(a,v){var F;if(!((F=c.value)!=null&&F.contentWindow)){console.warn("[VDO.ninja] Cannot send DOM command - iframe not ready");return}const g={action:"",target:a,...v};oe({timestamp:Date.now(),direction:"outgoing",type:"dom-manipulation",target:a,data:v,raw:g});try{c.value.contentWindow.postMessage(g,"*")}catch(T){console.error("[VDO.ninja] Failed to send DOM command:",T)}}function U(a,v=1){var T;const g=D.get(a)||a;if(g!==a&&console.log(`[VDO.ninja] Resolved UUID ${a} to stream ID ${g} for addToScene`),!((T=c.value)!=null&&T.contentWindow)){console.warn("[VDO.ninja] Cannot send addToScene - iframe not ready");return}const F={addToScene:v,target:g};oe({timestamp:Date.now(),direction:"outgoing",type:"addToScene",target:g,data:{sceneNumber:v},raw:F});try{c.value.contentWindow.postMessage(F,"*"),u.value=v}catch(x){console.error("[VDO.ninja] Failed to send addToScene:",x)}}function E(a,v=1){var T;const g=D.get(a)||a;if(!((T=c.value)!=null&&T.contentWindow)){console.warn("[VDO.ninja] Cannot send removeFromScene - iframe not ready");return}const F={removeFromScene:v,target:g};oe({timestamp:Date.now(),direction:"outgoing",type:"removeFromScene",target:g,data:{sceneNumber:v},raw:F});try{c.value.contentWindow.postMessage(F,"*")}catch(x){console.error("[VDO.ninja] Failed to send removeFromScene:",x)}}function H(a){I(a,{replace:!0})}function $(a){I(a,{add:!0})}function j(a){I(a,{remove:!0})}function O(a,v){m("mic",a,!v);const g=r.value.get(a);g&&(g.muted=v)}function R(a){m("mic",a,"toggle");const v=r.value.get(a);v&&(v.muted=!v.muted)}function S(a,v){m("volume",a,Math.max(0,Math.min(200,v)))}function L(a){m("soloChat",a)}function A(a){m("soloChatBidirectional",a)}function B(a,v){m("sendChat",a,v)}function n(a,v){m("sendDirectorChat",a,v)}function t(a){m("hangup",a),r.value.delete(a)}function l(a){a?m("togglescreenshare",a):m("togglescreenshare")}function o(a,v){m("forward",a,v)}function s(a="guests"){m("getGuestList",void 0,void 0)}function w(){m("record",void 0,!0),_.value=!0}function J(){m("record",void 0,!1),_.value=!1}function ie(a){m("layout",void 0,a)}function Me(a){a?m("reload",a):m("reload")}function $e(a,v){m("mixorder",a,v==="up"?-1:1)}function Re(a){m("camera",void 0,a)}function Pe(a,v){m("camera",a,v)}function De(a,v=!1){v?m("zoom",void 0,a,"abs"):m("zoom",void 0,a)}function Oe(a){m("pan",void 0,a)}function Te(a){m("tilt",void 0,a)}function fe(a){const v=a.origin;if(!v.includes(h.split(":")[0])&&!v.includes("vdo.ninja")&&!v.includes("vdo.itagenten")&&!v.includes("localhost"))return;const g=a.data;if(!g||typeof g!="object")return;const F=g.type||g.action||"unknown",T=g.streamID||g.UUID||g.streamId;switch(oe({timestamp:Date.now(),direction:"incoming",type:F,target:T,data:g.data||g.value,raw:g}),F){case"director-ready":case"mixer-ready":case"loaded":case"ready":case"started":case"director":case"joined-room-complete":case"seeding-started":y.value=!0,b.value="connected",k.value=null,console.log("[VDO.ninja] Ready event received:",F);break;case"stream-id-detected":{const x=g.value||g.data,P=g.UUID;if(x){if(P){D.set(P,x),console.log(`[VDO.ninja] Stream ID mapping: ${P} -> ${x}`);const G=r.value.get(P);G&&(r.value.delete(P),G.id=x,r.value.set(x,G),d.value++,console.log(`[VDO.ninja] Updated source ID from UUID to stream ID: ${x}`))}if(!r.value.has(x)){const G={id:x,label:g.label||x,type:"guest",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0};r.value.set(x,G),d.value++,console.log(`[VDO.ninja] Source added via stream-id-detected: ${x}`)}}break}case"new-guest":case"guest-connected":case"push":case"view":case"joined":case"new-push-connection":case"push-connection":case"new-view-connection":case"view-connection":{const x=g.UUID,P=g.streamID,G=P||x||T;if(G){x&&P&&D.set(x,P);const z=g.data,be={id:G,label:(z==null?void 0:z.label)||g.label||G,type:(z==null?void 0:z.type)||"guest",hasVideo:(z==null?void 0:z.video)!==!1,hasAudio:(z==null?void 0:z.audio)!==!1,muted:!1,audioLevel:0};r.value.set(G,be),d.value++,console.log(`[VDO.ninja] Source added: ${G} (${be.label})${x&&!P?" (UUID, awaiting stream ID)":""}`)}break}case"guest-left":case"guest-disconnected":case"left":case"disconnect":T&&(r.value.delete(T),d.value++);break;case"audio-level":case"loudness":{if(T){const x=r.value.get(T);if(x){const P=g.data;x.audioLevel=(P==null?void 0:P.level)||g.value||0}}break}case"mute-state":case"muted":{if(T){const x=r.value.get(T);if(x){const P=g.data;x.muted=(P==null?void 0:P.muted)??g.value??!1}}break}case"scene-changed":case"scene":{const x=g.data,P=(x==null?void 0:x.scene)||g.value;u.value=typeof P=="number"?P:null;break}case"recording-started":_.value=!0;break;case"recording-stopped":_.value=!1;break;case"error":console.error("[VDO.ninja Error]",g.data),k.value=String(g.data);break}}return pe(()=>{b.value="connecting",window.addEventListener("message",fe),setTimeout(()=>{!y.value&&c.value&&(y.value=!0,b.value="connected")},5e3)}),je(()=>{window.removeEventListener("message",fe),b.value="disconnected"}),{isReady:y,sources:r,sourcesVersion:d,activeScene:u,isRecording:_,connectionState:b,lastError:k,addToScene:U,removeFromScene:E,setProgram:H,addSource:$,removeSource:j,setLayout:ie,changeMixOrder:$e,setMute:O,toggleMute:R,setVolume:S,soloAudio:L,soloChatBidirectional:A,sendToGuest:B,sendDirectorMessage:n,kickGuest:t,toggleScreenShare:l,transferGuest:o,getGuestList:s,refreshSource:Me,setCamera:Re,setGuestCamera:Pe,zoom:De,pan:Oe,tilt:Te,startRecording:w,stopRecording:J,sendCommand:m,sendDomCommand:I,getEventHistory:Se,getEventStats:Ce}}const Oo={class:"flex items-center justify-between p-3 border-b border-preke-border"},To={key:0,class:"text-sm font-semibold text-preke-text"},Uo=["title"],Lo={key:0,class:"p-3 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto"},Vo={class:"grid grid-cols-3 gap-2"},jo=["onClick"],Io={class:"flex items-center justify-center gap-2"},Eo={key:0,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},Bo={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},Ho={key:0},Fo={class:"space-y-2"},Ko={class:"flex items-center justify-between mb-1"},Ao={class:"text-xs text-preke-text"},Wo=["onClick","title"],qo={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},zo={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},No=["value","onInput"],Go={key:1},Xo={class:"space-y-1"},Yo=["onClick"],Qo={class:"flex items-center justify-between"},Zo={key:1,class:"mt-2"},Jo={key:1,class:"p-2 space-y-2"},en=["title"],tn=ae({__name:"MixerControlPanel",props:{iframeRef:{}},emits:["close"],setup(c,{emit:y}){const r=c,d=f(null),u=Do(d);we(()=>{var l;return(l=r.iframeRef)==null?void 0:l.value},l=>{l?(console.log("[MixerControlPanel] Iframe ref available, updating:",l),d.value=l):d.value=null},{immediate:!0}),pe(()=>{var l;(l=r.iframeRef)!=null&&l.value&&(console.log("[MixerControlPanel] On mount, iframe ref:",r.iframeRef.value),d.value=r.iframeRef.value)});const _=K(()=>u.sources.value),b=K(()=>u.isRecording.value),k=u.setLayout,h=u.toggleMute,D=u.setVolume,m=u.startRecording,I=u.stopRecording,{cameras:U}=Ge(),E=f(null),H=f(!1),$=f(!1),j=f(null),O=f(!1);function R(l){var s,w,J;if(console.log("[MixerControlPanel] Switching to scene",l,"setLayout:",k,"iframeRef:",(s=r.iframeRef)==null?void 0:s.value,"dummyRef:",d.value,"vdo.isReady:",u.isReady.value),!k){console.warn("[MixerControlPanel] setLayout not available");return}if(u.isReady.value||(console.warn("[MixerControlPanel] VDO.ninja not ready yet (isReady:",u.isReady.value,"connectionState:",u.connectionState.value,")"),console.warn("[MixerControlPanel] Attempting anyway - VDO.ninja might queue the command")),!((J=(w=r.iframeRef)==null?void 0:w.value)!=null&&J.contentWindow)){console.error("[MixerControlPanel] Iframe contentWindow not available!");return}const o=l-1;console.log("[MixerControlPanel] Calling setLayout with layout number",o,"for scene",l),console.log("[MixerControlPanel] Iframe:",r.iframeRef.value,"ContentWindow:",r.iframeRef.value.contentWindow);try{k(o),j.value=l,console.log("[MixerControlPanel] setLayout called successfully")}catch(ie){console.error("[MixerControlPanel] Error calling setLayout:",ie)}}function S(l){console.log("[MixerControlPanel] Toggling mute for",l,"toggleMute:",h),h?h(l):console.warn("[MixerControlPanel] toggleMute not available")}function L(l,o){D&&D(l,o)}function A(){console.log("[MixerControlPanel] Recording toggle, current:",b.value,"startRecording:",m,"stopRecording:",I),b.value?I?I():console.warn("[MixerControlPanel] stopRecording not available"):m?m():console.warn("[MixerControlPanel] startRecording not available")}function B(l){E.value=l,H.value=!0}function n(){H.value=!1,E.value=null}const t=K(()=>Array.from(_.value.values()));return K(()=>U.value.filter(l=>t.value.some(o=>{var s;return((s=o.label)==null?void 0:s.toLowerCase().includes(l.name.toLowerCase()))||o.id===l.name}))),(l,o)=>(i(),p("div",{class:W(["mixer-control-panel fixed top-4 right-4 z-50 bg-preke-bg-surface border border-preke-border rounded-lg shadow-lg transition-all duration-300",O.value?"w-12":"w-80"])},[e("div",Oo,[O.value?M("",!0):(i(),p("h3",To,"Mixer Controls")),e("button",{onClick:o[0]||(o[0]=s=>O.value=!O.value),class:"p-1 rounded hover:bg-preke-bg-elevated transition-colors",title:O.value?"Expand":"Collapse"},[(i(),p("svg",{class:W(["w-4 h-4 transition-transform",{"rotate-180":O.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[4]||(o[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,Uo)]),O.value?(i(),p("div",Jo,[e("button",{onClick:o[3]||(o[3]=s=>R(1)),class:"w-full aspect-square flex items-center justify-center text-xs font-bold rounded bg-preke-bg-elevated hover:bg-preke-bg-elevated/80",title:"Scene 1"}," 1 "),e("button",{onClick:A,class:W(["w-full aspect-square flex items-center justify-center rounded",b.value.value?"bg-red-600 text-white":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80"]),title:b.value.value?"Stop Recording":"Start Recording"},[...o[16]||(o[16]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"6"})],-1)])],10,en)])):(i(),p("div",Lo,[e("div",null,[o[5]||(o[5]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Scenes",-1)),e("div",Vo,[(i(),p(Q,null,te(9,s=>e("button",{key:s,onClick:w=>R(s),class:W(["aspect-square flex items-center justify-center text-sm font-bold rounded transition-all",j.value===s?"bg-preke-purple text-white ring-2 ring-preke-purple":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 text-preke-text"])},C(s),11,jo)),64))])]),e("div",null,[o[8]||(o[8]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Recording",-1)),e("button",{onClick:A,class:W(["w-full px-4 py-2 rounded transition-all",b.value.value?"bg-red-600 hover:bg-red-700 text-white":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 text-preke-text"])},[e("span",Io,[b.value.value?(i(),p("svg",Eo,[...o[6]||(o[6]=[e("circle",{cx:"12",cy:"12",r:"6"},null,-1)])])):(i(),p("svg",Bo,[...o[7]||(o[7]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1)])])),ee(" "+C(b.value.value?"Stop Recording":"Start Recording"),1)])],2)]),t.value.length>0?(i(),p("div",Ho,[o[11]||(o[11]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Sources",-1)),e("div",Fo,[(i(!0),p(Q,null,te(t.value,s=>(i(),p("div",{key:s.id,class:"p-2 bg-preke-bg-elevated rounded"},[e("div",Ko,[e("span",Ao,C(s.label||s.id),1),e("button",{onClick:w=>S(s.id),class:W(["p-1 rounded hover:bg-preke-bg-surface transition-colors",s.muted?"text-red-400":"text-preke-text-dim"]),title:s.muted?"Unmute":"Mute"},[s.muted?(i(),p("svg",qo,[...o[9]||(o[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(i(),p("svg",zo,[...o[10]||(o[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},null,-1)])]))],10,Wo)]),s.hasAudio?(i(),p("input",{key:0,type:"range",value:s.audioLevel||100,onInput:w=>L(s.id,Number(w.target.value)),min:"0",max:"200",class:"w-full h-1 bg-preke-bg-base rounded-lg appearance-none cursor-pointer accent-preke-gold"},null,40,No)):M("",!0)]))),128))])])):M("",!0),q(U).length>0?(i(),p("div",Go,[o[13]||(o[13]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Camera Controls",-1)),e("div",Xo,[(i(!0),p(Q,null,te(q(U),s=>(i(),p("button",{key:s.name,onClick:w=>B(s.name),class:"w-full px-3 py-2 text-left text-xs bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 rounded transition-colors"},[e("span",Qo,[e("span",null,C(s.name),1),o[12]||(o[12]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])],8,Yo))),128))])])):M("",!0),e("div",null,[o[15]||(o[15]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"PTZ Controller",-1)),$.value?(i(),p("div",Zo,[Z(Xe,{"camera-name":E.value,onClose:o[2]||(o[2]=s=>$.value=!1)},null,8,["camera-name"])])):(i(),p("button",{key:0,onClick:o[1]||(o[1]=s=>$.value=!0),class:"w-full px-3 py-2 text-left text-xs bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 rounded transition-colors"},[...o[14]||(o[14]=[e("span",{class:"flex items-center justify-between"},[e("span",null,"Open PTZ Controller"),e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})])],-1)])]))])])),H.value&&E.value?(i(),le(Ye,{key:2,"camera-name":E.value,onClose:n},null,8,["camera-name"])):M("",!0)],2))}}),on=me(tn,[["__scopeId","data-v-5be44a96"]]),nn={class:"h-full flex flex-col bg-preke-bg"},sn={class:"flex-1 relative"},an=["src"],rn={key:0,class:"absolute inset-0 flex items-center justify-center bg-preke-bg"},ln=["title"],un=ae({__name:"MixerView",setup(c){const y=Fe(),r=Ie(),d=Ee();function u(){y.push("/")}const _=f(!0),b=f(!1),k=f(!1),h=f("Starting mixer..."),D=f(null),m=f(!0),I=K(()=>r.inputs.filter(R=>R.hasSignal)),U=f("");async function E(){const R=await We(),S=await qe({mediamtxHost:R||void 0,room:re});if(S)U.value=S,console.log("[Mixer] Mixer URL initialized with API key");else{const L=await _e()||"r58-vdo.itagenten.no",A=ze(),B=new URL(`${A}://${L}/mixer.html`);B.searchParams.set("room",re),B.searchParams.set("password",Ne),B.searchParams.set("css",`${A}://${L}/css/preke-colors.css`),U.value=B.toString(),console.warn("[Mixer] Using fallback URL without API key")}}function H(){console.log("[Mixer] VDO.ninja mixer iframe loaded"),b.value=!0,h.value="Waiting for cameras..."}function $(){_.value=!1}async function j(){const R=performance.now();h.value="Starting camera bridge...";for(let S=0;S<40;S++){try{if((await(await fetch(await se("/api/mode/status"))).json()).current_mode==="mixer"){const B=Math.round((performance.now()-R)/1e3);if(B>=5){console.log(`[Mixer] Bridge likely ready after ${B}s`),k.value=!0,h.value="Cameras connecting...";return}}}catch{}await new Promise(L=>setTimeout(L,500)),h.value=`Starting camera bridge... (${Math.round((performance.now()-R)/1e3)}s)`}console.log("[Mixer] Bridge wait timeout - continuing anyway"),k.value=!0}async function O(){var S;if(!Be())return;h.value="Checking mode...",await d.fetchCapabilities();const R=(S=d.capabilities)==null?void 0:S.current_mode;if(R&&R!=="mixer"){console.log("[Mixer] Not in mixer mode, switching..."),h.value="Switching to mixer mode...";try{(await fetch(await se("/api/mode/mixer"),{method:"POST"})).ok&&(await d.fetchCapabilities(),V.success("Switched to Mixer mode"))}catch(L){console.warn("[Mixer] Failed to switch mode:",L)}}}return pe(async()=>{const R=performance.now();await E(),await Promise.all([O(),r.fetchInputs()]),await j(),console.log(`[Mixer] Total load time: ${Math.round(performance.now()-R)}ms`)}),(R,S)=>(i(),p(Q,null,[Z(ue,{name:"fade"},{default:ce(()=>[_.value?(i(),le(Qe,{key:0,mode:"mixer","content-ready":b.value&&k.value,"min-time":2e3,"max-time":2e4,"show-cancel":!0,onReady:$,onCancel:u},null,8,["content-ready"])):M("",!0)]),_:1}),Z(ue,{name:"content-fade"},{default:ce(()=>[Y(e("div",nn,[Z($o,{"room-name":q(re),"camera-count":I.value.length},null,8,["room-name","camera-count"]),e("div",sn,[e("iframe",{ref_key:"iframeRef",ref:D,src:U.value,onLoad:H,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,an),b.value?M("",!0):(i(),p("div",rn,[...S[1]||(S[1]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-8 h-8 border-2 border-preke-gold border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-preke-text-muted"},"Loading VDO.ninja mixer..."),e("span",{class:"text-xs text-preke-text-subtle"},"Cameras will appear when bridge is running")],-1)])])),b.value?(i(),p("button",{key:1,onClick:S[0]||(S[0]=L=>m.value=!m.value),class:"absolute top-4 left-4 z-40 p-2 bg-preke-bg-surface border border-preke-border rounded-lg shadow-lg hover:bg-preke-bg-elevated transition-colors",title:m.value?"Hide Controls":"Show Controls"},[...S[2]||(S[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)])],8,ln)):M("",!0),m.value&&b.value?(i(),le(on,{"iframe-ref":D.value,key:b.value?"ready":"loading"},null,8,["iframe-ref"])):M("",!0)])],512),[[He,!_.value]])]),_:1})],64))}}),pn=me(un,[["__scopeId","data-v-6a4e56ef"]]);export{pn as default};
