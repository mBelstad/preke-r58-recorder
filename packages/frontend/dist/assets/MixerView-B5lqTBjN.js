import{C as ae,r as k,h as L,e as ie,f as le,d as B,w as G,c as m,p as U,a as e,A as O,n as R,o as d,F as A,B as K,t as P,D as ce,y as j,j as ue,s as F,v as W,m as de,x as me,k as E}from"./index-DqYuzIKo.js";import{u as q}from"./recorder-CicwZW5P.js";const N=ae("mixer",()=>{const h=k(!1),o=k(null),r=k(null),a=k(null),l=k([]),n=L(()=>l.value.filter(u=>u.hasVideo||u.hasAudio));function C(){h.value=!h.value}function g(u){o.value=u}function i(u){r.value=u}function v(u){a.value=u}function S(u){l.value=u}function p(u,$){const y=l.value.find(D=>D.id===u);y&&(y.muted=$)}function x(u,$){const y=l.value.find(D=>D.id===u);y&&(y.audioLevel=$)}return{isLive:h,activeScene:o,programSource:r,previewSource:a,sources:l,activeSources:n,toggleLive:C,setScene:g,setProgram:i,setPreview:v,updateSourcesFromVdo:S,setSourceMute:p,updateAudioLevel:x}}),H=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],X=ae("streaming",()=>{const h=k([]),o=k(!1),r=k(null),a=k({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),l=L(()=>h.value.find(c=>c.id===r.value)),n=L(()=>h.value.filter(c=>c.enabled)),C=L(()=>H),g=L(()=>{const c=window.location.hostname,b=c==="localhost"||c==="127.0.0.1"?"localhost":c.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${b}:1935/mixer_program`,rtsp:`rtsp://${b}:8554/mixer_program`,srt:`srt://${b}:8890?streamid=read:mixer_program`,hls:`https://${c}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function i(c,s){const b=H.find(T=>T.id===c);if(!b)throw new Error(`Unknown platform: ${c}`);const f={id:`dest-${Date.now()}`,platformId:c,name:s||b.name,streamKey:"",enabled:!1};return h.value.push(f),f}function v(c,s){const b=h.value.findIndex(f=>f.id===c);b!==-1&&(h.value[b]={...h.value[b],...s})}function S(c){const s=h.value.findIndex(b=>b.id===c);s!==-1&&h.value.splice(s,1),r.value===c&&(r.value=null)}function p(c){r.value=c}function x(c){a.value.enabled=c}function u(c){a.value={...a.value,...c}}function $(){o.value=!0}function y(){o.value=!1}function D(c){const s=H.find(b=>b.id===c.platformId);return s?c.platformId==="custom"?`${c.name}${c.streamKey}`:`${s.rtmpBaseUrl}${c.streamKey}`:""}function w(){const c=window.location.hostname;return`srt://${c==="localhost"||c==="127.0.0.1"?"localhost":c.replace("r58-api","r58-mediamtx")}:${a.value.port}?streamid=read:${a.value.streamId}`}function _(){try{const c=localStorage.getItem("r58-streaming-destinations");if(c){const s=JSON.parse(c);h.value=s.destinations||[],s.srtOutput&&(a.value={...a.value,...s.srtOutput})}}catch(c){console.warn("Failed to load saved streaming destinations:",c)}}function t(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:h.value,srtOutput:a.value}))}catch(c){console.warn("Failed to save streaming destinations:",c)}}return _(),{destinations:h,isStreaming:o,activeDestinationId:r,srtOutput:a,activeDestination:l,enabledDestinations:n,platforms:C,programOutputUrls:g,addDestination:i,updateDestination:v,removeDestination:S,setActiveDestination:p,toggleSrtOutput:x,updateSrtConfig:u,startStreaming:$,stopStreaming:y,buildRtmpUrl:D,getSrtOutputUrl:w,saveDestinations:t,loadSavedDestinations:_}});function z(){return"r58-vdo.itagenten.no"}function J(){return"https"}const V="studio",pe={director:{params:{director:V,hidesolo:!0,hideheader:!0,cleanoutput:!0,darkmode:!0,nologo:!0}},scene:{params:{scene:!0,room:V,cover:!0,fadein:500,animated:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0}},multiview:{params:{room:V,scene:!0,grid:!0,autoadd:"*",cleanoutput:!0,hideheader:!0,nologo:!0}},cameraContribution:{params:{room:V,videodevice:0,audiodevice:0,autostart:!0,noaudio:!1}},guestInvite:{params:{room:V,webcam:!0,mic:!0,quality:1,effects:!0}},soloView:{params:{room:V,cover:!0,cleanoutput:!0}},programOutput:{params:{scene:!0,room:V,cover:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0,autostart:!0}}};function Y(){return`${window.location.origin}/static/css/vdo-theme.css`}function ve(h,o={}){const r=z(),a=J(),l=pe[h],n=new URL(`${a}://${r}/`);n.searchParams.set("css",Y());for(const[C,g]of Object.entries(l.params))if(typeof g=="boolean")g&&n.searchParams.set(C,"");else if(typeof g=="number")n.searchParams.set(C,g.toString());else if(typeof g=="string"){let i=g;for(const[v,S]of Object.entries(o))i=i.replace(`{${v}}`,S);i.includes("{")||n.searchParams.set(C,i)}return o.push_id&&n.searchParams.set("push",o.push_id),o.view_id&&n.searchParams.set("view",o.view_id),o.source_ids&&n.searchParams.set("autoadd",o.source_ids),o.whep_url&&n.searchParams.set("whepshare",encodeURIComponent(o.whep_url)),o.label&&n.searchParams.set("label",o.label),n.toString()}function re(h,o,r){const a=z(),l=J(),n=new URL(`${l}://${a}/`);return n.searchParams.set("push",h),n.searchParams.set("room",V),n.searchParams.set("whepshare",o),n.searchParams.set("label",r),n.searchParams.set("videodevice","0"),n.searchParams.set("audiodevice","0"),n.searchParams.set("autostart",""),n.searchParams.set("css",Y()),n.toString()}function fe(h){const o=z(),r=J(),a=new URL(`${r}://${o}/`);return a.searchParams.set("scene",""),a.searchParams.set("room",V),a.searchParams.set("cover",""),a.searchParams.set("quality","2"),a.searchParams.set("cleanoutput",""),a.searchParams.set("hideheader",""),a.searchParams.set("nologo",""),a.searchParams.set("whipout",h),a.searchParams.set("autostart",""),a.searchParams.set("videodevice","0"),a.searchParams.set("audiodevice","0"),a.searchParams.set("css",Y()),a.toString()}function ge(h){const o=k(!1),r=k(new Map),a=k(null),l=z();function n(s,b,f){var M;if(!((M=h.value)!=null&&M.contentWindow)){console.warn("VDO.ninja iframe not ready");return}const T={action:s};b&&(T.target=b),f!==void 0&&(T.value=f),h.value.contentWindow.postMessage(T,"*")}function C(s){n("changeScene",void 0,s),a.value=s}function g(s){n("soloVideo",s)}function i(s,b){n("pip",s,b?"enable":"disable")}function v(s,b){n("mute",s,b);const f=r.value.get(s);f&&(f.muted=b)}function S(s,b){n("volume",s,Math.max(0,Math.min(100,b)))}function p(s){n("soloChat",s)}function x(s){n("highlight",s)}function u(s,b){n("sendChat",s,b)}function $(s){n("hangup",s),r.value.delete(s)}function y(s){n("requestScreen",s)}function D(){n("record",void 0,!0)}function w(){n("record",void 0,!1)}function _(s){n("layout",void 0,s)}function t(s){n("reload",s)}function c(s){var Q,Z,ee,te,se,ne,oe;const b=s.origin;if(!b.includes(l.split(":")[0])&&!b.includes("vdo.ninja")&&!b.includes("localhost"))return;const f=s.data;if(!f||typeof f!="object")return;console.log("[VDO.ninja] Message received:",{type:f.type,streamID:f.streamID,data:f.data,action:f.action,value:f.value,raw:f});const T=f.type||f.action,M=f.streamID||f.UUID||f.streamId;switch(T){case"director-ready":case"loaded":case"ready":case"started":o.value=!0,console.log("[VDO.ninja] Ready state detected");break;case"new-guest":case"guest-connected":case"push":case"view":case"joined":if(M){const I={id:M,label:((Q=f.data)==null?void 0:Q.label)||f.label||M,type:((Z=f.data)==null?void 0:Z.type)||f.type||"guest",hasVideo:((ee=f.data)==null?void 0:ee.video)!==!1,hasAudio:((te=f.data)==null?void 0:te.audio)!==!1,muted:!1,audioLevel:0};r.value.set(M,I),console.log("[VDO.ninja] Source added:",I)}break;case"guest-left":case"guest-disconnected":case"left":case"disconnect":M&&(r.value.delete(M),console.log("[VDO.ninja] Source removed:",M));break;case"audio-level":case"loudness":if(M){const I=r.value.get(M);I&&(I.audioLevel=((se=f.data)==null?void 0:se.level)||f.value||0)}break;case"mute-state":case"muted":if(M){const I=r.value.get(M);I&&(I.muted=((ne=f.data)==null?void 0:ne.muted)??f.value??!1)}break;case"scene-changed":case"scene":a.value=((oe=f.data)==null?void 0:oe.scene)||f.value||null;break;case"error":console.error("[VDO.ninja Error]",f.data);break;default:T&&console.log("[VDO.ninja] Unhandled message type:",T)}}return ie(()=>{window.addEventListener("message",c),setTimeout(()=>{!o.value&&h.value&&(o.value=!0)},5e3)}),le(()=>{window.removeEventListener("message",c)}),{isReady:o,sources:r,activeScene:a,setScene:C,setProgram:g,togglePiP:i,setLayout:_,setMute:v,setVolume:S,soloAudio:p,highlightSource:x,sendToGuest:u,kickGuest:$,requestScreenShare:y,refreshSource:t,startRecording:D,stopRecording:w,sendCommand:n}}const xe={class:"vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden"},be={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10"},he=["src"],ye=B({__name:"VdoNinjaEmbed",props:{profile:{},sources:{}},setup(h,{expose:o}){const r=h,a=k(null),l=N(),{isReady:n,sources:C,setScene:g,setMute:i,setVolume:v}=ge(a),S=L(()=>{const p={};return r.sources&&(p.source_ids=r.sources.join(",")),ve(r.profile,p)});return G(C,p=>{l.updateSourcesFromVdo(Array.from(p.values()))},{deep:!0}),o({isReady:n,setScene:g,setMute:i,setVolume:v}),(p,x)=>(d(),m("div",xe,[O(n)?U("",!0):(d(),m("div",be,[...x[0]||(x[0]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"}),e("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja..."),e("p",{class:"text-xs text-r58-text-secondary mt-2"},"Local mixer on R58")],-1)])])),e("iframe",{ref_key:"iframeRef",ref:a,src:S.value,class:R(["w-full h-full border-0",{"opacity-0":!O(n)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:""},null,10,he)]))}}),we={class:"space-y-6"},_e={class:"card"},Se={key:0,class:"mb-3 px-3 py-2 bg-amber-500/10 border border-amber-500/30 rounded-lg text-xs text-amber-400"},ke={key:1,class:"text-center py-8 text-r58-text-secondary"},$e={key:2,class:"space-y-2"},Ce={class:"flex items-center gap-3"},Pe={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Oe={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},De={key:2,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Le={class:"font-medium"},Re={class:"text-xs text-r58-text-secondary capitalize"},Ue={class:"flex items-center gap-2"},Me={class:"w-16 h-2 bg-r58-bg-primary rounded-full overflow-hidden"},je=["onClick"],Te={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ve={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ie={class:"card"},He={class:"grid grid-cols-2 gap-2"},Be=B({__name:"SourcePanel",setup(h){const o=N(),r=q(),a=L(()=>o.sources),l=L(()=>r.inputs.filter(g=>g.hasSignal).map(g=>({id:g.id,label:g.label,type:"camera",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0}))),n=L(()=>a.value.length>0?a.value:l.value);L(()=>n.value.filter(g=>g.hasVideo||g.hasAudio));const C=L(()=>a.value.length===0&&l.value.length>0);return(g,i)=>(d(),m("div",we,[e("div",_e,[i[10]||(i[10]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Sources",-1)),C.value?(d(),m("div",Se," Showing HDMI cameras. VDO.ninja sources will appear when guests join. ")):U("",!0),n.value.length===0?(d(),m("div",ke,[...i[4]||(i[4]=[e("p",null,"No sources connected",-1),e("p",{class:"text-sm mt-1"},"Connect HDMI sources or have guests join the room",-1)])])):(d(),m("div",$e,[(d(!0),m(A,null,K(n.value,v=>(d(),m("div",{key:v.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary"},[e("div",Ce,[e("div",{class:R(["w-10 h-10 rounded bg-r58-bg-primary flex items-center justify-center",{"ring-2 ring-r58-accent-primary":O(o).programSource===v.id}])},[v.type==="camera"?(d(),m("svg",Pe,[...i[5]||(i[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):v.type==="guest"?(d(),m("svg",Oe,[...i[6]||(i[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):(d(),m("svg",De,[...i[7]||(i[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])]))],2),e("div",null,[e("p",Le,P(v.label),1),e("p",Re,P(v.type),1)])]),e("div",Ue,[e("div",Me,[e("div",{class:"h-full bg-r58-accent-success rounded-full transition-all duration-100",style:ce({width:`${v.audioLevel}%`})},null,4)]),e("button",{onClick:S=>O(o).setSourceMute(v.id,!v.muted),class:R(["p-2 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":v.muted}])},[v.muted?(d(),m("svg",Te,[...i[8]||(i[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(d(),m("svg",Ve,[...i[9]||(i[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,je)])]))),128))]))]),i[12]||(i[12]=e("div",{class:"card"},[e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Guest Invite"),e("button",{class:"btn w-full justify-center"}," Generate Invite Link ")],-1)),e("div",Ie,[i[11]||(i[11]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Scenes",-1)),e("div",He,[e("button",{onClick:i[0]||(i[0]=v=>O(o).setScene("scene1")),class:R(["btn",{"btn-primary":O(o).activeScene==="scene1"}])}," Scene 1 ",2),e("button",{onClick:i[1]||(i[1]=v=>O(o).setScene("scene2")),class:R(["btn",{"btn-primary":O(o).activeScene==="scene2"}])}," Scene 2 ",2),e("button",{onClick:i[2]||(i[2]=v=>O(o).setScene("pip")),class:R(["btn",{"btn-primary":O(o).activeScene==="pip"}])}," PiP ",2),e("button",{onClick:i[3]||(i[3]=v=>O(o).setScene("grid")),class:R(["btn",{"btn-primary":O(o).activeScene==="grid"}])}," Grid ",2)])])]))}}),Ee={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary"},Ae={class:"flex items-center gap-2"},Ke={class:"text-r58-text-secondary"},Ne={key:0,class:"px-4 pb-3"},ze={key:0,class:"flex gap-3 flex-wrap"},Fe={class:"text-sm font-medium"},We={class:"text-xs text-r58-text-secondary"},Ge=["onClick"],qe={key:1,class:"text-sm text-r58-text-secondary py-2"},Xe={class:"hidden"},Je=["src","onLoad","onError"],Ye=B({__name:"CameraPushBar",setup(h){const o=q(),r=k(new Map),a=k(!0),l=L(()=>o.inputs.filter(p=>p.hasSignal));function n(p){return`${window.location.origin}/api/v1/whep/${p}/whep`}G(l,p=>{for(const u of p)if(!r.value.has(u.id)){const $=n(u.id),y=re(u.id,$,u.label);r.value.set(u.id,{cameraId:u.id,label:u.label,status:"connecting",iframeSrc:y})}const x=new Set(p.map(u=>u.id));for(const[u]of r.value)x.has(u)||r.value.delete(u)},{immediate:!0});function C(p){const x=r.value.get(p);x&&(x.status="connected",console.log(`[CameraPush] ${p} connected to VDO.ninja`))}function g(p){const x=r.value.get(p);x&&(x.status="error",console.error(`[CameraPush] ${p} failed to connect`))}function i(p){const x=o.inputs.find(y=>y.id===p);if(!x||!x.hasSignal)return;const u=n(p),$=re(p,u,x.label);r.value.set(p,{cameraId:p,label:x.label,status:"connecting",iframeSrc:$+`&_t=${Date.now()}`})}function v(p){switch(p){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function S(p){switch(p){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(p,x)=>(d(),m("div",Ee,[e("button",{onClick:x[0]||(x[0]=u=>a.value=!a.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors"},[e("div",Ae,[x[1]||(x[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",Ke,"("+P(l.value.length)+" active)",1)]),(d(),m("svg",{class:R(["w-4 h-4 transition-transform",{"rotate-180":a.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...x[2]||(x[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),a.value?(d(),m("div",Ne,[r.value.size>0?(d(),m("div",ze,[(d(!0),m(A,null,K(r.value,([u,$])=>(d(),m("div",{key:u,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[e("span",{class:R(["w-2 h-2 rounded-full",v($.status)])},null,2),e("span",Fe,P($.label),1),e("span",We,P(S($.status)),1),$.status==="error"?(d(),m("button",{key:0,onClick:y=>i(u),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,Ge)):U("",!0)]))),128))])):(d(),m("div",qe," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):U("",!0),e("div",Xe,[(d(!0),m(A,null,K(r.value,([u,$])=>(d(),m("iframe",{key:u,src:$.iframeSrc,onLoad:y=>C(u),onError:y=>g(u),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Je))),128))])]))}}),Qe={class:"program-output space-y-3"},Ze={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},et={class:"text-sm font-medium"},tt={key:0,class:"space-y-2"},st={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},nt={class:"flex-1 text-xs truncate text-r58-text-secondary"},ot={key:0,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},rt={class:"text-xs text-r58-text-secondary"},at={key:1,class:"text-xs text-r58-text-secondary px-3"},it={class:"hidden"},lt=["src"],ct=B({__name:"ProgramOutput",setup(h){const o=N(),r=X(),a=k(!1),l=k("idle"),n=k("");function C(){return`${window.location.origin}/api/v1/whip/program/whip`}function g(){a.value||(l.value="connecting",n.value=fe(C()),a.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function i(){a.value&&(a.value=!1,n.value="",l.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function v(){a.value&&(l.value="live",console.log("[ProgramOutput] WHIP push connected"))}function S(){l.value="error",console.error("[ProgramOutput] WHIP push failed")}function p(){i(),setTimeout(()=>g(),500)}G(()=>o.isLive,y=>{y?g():i()});function x(){switch(l.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function u(){switch(l.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function $(){const y=r.programOutputUrls.srt;navigator.clipboard.writeText(y),j.success("SRT URL copied")}return(y,D)=>(d(),m("div",Qe,[e("div",Ze,[e("span",{class:R(["w-2 h-2 rounded-full",x()])},null,2),e("span",et,P(u()),1),l.value==="error"?(d(),m("button",{key:0,onClick:D[0]||(D[0]=w=>p()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"}," Retry ")):U("",!0)]),l.value==="live"?(d(),m("div",tt,[e("div",st,[D[1]||(D[1]=e("span",{class:"text-xs text-r58-text-secondary"},"ðŸ”´ SRT:",-1)),e("code",nt,P(O(r).programOutputUrls.srt),1),e("button",{onClick:$,class:"text-xs text-r58-accent-primary hover:underline"},"Copy")]),O(r).enabledDestinations.length>0?(d(),m("div",ot,[D[2]||(D[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",rt,P(O(r).enabledDestinations.length)+" streaming destination"+P(O(r).enabledDestinations.length>1?"s":"")+" active ",1)])):U("",!0)])):U("",!0),l.value==="idle"?(d(),m("p",at," Program output will start automatically when you go live. ")):U("",!0),e("div",it,[a.value&&n.value?(d(),m("iframe",{key:0,src:n.value,onLoad:v,onError:S,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,lt)):U("",!0)])]))}}),ut={class:"streaming-settings"},dt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},mt={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},pt={class:"p-6 overflow-y-auto max-h-[60vh]"},vt={class:"mb-8"},ft={class:"flex items-center justify-between mb-4"},gt={key:0,class:"mb-4 p-4 bg-r58-bg-tertiary rounded-lg"},xt={class:"grid grid-cols-2 gap-2"},bt=["onClick"],ht={class:"text-xl"},yt={key:1,class:"space-y-3"},wt=["onClick"],_t={class:"text-xl"},St={class:"flex-1"},kt={class:"font-medium"},$t={class:"text-xs text-r58-text-secondary"},Ct=["onClick"],Pt=["onClick"],Ot={key:2,class:"text-r58-text-secondary text-sm"},Dt={key:0,class:"mb-8 p-4 bg-r58-bg-tertiary rounded-lg"},Lt={class:"text-lg font-medium mb-4"},Rt={class:"space-y-4"},Ut=["placeholder"],Mt={key:0},jt={class:"flex gap-2"},Tt={class:"mb-8"},Vt={class:"space-y-3"},It={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Ht={class:"flex items-center justify-between mb-1"},Bt={class:"text-xs text-r58-text-secondary break-all"},Et={class:"p-3 bg-r58-bg-tertiary rounded-lg"},At={class:"flex items-center justify-between mb-1"},Kt={class:"text-xs text-r58-text-secondary break-all"},Nt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},zt={class:"flex items-center justify-between mb-1"},Ft={class:"text-xs text-r58-text-secondary break-all"},Wt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Gt={class:"flex items-center justify-between mb-1"},qt={class:"text-xs text-r58-text-secondary break-all"},Xt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Jt={class:"flex items-center justify-between mb-1"},Yt={class:"text-xs text-r58-text-secondary break-all"},Qt={class:"p-4 bg-r58-bg-tertiary rounded-lg"},Zt={class:"flex items-center gap-3 mb-4"},es=B({__name:"StreamingSettings",setup(h,{expose:o}){const r=X(),a=k(!1),l=k(null),n=k(!1);k(""),k("");const C=L(()=>r.destinations),g=L(()=>H),i=L(()=>r.programOutputUrls);function v(){a.value=!0}function S(){a.value=!1,l.value=null,n.value=!1}function p(_){const t=r.addDestination(_);l.value=t,n.value=!1,r.saveDestinations()}function x(){l.value&&(r.updateDestination(l.value.id,l.value),r.saveDestinations(),l.value=null,j.success("Streaming destination saved"))}function u(_){r.removeDestination(_),r.saveDestinations(),j.info("Destination removed")}function $(_){r.updateDestination(_.id,{enabled:!_.enabled}),r.saveDestinations()}function y(_,t){navigator.clipboard.writeText(_),j.success(`${t} copied to clipboard`)}function D(_){const t=H.find(c=>c.id===_);return(t==null?void 0:t.icon)||"ðŸ“¡"}function w(_){const t=H.find(c=>c.id===_);return(t==null?void 0:t.name)||"Unknown"}return o({open:v}),(_,t)=>{var c;return d(),m("div",ut,[e("button",{onClick:v,class:"btn btn-sm"}," âš™ï¸ Streaming Settings "),(d(),ue(de,{to:"body"},[a.value?(d(),m("div",dt,[e("div",{class:"absolute inset-0 bg-black/60",onClick:S}),e("div",mt,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:S,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," Ã— ")]),e("div",pt,[e("section",vt,[e("div",ft,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[0]||(t[0]=s=>n.value=!n.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),n.value?(d(),m("div",gt,[t[13]||(t[13]=e("p",{class:"text-sm text-r58-text-secondary mb-3"},"Select a streaming platform:",-1)),e("div",xt,[(d(!0),m(A,null,K(g.value,s=>(d(),m("button",{key:s.id,onClick:b=>p(s.id),class:"flex items-center gap-2 p-3 bg-r58-bg-secondary hover:bg-r58-accent-primary/20 rounded-lg transition-colors text-left"},[e("span",ht,P(s.icon),1),e("span",null,P(s.name),1)],8,bt))),128))])])):U("",!0),C.value.length>0?(d(),m("div",yt,[(d(!0),m(A,null,K(C.value,s=>(d(),m("div",{key:s.id,class:"flex items-center gap-3 p-3 bg-r58-bg-tertiary rounded-lg"},[e("button",{onClick:b=>$(s),class:R(["w-10 h-6 rounded-full transition-colors relative",s.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:R(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",s.enabled?"left-5":"left-1"])},null,2)],10,wt),e("span",_t,P(D(s.platformId)),1),e("div",St,[e("div",kt,P(s.name),1),e("div",$t,P(s.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+s.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:b=>l.value={...s},class:"text-r58-accent-primary hover:underline text-sm"}," Edit ",8,Ct),e("button",{onClick:b=>u(s.id),class:"text-r58-accent-danger hover:underline text-sm"}," Remove ",8,Pt)]))),128))])):(d(),m("p",Ot," No streaming destinations configured. Add a platform above. "))]),l.value?(d(),m("section",Dt,[e("h3",Lt," Edit "+P(w(l.value.platformId)),1),e("div",Rt,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Display Name",-1)),F(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>l.value.name=s),type:"text",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none"},null,512),[[W,l.value.name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Stream Key",-1)),F(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>l.value.streamKey=s),type:"password",placeholder:(c=O(H).find(s=>s.id===l.value.platformId))==null?void 0:c.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,8,Ut),[[W,l.value.streamKey]]),t[16]||(t[16]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),l.value.platformId==="custom"?(d(),m("div",Mt,[t[17]||(t[17]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"RTMP URL",-1)),F(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>l.value.name=s),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,512),[[W,l.value.name]])])):U("",!0),e("div",jt,[e("button",{onClick:x,class:"btn btn-primary"}," Save "),e("button",{onClick:t[4]||(t[4]=s=>l.value=null),class:"btn"}," Cancel ")])])])):U("",!0),e("section",Tt,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[27]||(t[27]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",Vt,[e("div",It,[e("div",Ht,[t[18]||(t[18]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[5]||(t[5]=s=>y(i.value.srt,"SRT URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Bt,P(i.value.srt),1),t[19]||(t[19]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",Et,[e("div",At,[t[20]||(t[20]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[6]||(t[6]=s=>y(i.value.rtmp,"RTMP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Kt,P(i.value.rtmp),1)]),e("div",Nt,[e("div",zt,[t[21]||(t[21]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[7]||(t[7]=s=>y(i.value.rtsp,"RTSP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Ft,P(i.value.rtsp),1)]),e("div",Wt,[e("div",Gt,[t[22]||(t[22]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[8]||(t[8]=s=>y(i.value.hls,"HLS URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",qt,P(i.value.hls),1),t[23]||(t[23]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",Xt,[e("div",Jt,[t[24]||(t[24]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[9]||(t[9]=s=>y(i.value.whep,"WHEP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Yt,P(i.value.whep),1),t[25]||(t[25]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[30]||(t[30]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",Qt,[e("div",Zt,[e("button",{onClick:t[10]||(t[10]=s=>O(r).toggleSrtOutput(!O(r).srtOutput.enabled)),class:R(["w-10 h-6 rounded-full transition-colors relative",O(r).srtOutput.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:R(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",O(r).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[28]||(t[28]=e("span",null,"Enable SRT Output",-1))]),t[29]||(t[29]=e("div",{class:"text-sm text-r58-text-secondary"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-r58-bg-tertiary"},[e("button",{onClick:S,class:"btn"},"Close")])])])):U("",!0)]))])}}}),ts={class:"h-full flex flex-col"},ss={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},ns={class:"flex items-center gap-4"},os={class:"flex items-center gap-2"},rs={key:0,class:"badge badge-danger"},as={key:1,class:"text-xs text-r58-text-secondary"},is={class:"flex items-center gap-4"},ls={class:"flex-1 flex overflow-hidden"},cs={class:"flex-1 p-4"},us={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},ds={class:"mt-6 pt-4 border-t border-r58-bg-tertiary"},vs=B({__name:"MixerView",setup(h){const o=N(),r=q(),a=X(),{register:l}=me(),n=k(null),C=k(null),g=L(()=>o.isLive),i=L(()=>a.enabledDestinations.length);let v=null;const S=[];ie(()=>{r.fetchInputs(),v=window.setInterval(()=>{r.fetchInputs()},5e3);for(let w=1;w<=9;w++){const _=l({key:String(w),description:`Switch to scene ${w}`,action:()=>p(w),context:"mixer"});S.push(_)}S.push(l({key:"t",description:"Cut to preview (transition)",action:()=>x(),context:"mixer"})),S.push(l({key:"a",description:"Auto-transition with fade",action:()=>u(),context:"mixer"})),S.push(l({key:"Tab",description:"Cycle through sources",action:()=>$(),context:"mixer"})),S.push(l({key:"g",description:"Toggle Go Live",action:()=>y(),context:"mixer"}))}),le(()=>{S.forEach(w=>w()),v&&(clearInterval(v),v=null)});function p(w){const _=`scene-${w}`;o.setScene(_),n.value&&n.value.sendCommand("changeScene",{scene:w}),j.info(`Scene ${w}`)}function x(){o.previewSource&&(o.setProgram(o.previewSource),j.info("Cut"))}function u(){o.previewSource&&(n.value&&n.value.sendCommand("transition",{type:"fade",duration:500}),o.setProgram(o.previewSource),j.info("Fade"))}function $(){const w=o.activeSources;if(w.length===0)return;const t=(w.findIndex(c=>c.id===o.previewSource)+1)%w.length;o.setPreview(w[t].id)}function y(){if(o.isLive)o.toggleLive(),a.stopStreaming(),j.info("Session ended");else{o.toggleLive(),a.startStreaming();const w=a.enabledDestinations.length;w>0?j.success(`Live! Streaming to ${w} destination${w>1?"s":""}`):j.info("Live! (No streaming destinations configured)")}}function D(){var w;(w=C.value)==null||w.open()}return(w,_)=>(d(),m("div",ts,[e("header",ss,[e("div",ns,[e("div",os,[e("span",{class:R(["w-3 h-3 rounded-full",g.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),_[0]||(_[0]=e("span",{class:"text-xl font-semibold text-r58-mixer"},"Mixer",-1))]),g.value?(d(),m("span",rs,"ON AIR")):U("",!0),g.value&&i.value>0?(d(),m("span",as," Streaming to "+P(i.value)+" platform"+P(i.value>1?"s":""),1)):U("",!0)]),e("div",is,[e("button",{class:"btn btn-sm",onClick:D,title:"Streaming Settings"},[..._[1]||(_[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),e("button",{class:R(["btn",g.value?"btn-danger":"btn-primary"]),onClick:y},P(g.value?"End Session":"Go Live"),3)])]),e("div",ls,[e("div",cs,[E(ye,{ref_key:"vdoEmbedRef",ref:n,profile:"director",class:"h-full"},null,512)]),e("aside",us,[E(Be),e("div",ds,[_[2]||(_[2]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Program Output",-1)),E(ct)])])]),E(Ye),E(es,{ref_key:"streamingSettingsRef",ref:C},null,512)]))}});export{vs as default};
