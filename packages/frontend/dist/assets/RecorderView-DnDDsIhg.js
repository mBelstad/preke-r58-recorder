import{r as m,G as te,H as ee,o as re,p as ke,I as Pe,l as $,J as ue,d as ae,K as oe,g as O,T as ve,w as X,c as d,f as V,A as we,e,q,B as se,t as y,L as $e,k as o,_ as ie,M as Ie,j as Y,F as K,n as z,y as J,N as Se,s as A,u as he,a as Re,z as le,C as De,O as Me,P as _e,Q as Le,R as Ve,S as Ae,U as Ne,m as Ee,i as Be,V as Fe,b as Ge,v as ze,W as Ue}from"./index-DZOHfCnv.js";import{_ as ye}from"./InputPreview.vue_vue_type_script_setup_true_lang-D8Fdr78z.js";import{u as Oe,C as He,P as We,M as qe}from"./ModeLoadingScreen-C0vLlrzC.js";function Ke(){const M=m(!1),x=m(!1);let t=null;const B=te();ee(()=>B.status,i=>{M.value=i==="recording"},{immediate:!0});function p(i){if(M.value)return i.preventDefault(),i.returnValue="Recording in progress. Are you sure you want to leave?",i.returnValue}re(()=>{window.addEventListener("beforeunload",p)}),ke(()=>{window.removeEventListener("beforeunload",p)}),Pe((i,b,_)=>{M.value?(t=()=>_(),x.value=!0,_(!1)):_()});function f(){x.value=!1,M.value=!1,B.stopRecording().finally(()=>{t&&(t(),t=null)})}function v(){x.value=!1,t=null}return{isGuardActive:M,showLeaveConfirmation:x,confirmLeave:f,cancelLeave:v}}const G=m(null),fe=m(!1),xe=m(null),pe=m(null),Qe=10,me=2,Ze=25;function Ye(){const M=$(()=>G.value?G.value.available_gb<me?"critical":G.value.available_gb<Qe?"warning":"ok":"unknown"),x=$(()=>G.value?G.value.available_gb>=me:!0),t=$(()=>{if(!G.value)return null;const i=G.value.available_gb*1024*1024*1024,b=Ze*1024*1024,_=i/b,s=Math.floor(_/3600),S=Math.floor(_%3600/60);return s>24?`${Math.floor(s/24)}d ${s%24}h`:s>0?`${s}h ${S}m`:`${S}m`}),B=$(()=>{switch(M.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),p=$(()=>G.value?M.value==="critical"?`Disk space critically low (${G.value.available_gb.toFixed(1)} GB). Cannot start recording.`:M.value==="warning"?`Low disk space (${G.value.available_gb.toFixed(1)} GB). Estimated recording time: ${t.value}`:null:null);async function f(){fe.value=!0,pe.value=null;try{const i=await ue.getDegradation();if(i.resources&&i.resources.disk_free_gb!==void 0){const b=i.resources.disk_free_gb,_=b*3;G.value={available_gb:b,total_gb:_,used_percent:100-b/_*100,recording_path:"/opt/r58-app/shared/recordings"}}return xe.value=new Date,G.value}catch(i){return pe.value=i.message||"Failed to check disk space",console.error("Failed to check disk space:",i),null}finally{fe.value=!1}}async function v(){return await f(),G.value?M.value==="critical"?{ok:!1,message:`Insufficient disk space (${G.value.available_gb.toFixed(1)} GB). Need at least ${me} GB to start recording.`}:M.value==="warning"?{ok:!0,message:`Low disk space warning: ${G.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${t.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:G,isLoading:fe,lastCheck:xe,error:pe,status:M,statusColor:B,canStartRecording:x,estimatedRecordingTime:t,warningMessage:p,checkDiskSpace:f,preflightCheck:v}}const W=m(localStorage.getItem("r58_audio_feedback")!=="false");let ge=null;function Je(){return ge||(ge=new(window.AudioContext||window.webkitAudioContext)),ge}function H(M,x,t="sine",B=.3){if(W.value)try{const p=Je();p.state==="suspended"&&p.resume();const f=p.createOscillator(),v=p.createGain();f.connect(v),v.connect(p.destination),f.type=t,f.frequency.value=M;const i=p.currentTime;v.gain.setValueAtTime(0,i),v.gain.linearRampToValueAtTime(B,i+.01),v.gain.linearRampToValueAtTime(0,i+x),f.start(i),f.stop(i+x)}catch(p){console.warn("Audio feedback failed:",p)}}function Xe(){W.value&&(H(440,.1,"sine",.2),setTimeout(()=>H(554,.1,"sine",.2),100),setTimeout(()=>H(659,.15,"sine",.25),200))}function et(){W.value&&(H(880,.08,"sine",.3),setTimeout(()=>H(880,.15,"sine",.3),120))}function tt(){W.value&&(H(659,.1,"sine",.25),setTimeout(()=>H(554,.1,"sine",.2),100),setTimeout(()=>H(440,.15,"sine",.2),200))}function at(){W.value&&(H(200,.15,"square",.15),setTimeout(()=>H(180,.2,"square",.15),180))}function nt(){W.value&&(H(1e3,.08,"sine",.2),setTimeout(()=>H(1e3,.08,"sine",.2),150))}function Ce(){W.value&&H(1200,.03,"sine",.1)}function ot(M=50){if(W.value&&"vibrate"in navigator)try{navigator.vibrate(M)}catch{}}function st(){function M(t){W.value=t,localStorage.setItem("r58_audio_feedback",String(t))}function x(){M(!W.value),W.value&&Ce()}return{enabled:W,setEnabled:M,toggle:x,playSuccess:Xe,playError:at,playWarning:nt,playClick:Ce,playRecordStart:et,playRecordStop:tt,vibrate:ot}}const rt={class:"bg-preke-bg-elevated rounded-lg shadow-xl max-w-md w-full p-6"},lt=["placeholder"],it={class:"text-xs text-preke-text-dim mt-2"},ct=ae({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(M,{emit:x}){const t=M,B=x,p=m(""),f=m(null),v=$(()=>{const l=new Date,k=l.toLocaleDateString("en-CA"),u=l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${k}_${u}`}),i=$(()=>t.suggestedName||v.value);ee(()=>t.open,l=>{l&&(p.value=i.value,setTimeout(()=>{var k,u;(k=f.value)==null||k.focus(),(u=f.value)==null||u.select()},100))});function b(){B("confirm",p.value.trim()||i.value)}function _(){B("skip")}function s(){B("cancel")}function S(l){l.key==="Enter"?b():l.key==="Escape"&&s()}return(l,k)=>(o(),oe($e,{to:"body"},[O(ve,{name:"fade"},{default:X(()=>[M.open?(o(),d("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:we(s,["self"]),onKeydown:S},[e("div",rt,[k[1]||(k[1]=e("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),k[2]||(k[2]=e("p",{class:"text-preke-text-dim text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),q(e("input",{ref_key:"inputRef",ref:f,"onUpdate:modelValue":k[0]||(k[0]=u=>p.value=u),type:"text",placeholder:i.value,class:"w-full px-4 py-2 bg-preke-bg-surface border border-preke-bg-surface rounded-lg text-preke-text placeholder-preke-text-dim focus:outline-none focus:ring-2 focus:ring-preke-gold"},null,8,lt),[[se,p.value]]),e("p",it," Suggested: "+y(i.value),1),e("div",{class:"flex justify-between mt-6"},[e("button",{onClick:_,class:"text-sm text-preke-text-dim hover:text-preke-text transition-colors"}," Skip (use default) "),e("div",{class:"flex gap-3"},[e("button",{onClick:s,class:"btn"}," Cancel "),e("button",{onClick:b,class:"btn btn-primary"}," Start Recording ")])])])],32)):V("",!0)]),_:1})]))}}),dt=ie(ct,[["__scopeId","data-v-2eeca4e8"]]),ut={class:"recorder-controls"},vt={key:0,class:"recorder-controls__duration"},ft=["disabled","title"],pt={key:0,class:"recorder-controls__spinner"},mt={key:0,class:"recorder-controls__icon recorder-controls__icon--stop"},gt={key:1,class:"recorder-controls__icon recorder-controls__icon--record"},bt={class:"recorder-controls__hint"},_t=ae({__name:"RecorderControls",setup(M){const x=te(),{register:t}=Ie(),{preflightCheck:B,status:p,canStartRecording:f}=Ye(),{playRecordStart:v,playRecordStop:i,playError:b,playWarning:_,vibrate:s}=st(),S=m(null),l=m(!1),k=m(!1),u=m(!1),w=m(!1),I=m(void 0),C=$(()=>x.status==="recording"),F=$(()=>x.status==="starting"),U=$(()=>x.status==="stopping"),Q=$(()=>x.formattedDuration),g=$(()=>F.value||U.value||k.value),T=$(()=>F.value?"Starting recording...":U.value?"Stopping recording...":k.value?"Checking disk space...":!C.value&&!f.value?"Insufficient disk space":"");let j=null;re(()=>{j=t({key:" ",description:"Toggle Recording",action:N,context:"recorder",enabled:()=>!F.value&&!U.value})}),ke(()=>{j&&j()});async function N(){C.value?Z():await D()}async function D(n){k.value=!0;try{const L=await B();if(!L.ok){b(),s(200),Y.error("Cannot start recording",L.message||"Preflight check failed");return}if(L.message&&p.value==="warning"&&(_(),Y.warning("Low disk space",L.message)),w.value&&!n){I.value=void 0,u.value=!0;return}await c(n||I.value)}finally{k.value=!1}}async function c(n){try{await x.startRecording(n);const L=n||x.sessionId;v(),s([50,30,50]),Y.success("Recording started",`Session: ${L}`)}catch(L){b(),s(200),Y.error("Failed to start recording",L.message||"Unknown error",{label:"Retry",onClick:()=>D(n)})}}function P(n){u.value=!1,I.value=n,D(n)}function r(){u.value=!1,I.value=void 0,D()}function a(){u.value=!1,k.value=!1}async function R(){try{await x.stopRecording(),i(),s(100),Y.success("Recording stopped")}catch(n){b(),s(200),Y.error("Failed to stop recording",n.message||"Unknown error")}}function Z(){var n;l.value=!1,(n=S.value)==null||n.open(),setTimeout(()=>{l.value=!0},500)}function ne(){l.value&&R()}async function h(){C.value?Z():await c()}return(n,L)=>(o(),d(K,null,[e("div",ut,[C.value?(o(),d("div",vt,y(Q.value),1)):V("",!0),e("button",{onClick:h,disabled:g.value,class:z(["recorder-controls__btn",C.value?"recorder-controls__btn--stop":"recorder-controls__btn--start"]),title:T.value||(C.value?"Stop Recording (Space)":"Start Recording (Space)")},[F.value||U.value||k.value?(o(),d("span",pt)):(o(),d(K,{key:1},[C.value?(o(),d("span",mt)):(o(),d("span",gt))],64)),e("span",null,y(k.value?"Checking...":C.value?"Stop":"Start Recording"),1)],10,ft),e("span",bt,[L[0]||(L[0]=J(" Press ",-1)),L[1]||(L[1]=e("kbd",null,"Space",-1)),J(" to "+y(C.value?"stop":"start"),1)])]),O(Se,{ref_key:"stopConfirmDialog",ref:S,title:"Stop Recording?",message:`You have been recording for ${Q.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:ne},null,8,["message"]),O(dt,{open:u.value,onConfirm:P,onSkip:r,onCancel:a},null,8,["open"])],64))}}),kt=ie(_t,[["__scopeId","data-v-1e32920d"]]),de=m(localStorage.getItem("r58_performance_mode")==="true"),be=m(localStorage.getItem("r58_performance_mode_auto")!=="false"),ht=3,yt=100,xt=500;function Ct(){const M=te(),x=$(()=>de.value?!0:be.value&&M.isRecording?M.inputs.filter(S=>S.isRecording).length>=ht:!1),t=$(()=>x.value?xt:yt);ee(x,s=>{s?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function B(s){de.value=s,localStorage.setItem("r58_performance_mode",String(s))}function p(s){be.value=s,localStorage.setItem("r58_performance_mode_auto",String(s))}function f(){B(!de.value)}function v(s,S){let l=0,k=null;return(...u)=>{const w=Date.now(),I=S??t.value,C=w-l;C>=I?(l=w,s(...u)):k||(k=window.setTimeout(()=>{l=Date.now(),k=null,s(...u)},I-C))}}function i(s,S){let l=null;return(...k)=>{l&&clearTimeout(l),l=window.setTimeout(()=>{s(...k),l=null},S??t.value)}}function b(s){return x.value?window.setTimeout(()=>s(performance.now()),t.value):requestAnimationFrame(s)}function _(s){x.value?clearTimeout(s):cancelAnimationFrame(s)}return{enabled:de,autoEnable:be,isActive:x,updateInterval:t,setEnabled:B,setAutoEnable:p,toggle:f,throttle:v,debounce:i,requestFrame:b,cancelFrame:_}}const wt=["title"],$t={class:"flex items-center gap-1.5 text-sm"},St={key:0,class:"flex items-center gap-1.5 text-sm"},Rt={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},Mt={class:"font-mono"},Bt=ae({__name:"RecordingHealth",setup(M,{expose:x}){const t=te(),{isActive:B}=Ct(),p=m({}),f=m(0),v=m(0),i=m(0);let b=null;function _(){const u={};let w=0;t.inputs.forEach(C=>{u[C.id]=C.bytesWritten;const F=p.value[C.id]||0;w+=C.bytesWritten-F});const I=B.value?2:1;f.value=Math.round(w/(1024*1024)/I*10)/10,p.value=u}ee(()=>t.isRecording,u=>{if(u){p.value={},f.value=0,v.value=0,i.value=0;const w=B.value?2e3:1e3;b=window.setInterval(_,w)}else b&&(clearInterval(b),b=null)},{immediate:!0}),ee(B,u=>{if(t.isRecording&&b){clearInterval(b);const w=u?2e3:1e3;b=window.setInterval(_,w)}}),ke(()=>{b&&clearInterval(b)});const s=$(()=>t.isRecording?i.value>0||v.value>90?"critical":f.value<1||v.value>70?"warning":"healthy":"idle"),S=$(()=>{switch(s.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});$(()=>{switch(s.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const l=$(()=>{if(!t.isRecording)return"Not recording";const u=[`Write speed: ${f.value} MB/s`,`Buffer: ${v.value}%`];return i.value>0&&u.push(`Frames dropped: ${i.value}`),u.join(`
`)});function k(u){u.buffer_percent!==void 0&&(v.value=u.buffer_percent),u.frames_dropped!==void 0&&(i.value=u.frames_dropped)}return x({updateFromMetrics:k}),(u,w)=>A(t).isRecording?(o(),d("div",{key:0,class:z(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":S.value==="emerald","bg-amber-500/10":S.value==="amber","bg-red-500/10":S.value==="red"}]),title:l.value},[e("span",{class:z(["w-2 h-2 rounded-full",S.value==="emerald"?"bg-emerald-500":"",S.value==="amber"?"bg-amber-500 animate-pulse":"",S.value==="red"?"bg-red-500 animate-pulse":""])},null,2),e("div",$t,[w[0]||(w[0]=e("svg",{class:"w-3.5 h-3.5 text-preke-text-dim",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),e("span",{class:z(["font-mono",S.value==="emerald"?"text-emerald-400":"",S.value==="amber"?"text-amber-400":"",S.value==="red"?"text-red-400":""])},y(f.value)+" MB/s ",3)]),v.value>0?(o(),d("div",St,[w[1]||(w[1]=e("span",{class:"text-preke-text-dim"},"Buf:",-1)),e("span",{class:z(["font-mono",v.value<50?"text-emerald-400":"",v.value>=50&&v.value<80?"text-amber-400":"",v.value>=80?"text-red-400":""])},y(v.value)+"% ",3)])):V("",!0),i.value>0?(o(),d("div",Rt,[w[2]||(w[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",Mt,y(i.value)+" dropped",1)])):V("",!0)],10,wt)):V("",!0)}}),Tt={key:0,class:"h-full flex items-center justify-center"},jt={key:1,class:"input-grid"},Pt={key:0,class:"input-grid__warning"},It=["data-count"],Dt=["title","onClick"],Lt={key:1,class:"w-full h-full flex items-center justify-center bg-preke-bg-surface"},Vt={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},At={class:"flex items-center justify-between"},Nt={class:"flex items-center gap-2"},Et={class:"font-medium"},Ft={key:0,class:"flex items-center gap-2 text-sm"},Gt={class:"text-preke-text-dim"},zt={class:"enlarged-modal__info"},Ut={class:"flex items-center gap-3"},Ot={class:"font-semibold text-lg"},Ht={key:0,class:"px-2 py-0.5 text-xs font-bold bg-preke-red/20 text-preke-red rounded"},Wt={class:"flex items-center gap-4 text-sm"},qt={class:"text-preke-text-dim"},Kt=ae({__name:"InputGrid",emits:["allVideosReady"],setup(M,{emit:x}){const t=te(),B=he(),p=x,f=m(new Set),v=m(null);function i(g){v.value=g}function b(){v.value=null}const _=m({});function s(g){f.value.add(g),console.log(`[InputGrid] Video ready: ${g} (${f.value.size}/${u.value.length})`),f.value.size>=u.value.length&&(console.log("[InputGrid] All videos ready!"),p("allVideosReady"))}function S(g,T){_.value[g]=T,console.log(`[InputGrid] Aspect ratio for ${g}: ${T.toFixed(3)}`)}function l(g){return{aspectRatio:`${_.value[g]||1.7777777777777777}`}}ee(()=>u.value.length,()=>{f.value.clear()});const k=$(()=>{var g;return((g=B.capabilities)==null?void 0:g.current_mode)==="recorder"}),u=$(()=>t.inputs.filter(g=>g.hasSignal)),w=$(()=>t.framerateMismatch);function I(g){return g.isRecording?"border-preke-red ring-2 ring-preke-red/20":g.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-preke-bg-surface/50 opacity-60"}function C(g){return g.hasSignal?g.framerate>=29?"excellent":g.framerate>=24?"good":"unstable":"none"}function F(g){switch(C(g)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-preke-text-dim"}}function U(g){if(g===0)return"0 B";const T=1024,j=["B","KB","MB","GB"],N=Math.floor(Math.log(g)/Math.log(T));return parseFloat((g/Math.pow(T,N)).toFixed(1))+" "+j[N]}function Q(g){if(!g.hasSignal)return`${g.label}: No signal detected`;const T=[`${g.label}`,`Resolution: ${g.resolution}`,`Framerate: ${g.framerate} fps`,`Quality: ${C(g)}`];return g.isRecording&&T.push(`Written: ${U(g.bytesWritten)}`),T.join(`
`)}return(g,T)=>u.value.length===0?(o(),d("div",Tt,[...T[1]||(T[1]=[Re('<div class="text-center text-preke-text-dim" data-v-53f60619><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-53f60619><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" data-v-53f60619></path></svg><p class="text-lg font-medium" data-v-53f60619>No Video Sources Connected</p><p class="text-sm mt-2" data-v-53f60619>Connect HDMI cables to begin recording</p></div>',1)])])):(o(),d("div",jt,[w.value?(o(),d("div",Pt,[T[2]||(T[2]=e("svg",{class:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,y(w.value),1)])):V("",!0),e("div",{class:"input-grid__container","data-count":u.value.length},[(o(!0),d(K,null,le(u.value,j=>(o(),d("div",{key:j.id,class:z(["input-grid__tile",I(j)]),style:De(l(j.id)),title:Q(j),onClick:N=>i(j)},[k.value?(o(),oe(ye,{key:0,"input-id":j.id,class:"w-full h-full",onVideoReady:N=>s(j.id),onAspectRatio:N=>S(j.id,N)},null,8,["input-id","onVideoReady","onAspectRatio"])):(o(),d("div",Lt,[...T[3]||(T[3]=[e("div",{class:"text-center"},[e("svg",{class:"w-8 h-8 mx-auto mb-2 text-preke-text-dim/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})]),e("span",{class:"text-xs text-preke-text-dim/70"},"Mixer mode")],-1)])])),e("div",Vt,[e("div",At,[e("div",Nt,[e("span",{class:z(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":C(j)==="excellent"||C(j)==="good","bg-amber-500 animate-pulse":C(j)==="unstable","bg-preke-text-dim":C(j)==="none"}])},null,2),e("span",Et,y(j.label),1)]),j.hasSignal?(o(),d("div",Ft,[e("span",Gt,y(j.resolution),1),e("span",{class:z(F(j))},y(j.framerate)+"fps",3)])):V("",!0)])])],14,Dt))),128))],8,It),(o(),oe($e,{to:"body"},[O(ve,{name:"enlarged"},{default:X(()=>[v.value?(o(),d("div",{key:0,class:"enlarged-modal",onClick:b},[e("div",{class:"enlarged-modal__content",onClick:T[0]||(T[0]=we(()=>{},["stop"]))},[k.value?(o(),oe(ye,{key:0,"input-id":v.value.id,class:"w-full h-full"},null,8,["input-id"])):V("",!0),e("div",zt,[e("div",Ut,[e("span",{class:z(["w-2.5 h-2.5 rounded-full",{"bg-emerald-500":C(v.value)==="excellent"||C(v.value)==="good","bg-amber-500 animate-pulse":C(v.value)==="unstable","bg-preke-text-dim":C(v.value)==="none"}])},null,2),e("span",Ot,y(v.value.label),1),v.value.isRecording?(o(),d("span",Ht," REC ")):V("",!0)]),e("div",Wt,[e("span",qt,y(v.value.resolution),1),e("span",{class:z(F(v.value))},y(v.value.framerate)+"fps",3)])]),e("button",{class:"enlarged-modal__close",onClick:b,title:"Close (or click outside)"},[...T[4]||(T[4]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):V("",!0)]),_:1})]))]))}}),Qt=ie(Kt,[["__scopeId","data-v-53f60619"]]),Zt={key:0,class:"py-8 text-center text-preke-text-muted"},Yt={key:1,class:"camera-setup"},Jt={class:"camera-list"},Xt={class:"list-header"},ea=["disabled"],ta={key:0,class:"empty-state"},aa={key:1,class:"camera-items"},na={class:"camera-item__info"},oa={class:"camera-item__header"},sa={class:"camera-item__name"},ra={class:"camera-item__details"},la={class:"camera-item__type"},ia={class:"camera-item__ip"},ca={class:"camera-item__actions"},da=["onClick","disabled"],ua={key:0,class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},va={key:1,class:"spinner"},fa=["onClick","disabled"],pa=["onClick","disabled"],ma={key:0,class:"camera-form"},ga={class:"form-header"},ba={class:"form-title"},_a={class:"form-content"},ka={class:"form-group"},ha={class:"form-group"},ya=["value"],xa={class:"form-group"},Ca={class:"form-group"},wa=["placeholder"],$a={class:"form-hint"},Sa={class:"form-group"},Ra={class:"form-checkbox"},Ma={class:"form-actions"},Ba={class:"flex items-center justify-between w-full"},Ta={key:0,class:"text-sm text-amber-400"},ja={key:1,class:"text-sm text-preke-text-muted"},Pa={class:"flex gap-3"},Ia=["disabled"],Da=ae({__name:"CameraSetupModal",emits:["close","updated"],setup(M,{expose:x,emit:t}){const B=t,p=m(null),f=Me(),v=m(!1),i=m(!1),b=m(null),_=m([]),s=m(null),S=[{value:"blackmagic",label:"Blackmagic Design Studio Camera 4K Pro"},{value:"obsbot_tail2",label:"OBSbot Tail 2"}],l=m({name:"",type:"blackmagic",ip:"",port:void 0,enabled:!0}),k={blackmagic:80,obsbot_tail2:52381},u=$(()=>s.value!==null),w=m(!1);async function I(){v.value=!0;try{const r=await ue.cameras.getConfig();_.value=r.cameras.map(a=>({name:a.name,type:a.type,ip:a.ip,port:a.port,enabled:a.enabled??!0})),w.value=!1}catch(r){console.error("[CameraSetup] Failed to load config:",r),f.error("Failed to load camera configuration")}finally{v.value=!1}}function C(){l.value={name:"",type:"blackmagic",ip:"",port:void 0,enabled:!0},s.value=null}function F(r){s.value=r,l.value={..._.value[r]}}function U(){C()}function Q(){C(),s.value=-1}async function g(r){confirm(`Delete camera "${_.value[r].name}"?`)&&(_.value.splice(r,1),w.value=!0,await D())}async function T(r){b.value=r.name;try{(await ue.cameras.getStatus(r.name)).connected?f.success(`${r.name} is connected!`):f.warning(`${r.name} is not connected`)}catch{try{const R=await fetch(`http://${r.ip}:${r.port||k[r.type]}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(3e3)});f.info(`${r.name}: IP ${r.ip} is reachable`)}catch{f.error(`${r.name}: Cannot reach ${r.ip}`)}}finally{b.value=null}}function j(){return l.value.name.trim()?l.value.ip.trim()?/^(\d{1,3}\.){3}\d{1,3}$/.test(l.value.ip)?_.value.findIndex((R,Z)=>R.name===l.value.name&&Z!==s.value)>=0?(f.error("Camera name already exists"),!1):!0:(f.error("Invalid IP address format"),!1):(f.error("Camera IP address is required"),!1):(f.error("Camera name is required"),!1)}function N(){j()&&(l.value.port||(l.value.port=k[l.value.type]),s.value===-1?_.value.push({...l.value}):s.value!==null&&s.value>=0&&(_.value[s.value]={...l.value}),w.value=!0,C())}async function D(){i.value=!0;try{await ue.cameras.updateConfig(_.value),f.success("Camera configuration saved!"),w.value=!1,B("updated")}catch(r){console.error("[CameraSetup] Failed to save config:",r),f.error("Failed to save configuration: "+(r.message||"Unknown error"))}finally{i.value=!1}}function c(){var r;(r=p.value)==null||r.open(),I()}function P(){var r;w.value&&!confirm("You have unsaved changes. Close anyway?")||((r=p.value)==null||r.close(),C(),w.value=!1,B("close"))}return x({open:c,close:P}),re(()=>{I()}),(r,a)=>(o(),oe(Ve,{ref_key:"modalRef",ref:p,title:"Camera Setup",size:"xl",onClose:P},{header:X(()=>[...a[5]||(a[5]=[e("div",{class:"flex items-center justify-between w-full"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-preke-text"},"Camera Setup"),e("p",{class:"text-sm text-preke-text-muted mt-1"}," Configure external cameras for control ")])],-1)])]),footer:X(()=>[e("div",Ba,[w.value?(o(),d("div",Ta," You have unsaved changes ")):(o(),d("div",ja,y(_.value.length)+" camera"+y(_.value.length!==1?"s":"")+" configured ",1)),e("div",Pa,[e("button",{onClick:P,class:"btn-secondary"}," Close "),e("button",{onClick:D,disabled:!w.value||i.value,class:"btn-primary"},y(i.value?"Saving...":"Save Configuration"),9,Ia)])])]),default:X(()=>[v.value?(o(),d("div",Zt," Loading camera configuration... ")):(o(),d("div",Yt,[e("div",Jt,[e("div",Xt,[a[7]||(a[7]=e("h3",{class:"list-title"},"Configured Cameras",-1)),e("button",{onClick:Q,class:"btn-add",disabled:u.value},[...a[6]||(a[6]=[e("svg",{class:"btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),J(" Add Camera ",-1)])],8,ea)]),_.value.length===0&&!u.value?(o(),d("div",ta,[...a[8]||(a[8]=[e("svg",{class:"empty-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"empty-text"},"No cameras configured",-1),e("p",{class:"empty-hint"},'Click "Add Camera" to get started',-1)])])):(o(),d("div",aa,[(o(!0),d(K,null,le(_.value,(R,Z)=>{var ne;return o(),d("div",{key:Z,class:z(["camera-item",{"camera-item--disabled":!R.enabled}])},[e("div",na,[e("div",oa,[e("span",sa,y(R.name),1),e("span",{class:z(["camera-item__badge",R.enabled?"camera-item__badge--enabled":"camera-item__badge--disabled"])},y(R.enabled?"Enabled":"Disabled"),3)]),e("div",ra,[e("span",la,y(((ne=S.find(h=>h.value===R.type))==null?void 0:ne.label)||R.type),1),e("span",ia,y(R.ip)+":"+y(R.port||k[R.type]),1)])]),e("div",ca,[e("button",{onClick:h=>T(R),disabled:b.value===R.name,class:"btn-test",title:"Test Connection"},[b.value!==R.name?(o(),d("svg",ua,[...a[9]||(a[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])])):(o(),d("span",va))],8,da),e("button",{onClick:h=>F(Z),disabled:u.value,class:"btn-edit",title:"Edit"},[...a[10]||(a[10]=[e("svg",{class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,fa),e("button",{onClick:h=>g(Z),disabled:u.value,class:"btn-delete",title:"Delete"},[...a[11]||(a[11]=[e("svg",{class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,pa)])],2)}),128))]))]),u.value?(o(),d("div",ma,[e("div",ga,[e("h3",ba,y(s.value===-1?"Add Camera":"Edit Camera"),1),e("button",{onClick:U,class:"btn-cancel-form"},"Cancel")]),e("div",_a,[e("div",ka,[a[12]||(a[12]=e("label",{class:"form-label"},"Camera Name *",-1)),q(e("input",{"onUpdate:modelValue":a[0]||(a[0]=R=>l.value.name=R),type:"text",class:"form-input",placeholder:"e.g., BMD Cam 1"},null,512),[[se,l.value.name]])]),e("div",ha,[a[13]||(a[13]=e("label",{class:"form-label"},"Camera Type *",-1)),q(e("select",{"onUpdate:modelValue":a[1]||(a[1]=R=>l.value.type=R),class:"form-input"},[(o(),d(K,null,le(S,R=>e("option",{key:R.value,value:R.value},y(R.label),9,ya)),64))],512),[[_e,l.value.type]])]),e("div",xa,[a[14]||(a[14]=e("label",{class:"form-label"},"IP Address *",-1)),q(e("input",{"onUpdate:modelValue":a[2]||(a[2]=R=>l.value.ip=R),type:"text",class:"form-input",placeholder:"192.168.1.101"},null,512),[[se,l.value.ip]]),a[15]||(a[15]=e("p",{class:"form-hint"},"Camera's network IP address",-1))]),e("div",Ca,[a[16]||(a[16]=e("label",{class:"form-label"},"Port",-1)),q(e("input",{"onUpdate:modelValue":a[3]||(a[3]=R=>l.value.port=R),type:"number",class:"form-input",placeholder:String(k[l.value.type])},null,8,wa),[[se,l.value.port,void 0,{number:!0}]]),e("p",$a,"Default: "+y(k[l.value.type])+" for "+y(l.value.type),1)]),e("div",Sa,[e("label",Ra,[q(e("input",{"onUpdate:modelValue":a[4]||(a[4]=R=>l.value.enabled=R),type:"checkbox",class:"checkbox"},null,512),[[Le,l.value.enabled]]),a[17]||(a[17]=e("span",null,"Enabled",-1))]),a[18]||(a[18]=e("p",{class:"form-hint"},"Disable to keep configuration but not use the camera",-1))]),e("div",Ma,[e("button",{onClick:N,class:"btn-save-form"},y(s.value===-1?"Add Camera":"Update Camera"),1),e("button",{onClick:U,class:"btn-cancel-form"}," Cancel ")])])])):V("",!0)]))]),_:1},512))}}),La=ie(Da,[["__scopeId","data-v-d42e0adf"]]),Va={class:"sidebar"},Aa={class:"sidebar__card sidebar__card--header"},Na={class:"connection-row"},Ea={class:"connection-status"},Fa={class:"connection-label"},Ga={key:0,class:"connection-latency"},za=["disabled"],Ua={class:"sidebar__card sidebar__card--recording"},Oa={class:"recording__duration"},Ha={class:"recording__meta"},Wa={key:0,class:"sidebar__card sidebar__card--warning"},qa={class:"warning__text"},Ka={key:1,class:"sidebar__card sidebar__card--davinci"},Qa={class:"davinci__buttons"},Za=["disabled"],Ya=["disabled"],Ja=["disabled"],Xa={class:"sidebar__card"},en={key:0,class:"cameras"},tn={class:"camera__header"},an=["onClick","disabled"],nn={key:1,class:"cameras-empty"},on={key:0,class:"sidebar__card"},sn={key:1,class:"sidebar__card"},rn=ae({__name:"SessionInfoV2",setup(M){const x=Be(),t=te(),B=he(),p=Me(),{state:f,latencyMs:v}=Ae(),{connectionMethod:i}=Ne(),b=$(()=>{const h=f.value==="connected",n=f.value==="connecting",L=f.value==="degraded";if(h){let E="";return i.value==="relay"?E="Relay":i.value==="p2p"?E="P2P":i.value==="local"&&(E="Local"),{status:"online",color:"green",label:E||"Connected",latency:v.value,pulse:!1}}return n?{status:"connecting",color:"amber",label:"Connecting...",latency:null,pulse:!0}:L?{status:"degraded",color:"amber",label:"Slow",latency:v.value,pulse:!1}:{status:"offline",color:"red",label:"Offline",latency:null,pulse:!0}}),_=$(()=>t.currentSession),s=$(()=>t.activeInputs),S=$(()=>t.isRecording),l=$(()=>t.inputs.filter(h=>h.isRecording)),k=m("");re(()=>{const n=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,".");k.value=`Session ${n}`});const{cameras:u,loadCameras:w}=Oe(),I=m(null),C=m(null),F=m(null),U=m(!1);re(async()=>{await w()});function Q(h){var n;I.value=h,(n=C.value)==null||n.open()}function g(){I.value=null}function T(){var h;(h=F.value)==null||h.open()}function j(){w()}const N=$(()=>{const h=B.capabilities;if(!h)return null;const n=h.storage_total_gb||1,L=h.storage_available_gb||0,E=n-L,ce=Math.round(E/n*100),Te=(s.value.length||1)*8,je=L/Te;return{freeGB:Math.round(L),totalGB:Math.round(n),percent:ce,hoursRemaining:Math.round(je*10)/10,isLow:ce>85,isCritical:ce>95}});function D(){x.push({name:"admin",query:{tab:"settings"}})}const c=$(()=>Ee()),P=m(!1),r=$(()=>{const h=_.value;return h!=null&&h.id?`Preke_${h.id}`:`Preke_${k.value.replace(/\s+/g,"_")}`}),a=window.electronAPI;async function R(){if(a!=null&&a.davinciOpenProject){P.value=!0,p.info("Opening DaVinci Resolve...");try{const h=await a.davinciOpenProject(r.value);h.success?p.success(`Opened project: ${h.projectName}`):p.error(h.error||"Failed to open DaVinci project")}catch(h){console.error("DaVinci error:",h),p.error("Failed to connect to DaVinci Resolve")}finally{P.value=!1}}}async function Z(){if(a!=null&&a.davinciCreateMulticam){P.value=!0;try{a.davinciOpenProject&&await a.davinciOpenProject(r.value);const h=await a.davinciCreateMulticam({projectName:r.value,clipName:`Multicam_${k.value.replace(/\s+/g,"_")}`,syncMethod:"timecode"});h.success?p.success(`Created timeline: ${h.timelineName}`):p.error(h.error||"Failed to create multicam timeline")}catch(h){console.error("DaVinci error:",h),p.error("Failed to create multicam timeline")}finally{P.value=!1}}}async function ne(){if(a!=null&&a.davinciRefreshClips){P.value=!0,p.info("Refreshing growing clips...");try{const h=await a.davinciRefreshClips();if(h.success){const n=h.clipsRefreshed||0;p.success(`Refreshed ${n} clip${n!==1?"s":""}`)}else p.error(h.error||"Failed to refresh clips")}catch(h){console.error("DaVinci refresh error:",h),p.error("Failed to refresh clips")}finally{P.value=!1}}}return(h,n)=>{var L;return o(),d("div",Va,[e("div",Aa,[e("div",Na,[e("div",Ea,[e("span",{class:z(["connection-dot",[`connection-dot--${b.value.color}`,{"connection-dot--pulse":b.value.pulse}]])},null,2),e("span",Fa,y(b.value.label),1),b.value.latency?(o(),d("span",Ga,y(b.value.latency)+"ms ",1)):V("",!0)])]),n[3]||(n[3]=e("div",{class:"sidebar__divider"},null,-1)),n[4]||(n[4]=e("label",{class:"sidebar__label"},"Session Name",-1)),q(e("input",{"onUpdate:modelValue":n[0]||(n[0]=E=>k.value=E),type:"text",class:"sidebar__input",placeholder:"Session 06.01.2026",disabled:S.value},null,8,za),[[se,k.value]])]),S.value?(o(),d(K,{key:0},[e("div",Ua,[n[5]||(n[5]=e("div",{class:"recording__header"},[e("span",{class:"recording__dot"}),e("span",{class:"recording__label"},"Recording")],-1)),e("div",Oa,y(A(t).formattedDuration),1),e("div",Ha,y(l.value.length)+" camera"+y(l.value.length!==1?"s":"")+" recording ",1)]),(L=N.value)!=null&&L.isLow?(o(),d("div",Wa,[n[7]||(n[7]=e("span",{class:"warning__icon"},"⚠️",-1)),e("div",qa,[n[6]||(n[6]=e("strong",null,"Low storage",-1)),e("span",null,y(N.value.freeGB)+" GB remaining",1)])])):V("",!0),c.value?(o(),d("div",Ka,[n[8]||(n[8]=Re('<div class="davinci__header" data-v-9c962cbb><svg class="davinci__icon" viewBox="0 0 24 24" fill="currentColor" data-v-9c962cbb><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" data-v-9c962cbb></path></svg><span class="davinci__label" data-v-9c962cbb>DaVinci Resolve</span></div><p class="davinci__hint" data-v-9c962cbb>Edit while recording (mount R58 recordings via SMB)</p>',2)),e("div",Qa,[e("button",{onClick:R,disabled:P.value,class:"davinci__btn"},y(P.value?"Opening...":"Open Project"),9,Za),e("button",{onClick:Z,disabled:P.value,class:"davinci__btn davinci__btn--secondary"}," Create Multicam ",8,Ya),e("button",{onClick:ne,disabled:P.value,class:"davinci__btn davinci__btn--secondary",title:"Refresh growing clips to update duration"},y(P.value?"Refreshing...":"Refresh Clips"),9,Ja)])])):V("",!0)],64)):(o(),d(K,{key:1},[e("div",Xa,[e("div",{class:"sidebar__label"},[n[10]||(n[10]=J(" Camera Controls ",-1)),e("button",{onClick:T,class:"camera-setup-btn",title:"Setup Cameras"},[...n[9]||(n[9]=[e("svg",{class:"camera-setup-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])])]),A(u).length>0?(o(),d("div",en,[(o(!0),d(K,null,le(A(u),E=>(o(),d("div",{key:E.name,class:"camera"},[e("div",tn,[J(y(E.name)+" ",1),e("span",{class:z(["camera__status",E.connected?"camera__status--connected":"camera__status--disconnected"])},y(E.connected?"●":"○"),3)]),e("button",{class:"camera__control-btn",onClick:ce=>Q(E.name),disabled:!E.connected},[...n[11]||(n[11]=[e("svg",{class:"camera__control-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),e("span",null,"Controls",-1)])],8,an)]))),128))])):(o(),d("div",nn,[n[12]||(n[12]=e("p",{class:"cameras-empty__text"},"No cameras configured",-1)),e("button",{onClick:T,class:"cameras-empty__btn"}," Setup Cameras ")]))]),O(He,{ref_key:"cameraModalRef",ref:C,"camera-name":I.value,onClose:g},null,8,["camera-name"]),O(La,{ref_key:"cameraSetupModalRef",ref:F,onUpdated:j},null,512),U.value?(o(),d("div",on,[O(We,{"camera-name":I.value,onClose:n[1]||(n[1]=E=>U.value=!1)},null,8,["camera-name"])])):(o(),d("div",sn,[n[14]||(n[14]=e("div",{class:"sidebar__label"},"PTZ Controller",-1)),e("button",{onClick:n[2]||(n[2]=E=>U.value=!0),class:"sidebar__btn",title:"Open PTZ Controller (Gamepad/Joystick)"},[...n[13]||(n[13]=[e("svg",{class:"sidebar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1),J(" Open PTZ Controller ",-1)])])])),e("div",{class:"sidebar__card"},[n[16]||(n[16]=e("div",{class:"sidebar__label"},"Quick Actions",-1)),e("button",{onClick:D,class:"sidebar__btn"},[...n[15]||(n[15]=[e("svg",{class:"sidebar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),J(" Configure Inputs ",-1)])])])],64))])}}}),ln=ie(rn,[["__scopeId","data-v-9c962cbb"]]),cn={class:"h-full flex flex-col"},dn={class:"recorder-header"},un={class:"recorder-header__left"},vn={class:"recorder-header__title"},fn={key:0,class:"recorder-header__badge"},pn={class:"flex-1 flex min-h-0 overflow-hidden"},mn={class:"flex-1 min-h-0 min-w-0 p-3 overflow-hidden"},gn={class:"w-72 flex-shrink-0 border-l border-preke-surface-border bg-preke-surface/80 backdrop-blur-lg p-4 overflow-y-auto"},bn={class:"mb-4"},_n={key:0,class:"mt-2 space-y-3 p-3 bg-preke-bg-base border border-preke-border rounded-lg"},kn=["value"],hn={key:0},yn=["value"],xn=["value"],Cn={key:1,class:"p-3 bg-preke-bg-elevated border border-preke-border-gold rounded"},wn={class:"flex gap-2"},$n=["disabled"],Sn={key:2,class:"text-xs text-preke-text-muted"},Rn={class:"font-mono"},Mn=ae({__name:"RecorderView",setup(M){const x=Be(),t=te(),B=he(),{showLeaveConfirmation:p,confirmLeave:f,cancelLeave:v}=Ke(),i=m(!1),b=m(!1),_=m(""),s=m(!1);function S(){x.push("/")}const l=$(()=>t.status==="recording"),k=$(()=>t.formattedDuration),u=m(!0),w=m(!1),I=m(!1),C=$(()=>w.value&&I.value);function F(){u.value=!1}async function U(){var c;if(!Fe())return;await B.fetchCapabilities();const D=(c=B.capabilities)==null?void 0:c.current_mode;if(D&&D!=="recorder"){console.log("[Recorder] Not in recorder mode, switching...");try{(await fetch(await Ge("/api/mode/recorder"),{method:"POST"})).ok&&(await B.fetchCapabilities(),Y.success("Switched to Recorder mode"))}catch(P){console.warn("[Recorder] Failed to switch mode:",P)}}}function Q(){console.log("[Recorder] All videos ready!"),I.value=!0}async function g(){t.selectedClient?await t.loadProjects(t.selectedClient.id):t.projects=[],t.setProject(null)}async function T(D){const c=D.target.value;if(c==="new")b.value=!0;else if(c){const P=t.projects.find(r=>r.id===parseInt(c));t.setProject(P)}else t.setProject(null)}async function j(){if(!t.selectedClient||!_.value.trim()){Y.error("Please enter a project name");return}s.value=!0;try{const D=await t.createProject(t.selectedClient.id,_.value.trim(),t.recordingType||"podcast");await t.loadProjects(t.selectedClient.id),t.setProject(D),b.value=!1,_.value="",Y.success("Project created")}catch(D){Y.error(D.message||"Failed to create project")}finally{s.value=!1}}re(async()=>{const D=performance.now();await Promise.all([U(),t.fetchInputs(),t.fetchStatus(),t.loadClients()]);const c=t.inputs.filter(P=>P.hasSignal).length;console.log(`[Recorder] Data loaded: ${t.inputs.length} inputs, ${c} with signal (${Math.round(performance.now()-D)}ms)`),w.value=!0,c===0&&(I.value=!0)});const N=m(null);return ee(p,D=>{var c,P;D?(c=N.value)==null||c.open():(P=N.value)==null||P.close()}),(D,c)=>(o(),d(K,null,[O(ve,{name:"fade"},{default:X(()=>[u.value?(o(),oe(qe,{key:0,mode:"recorder","content-ready":C.value,"min-time":1500,"max-time":5e3,"show-cancel":!0,onReady:F,onCancel:S},null,8,["content-ready"])):V("",!0)]),_:1}),O(ve,{name:"content-fade"},{default:X(()=>{var P;return[q(e("div",cn,[e("header",dn,[e("div",un,[e("div",vn,[e("span",{class:z(["recorder-header__indicator",{"recorder-header__indicator--active":l.value}])},null,2),c[6]||(c[6]=e("span",{class:"recorder-header__label"},"Recorder",-1))]),l.value?(o(),d("span",fn," REC ")):V("",!0),O(Bt)]),O(kt)]),e("div",pn,[e("div",mn,[O(Qt,{onAllVideosReady:Q})]),e("aside",gn,[e("div",bn,[e("button",{onClick:c[0]||(c[0]=r=>i.value=!i.value),class:"w-full flex items-center justify-between p-3 bg-preke-bg-elevated border border-preke-border rounded-lg hover:border-preke-border-gold transition-colors"},[c[8]||(c[8]=e("span",{class:"text-sm font-medium text-preke-text-dim"},"Project (Optional)",-1)),(o(),d("svg",{class:z(["w-4 h-4 text-preke-text-muted transition-transform",{"rotate-180":i.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...c[7]||(c[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),i.value?(o(),d("div",_n,[e("div",null,[c[10]||(c[10]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Recording Type",-1)),q(e("select",{"onUpdate:modelValue":c[1]||(c[1]=r=>A(t).recordingType=r),onChange:c[2]||(c[2]=r=>A(t).setRecordingType(r.target.value)),class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[...c[9]||(c[9]=[e("option",{value:null},"Select type...",-1),e("option",{value:"podcast"},"Podcast",-1),e("option",{value:"recording"},"Talking Head",-1),e("option",{value:"course"},"Course",-1),e("option",{value:"webinar"},"Webinar",-1)])],544),[[_e,A(t).recordingType]])]),e("div",null,[c[12]||(c[12]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Client",-1)),q(e("select",{"onUpdate:modelValue":c[3]||(c[3]=r=>A(t).selectedClient=r),onChange:g,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[c[11]||(c[11]=e("option",{value:null},"Select client...",-1)),(o(!0),d(K,null,le(A(t).clients,r=>(o(),d("option",{key:r.id,value:r},y(r.name),9,kn))),128))],544),[[_e,A(t).selectedClient]])]),A(t).selectedClient?(o(),d("div",hn,[c[15]||(c[15]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Project",-1)),e("select",{value:((P=A(t).selectedProject)==null?void 0:P.id)||"",onChange:T,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[c[13]||(c[13]=e("option",{value:""},"Select project...",-1)),(o(!0),d(K,null,le(A(t).projects,r=>(o(),d("option",{key:r.id,value:r.id},y(r.name),9,xn))),128)),c[14]||(c[14]=e("option",{value:"new"},"+ Create New Project",-1))],40,yn)])):V("",!0),b.value?(o(),d("div",Cn,[c[16]||(c[16]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"New Project Name",-1)),q(e("input",{"onUpdate:modelValue":c[4]||(c[4]=r=>_.value=r),type:"text",placeholder:"Project name",class:"w-full px-3 py-2 bg-preke-bg-base border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold mb-2",onKeyup:Ue(j,["enter"])},null,544),[[se,_.value]]),e("div",wn,[e("button",{onClick:j,disabled:s.value||!_.value.trim(),class:"flex-1 px-3 py-1.5 bg-preke-gold text-preke-bg-base rounded text-xs font-medium hover:bg-preke-gold-hover disabled:opacity-50 disabled:cursor-not-allowed"},y(s.value?"Creating...":"Create"),9,$n),e("button",{onClick:c[5]||(c[5]=r=>{b.value=!1,_.value=""}),class:"flex-1 px-3 py-1.5 bg-preke-bg-base border border-preke-border rounded text-xs font-medium hover:bg-preke-bg-elevated"}," Cancel ")])])):V("",!0),A(t).selectedClient&&A(t).selectedProject?(o(),d("div",Sn,[e("span",Rn,y(A(t).recordingPath),1)])):V("",!0)])):V("",!0)]),O(ln)])]),O(Se,{ref_key:"leaveDialog",ref:N,title:"Recording in Progress",message:`You are currently recording (${k.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:A(f),onCancel:A(v)},null,8,["message","onConfirm","onCancel"])],512),[[ze,!u.value]])]}),_:1})],64))}}),In=ie(Mn,[["__scopeId","data-v-0c8a0007"]]);export{In as default};
