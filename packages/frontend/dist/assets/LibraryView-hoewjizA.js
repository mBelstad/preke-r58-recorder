import{d as P,r as m,j as q,c as r,a as e,E as N,t as a,F as C,q as M,b as j,s as g,G as R,f as k,y as Q,n as E,w as W,x as X,K as F,o as l}from"./index-DSt97A8k.js";const Z={class:"h-full flex flex-col"},ee={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},te={class:"flex items-center gap-4"},se=["disabled"],oe={key:0,class:"animate-spin w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ne={key:1},le={class:"flex-1 p-6 overflow-y-auto"},re={key:0,class:"flex items-center justify-center h-64"},ae={key:1,class:"flex flex-col items-center justify-center h-64 text-center"},ie={class:"text-r58-text-secondary"},ce={key:2,class:"flex flex-col items-center justify-center h-64 text-center"},de={key:3,class:"grid gap-4"},ue={class:"flex items-center gap-4"},me={class:"flex -space-x-2"},fe={key:0,class:"w-10 h-10 rounded-lg bg-r58-bg-tertiary flex items-center justify-center text-xs font-medium text-r58-text-secondary border-2 border-r58-bg-secondary"},ve={class:"flex-1"},xe={key:0,class:"flex items-center gap-2"},pe=["onKeyup"],he=["onClick"],be={key:1,class:"flex items-center gap-2"},ye={class:"font-medium"},_e=["onClick"],ge={class:"text-sm text-r58-text-secondary"},ke={class:"flex items-center gap-4 text-sm text-r58-text-secondary"},we=["onClick"],Ce=["onClick"],Me={class:"bg-r58-bg-secondary rounded-xl max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col"},je={class:"px-6 py-4 border-b border-r58-bg-tertiary flex items-center justify-between"},Be={class:"text-lg font-semibold"},Le={class:"text-sm text-r58-text-secondary"},Se={class:"flex-1 overflow-y-auto p-6"},ze={class:"space-y-2"},$e={class:"flex items-center gap-3"},De={class:"font-medium text-sm"},Ne={class:"text-xs text-r58-text-secondary"},Re={class:"flex items-center gap-3"},Ee={class:"text-sm text-r58-text-secondary"},Fe=["onClick"],He=["onClick"],Ve={class:"relative max-w-5xl w-full"},Ie={class:"absolute -top-12 left-0 text-white/80 font-medium"},Ue=["src"],H="preke-session-names",Oe=P({__name:"LibraryView",setup(Ae){function B(){try{const s=localStorage.getItem(H);return s?JSON.parse(s):{}}catch{return{}}}function V(s,t){const o=B();o[s]=t,localStorage.setItem(H,JSON.stringify(o))}const v=m([]),x=m(!0),b=m(null),i=m(null),p=m(null),f=m(""),h=m(null),I={cam0:"HDMI 1",cam1:"HDMI 2",cam2:"HDMI 3",cam3:"HDMI 4"};function y(s){return I[s]||s.toUpperCase()}function L(s){return{cam0:"bg-blue-500/20 text-blue-400",cam1:"bg-green-500/20 text-green-400",cam2:"bg-purple-500/20 text-purple-400",cam3:"bg-amber-500/20 text-amber-400"}[s]||"bg-r58-bg-tertiary text-r58-text-secondary"}function U(s){const t=k(s.url);h.value={url:t,label:`${y(s.cam_id)} - ${s.filename}`}}function S(){h.value=null}function A(s){if(s===0)return"0 B";const t=1024,o=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,n)).toFixed(2))+" "+o[n]}function K(s,t){return`${s} - ${t}`}async function w(){x.value=!0,b.value=null;try{const s=k("/api/recordings"),t=await fetch(s);if(!t.ok)throw new Error(`Failed to fetch sessions: ${t.status}`);const o=await t.json(),n=[],d=B();for(const u of o.sessions||[])for(const c of u.date_sessions){const J=d[c.session_id]||c.name;n.push({id:c.session_id,name:J,date:u.date,duration:K(c.start_time,c.end_time),file_count:c.count,total_size:A(c.total_size),files:c.recordings.map(_=>({..._,size_bytes:_.size,camera_id:_.cam_id,created_at:_.time}))})}v.value=n}catch(s){console.error("Failed to fetch sessions:",s),b.value=s instanceof Error?s.message:"Failed to load recordings"}finally{x.value=!1}}function O(s){i.value=s}function z(){i.value=null}async function T(s,t){const o=k(t.url);try{const n=await fetch(o);if(!n.ok)throw new Error(`Download failed: ${n.status}`);const d=await n.blob(),u=document.createElement("a");u.href=URL.createObjectURL(d),u.download=t.filename,u.click(),URL.revokeObjectURL(u.href)}catch(n){console.error("Failed to download file:",n),window.open(o,"_blank")}}function G(s){p.value=s.id,f.value=s.name||""}async function $(s){if(!f.value.trim()){p.value=null;return}const t=f.value.trim();V(s.id,t),s.name=t,p.value=null}function D(){p.value=null,f.value=""}async function Y(s){var t;if(confirm(`Delete "${s.name||s.id}"? This will permanently delete ${s.file_count} recording files (${s.total_size}).`))try{const o=k(`/api/sessions/${s.id}`);(await fetch(o,{method:"DELETE"})).ok&&(v.value=v.value.filter(d=>d.id!==s.id),((t=i.value)==null?void 0:t.id)===s.id&&(i.value=null))}catch(o){console.error("Failed to delete session:",o)}}return q(()=>{w()}),(s,t)=>(l(),r("div",Z,[e("header",ee,[t[2]||(t[2]=e("h1",{class:"text-xl font-semibold"},"Recording Library",-1)),e("div",te,[e("button",{onClick:w,class:"btn",disabled:x.value},[x.value?(l(),r("svg",oe,[...t[1]||(t[1]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):(l(),r("span",ne,"Refresh"))],8,se)])]),e("div",le,[x.value?(l(),r("div",re,[...t[3]||(t[3]=[e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full"},null,-1)])])):b.value?(l(),r("div",ae,[t[4]||(t[4]=e("svg",{class:"w-12 h-12 text-r58-accent-danger mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("p",ie,a(b.value),1),e("button",{onClick:w,class:"btn mt-4"},"Try Again")])):v.value.length===0?(l(),r("div",ce,[...t[5]||(t[5]=[e("svg",{class:"w-16 h-16 text-r58-text-secondary mb-4 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"text-lg font-medium"},"No Recordings Yet",-1),e("p",{class:"text-sm text-r58-text-secondary mt-2"},"Recordings will appear here after you record from the Recorder page.",-1)])])):(l(),r("div",de,[(l(!0),r(C,null,M(v.value,o=>(l(),r("div",{key:o.id,class:"card flex items-center justify-between hover:border-r58-accent-primary/50 transition-colors"},[e("div",ue,[e("div",me,[(l(!0),r(C,null,M(o.files.slice(0,3),(n,d)=>(l(),r("div",{key:n.filename,class:E(["w-10 h-10 rounded-lg flex items-center justify-center text-xs font-bold border-2 border-r58-bg-secondary",L(n.cam_id)]),style:Q({zIndex:3-d})},a(y(n.cam_id).replace("HDMI ","")),7))),128)),o.files.length>3?(l(),r("div",fe," +"+a(o.files.length-3),1)):j("",!0)]),e("div",ve,[p.value===o.id?(l(),r("div",xe,[W(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>f.value=n),onKeyup:[F(n=>$(o),["enter"]),F(D,["escape"])],class:"input text-sm py-1",placeholder:"Session name...",autofocus:""},null,40,pe),[[X,f.value]]),e("button",{onClick:n=>$(o),class:"text-r58-accent-primary text-sm"},"Save",8,he),e("button",{onClick:D,class:"text-r58-text-secondary text-sm"},"Cancel")])):(l(),r("div",be,[e("h3",ye,a(o.name||o.id.substring(0,8)),1),e("button",{onClick:g(n=>G(o),["stop"]),class:"text-r58-text-secondary hover:text-r58-text-primary",title:"Rename session"},[...t[6]||(t[6]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])],8,_e)])),e("p",ge,a(o.date)+" · "+a(o.duration),1)])]),e("div",ke,[e("span",null,a(o.file_count)+" files",1),e("span",null,a(o.total_size),1),e("button",{onClick:n=>O(o),class:"btn"},"Open",8,we),e("button",{onClick:g(n=>Y(o),["stop"]),class:"btn text-r58-accent-danger hover:bg-r58-accent-danger/10",title:"Delete session"},[...t[7]||(t[7]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Ce)])]))),128))]))]),(l(),N(R,{to:"body"},[i.value?(l(),r("div",{key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-8",onClick:g(z,["self"])},[e("div",Me,[e("div",je,[e("div",null,[e("h2",Be,a(i.value.name||i.value.id.substring(0,8)),1),e("p",Le,a(i.value.date)+" · "+a(i.value.file_count)+" files · "+a(i.value.total_size),1)]),e("button",{onClick:z,class:"text-r58-text-secondary hover:text-r58-text-primary"},[...t[8]||(t[8]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Se,[t[11]||(t[11]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Recording Files",-1)),e("div",ze,[(l(!0),r(C,null,M(i.value.files,o=>(l(),r("div",{key:o.filename,class:"flex items-center justify-between p-3 bg-r58-bg-tertiary rounded-lg"},[e("div",$e,[e("div",{class:E(["w-10 h-10 rounded-lg flex items-center justify-center text-sm font-bold",L(o.cam_id)])},a(y(o.cam_id).replace("HDMI ","")),3),e("div",null,[e("p",De,a(y(o.cam_id)),1),e("p",Ne,a(o.filename),1)])]),e("div",Re,[e("span",Ee,a((o.size_bytes/(1024*1024*1024)).toFixed(2))+" GB",1),e("button",{onClick:n=>U(o),class:"btn btn-primary text-sm",title:"Play video"},[...t[9]||(t[9]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M8 5v14l11-7z"})],-1)])],8,Fe),e("button",{onClick:n=>T(i.value,o),class:"btn text-sm",title:"Download"},[...t[10]||(t[10]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,He)])]))),128))])])])])):j("",!0)])),(l(),N(R,{to:"body"},[h.value?(l(),r("div",{key:0,class:"fixed inset-0 bg-black/90 flex items-center justify-center z-[60] p-4",onClick:g(S,["self"])},[e("div",Ve,[e("button",{onClick:S,class:"absolute -top-12 right-0 text-white/80 hover:text-white"},[...t[12]||(t[12]=[e("svg",{class:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])]),e("p",Ie,a(h.value.label),1),e("video",{src:h.value.url,controls:"",autoplay:"",class:"w-full rounded-lg shadow-2xl bg-black"}," Your browser does not support video playback. ",8,Ue)])])):j("",!0)]))]))}});export{Oe as default};
