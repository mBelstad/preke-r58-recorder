import{e as W,r as y,f as j,h as T,i as G,d as I,w as K,c as p,q as H,a as o,B as v,n as k,o as h,F as J,C as Q,t as D,D as X,y as Y,z as P,l as E}from"./index-DVhIzN-T.js";const O=W("mixer",()=>{const d=y(!1),e=y(null),r=y(null),l=y(null),t=y([]),s=j(()=>t.value.filter(u=>u.hasVideo||u.hasAudio));function f(){d.value=!d.value}function g(u){e.value=u}function w(u){r.value=u}function x(u){l.value=u}function a(u){t.value=u}function c(u,$){const S=t.value.find(V=>V.id===u);S&&(S.muted=$)}function b(u,$){const S=t.value.find(V=>V.id===u);S&&(S.audioLevel=$)}return{isLive:d,activeScene:e,programSource:r,previewSource:l,sources:t,activeSources:s,toggleLive:f,setScene:g,setProgram:w,setPreview:x,updateSourcesFromVdo:a,setSourceMute:c,updateAudioLevel:b}});function F(){return`${window.location.hostname}:8443`}const C="studio",Z={director:{params:{director:C,hidesolo:!0,hideheader:!0,cleanoutput:!0,darkmode:!0,nologo:!0}},scene:{params:{scene:!0,room:C,cover:!0,fadein:500,animated:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0}},multiview:{params:{room:C,scene:!0,grid:!0,autoadd:"*",cleanoutput:!0,hideheader:!0,nologo:!0}},cameraContribution:{params:{room:C,videodevice:0,audiodevice:0,autostart:!0,noaudio:!1}},guestInvite:{params:{room:C,webcam:!0,mic:!0,quality:1,effects:!0}},soloView:{params:{room:C,cover:!0,cleanoutput:!0}}};function ee(){return`http://${window.location.hostname}:8000/static/css/vdo-theme.css`}function te(d,e={}){const r=F(),l=Z[d],t=new URL(`http://${r}/`);t.searchParams.set("css",ee());for(const[s,f]of Object.entries(l.params))if(typeof f=="boolean")f&&t.searchParams.set(s,"");else if(typeof f=="number")t.searchParams.set(s,f.toString());else if(typeof f=="string"){let g=f;for(const[w,x]of Object.entries(e))g=g.replace(`{${w}}`,x);g.includes("{")||t.searchParams.set(s,g)}return e.push_id&&t.searchParams.set("push",e.push_id),e.view_id&&t.searchParams.set("view",e.view_id),e.source_ids&&t.searchParams.set("autoadd",e.source_ids),e.whep_url&&t.searchParams.set("whepshare",encodeURIComponent(e.whep_url)),e.label&&t.searchParams.set("label",e.label),t.toString()}function se(d){const e=y(!1),r=y(new Map),l=y(null),t=F();function s(n,m,i){var L;if(!((L=d.value)!=null&&L.contentWindow)){console.warn("VDO.ninja iframe not ready");return}const _={action:n};m&&(_.target=m),i!==void 0&&(_.value=i),d.value.contentWindow.postMessage(_,"*")}function f(n){s("changeScene",void 0,n),l.value=n}function g(n){s("soloVideo",n)}function w(n,m){s("pip",n,m?"enable":"disable")}function x(n,m){s("mute",n,m);const i=r.value.get(n);i&&(i.muted=m)}function a(n,m){s("volume",n,Math.max(0,Math.min(100,m)))}function c(n){s("soloChat",n)}function b(n){s("highlight",n)}function u(n,m){s("sendChat",n,m)}function $(n){s("hangup",n),r.value.delete(n)}function S(n){s("requestScreen",n)}function V(){s("record",void 0,!0)}function N(){s("record",void 0,!1)}function q(n){s("layout",void 0,n)}function U(n){s("reload",n)}function z(n){var _,L,R,A,B;const m=n.origin;if(!m.includes(t.split(":")[0])&&!m.includes("vdo.ninja")&&!m.includes("localhost"))return;const i=n.data;if(!(!i||typeof i!="object"))switch(i.type){case"director-ready":case"loaded":case"ready":e.value=!0;break;case"new-guest":case"guest-connected":i.streamID&&r.value.set(i.streamID,{id:i.streamID,label:((_=i.data)==null?void 0:_.label)||i.streamID,type:((L=i.data)==null?void 0:L.type)||"guest",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0});break;case"guest-left":case"guest-disconnected":i.streamID&&r.value.delete(i.streamID);break;case"audio-level":if(i.streamID){const M=r.value.get(i.streamID);M&&(M.audioLevel=((R=i.data)==null?void 0:R.level)||0)}break;case"mute-state":if(i.streamID){const M=r.value.get(i.streamID);M&&(M.muted=((A=i.data)==null?void 0:A.muted)||!1)}break;case"scene-changed":l.value=((B=i.data)==null?void 0:B.scene)||null;break;case"error":console.error("[VDO.ninja Error]",i.data);break}}return T(()=>{window.addEventListener("message",z),setTimeout(()=>{!e.value&&d.value&&(e.value=!0)},5e3)}),G(()=>{window.removeEventListener("message",z)}),{isReady:e,sources:r,activeScene:l,setScene:f,setProgram:g,togglePiP:w,setLayout:q,setMute:x,setVolume:a,soloAudio:c,highlightSource:b,sendToGuest:u,kickGuest:$,requestScreenShare:S,refreshSource:U,startRecording:V,stopRecording:N,sendCommand:s}}const oe={class:"vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden"},ne={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10"},re=["src"],ie=I({__name:"VdoNinjaEmbed",props:{profile:{},sources:{}},setup(d,{expose:e}){const r=d,l=y(null),t=O(),{isReady:s,sources:f,setScene:g,setMute:w,setVolume:x}=se(l),a=j(()=>{const c={};return r.sources&&(c.source_ids=r.sources.join(",")),te(r.profile,c)});return K(f,c=>{t.updateSourcesFromVdo(Array.from(c.values()))},{deep:!0}),e({isReady:s,setScene:g,setMute:w,setVolume:x}),(c,b)=>(h(),p("div",oe,[v(s)?H("",!0):(h(),p("div",ne,[...b[0]||(b[0]=[o("div",{class:"text-center"},[o("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"}),o("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja..."),o("p",{class:"text-xs text-r58-text-secondary mt-2"},"Local mixer on R58")],-1)])])),o("iframe",{ref_key:"iframeRef",ref:l,src:a.value,class:k(["w-full h-full border-0",{"opacity-0":!v(s)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:""},null,10,re)]))}}),ae={class:"space-y-6"},ce={class:"card"},le={key:0,class:"text-center py-8 text-r58-text-secondary"},ue={key:1,class:"space-y-2"},de={class:"flex items-center gap-3"},fe={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},me={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},pe={key:2,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ve={class:"font-medium"},he={class:"text-xs text-r58-text-secondary capitalize"},ge={class:"flex items-center gap-2"},be={class:"w-16 h-2 bg-r58-bg-primary rounded-full overflow-hidden"},ye=["onClick"],we={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},xe={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ke={class:"card"},Se={class:"grid grid-cols-2 gap-2"},_e=I({__name:"SourcePanel",setup(d){const e=O(),r=j(()=>e.sources);return j(()=>e.activeSources),(l,t)=>(h(),p("div",ae,[o("div",ce,[t[10]||(t[10]=o("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Sources",-1)),r.value.length===0?(h(),p("div",le,[...t[4]||(t[4]=[o("p",null,"No sources connected",-1),o("p",{class:"text-sm mt-1"},"Sources will appear when they join the room",-1)])])):(h(),p("div",ue,[(h(!0),p(J,null,Q(r.value,s=>(h(),p("div",{key:s.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary"},[o("div",de,[o("div",{class:k(["w-10 h-10 rounded bg-r58-bg-primary flex items-center justify-center",{"ring-2 ring-r58-accent-primary":v(e).programSource===s.id}])},[s.type==="camera"?(h(),p("svg",fe,[...t[5]||(t[5]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):s.type==="guest"?(h(),p("svg",me,[...t[6]||(t[6]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):(h(),p("svg",pe,[...t[7]||(t[7]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])]))],2),o("div",null,[o("p",ve,D(s.label),1),o("p",he,D(s.type),1)])]),o("div",ge,[o("div",be,[o("div",{class:"h-full bg-r58-accent-success rounded-full transition-all duration-100",style:X({width:`${s.audioLevel}%`})},null,4)]),o("button",{onClick:f=>v(e).setSourceMute(s.id,!s.muted),class:k(["p-2 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":s.muted}])},[s.muted?(h(),p("svg",we,[...t[8]||(t[8]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(h(),p("svg",xe,[...t[9]||(t[9]=[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,ye)])]))),128))]))]),t[12]||(t[12]=o("div",{class:"card"},[o("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Guest Invite"),o("button",{class:"btn w-full justify-center"}," Generate Invite Link ")],-1)),o("div",ke,[t[11]||(t[11]=o("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Scenes",-1)),o("div",Se,[o("button",{onClick:t[0]||(t[0]=s=>v(e).setScene("scene1")),class:k(["btn",{"btn-primary":v(e).activeScene==="scene1"}])}," Scene 1 ",2),o("button",{onClick:t[1]||(t[1]=s=>v(e).setScene("scene2")),class:k(["btn",{"btn-primary":v(e).activeScene==="scene2"}])}," Scene 2 ",2),o("button",{onClick:t[2]||(t[2]=s=>v(e).setScene("pip")),class:k(["btn",{"btn-primary":v(e).activeScene==="pip"}])}," PiP ",2),o("button",{onClick:t[3]||(t[3]=s=>v(e).setScene("grid")),class:k(["btn",{"btn-primary":v(e).activeScene==="grid"}])}," Grid ",2)])])]))}}),Ce={class:"h-full flex flex-col"},$e={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},Ve={class:"flex items-center gap-4"},Le={class:"flex items-center gap-2"},Me={key:0,class:"badge badge-danger"},je={class:"flex items-center gap-4"},Pe={class:"flex-1 flex overflow-hidden"},De={class:"flex-1 p-4"},Ie={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},ze=I({__name:"MixerView",setup(d){const e=O(),{register:r}=Y(),l=y(null),t=j(()=>e.isLive),s=[];T(()=>{for(let a=1;a<=9;a++){const c=r({key:String(a),description:`Switch to scene ${a}`,action:()=>f(a),context:"mixer"});s.push(c)}s.push(r({key:"t",description:"Cut to preview (transition)",action:()=>g(),context:"mixer"})),s.push(r({key:"a",description:"Auto-transition with fade",action:()=>w(),context:"mixer"})),s.push(r({key:"Tab",description:"Cycle through sources",action:()=>x(),context:"mixer"})),s.push(r({key:"g",description:"Toggle Go Live",action:()=>{e.toggleLive(),P.info(e.isLive?"Session started":"Session ended")},context:"mixer"}))}),G(()=>{s.forEach(a=>a())});function f(a){const c=`scene-${a}`;e.setScene(c),l.value&&l.value.sendCommand("changeScene",{scene:a}),P.info(`Scene ${a}`)}function g(){e.previewSource&&(e.setProgram(e.previewSource),P.info("Cut"))}function w(){e.previewSource&&(l.value&&l.value.sendCommand("transition",{type:"fade",duration:500}),e.setProgram(e.previewSource),P.info("Fade"))}function x(){const a=e.activeSources;if(a.length===0)return;const b=(a.findIndex(u=>u.id===e.previewSource)+1)%a.length;e.setPreview(a[b].id)}return(a,c)=>(h(),p("div",Ce,[o("header",$e,[o("div",Ve,[o("div",Le,[o("span",{class:k(["w-3 h-3 rounded-full",t.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),c[1]||(c[1]=o("span",{class:"text-xl font-semibold text-r58-mixer"},"Mixer",-1))]),t.value?(h(),p("span",Me,"ON AIR")):H("",!0)]),o("div",je,[o("button",{class:"btn",onClick:c[0]||(c[0]=(...b)=>v(e).toggleLive&&v(e).toggleLive(...b))},D(t.value?"End Session":"Go Live"),1)])]),o("div",Pe,[o("div",De,[E(ie,{ref_key:"vdoEmbedRef",ref:l,profile:"director",class:"h-full"},null,512)]),o("aside",Ie,[E(_e)])])]))}});export{ze as default};
