const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-ikjIKck0.js","assets/index-BbM8qQky.css"])))=>i.map(i=>d[i]);
import{D as ie,E as ne,o as le,l as we,G as et,r as _,j as P,H as j,d as oe,I as pe,m as Q,T as Me,p as se,c as g,f as F,z as tt,e,w as I,A as q,t as x,J as nt,i as d,_ as de,K as at,h as re,F as ae,n as L,x as ue,L as De,q as V,M as ye,N as ot,O as Ve,u as Pe,a as Ue,y as he,B as st,P as We,Q as He,R as lt,S as it,U as rt,V as ct,k as ut,g as Ie,W as dt,b as vt,v as mt}from"./index-ikjIKck0.js";import{M as ft}from"./ModeLoadingScreen-2J19sk39.js";const me=_(!1),ge=_(!1);let fe=null;function pt(){const n=ie();ne(()=>n.status,m=>{me.value=m==="recording"},{immediate:!0});function t(m){if(me.value)return m.preventDefault(),m.returnValue="Recording in progress. Are you sure you want to leave?",m.returnValue}le(()=>{window.addEventListener("beforeunload",t)}),we(()=>{window.removeEventListener("beforeunload",t)}),et((m,i,p)=>{me.value?(fe=()=>p(),ge.value=!0,p(!1)):p()});function o(){ge.value=!1,me.value=!1,n.stopRecording().finally(()=>{fe&&(fe(),fe=null)})}function v(){ge.value=!1,fe=null}return{isGuardActive:me,showLeaveConfirmation:ge,confirmLeave:o,cancelLeave:v}}const z=_(null),ke=_(!1),Fe=_(null),Ce=_(null),gt=10,$e=2,bt=25;function _t(){const n=P(()=>z.value?z.value.available_gb<$e?"critical":z.value.available_gb<gt?"warning":"ok":"unknown"),t=P(()=>z.value?z.value.available_gb>=$e:!0),o=P(()=>{if(!z.value)return null;const l=z.value.available_gb*1024*1024*1024,c=bt*1024*1024,S=l/c,b=Math.floor(S/3600),h=Math.floor(S%3600/60);return b>24?`${Math.floor(b/24)}d ${b%24}h`:b>0?`${b}h ${h}m`:`${h}m`}),v=P(()=>{switch(n.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),m=P(()=>z.value?n.value==="critical"?`Disk space critically low (${z.value.available_gb.toFixed(1)} GB). Cannot start recording.`:n.value==="warning"?`Low disk space (${z.value.available_gb.toFixed(1)} GB). Estimated recording time: ${o.value}`:null:null);async function i(){ke.value=!0,Ce.value=null;try{const l=await j.getDegradation();if(l.resources&&l.resources.disk_free_gb!==void 0){const c=l.resources.disk_free_gb,S=c*3;z.value={available_gb:c,total_gb:S,used_percent:100-c/S*100,recording_path:"/opt/r58-app/shared/recordings"}}return Fe.value=new Date,z.value}catch(l){return Ce.value=l.message||"Failed to check disk space",console.error("Failed to check disk space:",l),null}finally{ke.value=!1}}async function p(){return await i(),z.value?n.value==="critical"?{ok:!1,message:`Insufficient disk space (${z.value.available_gb.toFixed(1)} GB). Need at least ${$e} GB to start recording.`}:n.value==="warning"?{ok:!0,message:`Low disk space warning: ${z.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${o.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:z,isLoading:ke,lastCheck:Fe,error:Ce,status:n,statusColor:v,canStartRecording:t,estimatedRecordingTime:o,warningMessage:m,checkDiskSpace:i,preflightCheck:p}}const X=_(localStorage.getItem("r58_audio_feedback")!=="false");let xe=null;function yt(){return xe||(xe=new(window.AudioContext||window.webkitAudioContext)),xe}function Y(n,t,o="sine",v=.3){if(X.value)try{const m=yt();m.state==="suspended"&&m.resume();const i=m.createOscillator(),p=m.createGain();i.connect(p),p.connect(m.destination),i.type=o,i.frequency.value=n;const l=m.currentTime;p.gain.setValueAtTime(0,l),p.gain.linearRampToValueAtTime(v,l+.01),p.gain.linearRampToValueAtTime(0,l+t),i.start(l),i.stop(l+t)}catch(m){console.warn("Audio feedback failed:",m)}}function ht(){X.value&&(Y(440,.1,"sine",.2),setTimeout(()=>Y(554,.1,"sine",.2),100),setTimeout(()=>Y(659,.15,"sine",.25),200))}function wt(){X.value&&(Y(880,.08,"sine",.3),setTimeout(()=>Y(880,.15,"sine",.3),120))}function kt(){X.value&&(Y(659,.1,"sine",.25),setTimeout(()=>Y(554,.1,"sine",.2),100),setTimeout(()=>Y(440,.15,"sine",.2),200))}function Ct(){X.value&&(Y(200,.15,"square",.15),setTimeout(()=>Y(180,.2,"square",.15),180))}function $t(){X.value&&(Y(1e3,.08,"sine",.2),setTimeout(()=>Y(1e3,.08,"sine",.2),150))}function Ne(){X.value&&Y(1200,.03,"sine",.1)}function xt(n=50){if(X.value&&"vibrate"in navigator)try{navigator.vibrate(n)}catch{}}function St(){function n(o){X.value=o,localStorage.setItem("r58_audio_feedback",String(o))}function t(){n(!X.value),X.value&&Ne()}return{enabled:X,setEnabled:n,toggle:t,playSuccess:ht,playError:Ct,playWarning:$t,playClick:Ne,playRecordStart:wt,playRecordStop:kt,vibrate:xt}}const Rt={class:"bg-preke-bg-elevated rounded-lg shadow-xl max-w-md w-full p-6"},Tt=["placeholder"],Mt={class:"text-xs text-preke-text-dim mt-2"},Et=oe({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(n,{emit:t}){const o=n,v=t,m=_(""),i=_(null),p=P(()=>{const f=new Date,k=f.toLocaleDateString("en-CA"),w=f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${k}_${w}`}),l=P(()=>o.suggestedName||p.value);ne(()=>o.open,f=>{f&&(m.value=l.value,setTimeout(()=>{var k,w;(k=i.value)==null||k.focus(),(w=i.value)==null||w.select()},100))});function c(){v("confirm",m.value.trim()||l.value)}function S(){v("skip")}function b(){v("cancel")}function h(f){f.key==="Enter"?c():f.key==="Escape"&&b()}return(f,k)=>(d(),pe(nt,{to:"body"},[Q(Me,{name:"fade"},{default:se(()=>[n.open?(d(),g("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:tt(b,["self"]),onKeydown:h},[e("div",Rt,[k[1]||(k[1]=e("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),k[2]||(k[2]=e("p",{class:"text-preke-text-dim text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),I(e("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":k[0]||(k[0]=w=>m.value=w),type:"text",placeholder:l.value,class:"w-full px-4 py-2 bg-preke-bg-surface border border-preke-bg-surface rounded-lg text-preke-text placeholder-preke-text-dim focus:outline-none focus:ring-2 focus:ring-preke-gold"},null,8,Tt),[[q,m.value]]),e("p",Mt," Suggested: "+x(l.value),1),e("div",{class:"flex justify-between mt-6"},[e("button",{onClick:S,class:"text-sm text-preke-text-dim hover:text-preke-text transition-colors"}," Skip (use default) "),e("div",{class:"flex gap-3"},[e("button",{onClick:b,class:"btn"}," Cancel "),e("button",{onClick:c,class:"btn btn-primary"}," Start Recording ")])])])],32)):F("",!0)]),_:1})]))}}),Pt=de(Et,[["__scopeId","data-v-2eeca4e8"]]),Bt={class:"recorder-controls"},Ft={key:0,class:"recorder-controls__duration"},Nt=["disabled","title"],At={key:0,class:"recorder-controls__spinner"},Lt={key:0,class:"recorder-controls__icon recorder-controls__icon--stop"},Dt={key:1,class:"recorder-controls__icon recorder-controls__icon--record"},Vt={class:"recorder-controls__hint"},Ut=oe({__name:"RecorderControls",setup(n){const t=ie(),{register:o}=at(),{preflightCheck:v,status:m,canStartRecording:i}=_t(),{playRecordStart:p,playRecordStop:l,playError:c,playWarning:S,vibrate:b}=St(),h=_(null),f=_(!1),k=_(!1),w=_(!1),R=_(!1),A=_(void 0),$=P(()=>t.status==="recording"),a=P(()=>t.status==="starting"),s=P(()=>t.status==="stopping"),u=P(()=>t.formattedDuration),B=P(()=>a.value||s.value||k.value),Z=P(()=>a.value?"Starting recording...":s.value?"Stopping recording...":k.value?"Checking disk space...":!$.value&&!i.value?"Insufficient disk space":"");let J=null;le(()=>{J=o({key:" ",description:"Toggle Recording",action:ee,context:"recorder",enabled:()=>!a.value&&!s.value})}),we(()=>{J&&J()});async function ee(){$.value?T():await H()}async function H(W){k.value=!0;try{const O=await v();if(!O.ok){c(),b(200),re.error("Cannot start recording",O.message||"Preflight check failed");return}if(O.message&&m.value==="warning"&&(S(),re.warning("Low disk space",O.message)),R.value&&!W){A.value=void 0,w.value=!0;return}await K(W||A.value)}finally{k.value=!1}}async function K(W){try{await t.startRecording(W);const O=W||t.sessionId;p(),b([50,30,50]),re.success("Recording started",`Session: ${O}`)}catch(O){c(),b(200),re.error("Failed to start recording",O.message||"Unknown error",{label:"Retry",onClick:()=>H(W)})}}function M(W){w.value=!1,A.value=W,H(W)}function E(){w.value=!1,A.value=void 0,H()}function C(){w.value=!1,k.value=!1}async function y(){try{await t.stopRecording(),l(),b(100),re.success("Recording stopped")}catch(W){c(),b(200),re.error("Failed to stop recording",W.message||"Unknown error")}}function T(){var W;f.value=!1,(W=h.value)==null||W.open(),setTimeout(()=>{f.value=!0},500)}function G(){f.value&&y()}async function D(){$.value?T():await K()}return(W,O)=>(d(),g(ae,null,[e("div",Bt,[$.value?(d(),g("div",Ft,x(u.value),1)):F("",!0),e("button",{onClick:D,disabled:B.value,class:L(["recorder-controls__btn",$.value?"recorder-controls__btn--stop":"recorder-controls__btn--start"]),title:Z.value||($.value?"Stop Recording (Space)":"Start Recording (Space)")},[a.value||s.value||k.value?(d(),g("span",At)):(d(),g(ae,{key:1},[$.value?(d(),g("span",Lt)):(d(),g("span",Dt))],64)),e("span",null,x(k.value?"Checking...":$.value?"Stop":"Start Recording"),1)],10,Nt),e("span",Vt,[O[0]||(O[0]=ue(" Press ",-1)),O[1]||(O[1]=e("kbd",null,"Space",-1)),ue(" to "+x($.value?"stop":"start"),1)])]),Q(De,{ref_key:"stopConfirmDialog",ref:h,title:"Stop Recording?",message:`You have been recording for ${u.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:G},null,8,["message"]),Q(Pt,{open:w.value,onConfirm:M,onSkip:E,onCancel:C},null,8,["open"])],64))}}),Wt=de(Ut,[["__scopeId","data-v-1e32920d"]]),be=_(localStorage.getItem("r58_performance_mode")==="true"),Se=_(localStorage.getItem("r58_performance_mode_auto")!=="false"),Ht=3,It=100,Ot=500;function jt(){const n=ie(),t=P(()=>be.value?!0:Se.value&&n.isRecording?n.inputs.filter(h=>h.isRecording).length>=Ht:!1),o=P(()=>t.value?Ot:It);ne(t,b=>{b?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function v(b){be.value=b,localStorage.setItem("r58_performance_mode",String(b))}function m(b){Se.value=b,localStorage.setItem("r58_performance_mode_auto",String(b))}function i(){v(!be.value)}function p(b,h){let f=0,k=null;return(...w)=>{const R=Date.now(),A=h??o.value,$=R-f;$>=A?(f=R,b(...w)):k||(k=window.setTimeout(()=>{f=Date.now(),k=null,b(...w)},A-$))}}function l(b,h){let f=null;return(...k)=>{f&&clearTimeout(f),f=window.setTimeout(()=>{b(...k),f=null},h??o.value)}}function c(b){return t.value?window.setTimeout(()=>b(performance.now()),o.value):requestAnimationFrame(b)}function S(b){t.value?clearTimeout(b):cancelAnimationFrame(b)}return{enabled:be,autoEnable:Se,isActive:t,updateInterval:o,setEnabled:v,setAutoEnable:m,toggle:i,throttle:p,debounce:l,requestFrame:c,cancelFrame:S}}const zt=["title"],Gt={class:"flex items-center gap-1.5 text-sm"},qt={key:0,class:"flex items-center gap-1.5 text-sm"},Zt={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},Kt={class:"font-mono"},Yt=oe({__name:"RecordingHealth",setup(n,{expose:t}){const o=ie(),{isActive:v}=jt(),m=_({}),i=_(0),p=_(0),l=_(0);let c=null;function S(){const w={};let R=0;o.inputs.forEach($=>{w[$.id]=$.bytesWritten;const a=m.value[$.id]||0;R+=$.bytesWritten-a});const A=v.value?2:1;i.value=Math.round(R/(1024*1024)/A*10)/10,m.value=w}ne(()=>o.isRecording,w=>{if(w){m.value={},i.value=0,p.value=0,l.value=0;const R=v.value?2e3:1e3;c=window.setInterval(S,R)}else c&&(clearInterval(c),c=null)},{immediate:!0}),ne(v,w=>{if(o.isRecording&&c){clearInterval(c);const R=w?2e3:1e3;c=window.setInterval(S,R)}}),we(()=>{c&&clearInterval(c)});const b=P(()=>o.isRecording?l.value>0||p.value>90?"critical":i.value<1||p.value>70?"warning":"healthy":"idle"),h=P(()=>{switch(b.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});P(()=>{switch(b.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const f=P(()=>{if(!o.isRecording)return"Not recording";const w=[`Write speed: ${i.value} MB/s`,`Buffer: ${p.value}%`];return l.value>0&&w.push(`Frames dropped: ${l.value}`),w.join(`
`)});function k(w){w.buffer_percent!==void 0&&(p.value=w.buffer_percent),w.frames_dropped!==void 0&&(l.value=w.frames_dropped)}return t({updateFromMetrics:k}),(w,R)=>V(o).isRecording?(d(),g("div",{key:0,class:L(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":h.value==="emerald","bg-amber-500/10":h.value==="amber","bg-red-500/10":h.value==="red"}]),title:f.value},[e("span",{class:L(["w-2 h-2 rounded-full",h.value==="emerald"?"bg-emerald-500":"",h.value==="amber"?"bg-amber-500 animate-pulse":"",h.value==="red"?"bg-red-500 animate-pulse":""])},null,2),e("div",Gt,[R[0]||(R[0]=e("svg",{class:"w-3.5 h-3.5 text-preke-text-dim",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),e("span",{class:L(["font-mono",h.value==="emerald"?"text-emerald-400":"",h.value==="amber"?"text-amber-400":"",h.value==="red"?"text-red-400":""])},x(i.value)+" MB/s ",3)]),p.value>0?(d(),g("div",qt,[R[1]||(R[1]=e("span",{class:"text-preke-text-dim"},"Buf:",-1)),e("span",{class:L(["font-mono",p.value<50?"text-emerald-400":"",p.value>=50&&p.value<80?"text-amber-400":"",p.value>=80?"text-red-400":""])},x(p.value)+"% ",3)])):F("",!0),l.value>0?(d(),g("div",Zt,[R[2]||(R[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",Kt,x(l.value)+" dropped",1)])):F("",!0)],10,zt)):F("",!0)}});function Ae(n){return n.startsWith("192.168.")||n.startsWith("10.")||n.startsWith("172.")||n.startsWith("100.")||n==="127.0.0.1"||n==="localhost"}const Qt=5,Xt=1e3,Jt=3e4,en=()=>typeof window<"u"&&window.__NETWORK_DEBUG__===!0,Le=new Map,tn=1e3;function _e(n,t,...o){if(!en())return;const v=Date.now(),m=Le.get(n)||0;v-m<tn||(Le.set(n,v),console.log(`[NETWORK DEBUG ${n}] ${t}`,...o))}const te=new Map,ve=new Map;async function nn(n){const t=ye(),o=Ve();if(t&&!o)try{return`http://${new URL(t).hostname}:8889/${n}/whep`}catch{console.warn("[WHEP Manager] Invalid device URL, falling back to FRP")}if(typeof window<"u"&&window.location.hostname==="app.itagenten.no")return console.log("[WHEP Manager] Browser access from app.itagenten.no, using same-domain proxy"),`https://app.itagenten.no/${n}/whep`;const{getFrpUrl:v}=await ot(async()=>{const{getFrpUrl:i}=await import("./index-ikjIKck0.js").then(p=>p.a3);return{getFrpUrl:i}},__vite__mapDeps([0,1])),m=await v();if(m)try{const i=new URL(m);return i.hostname.includes("mediamtx")?`${m}/${n}/whep`:`https://${i.hostname.replace("api","mediamtx")}/${n}/whep`}catch{console.warn("[WHEP Manager] Invalid FRP URL, cannot build WHEP URL")}throw new Error("No device configured and no FRP fallback available")}async function an(n,t){const o=te.get(t);if(!o)return"unknown";try{const i=new URL(o.whepUrl).hostname;if(i.includes("itagenten.no"))return console.log(`[WHEP Manager ${t}] Detected relay (FRP URL)`),"relay";if(Ae(i))return console.log(`[WHEP Manager ${t}] Detected P2P (private IP: ${i})`),"p2p"}catch(m){console.warn(`[WHEP Manager ${t}] Failed to parse WHEP URL:`,m)}try{const m=await n.getStats();for(const i of m.values())if(i.type==="candidate-pair"&&i.state==="succeeded"){const p=m.get(i.remoteCandidateId);if((p==null?void 0:p.candidateType)==="relay")return console.log(`[WHEP Manager ${t}] Detected relay (TURN candidate)`),"relay";const l=p==null?void 0:p.address;if(l&&!Ae(l))return console.log(`[WHEP Manager ${t}] Detected relay (public IP: ${l})`),"relay"}}catch(m){console.warn(`[WHEP Manager ${t}] Failed to get WebRTC stats:`,m)}return ye()&&!Ve()?(console.log(`[WHEP Manager ${t}] Assuming P2P (direct device URL configured)`),"p2p"):"unknown"}function ce(n){const t=te.get(n);if(!t)return;const o=ve.get(n);o&&o.forEach(v=>v(t))}function Re(n){const t=te.get(n);if(!t)return;if(t.reconnectAttempts>=Qt){console.error(`[WHEP Manager ${n}] Max reconnect attempts reached`),t.state="failed",ce(n);return}t.reconnectAttempts++;const o=Math.min(Xt*Math.pow(2,t.reconnectAttempts-1),Jt),v=o*.2*(Math.random()*2-1),m=Math.max(100,Math.round(o+v));_e("WHEP",`Camera ${n}: Reconnect #${t.reconnectAttempts} in ${m}ms (base: ${o}ms)`),console.log(`[WHEP Manager ${n}] Scheduling reconnect #${t.reconnectAttempts} in ${m}ms`),t.state="connecting",ce(n),t.reconnectTimeout&&clearTimeout(t.reconnectTimeout),t.reconnectTimeout=setTimeout(()=>{Be(n)},m)}async function Be(n){let t=te.get(n);if(t&&(t.state==="connected"||t.state==="connecting"))return console.log(`[WHEP Manager ${n}] Reusing existing connection (state: ${t.state})`),t;if(t!=null&&t.isConnecting){for(_e("WHEP",`Camera ${n}: Connection already in progress, skipping duplicate attempt`),console.log(`[WHEP Manager ${n}] Connection already in progress, waiting...`);t.isConnecting&&t.state==="connecting"&&(await new Promise(l=>setTimeout(l,100)),t=te.get(n),!!t););if(t)return t}const o=typeof window<"u"&&window.location.hostname==="app.itagenten.no";let v=ye();if(o)console.log(`[WHEP Manager ${n}] Browser mode - using MediaMTX proxy`);else{let l=0;for(;!v&&l<5;)console.log(`[WHEP Manager ${n}] No device URL yet, waiting... (attempt ${l+1})`),await new Promise(c=>setTimeout(c,100)),v=ye(),l++}const m=performance.now(),i=await nn(n);_e("WHEP",`Camera ${n}: Creating connection to ${i}`),console.log(`[WHEP Manager ${n}] Creating connection to: ${i}`),console.log(`[WHEP Manager ${n}] Device URL was: ${v||"none (browser mode)"}`),t!=null&&t.peerConnection&&t.peerConnection.close(),t!=null&&t.disconnectedTimeout&&(clearTimeout(t.disconnectedTimeout),t.disconnectedTimeout=null),t&&(t.isConnecting=!0);const p=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"}]});t?(t.peerConnection=p,t.state="connecting",t.whepUrl=i,t.mediaStream=null,t.connectionType="unknown",t.connectionStartTime=m,t.isConnecting=!0):(t={cameraId:n,peerConnection:p,mediaStream:null,state:"connecting",connectionType:"unknown",refCount:0,whepUrl:i,lastConnectedAt:null,reconnectAttempts:0,reconnectTimeout:null,disconnectedTimeout:null,connectionStartTime:m,isConnecting:!0},te.set(n,t)),p.ontrack=l=>{l.streams[0]&&(t.mediaStream=l.streams[0],console.log(`[WHEP Manager ${n}] Received media stream`),ce(n))},p.oniceconnectionstatechange=async()=>{const l=p.iceConnectionState;if(_e("WHEP",`Camera ${n}: ICE state changed to ${l}`),console.log(`[WHEP Manager ${n}] ICE state: ${l}`),l==="connected"||l==="completed"){t.state="connected",t.lastConnectedAt=Date.now(),t.reconnectAttempts=0,t.isConnecting=!1,t.connectionType=await an(p,n),t.disconnectedTimeout&&(clearTimeout(t.disconnectedTimeout),t.disconnectedTimeout=null);const c=t.connectionStartTime?Math.round(performance.now()-t.connectionStartTime):0;console.log(`[WHEP Manager ${n}] Connected (${t.connectionType}) in ${c}ms`),ce(n)}else l==="failed"?(t.state="failed",t.connectionType="unknown",t.isConnecting=!1,ce(n),t.refCount>0&&Re(n)):l==="disconnected"&&(t.disconnectedTimeout&&clearTimeout(t.disconnectedTimeout),t.disconnectedTimeout=setTimeout(()=>{(p.iceConnectionState==="disconnected"||p.iceConnectionState==="failed")&&(t.state="disconnected",t.isConnecting=!1,ce(n),t.refCount>0&&Re(n)),t.disconnectedTimeout=null},3e3))},p.addTransceiver("video",{direction:"recvonly"}),p.addTransceiver("audio",{direction:"recvonly"});try{const l=await p.createOffer();await p.setLocalDescription(l);const c=await fetch(i,{method:"POST",headers:{"Content-Type":"application/sdp"},body:l.sdp});if(!c.ok)throw new Error(`WHEP request failed: ${c.status}`);const S=await c.text();await p.setRemoteDescription({type:"answer",sdp:S})}catch(l){console.error(`[WHEP Manager ${n}] Connection error:`,l),t.state="failed",t.isConnecting=!1,ce(n),t.refCount>0&&Re(n)}return t}async function on(n,t){ve.has(n)||ve.set(n,new Set),ve.get(n).add(t);let o=te.get(n);return(!o||o.state==="failed"||o.state==="disconnected")&&(o=await Be(n)),o.refCount++,console.log(`[WHEP Manager ${n}] Acquired connection (refCount: ${o.refCount})`),t(o),o}function sn(n,t){const o=te.get(n);if(!o)return;const v=ve.get(n);v&&(v.delete(t),v.size===0&&ve.delete(n)),o.refCount=Math.max(0,o.refCount-1),console.log(`[WHEP Manager ${n}] Released connection (refCount: ${o.refCount})`),o.refCount===0&&(console.log(`[WHEP Manager ${n}] Closing unused connection`),o.reconnectTimeout&&clearTimeout(o.reconnectTimeout),o.disconnectedTimeout&&clearTimeout(o.disconnectedTimeout),o.peerConnection.close(),te.delete(n))}function Te(n){const t=te.get(n);t&&(console.log(`[WHEP Manager ${n}] Force reconnecting...`),t.reconnectAttempts=0,Be(n))}const ln={class:"relative w-full h-full bg-black"},rn=["title"],cn={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/50"},un={key:2,class:"absolute inset-0 flex items-center justify-center bg-black/70"},dn={class:"text-center"},vn={class:"text-xs text-amber-400"},mn={key:3,class:"absolute inset-0 flex items-center justify-center bg-black/80"},fn={class:"text-center text-preke-text-dim"},pn={class:"text-sm"},gn=oe({__name:"InputPreview",props:{inputId:{},protocol:{}},emits:["videoReady","aspectRatio"],setup(n,{emit:t}){const o=n,v=t,m=ie();let i=!1;const p=P(()=>m.status==="recording"),l=_(null),c=_(!0),S=_(null),b=_("unknown"),h=_(!1),f=_(0);let k=null;function w(a){switch(console.log(`[InputPreview ${o.inputId}] Connection update:`,{state:a.state,type:a.connectionType,hasStream:!!a.mediaStream}),b.value=a.connectionType,f.value=a.reconnectAttempts,a.state){case"connecting":c.value=!0,S.value=null,h.value=a.reconnectAttempts>0;break;case"connected":c.value=!1,S.value=null,h.value=!1,a.mediaStream&&l.value&&l.value.srcObject!==a.mediaStream&&(l.value.srcObject=a.mediaStream,l.value.play().catch(s=>{console.warn(`[InputPreview ${o.inputId}] Autoplay prevented:`,s)}),i||(l.value.onloadeddata=()=>{if(!i&&l.value){i=!0;const s=l.value.videoWidth,u=l.value.videoHeight,B=s&&u?s/u:16/9;console.log(`[InputPreview ${o.inputId}] Video ready (${s}x${u}, ratio: ${B.toFixed(3)})`),v("aspectRatio",B),v("videoReady")}}));break;case"disconnected":h.value=!0,S.value=`Reconnecting... (${a.reconnectAttempts}/5)`;break;case"failed":c.value=!1,h.value=!1,S.value="Connection failed after multiple attempts";break}}async function R(){if(l.value){$(),c.value=!0,S.value=null,k=w;try{await on(o.inputId,k)}catch(a){console.error(`[InputPreview ${o.inputId}] Failed to acquire connection:`,a),S.value=a instanceof Error?a.message:"Failed to connect",c.value=!1}}}function A(){Te(o.inputId)}function $(){k&&(sn(o.inputId,k),k=null)}return le(()=>{R()}),ne(()=>o.inputId,()=>{R()}),ne(p,(a,s)=>{s&&!a&&S.value?(console.log("[InputPreview] Recording stopped, reconnecting preview..."),Te(o.inputId)):!s&&a&&(console.log("[InputPreview] Recording started, will try to reconnect preview after delay..."),setTimeout(()=>{p.value&&(console.log("[InputPreview] Attempting to reconnect preview during recording..."),Te(o.inputId))},2e3))}),we(()=>{$()}),(a,s)=>(d(),g("div",ln,[e("video",{ref_key:"videoRef",ref:l,autoplay:"",muted:"",playsinline:"",class:"w-full h-full object-contain"},null,512),!c.value&&!S.value&&b.value!=="unknown"?(d(),g("div",{key:0,class:L(["absolute top-1 right-1 px-1.5 py-0.5 text-[10px] font-medium rounded",b.value==="p2p"?"bg-emerald-500/80 text-white":"bg-amber-500/80 text-white"]),title:b.value==="p2p"?"Direct P2P connection":"Relay connection (FRP)"},x(b.value==="p2p"?"P2P":"RELAY"),11,rn)):F("",!0),c.value&&!h.value?(d(),g("div",cn,[...s[0]||(s[0]=[e("div",{class:"animate-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full"},null,-1)])])):F("",!0),h.value?(d(),g("div",un,[e("div",dn,[s[1]||(s[1]=e("div",{class:"animate-spin w-5 h-5 border-2 border-amber-400 border-t-transparent rounded-full mx-auto mb-2"},null,-1)),e("p",vn,x(S.value||"Reconnecting..."),1)])])):S.value&&!c.value?(d(),g("div",mn,[e("div",fn,[e("p",pn,x(S.value),1),e("button",{onClick:A,class:"mt-2 text-xs text-preke-gold hover:underline"}," Retry ")])])):F("",!0)]))}}),bn={key:0,class:"h-full flex items-center justify-center"},_n={key:1,class:"input-grid"},yn={key:0,class:"input-grid__warning"},hn=["data-count"],wn=["title"],kn={key:1,class:"w-full h-full flex items-center justify-center bg-preke-bg-surface"},Cn={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},$n={class:"flex items-center justify-between"},xn={class:"flex items-center gap-2"},Sn={class:"font-medium"},Rn={key:0,class:"flex items-center gap-2 text-sm"},Tn={class:"text-preke-text-dim"},Mn=oe({__name:"InputGrid",emits:["allVideosReady"],setup(n,{emit:t}){const o=ie(),v=Pe(),m=t,i=_(new Set),p=_({});function l(a){i.value.add(a),console.log(`[InputGrid] Video ready: ${a} (${i.value.size}/${h.value.length})`),i.value.size>=h.value.length&&(console.log("[InputGrid] All videos ready!"),m("allVideosReady"))}function c(a,s){p.value[a]=s,console.log(`[InputGrid] Aspect ratio for ${a}: ${s.toFixed(3)}`)}function S(a){return{aspectRatio:`${p.value[a]||1.7777777777777777}`}}ne(()=>h.value.length,()=>{i.value.clear()});const b=P(()=>{var a;return((a=v.capabilities)==null?void 0:a.current_mode)==="recorder"}),h=P(()=>o.inputs.filter(a=>a.hasSignal)),f=P(()=>o.framerateMismatch);function k(a){return a.isRecording?"border-preke-red ring-2 ring-preke-red/20":a.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-preke-bg-surface/50 opacity-60"}function w(a){return a.hasSignal?a.framerate>=29?"excellent":a.framerate>=24?"good":"unstable":"none"}function R(a){switch(w(a)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-preke-text-dim"}}function A(a){if(a===0)return"0 B";const s=1024,u=["B","KB","MB","GB"],B=Math.floor(Math.log(a)/Math.log(s));return parseFloat((a/Math.pow(s,B)).toFixed(1))+" "+u[B]}function $(a){if(!a.hasSignal)return`${a.label}: No signal detected`;const s=[`${a.label}`,`Resolution: ${a.resolution}`,`Framerate: ${a.framerate} fps`,`Quality: ${w(a)}`];return a.isRecording&&s.push(`Written: ${A(a.bytesWritten)}`),s.join(`
`)}return(a,s)=>h.value.length===0?(d(),g("div",bn,[...s[0]||(s[0]=[Ue('<div class="text-center text-preke-text-dim" data-v-206e9703><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-206e9703><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" data-v-206e9703></path></svg><p class="text-lg font-medium" data-v-206e9703>No Video Sources Connected</p><p class="text-sm mt-2" data-v-206e9703>Connect HDMI cables to begin recording</p></div>',1)])])):(d(),g("div",_n,[f.value?(d(),g("div",yn,[s[1]||(s[1]=e("svg",{class:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,x(f.value),1)])):F("",!0),e("div",{class:"input-grid__container","data-count":h.value.length},[(d(!0),g(ae,null,he(h.value,u=>(d(),g("div",{key:u.id,class:L(["input-grid__tile",k(u)]),style:st(S(u.id)),title:$(u)},[b.value?(d(),pe(gn,{key:0,"input-id":u.id,class:"w-full h-full",onVideoReady:B=>l(u.id),onAspectRatio:B=>c(u.id,B)},null,8,["input-id","onVideoReady","onAspectRatio"])):(d(),g("div",kn,[...s[2]||(s[2]=[e("div",{class:"text-center"},[e("svg",{class:"w-8 h-8 mx-auto mb-2 text-preke-text-dim/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})]),e("span",{class:"text-xs text-preke-text-dim/70"},"Mixer mode")],-1)])])),e("div",Cn,[e("div",$n,[e("div",xn,[e("span",{class:L(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":w(u)==="excellent"||w(u)==="good","bg-amber-500 animate-pulse":w(u)==="unstable","bg-preke-text-dim":w(u)==="none"}])},null,2),e("span",Sn,x(u.label),1)]),u.hasSignal?(d(),g("div",Rn,[e("span",Tn,x(u.resolution),1),e("span",{class:L(R(u))},x(u.framerate)+"fps",3)])):F("",!0)])])],14,wn))),128))],8,hn)]))}}),En=de(Mn,[["__scopeId","data-v-206e9703"]]);function Ee(){const n=_([]),t=_(!1),o=_(null),v=_(null);async function m(){t.value=!0,o.value=null;try{const a=await j.cameras.list();n.value=await Promise.all(a.map(async s=>{try{const u=await j.cameras.getStatus(s);return{name:u.name,type:u.type,connected:u.connected,settings:u.settings}}catch{return{name:s,type:"blackmagic",connected:!1}}}))}catch(a){o.value=a.message||"Failed to load cameras",console.error("[CameraControls] Failed to load cameras:",a)}finally{t.value=!1}}const i=P(()=>a=>n.value.find(s=>s.name===a));function p(a,s){const u=i.value(a);if(!u)return!1;const B=["focus","iris","whiteBalance","gain","iso","shutter","colorCorrection"],Z=["focus","exposure","whiteBalance","ptz"];return u.type==="blackmagic"?B.includes(s):u.type==="obsbot_tail2"?Z.includes(s):!1}async function l(a,s,u){try{await j.cameras.setFocus(a,s,u),await $(a)}catch(B){throw new Error(B.message||"Failed to set focus")}}async function c(a,s,u){try{await j.cameras.setWhiteBalance(a,s,u),await $(a)}catch(B){throw new Error(B.message||"Failed to set white balance")}}async function S(a,s,u){try{await j.cameras.setExposure(a,s,u),await $(a)}catch(B){throw new Error(B.message||"Failed to set exposure")}}async function b(a,s){try{await j.cameras.setISO(a,s),await $(a)}catch(u){throw new Error(u.message||"Failed to set ISO")}}async function h(a,s){try{await j.cameras.setShutter(a,s),await $(a)}catch(u){throw new Error(u.message||"Failed to set shutter")}}async function f(a,s,u){try{await j.cameras.setIris(a,s,u),await $(a)}catch(B){throw new Error(B.message||"Failed to set iris")}}async function k(a,s){try{await j.cameras.setGain(a,s),await $(a)}catch(u){throw new Error(u.message||"Failed to set gain")}}async function w(a,s,u,B){try{await j.cameras.setPTZ(a,s,u,B)}catch(Z){throw new Error(Z.message||"Failed to move PTZ")}}async function R(a,s){try{await j.cameras.recallPTZPreset(a,s)}catch(u){throw new Error(u.message||"Failed to recall preset")}}async function A(a,s){try{await j.cameras.setColorCorrection(a,s),await $(a)}catch(u){throw new Error(u.message||"Failed to set color correction")}}async function $(a){try{const s=await j.cameras.getStatus(a),u=n.value.findIndex(B=>B.name===a);u>=0&&(n.value[u]={name:s.name,type:s.type,connected:s.connected,settings:s.settings})}catch(s){console.error(`[CameraControls] Failed to refresh status for ${a}:`,s)}}return{cameras:n,loading:t,error:o,selectedCamera:v,getCamera:i,supportsFeature:p,loadCameras:m,setFocus:l,setWhiteBalance:c,setExposure:S,setISO:b,setShutter:h,setIris:f,setGain:k,setPTZ:w,recallPTZPreset:R,setColorCorrection:A,refreshCameraStatus:$}}const Pn={class:"flex items-center justify-between w-full"},Bn={class:"text-lg font-semibold text-preke-text"},Fn={key:0,class:"text-sm text-preke-text-muted mt-1"},Nn={key:0,class:"py-8 text-center text-preke-text-muted"},An={key:1,class:"py-8 text-center text-red-400"},Ln={key:2,class:"py-8 text-center text-preke-text-muted"},Dn={key:3,class:"camera-controls"},Vn={class:"tabs"},Un={key:0,class:"tab-content"},Wn={key:0,class:"control-group"},Hn={class:"control-row"},In={key:0,class:"control-slider"},On={class:"slider-value"},jn=["disabled"],zn={key:1,class:"control-group"},Gn={class:"control-row"},qn={key:0,class:"control-input"},Zn=["disabled"],Kn={key:2,class:"control-group"},Yn={class:"control-row"},Qn={key:0,class:"control-slider"},Xn={class:"slider-value"},Jn=["disabled"],ea={key:1,class:"tab-content"},ta={key:0,class:"control-group"},na={class:"control-input"},aa=["disabled"],oa={key:1,class:"control-group"},sa={class:"control-input"},la=["disabled"],ia={key:2,class:"control-group"},ra={class:"control-row"},ca={key:0,class:"control-input"},ua=["disabled"],da={key:3,class:"control-group"},va={class:"control-input"},ma=["disabled"],fa={key:2,class:"tab-content"},pa={class:"control-group"},ga={class:"ptz-controls"},ba={class:"ptz-axis"},_a={class:"slider-value"},ya={class:"ptz-axis"},ha={class:"slider-value"},wa={class:"ptz-axis"},ka={class:"slider-value"},Ca={key:3,class:"tab-content"},$a=oe({__name:"CameraControlModal",props:{cameraName:{}},emits:["close"],setup(n,{expose:t,emit:o}){const v=n,m=o,i=_(null),{loading:p,error:l,supportsFeature:c,loadCameras:S,getCamera:b}=Ee(),h=_("basic"),f=P(()=>v.cameraName?b.value(v.cameraName):null),k=_("auto"),w=_(.5),R=_("auto"),A=_(5600),$=_("auto"),a=_(.5),s=_(400),u=_(1/60),B=_("auto"),Z=_(2.8),J=_(0),ee=_(0),H=_(0),K=_(0),M=_(!1);le(async()=>{await S(),v.cameraName&&f.value&&await E()}),ne(()=>v.cameraName,async U=>{U&&f.value&&await E()});async function E(){!v.cameraName||f.value}function C(){var U;(U=i.value)==null||U.open()}function y(){var U;(U=i.value)==null||U.close(),m("close")}const{setFocus:T,setWhiteBalance:G,setExposure:D,setISO:W,setShutter:O,setIris:Oe,setGain:je,setPTZ:ze}=Ee();async function Ge(){if(v.cameraName){M.value=!0;try{await T(v.cameraName,k.value,k.value==="manual"?w.value:void 0)}catch(U){alert(`Failed to set focus: ${U.message}`)}finally{M.value=!1}}}async function qe(){if(v.cameraName){M.value=!0;try{await G(v.cameraName,R.value,R.value==="manual"?A.value:void 0)}catch(U){alert(`Failed to set white balance: ${U.message}`)}finally{M.value=!1}}}async function Ze(){if(v.cameraName){M.value=!0;try{await D(v.cameraName,$.value,$.value==="manual"?a.value:void 0)}catch(U){alert(`Failed to set exposure: ${U.message}`)}finally{M.value=!1}}}async function Ke(){if(v.cameraName){M.value=!0;try{await W(v.cameraName,s.value)}catch(U){alert(`Failed to set ISO: ${U.message}`)}finally{M.value=!1}}}async function Ye(){if(v.cameraName){M.value=!0;try{await O(v.cameraName,u.value)}catch(U){alert(`Failed to set shutter: ${U.message}`)}finally{M.value=!1}}}async function Qe(){if(v.cameraName){M.value=!0;try{await Oe(v.cameraName,B.value,B.value==="manual"?Z.value:void 0)}catch(U){alert(`Failed to set iris: ${U.message}`)}finally{M.value=!1}}}async function Xe(){if(v.cameraName){M.value=!0;try{await je(v.cameraName,J.value)}catch(U){alert(`Failed to set gain: ${U.message}`)}finally{M.value=!1}}}async function Je(){if(v.cameraName)try{await ze(v.cameraName,ee.value,H.value,K.value)}catch(U){alert(`Failed to move PTZ: ${U.message}`)}}return t({open:C,close:y}),(U,r)=>(d(),pe(We,{ref_key:"modalRef",ref:i,title:"Camera Controls",size:"xl",onClose:r[22]||(r[22]=N=>m("close"))},{header:se(()=>[e("div",Pn,[e("div",null,[e("h2",Bn,x(n.cameraName||"Camera Controls"),1),f.value?(d(),g("p",Fn,[ue(x(f.value.type==="blackmagic"?"Blackmagic Design":"OBSbot Tail 2")+" ",1),e("span",{class:L([f.value.connected?"text-green-500":"text-red-500","ml-2"])},x(f.value.connected?"● Connected":"○ Disconnected"),3)])):F("",!0)])])]),default:se(()=>[V(p)?(d(),g("div",Nn," Loading camera settings... ")):V(l)?(d(),g("div",An,x(V(l)),1)):f.value?(d(),g("div",Dn,[e("div",Vn,[V(c)(n.cameraName,"focus")||V(c)(n.cameraName,"whiteBalance")||V(c)(n.cameraName,"exposure")?(d(),g("button",{key:0,class:L(["tab",{"tab--active":h.value==="basic"}]),onClick:r[0]||(r[0]=N=>h.value="basic")}," Basic ",2)):F("",!0),V(c)(n.cameraName,"iso")||V(c)(n.cameraName,"shutter")||V(c)(n.cameraName,"iris")||V(c)(n.cameraName,"gain")?(d(),g("button",{key:1,class:L(["tab",{"tab--active":h.value==="advanced"}]),onClick:r[1]||(r[1]=N=>h.value="advanced")}," Advanced ",2)):F("",!0),V(c)(n.cameraName,"ptz")?(d(),g("button",{key:2,class:L(["tab",{"tab--active":h.value==="ptz"}]),onClick:r[2]||(r[2]=N=>h.value="ptz")}," PTZ ",2)):F("",!0),V(c)(n.cameraName,"colorCorrection")?(d(),g("button",{key:3,class:L(["tab",{"tab--active":h.value==="color"}]),onClick:r[3]||(r[3]=N=>h.value="color")}," Color ",2)):F("",!0)]),h.value==="basic"?(d(),g("div",Un,[V(c)(n.cameraName,"focus")?(d(),g("div",Wn,[r[23]||(r[23]=e("label",{class:"control-label"},"Focus",-1)),e("div",Hn,[e("button",{class:L(["mode-btn",{"mode-btn--active":k.value==="auto"}]),onClick:r[4]||(r[4]=N=>k.value="auto")}," Auto ",2),e("button",{class:L(["mode-btn",{"mode-btn--active":k.value==="manual"}]),onClick:r[5]||(r[5]=N=>k.value="manual")}," Manual ",2)]),k.value==="manual"?(d(),g("div",In,[I(e("input",{"onUpdate:modelValue":r[6]||(r[6]=N=>w.value=N),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[q,w.value,void 0,{number:!0}]]),e("span",On,x(Math.round(w.value*100))+"%",1)])):F("",!0),e("button",{onClick:Ge,disabled:M.value,class:"save-btn"},x(M.value?"Saving...":"Save Focus"),9,jn)])):F("",!0),V(c)(n.cameraName,"whiteBalance")?(d(),g("div",zn,[r[25]||(r[25]=e("label",{class:"control-label"},"White Balance",-1)),e("div",Gn,[e("button",{class:L(["mode-btn",{"mode-btn--active":R.value==="auto"}]),onClick:r[7]||(r[7]=N=>R.value="auto")}," Auto ",2),e("button",{class:L(["mode-btn",{"mode-btn--active":R.value==="manual"}]),onClick:r[8]||(r[8]=N=>R.value="manual")}," Manual ",2)]),R.value==="manual"?(d(),g("div",qn,[I(e("input",{"onUpdate:modelValue":r[9]||(r[9]=N=>A.value=N),type:"number",min:"2000",max:"10000",step:"100",class:"input"},null,512),[[q,A.value,void 0,{number:!0}]]),r[24]||(r[24]=e("span",{class:"input-unit"},"K",-1))])):F("",!0),e("button",{onClick:qe,disabled:M.value,class:"save-btn"},x(M.value?"Saving...":"Save White Balance"),9,Zn)])):F("",!0),V(c)(n.cameraName,"exposure")?(d(),g("div",Kn,[r[26]||(r[26]=e("label",{class:"control-label"},"Exposure",-1)),e("div",Yn,[e("button",{class:L(["mode-btn",{"mode-btn--active":$.value==="auto"}]),onClick:r[10]||(r[10]=N=>$.value="auto")}," Auto ",2),e("button",{class:L(["mode-btn",{"mode-btn--active":$.value==="manual"}]),onClick:r[11]||(r[11]=N=>$.value="manual")}," Manual ",2)]),$.value==="manual"?(d(),g("div",Qn,[I(e("input",{"onUpdate:modelValue":r[12]||(r[12]=N=>a.value=N),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[q,a.value,void 0,{number:!0}]]),e("span",Xn,x(Math.round(a.value*100))+"%",1)])):F("",!0),e("button",{onClick:Ze,disabled:M.value,class:"save-btn"},x(M.value?"Saving...":"Save Exposure"),9,Jn)])):F("",!0)])):F("",!0),h.value==="advanced"?(d(),g("div",ea,[V(c)(n.cameraName,"iso")?(d(),g("div",ta,[r[27]||(r[27]=e("label",{class:"control-label"},"ISO",-1)),e("div",na,[I(e("input",{"onUpdate:modelValue":r[13]||(r[13]=N=>s.value=N),type:"number",min:"100",max:"25600",step:"100",class:"input"},null,512),[[q,s.value,void 0,{number:!0}]])]),e("button",{onClick:Ke,disabled:M.value,class:"save-btn"},x(M.value?"Saving...":"Save ISO"),9,aa)])):F("",!0),V(c)(n.cameraName,"shutter")?(d(),g("div",oa,[r[29]||(r[29]=e("label",{class:"control-label"},"Shutter Speed",-1)),e("div",sa,[I(e("input",{"onUpdate:modelValue":r[14]||(r[14]=N=>u.value=N),type:"number",min:"0.0001",max:"1",step:"0.0001",class:"input"},null,512),[[q,u.value,void 0,{number:!0}]]),r[28]||(r[28]=e("span",{class:"input-unit"},"s",-1))]),e("button",{onClick:Ye,disabled:M.value,class:"save-btn"},x(M.value?"Saving...":"Save Shutter"),9,la)])):F("",!0),V(c)(n.cameraName,"iris")?(d(),g("div",ia,[r[31]||(r[31]=e("label",{class:"control-label"},"Iris",-1)),e("div",ra,[e("button",{class:L(["mode-btn",{"mode-btn--active":B.value==="auto"}]),onClick:r[15]||(r[15]=N=>B.value="auto")}," Auto ",2),e("button",{class:L(["mode-btn",{"mode-btn--active":B.value==="manual"}]),onClick:r[16]||(r[16]=N=>B.value="manual")}," Manual ",2)]),B.value==="manual"?(d(),g("div",ca,[I(e("input",{"onUpdate:modelValue":r[17]||(r[17]=N=>Z.value=N),type:"number",min:"1.4",max:"22",step:"0.1",class:"input"},null,512),[[q,Z.value,void 0,{number:!0}]]),r[30]||(r[30]=e("span",{class:"input-unit"},"f/",-1))])):F("",!0),e("button",{onClick:Qe,disabled:M.value,class:"save-btn"},x(M.value?"Saving...":"Save Iris"),9,ua)])):F("",!0),V(c)(n.cameraName,"gain")?(d(),g("div",da,[r[33]||(r[33]=e("label",{class:"control-label"},"Gain",-1)),e("div",va,[I(e("input",{"onUpdate:modelValue":r[18]||(r[18]=N=>J.value=N),type:"number",min:"-12",max:"36",step:"0.1",class:"input"},null,512),[[q,J.value,void 0,{number:!0}]]),r[32]||(r[32]=e("span",{class:"input-unit"},"dB",-1))]),e("button",{onClick:Xe,disabled:M.value,class:"save-btn"},x(M.value?"Saving...":"Save Gain"),9,ma)])):F("",!0)])):F("",!0),h.value==="ptz"?(d(),g("div",fa,[e("div",pa,[r[37]||(r[37]=e("label",{class:"control-label"},"Pan/Tilt/Zoom",-1)),e("div",ga,[e("div",ba,[r[34]||(r[34]=e("label",null,"Pan",-1)),I(e("input",{"onUpdate:modelValue":r[19]||(r[19]=N=>ee.value=N),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[q,ee.value,void 0,{number:!0}]]),e("span",_a,x(ee.value.toFixed(1)),1)]),e("div",ya,[r[35]||(r[35]=e("label",null,"Tilt",-1)),I(e("input",{"onUpdate:modelValue":r[20]||(r[20]=N=>H.value=N),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[q,H.value,void 0,{number:!0}]]),e("span",ha,x(H.value.toFixed(1)),1)]),e("div",wa,[r[36]||(r[36]=e("label",null,"Zoom",-1)),I(e("input",{"onUpdate:modelValue":r[21]||(r[21]=N=>K.value=N),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[q,K.value,void 0,{number:!0}]]),e("span",ka,x(K.value.toFixed(1)),1)])]),e("button",{onClick:Je,class:"save-btn"}," Move PTZ ")])])):F("",!0),h.value==="color"?(d(),g("div",Ca,[...r[38]||(r[38]=[e("div",{class:"control-group"},[e("p",{class:"text-preke-text-muted text-sm"}," Color correction controls coming soon ")],-1)])])):F("",!0)])):(d(),g("div",Ln," Camera not found "))]),_:1},512))}}),xa=de($a,[["__scopeId","data-v-5d82bd61"]]),Sa={key:0,class:"py-8 text-center text-preke-text-muted"},Ra={key:1,class:"camera-setup"},Ta={class:"camera-list"},Ma={class:"list-header"},Ea=["disabled"],Pa={key:0,class:"empty-state"},Ba={key:1,class:"camera-items"},Fa={class:"camera-item__info"},Na={class:"camera-item__header"},Aa={class:"camera-item__name"},La={class:"camera-item__details"},Da={class:"camera-item__type"},Va={class:"camera-item__ip"},Ua={class:"camera-item__actions"},Wa=["onClick","disabled"],Ha={key:0,class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ia={key:1,class:"spinner"},Oa=["onClick","disabled"],ja=["onClick","disabled"],za={key:0,class:"camera-form"},Ga={class:"form-header"},qa={class:"form-title"},Za={class:"form-content"},Ka={class:"form-group"},Ya={class:"form-group"},Qa=["value"],Xa={class:"form-group"},Ja={class:"form-group"},eo=["placeholder"],to={class:"form-hint"},no={class:"form-group"},ao={class:"form-checkbox"},oo={class:"form-actions"},so={class:"flex items-center justify-between w-full"},lo={key:0,class:"text-sm text-amber-400"},io={key:1,class:"text-sm text-preke-text-muted"},ro={class:"flex gap-3"},co=["disabled"],uo=oe({__name:"CameraSetupModal",emits:["close","updated"],setup(n,{expose:t,emit:o}){const v=o,m=_(null),i=He(),p=_(!1),l=_(!1),c=_(null),S=_([]),b=_(null),h=[{value:"blackmagic",label:"Blackmagic Design Studio Camera 4K Pro"},{value:"obsbot_tail2",label:"OBSbot Tail 2"}],f=_({name:"",type:"blackmagic",ip:"",port:void 0,enabled:!0}),k={blackmagic:80,obsbot_tail2:52381},w=P(()=>b.value!==null),R=_(!1);async function A(){p.value=!0;try{const E=await j.cameras.getConfig();S.value=E.cameras.map(C=>({name:C.name,type:C.type,ip:C.ip,port:C.port,enabled:C.enabled??!0})),R.value=!1}catch(E){console.error("[CameraSetup] Failed to load config:",E),i.error("Failed to load camera configuration")}finally{p.value=!1}}function $(){f.value={name:"",type:"blackmagic",ip:"",port:void 0,enabled:!0},b.value=null}function a(E){b.value=E,f.value={...S.value[E]}}function s(){$()}function u(){$(),b.value=-1}async function B(E){confirm(`Delete camera "${S.value[E].name}"?`)&&(S.value.splice(E,1),R.value=!0,await H())}async function Z(E){c.value=E.name;try{(await j.cameras.getStatus(E.name)).connected?i.success(`${E.name} is connected!`):i.warning(`${E.name} is not connected`)}catch{try{const y=await fetch(`http://${E.ip}:${E.port||k[E.type]}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(3e3)});i.info(`${E.name}: IP ${E.ip} is reachable`)}catch{i.error(`${E.name}: Cannot reach ${E.ip}`)}}finally{c.value=null}}function J(){return f.value.name.trim()?f.value.ip.trim()?/^(\d{1,3}\.){3}\d{1,3}$/.test(f.value.ip)?S.value.findIndex((y,T)=>y.name===f.value.name&&T!==b.value)>=0?(i.error("Camera name already exists"),!1):!0:(i.error("Invalid IP address format"),!1):(i.error("Camera IP address is required"),!1):(i.error("Camera name is required"),!1)}function ee(){J()&&(f.value.port||(f.value.port=k[f.value.type]),b.value===-1?S.value.push({...f.value}):b.value!==null&&b.value>=0&&(S.value[b.value]={...f.value}),R.value=!0,$())}async function H(){l.value=!0;try{await j.cameras.updateConfig(S.value),i.success("Camera configuration saved!"),R.value=!1,v("updated")}catch(E){console.error("[CameraSetup] Failed to save config:",E),i.error("Failed to save configuration: "+(E.message||"Unknown error"))}finally{l.value=!1}}function K(){var E;(E=m.value)==null||E.open(),A()}function M(){var E;R.value&&!confirm("You have unsaved changes. Close anyway?")||((E=m.value)==null||E.close(),$(),R.value=!1,v("close"))}return t({open:K,close:M}),le(()=>{A()}),(E,C)=>(d(),pe(We,{ref_key:"modalRef",ref:m,title:"Camera Setup",size:"xl",onClose:M},{header:se(()=>[...C[5]||(C[5]=[e("div",{class:"flex items-center justify-between w-full"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-preke-text"},"Camera Setup"),e("p",{class:"text-sm text-preke-text-muted mt-1"}," Configure external cameras for control ")])],-1)])]),footer:se(()=>[e("div",so,[R.value?(d(),g("div",lo," You have unsaved changes ")):(d(),g("div",io,x(S.value.length)+" camera"+x(S.value.length!==1?"s":"")+" configured ",1)),e("div",ro,[e("button",{onClick:M,class:"btn-secondary"}," Close "),e("button",{onClick:H,disabled:!R.value||l.value,class:"btn-primary"},x(l.value?"Saving...":"Save Configuration"),9,co)])])]),default:se(()=>[p.value?(d(),g("div",Sa," Loading camera configuration... ")):(d(),g("div",Ra,[e("div",Ta,[e("div",Ma,[C[7]||(C[7]=e("h3",{class:"list-title"},"Configured Cameras",-1)),e("button",{onClick:u,class:"btn-add",disabled:w.value},[...C[6]||(C[6]=[e("svg",{class:"btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),ue(" Add Camera ",-1)])],8,Ea)]),S.value.length===0&&!w.value?(d(),g("div",Pa,[...C[8]||(C[8]=[e("svg",{class:"empty-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"empty-text"},"No cameras configured",-1),e("p",{class:"empty-hint"},'Click "Add Camera" to get started',-1)])])):(d(),g("div",Ba,[(d(!0),g(ae,null,he(S.value,(y,T)=>{var G;return d(),g("div",{key:T,class:L(["camera-item",{"camera-item--disabled":!y.enabled}])},[e("div",Fa,[e("div",Na,[e("span",Aa,x(y.name),1),e("span",{class:L(["camera-item__badge",y.enabled?"camera-item__badge--enabled":"camera-item__badge--disabled"])},x(y.enabled?"Enabled":"Disabled"),3)]),e("div",La,[e("span",Da,x(((G=h.find(D=>D.value===y.type))==null?void 0:G.label)||y.type),1),e("span",Va,x(y.ip)+":"+x(y.port||k[y.type]),1)])]),e("div",Ua,[e("button",{onClick:D=>Z(y),disabled:c.value===y.name,class:"btn-test",title:"Test Connection"},[c.value!==y.name?(d(),g("svg",Ha,[...C[9]||(C[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])])):(d(),g("span",Ia))],8,Wa),e("button",{onClick:D=>a(T),disabled:w.value,class:"btn-edit",title:"Edit"},[...C[10]||(C[10]=[e("svg",{class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,Oa),e("button",{onClick:D=>B(T),disabled:w.value,class:"btn-delete",title:"Delete"},[...C[11]||(C[11]=[e("svg",{class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ja)])],2)}),128))]))]),w.value?(d(),g("div",za,[e("div",Ga,[e("h3",qa,x(b.value===-1?"Add Camera":"Edit Camera"),1),e("button",{onClick:s,class:"btn-cancel-form"},"Cancel")]),e("div",Za,[e("div",Ka,[C[12]||(C[12]=e("label",{class:"form-label"},"Camera Name *",-1)),I(e("input",{"onUpdate:modelValue":C[0]||(C[0]=y=>f.value.name=y),type:"text",class:"form-input",placeholder:"e.g., BMD Cam 1"},null,512),[[q,f.value.name]])]),e("div",Ya,[C[13]||(C[13]=e("label",{class:"form-label"},"Camera Type *",-1)),I(e("select",{"onUpdate:modelValue":C[1]||(C[1]=y=>f.value.type=y),class:"form-input"},[(d(),g(ae,null,he(h,y=>e("option",{key:y.value,value:y.value},x(y.label),9,Qa)),64))],512),[[lt,f.value.type]])]),e("div",Xa,[C[14]||(C[14]=e("label",{class:"form-label"},"IP Address *",-1)),I(e("input",{"onUpdate:modelValue":C[2]||(C[2]=y=>f.value.ip=y),type:"text",class:"form-input",placeholder:"192.168.1.101"},null,512),[[q,f.value.ip]]),C[15]||(C[15]=e("p",{class:"form-hint"},"Camera's network IP address",-1))]),e("div",Ja,[C[16]||(C[16]=e("label",{class:"form-label"},"Port",-1)),I(e("input",{"onUpdate:modelValue":C[3]||(C[3]=y=>f.value.port=y),type:"number",class:"form-input",placeholder:String(k[f.value.type])},null,8,eo),[[q,f.value.port,void 0,{number:!0}]]),e("p",to,"Default: "+x(k[f.value.type])+" for "+x(f.value.type),1)]),e("div",no,[e("label",ao,[I(e("input",{"onUpdate:modelValue":C[4]||(C[4]=y=>f.value.enabled=y),type:"checkbox",class:"checkbox"},null,512),[[it,f.value.enabled]]),C[17]||(C[17]=e("span",null,"Enabled",-1))]),C[18]||(C[18]=e("p",{class:"form-hint"},"Disable to keep configuration but not use the camera",-1))]),e("div",oo,[e("button",{onClick:ee,class:"btn-save-form"},x(b.value===-1?"Add Camera":"Update Camera"),1),e("button",{onClick:s,class:"btn-cancel-form"}," Cancel ")])])])):F("",!0)]))]),_:1},512))}}),vo=de(uo,[["__scopeId","data-v-d42e0adf"]]),mo={class:"sidebar"},fo={class:"sidebar__card sidebar__card--header"},po={class:"connection-row"},go={class:"connection-status"},bo={class:"connection-label"},_o={key:0,class:"connection-latency"},yo=["disabled"],ho={class:"sidebar__card sidebar__card--recording"},wo={class:"recording__duration"},ko={class:"recording__meta"},Co={key:0,class:"sidebar__card sidebar__card--warning"},$o={class:"warning__text"},xo={key:1,class:"sidebar__card sidebar__card--davinci"},So={class:"davinci__buttons"},Ro=["disabled"],To=["disabled"],Mo={class:"sidebar__card"},Eo={key:0,class:"cameras"},Po={class:"camera__header"},Bo=["onClick","disabled"],Fo={key:1,class:"cameras-empty"},No=oe({__name:"SessionInfoV2",setup(n){const t=Ie(),o=ie(),v=Pe(),m=He(),{state:i,latencyMs:p}=rt(),{connectionMethod:l}=ct(),c=P(()=>{const y=i.value==="connected",T=i.value==="connecting",G=i.value==="degraded";if(y){let D="";return l.value==="relay"?D="Relay":l.value==="p2p"?D="P2P":l.value==="local"&&(D="Local"),{status:"online",color:"green",label:D||"Connected",latency:p.value,pulse:!1}}return T?{status:"connecting",color:"amber",label:"Connecting...",latency:null,pulse:!0}:G?{status:"degraded",color:"amber",label:"Slow",latency:p.value,pulse:!1}:{status:"offline",color:"red",label:"Offline",latency:null,pulse:!0}}),S=P(()=>o.currentSession);P(()=>o.activeInputs);const b=P(()=>o.isRecording),h=P(()=>o.inputs.filter(y=>y.isRecording)),f=_("");le(()=>{const T=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,".");f.value=`Session ${T}`});const{cameras:k,loadCameras:w}=Ee(),R=_(null),A=_(null),$=_(null);le(async()=>{await w()});function a(y){var T;R.value=y,(T=A.value)==null||T.open()}function s(){R.value=null}function u(){var y;(y=$.value)==null||y.open()}function B(){w()}const Z=P(()=>{const y=v.capabilities;if(!y)return null;const T=y.storage_used_gb||0,G=y.storage_total_gb||1,D=G-T,W=Math.round(T/G*100),O=D/10;return{freeGB:Math.round(D),totalGB:Math.round(G),percent:W,hoursRemaining:Math.round(O*10)/10,isLow:W>85,isCritical:W>95}});function J(){t.push({name:"admin",query:{tab:"settings"}})}const ee=P(()=>ut()),H=_(!1),K=P(()=>{const y=S.value;return y!=null&&y.id?`Preke_${y.id}`:`Preke_${f.value.replace(/\s+/g,"_")}`}),M=window.electronAPI;async function E(){if(M!=null&&M.davinciOpenProject){H.value=!0,m.info("Opening DaVinci Resolve...");try{const y=await M.davinciOpenProject(K.value);y.success?m.success(`Opened project: ${y.projectName}`):m.error(y.error||"Failed to open DaVinci project")}catch(y){console.error("DaVinci error:",y),m.error("Failed to connect to DaVinci Resolve")}finally{H.value=!1}}}async function C(){if(M!=null&&M.davinciCreateMulticam){H.value=!0;try{M.davinciOpenProject&&await M.davinciOpenProject(K.value);const y=await M.davinciCreateMulticam({projectName:K.value,clipName:`Multicam_${f.value.replace(/\s+/g,"_")}`,syncMethod:"timecode"});y.success?m.success(`Created timeline: ${y.timelineName}`):m.error(y.error||"Failed to create multicam timeline")}catch(y){console.error("DaVinci error:",y),m.error("Failed to create multicam timeline")}finally{H.value=!1}}}return(y,T)=>{var G;return d(),g("div",mo,[e("div",fo,[e("div",po,[e("div",go,[e("span",{class:L(["connection-dot",[`connection-dot--${c.value.color}`,{"connection-dot--pulse":c.value.pulse}]])},null,2),e("span",bo,x(c.value.label),1),c.value.latency?(d(),g("span",_o,x(c.value.latency)+"ms ",1)):F("",!0)])]),T[1]||(T[1]=e("div",{class:"sidebar__divider"},null,-1)),T[2]||(T[2]=e("label",{class:"sidebar__label"},"Session Name",-1)),I(e("input",{"onUpdate:modelValue":T[0]||(T[0]=D=>f.value=D),type:"text",class:"sidebar__input",placeholder:"Session 06.01.2026",disabled:b.value},null,8,yo),[[q,f.value]])]),b.value?(d(),g(ae,{key:0},[e("div",ho,[T[3]||(T[3]=e("div",{class:"recording__header"},[e("span",{class:"recording__dot"}),e("span",{class:"recording__label"},"Recording")],-1)),e("div",wo,x(V(o).formattedDuration),1),e("div",ko,x(h.value.length)+" camera"+x(h.value.length!==1?"s":"")+" recording ",1)]),(G=Z.value)!=null&&G.isLow?(d(),g("div",Co,[T[5]||(T[5]=e("span",{class:"warning__icon"},"⚠️",-1)),e("div",$o,[T[4]||(T[4]=e("strong",null,"Low storage",-1)),e("span",null,x(Z.value.freeGB)+" GB remaining",1)])])):F("",!0),ee.value?(d(),g("div",xo,[T[6]||(T[6]=Ue('<div class="davinci__header" data-v-16fa43c5><svg class="davinci__icon" viewBox="0 0 24 24" fill="currentColor" data-v-16fa43c5><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" data-v-16fa43c5></path></svg><span class="davinci__label" data-v-16fa43c5>DaVinci Resolve</span></div><p class="davinci__hint" data-v-16fa43c5>Edit while recording (mount R58 recordings via SMB)</p>',2)),e("div",So,[e("button",{onClick:E,disabled:H.value,class:"davinci__btn"},x(H.value?"Opening...":"Open Project"),9,Ro),e("button",{onClick:C,disabled:H.value,class:"davinci__btn davinci__btn--secondary"}," Create Multicam ",8,To)])])):F("",!0)],64)):(d(),g(ae,{key:1},[e("div",Mo,[e("div",{class:"sidebar__label"},[T[8]||(T[8]=ue(" Camera Controls ",-1)),e("button",{onClick:u,class:"camera-setup-btn",title:"Setup Cameras"},[...T[7]||(T[7]=[e("svg",{class:"camera-setup-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])])]),V(k).length>0?(d(),g("div",Eo,[(d(!0),g(ae,null,he(V(k),D=>(d(),g("div",{key:D.name,class:"camera"},[e("div",Po,[ue(x(D.name)+" ",1),e("span",{class:L(["camera__status",D.connected?"camera__status--connected":"camera__status--disconnected"])},x(D.connected?"●":"○"),3)]),e("button",{class:"camera__control-btn",onClick:W=>a(D.name),disabled:!D.connected},[...T[9]||(T[9]=[e("svg",{class:"camera__control-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),e("span",null,"Controls",-1)])],8,Bo)]))),128))])):(d(),g("div",Fo,[T[10]||(T[10]=e("p",{class:"cameras-empty__text"},"No cameras configured",-1)),e("button",{onClick:u,class:"cameras-empty__btn"}," Setup Cameras ")]))]),Q(xa,{ref_key:"cameraModalRef",ref:A,"camera-name":R.value,onClose:s},null,8,["camera-name"]),Q(vo,{ref_key:"cameraSetupModalRef",ref:$,onUpdated:B},null,512),e("div",{class:"sidebar__card"},[T[12]||(T[12]=e("div",{class:"sidebar__label"},"Quick Actions",-1)),e("button",{onClick:J,class:"sidebar__btn"},[...T[11]||(T[11]=[e("svg",{class:"sidebar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),ue(" Configure Inputs ",-1)])])])],64))])}}}),Ao=de(No,[["__scopeId","data-v-16fa43c5"]]),Lo={class:"h-full flex flex-col"},Do={class:"recorder-header"},Vo={class:"recorder-header__left"},Uo={class:"recorder-header__title"},Wo={key:0,class:"recorder-header__badge"},Ho={class:"flex-1 flex min-h-0 overflow-hidden"},Io={class:"flex-1 min-h-0 min-w-0 p-3 overflow-hidden"},Oo={class:"w-72 flex-shrink-0 border-l border-preke-surface-border bg-preke-surface/80 backdrop-blur-lg p-4 overflow-y-auto"},jo=oe({__name:"RecorderView",setup(n){const t=Ie(),o=ie(),v=Pe(),{showLeaveConfirmation:m,confirmLeave:i,cancelLeave:p}=pt();function l(){t.push("/")}const c=P(()=>o.status==="recording"),S=P(()=>o.formattedDuration),b=_(!0),h=_(!1),f=_(!1),k=P(()=>h.value&&f.value);function w(){b.value=!1}async function R(){var s;if(!dt())return;await v.fetchCapabilities();const a=(s=v.capabilities)==null?void 0:s.current_mode;if(a&&a!=="recorder"){console.log("[Recorder] Not in recorder mode, switching...");try{(await fetch(await vt("/api/mode/recorder"),{method:"POST"})).ok&&(await v.fetchCapabilities(),re.success("Switched to Recorder mode"))}catch(u){console.warn("[Recorder] Failed to switch mode:",u)}}}function A(){console.log("[Recorder] All videos ready!"),f.value=!0}le(async()=>{const a=performance.now();await Promise.all([R(),o.fetchInputs(),o.fetchStatus()]);const s=o.inputs.filter(u=>u.hasSignal).length;console.log(`[Recorder] Data loaded: ${o.inputs.length} inputs, ${s} with signal (${Math.round(performance.now()-a)}ms)`),h.value=!0,s===0&&(f.value=!0)});const $=_(null);return ne(m,a=>{var s,u;a?(s=$.value)==null||s.open():(u=$.value)==null||u.close()}),(a,s)=>(d(),g(ae,null,[Q(Me,{name:"fade"},{default:se(()=>[b.value?(d(),pe(ft,{key:0,mode:"recorder","content-ready":k.value,"min-time":1500,"max-time":5e3,"show-cancel":!0,onReady:w,onCancel:l},null,8,["content-ready"])):F("",!0)]),_:1}),Q(Me,{name:"content-fade"},{default:se(()=>[I(e("div",Lo,[e("header",Do,[e("div",Vo,[e("div",Uo,[e("span",{class:L(["recorder-header__indicator",{"recorder-header__indicator--active":c.value}])},null,2),s[0]||(s[0]=e("span",{class:"recorder-header__label"},"Recorder",-1))]),c.value?(d(),g("span",Wo," REC ")):F("",!0),Q(Yt)]),Q(Wt)]),e("div",Ho,[e("div",Io,[Q(En,{onAllVideosReady:A})]),e("aside",Oo,[Q(Ao)])]),Q(De,{ref_key:"leaveDialog",ref:$,title:"Recording in Progress",message:`You are currently recording (${S.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:V(i),onCancel:V(p)},null,8,["message","onConfirm","onCancel"])],512),[[mt,!b.value]])]),_:1})],64))}}),qo=de(jo,[["__scopeId","data-v-a7fdeea3"]]);export{qo as default};
