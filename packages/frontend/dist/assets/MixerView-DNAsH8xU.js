import{d as P,A as V,r as p,h as y,B as D,c as l,a as s,b as _,t as m,n as S,F as w,q as C,o,j as M,l as k,m as O,T as U,J as j,E as B,_ as E}from"./index-DOS0A_I6.js";import{b as $,g as N,V as L,a as T,c as W}from"./vdoninja-6l6Gxvj5.js";import{M as F}from"./ModeLoadingScreen-DPo2jpZo.js";const z={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"camera-push-bar"},A={class:"flex items-center gap-2"},H={class:"text-r58-text-secondary"},q={key:0,class:"px-4 pb-3"},I={key:0,class:"flex gap-3 flex-wrap"},J={class:"text-sm font-medium"},G={class:"text-xs text-r58-text-secondary"},K=["onClick"],Q={key:1,class:"text-sm text-r58-text-secondary py-2"},X={class:"hidden"},Y=["src","onLoad","onError"],Z=P({__name:"CameraPushBar",setup(R){const f=V(),n=p(new Map),i=p(!0),h=y(()=>f.inputs.filter(e=>e.hasSignal));function x(e){return N(e)}D(h,e=>{for(const t of e)if(!n.value.has(t.id)){const c=x(t.id),u=$(t.id,c,t.label);n.value.set(t.id,{cameraId:t.id,label:t.label,status:"connecting",iframeSrc:u})}const r=new Set(e.map(t=>t.id));for(const[t]of n.value)r.has(t)||n.value.delete(t)},{immediate:!0});function g(e){const r=n.value.get(e);r&&(r.status="connected",console.log(`[CameraPush] ${e} connected to VDO.ninja`))}function b(e){const r=n.value.get(e);r&&(r.status="error",console.error(`[CameraPush] ${e} failed to connect`))}function v(e){const r=f.inputs.find(u=>u.id===e);if(!r||!r.hasSignal)return;const t=x(e),c=$(e,t,r.label);n.value.set(e,{cameraId:e,label:r.label,status:"connecting",iframeSrc:c+`&_t=${Date.now()}`})}function d(e){switch(e){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function a(e){switch(e){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(e,r)=>(o(),l("div",z,[s("button",{onClick:r[0]||(r[0]=t=>i.value=!i.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[s("div",A,[r[1]||(r[1]=s("span",{class:"font-medium"},"Camera Sources",-1)),s("span",H,"("+m(h.value.length)+" active)",1)]),(o(),l("svg",{class:S(["w-4 h-4 transition-transform",{"rotate-180":i.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...r[2]||(r[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),i.value?(o(),l("div",q,[n.value.size>0?(o(),l("div",I,[(o(!0),l(w,null,C(n.value,([t,c])=>(o(),l("div",{key:t,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[s("span",{class:S(["w-2 h-2 rounded-full",d(c.status)])},null,2),s("span",J,m(c.label),1),s("span",G,m(a(c.status)),1),c.status==="error"?(o(),l("button",{key:0,onClick:u=>v(t),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,K)):_("",!0)]))),128))])):(o(),l("div",Q," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):_("",!0),s("div",X,[(o(!0),l(w,null,C(n.value,([t,c])=>(o(),l("iframe",{key:t,src:c.iframeSrc,onLoad:u=>g(t),onError:u=>b(t),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Y))),128))])]))}}),ee={class:"h-full flex flex-col bg-r58-bg-primary"},te={class:"flex items-center justify-between px-4 py-2 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},se={class:"flex items-center gap-3"},re={class:"text-sm text-r58-text-secondary"},ae={class:"flex items-center gap-2 text-xs text-r58-text-secondary"},ne={class:"px-2 py-1 bg-r58-bg-tertiary rounded"},oe={class:"flex-1 relative"},le=["src"],ce={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-primary"},ie=P({__name:"MixerView",setup(R){const f=V(),n=p(!0),i=p(!1),h=p(null),x=y(()=>{const d="r58-vdo.itagenten.no",a=new URL(`https://${d}/`);a.searchParams.set("director",L),a.searchParams.set("password",T),a.searchParams.set("darkmode",""),a.searchParams.set("nologo",""),a.searchParams.set("hideheader",""),a.searchParams.set("api","");const e=W();return e&&a.searchParams.set("css",e),a.toString()}),g=y(()=>f.inputs.filter(d=>d.hasSignal).length);function b(){console.log("[Mixer] Native mixer iframe loaded"),i.value=!0}function v(){n.value=!1}return M(async()=>{await f.fetchInputs()}),(d,a)=>(o(),l(w,null,[k(U,{name:"fade"},{default:O(()=>[n.value?(o(),B(F,{key:0,mode:"mixer","content-ready":i.value,"min-time":1500,"max-time":1e4,onReady:v},null,8,["content-ready"])):_("",!0)]),_:1}),s("div",ee,[s("header",te,[s("div",se,[a[0]||(a[0]=s("span",{class:"text-lg font-semibold text-r58-mixer"},"Mixer",-1)),s("span",re,m(g.value)+" camera"+m(g.value!==1?"s":"")+" connected ",1)]),s("div",ae,[s("span",ne,"Room: "+m(j(L)),1)])]),s("div",oe,[s("iframe",{ref_key:"iframeRef",ref:h,src:x.value,onLoad:b,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,le),i.value?_("",!0):(o(),l("div",ce,[...a[1]||(a[1]=[s("div",{class:"flex flex-col items-center gap-4"},[s("div",{class:"w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full animate-spin"}),s("span",{class:"text-r58-text-secondary"},"Loading VDO.ninja mixer...")],-1)])]))]),k(Z)])],64))}}),fe=E(ie,[["__scopeId","data-v-0cd9f7b0"]]);export{fe as default};
