import{d as Z,r as n,j as I,k as ee,o as te,l as se,c as o,f as q,m as le,w as O,p as oe,T as ae,v as ne,a as t,q as j,s as G,e as i,F as C,x as u,n as D,y as F,t as v,z as ie,A as re,g as de,B as ce,C as ve,i as a,_ as ue}from"./index-DAwJWy82.js";const fe={class:"setup-page"},we={class:"welcome-content"},pe={class:"welcome-logo-wrap"},me={class:"welcome-logo-inline"},_e=["src"],ge={class:"setup-page__content"},be={class:"logo-hero"},he={class:"logo-hero__inline"},ye=["src"],ke={class:"setup-card"},Ce={class:"discovery-section"},De={class:"discovery-header"},Ae={key:0,class:"section-title"},Se={key:1,class:"section-title-spacer"},Pe=["disabled"],xe={key:0,class:"scan-indicator"},Ie={class:"soundwave"},Me={key:0,class:"scan-status"},Be={key:1,class:"device-group"},Ve={class:"device-group__label"},ze={key:0,class:"device-group__count"},Fe={key:0,class:"device-selection"},He={class:"device-item__info"},$e={class:"device-item__name"},Ne={key:0,class:"device-item__version"},Te={class:"device-item__url"},Ue=["onClick"],Re={key:2,class:"device-group"},Le={key:0,class:"device-group__label"},Ee={class:"device-item__info"},We={class:"device-item__name"},qe={key:0,class:"device-item__badge"},Oe={class:"device-item__url"},je={class:"device-item__actions"},Ge=["onClick"],Ke=["onClick"],Xe={key:3,class:"empty-state"},Je={class:"empty-state__actions"},Qe=["disabled"],Ye={class:"manual-section"},Ze={class:"manual-form__row"},et=["disabled"],tt={key:0,class:"spinner",viewBox:"0 0 24 24"},st={key:0,class:"field-error"},lt={key:0,class:"electron-warning"},ot={class:"setup-footer"},at=30,nt=Z({__name:"DeviceSetupView",setup(it){const H=de(),f=n([]),_=n(null),m=n(!0),$=n(!1),d=n(!1),r=n(!1),c=n([]),h=n(""),A=n(null),S=n(null),M=n(0),y=n(!1),g=n(""),B=n(""),w=n(""),P=n(!1),N=[],b=I(()=>f.value.length>0),T=I(()=>f.value.find(s=>s.id===_.value)),K=I(()=>ee()),p=I(()=>{const s=new Set(f.value.map(l=>l.url.replace(/\/$/,""))),e=c.value.filter(l=>!s.has(l.url.replace(/\/$/,"")));return{saved:f.value,discovered:e}});async function x(){if(window.electronAPI)try{f.value=await window.electronAPI.getDevices();const s=await window.electronAPI.getActiveDevice();_.value=(s==null?void 0:s.id)||null}catch(s){console.error("Failed to load devices:",s)}}function V(s=!1){!window.electronAPI||d.value||(c.value=[],h.value="",s&&(M.value=0,r.value=!1,R()),window.electronAPI.startDiscovery())}function U(){window.electronAPI&&window.electronAPI.stopDiscovery()}function R(){k(),S.value=setTimeout(()=>{A.value=setInterval(()=>{var s;!d.value&&c.value.length===0&&!b.value&&(M.value<at?(M.value++,r.value=!0,(s=window.electronAPI)==null||s.startDiscovery()):k())},45e3)},3e4)}function k(){S.value&&(clearTimeout(S.value),S.value=null),A.value&&(clearInterval(A.value),A.value=null)}async function L(s){if(window.electronAPI)try{const e=await window.electronAPI.addDevice(s.name,s.url);await x(),f.value.length===1&&await z(e.id)}catch(e){console.error("Failed to add device:",e)}}async function X(){if(!window.electronAPI)return;if(w.value="",!g.value.trim()){w.value="URL is required";return}let s=g.value.trim();!s.startsWith("http://")&&!s.startsWith("https://")&&(s=`http://${s}`);try{new URL(s)}catch{w.value="Invalid URL format";return}P.value=!0;try{const e=await window.electronAPI.probeDevice(s);if(e)await L(e),g.value="",B.value="",y.value=!1;else{const l=await window.electronAPI.addDevice(B.value.trim()||"Preke Device",s);await x(),f.value.length===1&&await z(l.id),g.value="",B.value="",y.value=!1}}catch{w.value="Failed to add device"}finally{P.value=!1}}async function J(s){if(!(!window.electronAPI||!confirm("Remove this device?")))try{await window.electronAPI.removeDevice(s),await x()}catch(e){console.error("Failed to remove device:",e)}}async function z(s){if(window.electronAPI)try{await window.electronAPI.setActiveDevice(s),_.value=s;const e=f.value.find(l=>l.id===s);e&&ve(e.url),H.push("/")}catch(e){console.error("Failed to select device:",e)}}function E(){T.value&&H.push("/")}function Q(){window.electronAPI&&N.push(window.electronAPI.onDiscoveryStarted(()=>{d.value=!0}),window.electronAPI.onDeviceDiscovered(s=>{c.value.find(e=>e.id===s.id)||(c.value.push(s),k(),r.value=!1,m.value&&(m.value=!1))}),window.electronAPI.onScanningSubnet(s=>{r.value||(h.value=s)}),window.electronAPI.onDiscoveryComplete(s=>{d.value=!1,r.value=!1,h.value="";for(const e of s)c.value.find(l=>l.id===e.id)||c.value.push(e);(c.value.length>0||b.value)&&k()}))}function Y(){$.value=!0,setTimeout(()=>{m.value=!1},500)}return te(async()=>{if(await x(),Q(),b.value){m.value=!1;return}window.electronAPI&&(V(),R(),setTimeout(()=>{m.value&&c.value.length===0&&Y()},2500))}),se(()=>{for(const s of N)s();k(),d.value&&U()}),(s,e)=>(a(),o("div",fe,[e[29]||(e[29]=q('<div class="setup-page__bg" data-v-5f772d2b><div class="setup-page__bg-texture" data-v-5f772d2b></div><div class="bg-orb bg-orb--1" data-v-5f772d2b></div><div class="bg-orb bg-orb--2" data-v-5f772d2b></div><div class="bg-highlight bg-highlight--1" data-v-5f772d2b></div><div class="bg-highlight bg-highlight--2" data-v-5f772d2b></div></div>',1)),le(ae,{name:"welcome-fade"},{default:oe(()=>[m.value?(a(),o("div",{key:0,class:D(["welcome-screen",{"welcome-screen--fading":$.value}])},[e[7]||(e[7]=t("div",{class:"welcome-orb welcome-orb--1"},null,-1)),e[8]||(e[8]=t("div",{class:"welcome-orb welcome-orb--2"},null,-1)),e[9]||(e[9]=t("div",{class:"welcome-orb welcome-orb--3"},null,-1)),e[10]||(e[10]=t("div",{class:"welcome-orb welcome-orb--4"},null,-1)),e[11]||(e[11]=t("div",{class:"welcome-beam welcome-beam--1"},null,-1)),e[12]||(e[12]=t("div",{class:"welcome-beam welcome-beam--2"},null,-1)),e[13]||(e[13]=t("div",{class:"welcome-beam welcome-beam--3"},null,-1)),t("div",we,[t("div",pe,[t("div",me,[t("img",{src:j(G),alt:"",class:"welcome-logo-waveform"},null,8,_e),e[5]||(e[5]=t("div",{class:"welcome-logo-text"},[t("span",{class:"welcome-logo-preke"},"Preke"),t("span",{class:"welcome-logo-studio"},"Studio")],-1))]),e[6]||(e[6]=t("div",{class:"welcome-glow"},null,-1))])])],2)):i("",!0)]),_:1}),O(t("div",ge,[t("div",be,[t("div",he,[t("img",{src:j(G),alt:"",class:"logo-hero__waveform"},null,8,ye),e[14]||(e[14]=t("div",{class:"logo-hero__text"},[t("span",{class:"logo-hero__preke"},"Preke"),t("span",{class:"logo-hero__studio"},"Studio")],-1))])]),t("div",ke,[t("div",Ce,[t("div",De,[d.value&&!r.value||c.value.length>0||b.value?(a(),o("h2",Ae,[d.value&&!r.value?(a(),o(C,{key:0},[u("Searching...")],64)):(a(),o(C,{key:1},[u("Devices")],64))])):(a(),o("div",Se)),d.value&&!r.value?(a(),o("button",{key:2,onClick:U,class:"btn-scan btn-scan--stop"}," Stop ")):c.value.length>0||b.value?(a(),o("button",{key:3,onClick:e[0]||(e[0]=l=>V(!0)),disabled:d.value,class:D(["btn-scan",{"btn-scan--spinning":r.value}]),title:"Scan again"},[...e[15]||(e[15]=[t("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"btn-scan__icon"},[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1),u(" Scan ",-1)])],10,Pe)):i("",!0)]),d.value&&!r.value?(a(),o("div",xe,[t("div",Ie,[(a(),o(C,null,F(24,l=>t("span",{key:l,class:"soundwave__bar",style:ce({"--i":l})},null,4)),64))]),h.value?(a(),o("p",Me,"Scanning "+v(h.value)+".x",1)):i("",!0)])):i("",!0),p.value.discovered.length>0?(a(),o("div",Be,[t("p",Ve,[e[16]||(e[16]=u(" Found on network ",-1)),p.value.discovered.length>1?(a(),o("span",ze," ("+v(p.value.discovered.length)+" devices) ",1)):i("",!0)]),p.value.discovered.length>1?(a(),o("div",Fe,[...e[17]||(e[17]=[t("p",{class:"device-selection__hint"},"Select a device to connect:",-1)])])):i("",!0),(a(!0),o(C,null,F(p.value.discovered,l=>(a(),o("div",{key:l.id,class:"device-item device-item--discovered"},[e[18]||(e[18]=t("div",{class:"device-item__icon device-item__icon--new"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),t("path",{d:"M8 21h8M12 17v4"})])],-1)),t("div",He,[t("span",$e,v(l.name),1),l.version?(a(),o("span",Ne,"v"+v(l.version),1)):i("",!0),t("span",Te,v(l.host)+":"+v(l.port),1)]),t("button",{onClick:W=>L(l),class:"btn btn--primary"}," Connect ",8,Ue)]))),128))])):i("",!0),p.value.saved.length>0?(a(),o("div",Re,[p.value.discovered.length>0?(a(),o("p",Le,"Saved devices")):i("",!0),(a(!0),o(C,null,F(p.value.saved,l=>(a(),o("div",{key:l.id,class:D(["device-item",{"device-item--active":l.id===_.value}])},[e[20]||(e[20]=t("div",{class:"device-item__icon"},[t("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.5"},[t("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2"}),t("path",{d:"M8 21h8M12 17v4"})])],-1)),t("div",Ee,[t("span",We,v(l.name),1),l.id===_.value?(a(),o("span",qe,"Connected")):i("",!0),t("span",Oe,v(l.url),1)]),t("div",je,[l.id!==_.value?(a(),o("button",{key:0,onClick:W=>z(l.id),class:"btn btn--primary"}," Connect ",8,Ge)):(a(),o("button",{key:1,onClick:E,class:"btn btn--success"}," Open ")),t("button",{onClick:W=>J(l.id),class:"btn-icon btn-icon--danger",title:"Remove"},[...e[19]||(e[19]=[t("svg",{viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)])],8,Ke)])],2))),128))])):i("",!0),(!d.value||r.value)&&c.value.length===0&&!b.value?(a(),o("div",Xe,[e[22]||(e[22]=q('<div class="empty-state__icon" data-v-5f772d2b><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-v-5f772d2b><rect x="2" y="3" width="20" height="14" rx="2" data-v-5f772d2b></rect><path d="M8 21h8M12 17v4" data-v-5f772d2b></path><path d="M9 9l6 6M15 9l-6 6" stroke-width="1.5" stroke-linecap="round" data-v-5f772d2b></path></svg></div><p class="empty-state__title" data-v-5f772d2b>No devices found</p><p class="empty-state__hint" data-v-5f772d2b>Make sure your Preke device is:</p><ul class="empty-state__checklist" data-v-5f772d2b><li data-v-5f772d2b>Powered on</li><li data-v-5f772d2b>Connected to the same network</li><li data-v-5f772d2b>Finished booting up (~30 seconds)</li></ul>',4)),t("div",Je,[t("button",{onClick:e[1]||(e[1]=l=>V(!0)),disabled:d.value,class:D(["btn-scan-large",{"btn-scan-large--spinning":r.value}])},[e[21]||(e[21]=t("svg",{viewBox:"0 0 20 20",fill:"currentColor",class:"btn-scan-large__icon"},[t("path",{"fill-rule":"evenodd",d:"M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z","clip-rule":"evenodd"})],-1)),u(" "+v(r.value?"Searching...":"Scan for devices"),1)],10,Qe)])])):i("",!0)]),e[27]||(e[27]=t("div",{class:"divider"},[t("span",null,"or")],-1)),t("div",Ye,[y.value?(a(),o("form",{key:1,onSubmit:ie(X,["prevent"]),class:"manual-form"},[t("div",Ze,[O(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>g.value=l),type:"text",placeholder:"IP address or URL (e.g., 192.168.1.100)",class:D(["input",{"input--error":w.value}])},null,2),[[re,g.value]]),t("button",{type:"submit",disabled:P.value,class:"btn btn--primary"},[P.value?(a(),o("svg",tt,[...e[24]||(e[24]=[t("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4",fill:"none",opacity:"0.25"},null,-1),t("path",{fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",opacity:"0.75"},null,-1)])])):i("",!0),e[25]||(e[25]=u(" Add ",-1))],8,et)]),w.value?(a(),o("span",st,v(w.value),1)):i("",!0),t("button",{type:"button",onClick:e[4]||(e[4]=l=>{y.value=!1,w.value=""}),class:"btn-cancel"}," Cancel ")],32)):(a(),o("button",{key:0,onClick:e[2]||(e[2]=l=>y.value=!0),class:"btn-manual"},[...e[23]||(e[23]=[t("svg",{viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z","clip-rule":"evenodd"})],-1),u(" Enter address manually ",-1)])]))]),K.value?i("",!0):(a(),o("div",lt,[...e[26]||(e[26]=[t("svg",{viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1),u(" Auto-discovery requires the ",-1),t("strong",null,"Preke Studio",-1),u(" desktop app. ",-1)])]))]),t("footer",ot,[T.value?(a(),o("button",{key:0,onClick:E,class:"back-link"},"‚Üê Back to Studio")):i("",!0),e[28]||(e[28]=t("span",{class:"version"},"v2.0",-1))])],512),[[ne,!m.value]])]))}}),dt=ue(nt,[["__scopeId","data-v-5f772d2b"]]);export{dt as default};
