import{X as oe,r as d,j as R,b as N,d as A,I as G,c as u,f as y,e,w as K,R as Z,A as F,x as q,F as H,y as W,t as v,n as E,q as T,J as ne,h as S,i,Y as ee,E as ae,m as V,T as z,p as Y,Z as re,_ as te,D as le,u as ie,o as ue,W as ce,v as de,g as pe}from"./index-ikjIKck0.js";import{b as me,o as fe,g as ve,a as ge,V as X,c as xe}from"./vdoninja-iKOBRceV.js";import{M as be}from"./ModeLoadingScreen-2J19sk39.js";const P=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],Q=oe("streaming",()=>{const h=d([]),w=d(!1),r=d(null),a=d({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),l=R(()=>h.value.find(s=>s.id===r.value)),x=R(()=>h.value.filter(s=>s.enabled)),g=R(()=>P),p=R(()=>{const s=window.location.hostname,n=s==="localhost"||s==="127.0.0.1"?"localhost":s.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${n}:1935/mixer_program`,rtsp:`rtsp://${n}:8554/mixer_program`,srt:`srt://${n}:8890?streamid=read:mixer_program`,hls:`https://${s}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function m(s,t){const n=P.find(U=>U.id===s);if(!n)throw new Error(`Unknown platform: ${s}`);const o={id:`dest-${Date.now()}`,platformId:s,name:t||n.name,streamKey:"",enabled:!1};return h.value.push(o),o}function C(s,t){const n=h.value.findIndex(o=>o.id===s);n!==-1&&(h.value[n]={...h.value[n],...t})}function b(s){const t=h.value.findIndex(n=>n.id===s);t!==-1&&h.value.splice(t,1),r.value===s&&(r.value=null)}function D(s){r.value=s}function $(s){a.value.enabled=s}function M(s){a.value={...a.value,...s}}function O(){w.value=!0}function k(){w.value=!1}function c(s){const t=P.find(n=>n.id===s.platformId);return t?s.platformId==="custom"?`${s.name}${s.streamKey}`:`${t.rtmpBaseUrl}${s.streamKey}`:""}function f(){const s=window.location.hostname;return`srt://${s==="localhost"||s==="127.0.0.1"?"localhost":s.replace("r58-api","r58-mediamtx")}:${a.value.port}?streamid=read:${a.value.streamId}`}function _(){try{const s=localStorage.getItem("r58-streaming-destinations");if(s){const t=JSON.parse(s);h.value=t.destinations||[],t.srtOutput&&(a.value={...a.value,...t.srtOutput})}}catch(s){console.warn("Failed to load saved streaming destinations:",s)}}function L(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:h.value,srtOutput:a.value}))}catch(s){console.warn("Failed to save streaming destinations:",s)}}async function I(){try{const s=x.value;if(s.length===0)return console.warn("[Streaming] No enabled destinations to stream to"),{success:!1,message:"No destinations configured"};const t=s.map(U=>{var J;return{platform:U.platformId,rtmp_url:((J=P.find(se=>se.id===U.platformId))==null?void 0:J.rtmpBaseUrl)||"",stream_key:U.streamKey,enabled:!0}}),n=await fetch(await N("/api/streaming/rtmp/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinations:t})}),o=await n.json();if(!n.ok)throw new Error(o.detail||"Failed to start RTMP relay");return console.log("[Streaming] RTMP relay configured via MediaMTX runOnReady:",o),{success:!0,message:o.message||`Streaming to ${s.length} destination(s)`}}catch(s){const t=s instanceof Error?s.message:"Failed to start RTMP relay";return console.error("[Streaming] Failed to start RTMP relay:",s),{success:!1,message:t}}}async function j(){try{const s=await fetch(await N("/api/streaming/rtmp/stop"),{method:"POST"}),t=await s.json();if(!s.ok)throw new Error(t.detail||"Failed to stop RTMP relay");return console.log("[Streaming] RTMP relay stopped"),{success:!0,message:"RTMP relay stopped"}}catch(s){const t=s instanceof Error?s.message:"Failed to stop RTMP relay";return console.error("[Streaming] Failed to stop RTMP relay:",s),{success:!1,message:t}}}async function B(){try{const s=await fetch(await N("/api/streaming/status"));if(!s.ok)throw new Error("Failed to get streaming status");return await s.json()}catch(s){return console.error("[Streaming] Failed to get streaming status:",s),null}}return _(),{destinations:h,isStreaming:w,activeDestinationId:r,srtOutput:a,activeDestination:l,enabledDestinations:x,platforms:g,programOutputUrls:p,addDestination:m,updateDestination:C,removeDestination:b,setActiveDestination:D,toggleSrtOutput:$,updateSrtConfig:M,startStreaming:O,stopStreaming:k,buildRtmpUrl:c,getSrtOutputUrl:f,saveDestinations:L,loadSavedDestinations:_,startRtmpRelay:I,stopRtmpRelay:j,getStreamingStatus:B}}),ke={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},_e={class:"relative bg-preke-bg-elevated border border-preke-bg-surface rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},ye={class:"p-6 overflow-y-auto max-h-[60vh]"},he={key:0,class:"mb-8 p-6 bg-gradient-to-br from-amber-600/20 to-red-600/20 rounded-xl border border-amber-500/30"},we={class:"flex gap-3 mb-4"},Se=["placeholder"],Ce={class:"text-xs text-preke-text-dim"},$e=["href"],Pe={class:"mb-8"},Re={class:"flex items-center justify-between mb-4"},Te={key:0,class:"mb-4 p-4 bg-preke-bg-surface rounded-lg"},Oe={class:"grid grid-cols-2 gap-2"},De=["onClick"],Me={class:"text-xl"},Ue={key:1,class:"space-y-3"},Le=["onClick"],Ie={class:"text-xl"},Ke={class:"flex-1"},Ee={class:"font-medium"},Ve={class:"text-xs text-preke-text-dim"},je=["onClick"],Be=["onClick"],Fe={key:2,class:"text-preke-text-dim text-sm"},Ne={key:1,class:"mb-8 p-4 bg-preke-bg-surface rounded-lg"},qe={class:"text-lg font-medium mb-4"},He={class:"space-y-4"},Ae=["placeholder"],We={key:0},ze={class:"flex gap-2"},Ye={class:"mb-8"},Qe={class:"space-y-3"},Je={class:"p-3 bg-preke-bg-surface rounded-lg"},Xe={class:"flex items-center justify-between mb-1"},Ge={class:"text-xs text-preke-text-dim break-all"},Ze={class:"p-3 bg-preke-bg-surface rounded-lg"},et={class:"flex items-center justify-between mb-1"},tt={class:"text-xs text-preke-text-dim break-all"},st={class:"p-3 bg-preke-bg-surface rounded-lg"},ot={class:"flex items-center justify-between mb-1"},nt={class:"text-xs text-preke-text-dim break-all"},at={class:"p-3 bg-preke-bg-surface rounded-lg"},rt={class:"flex items-center justify-between mb-1"},lt={class:"text-xs text-preke-text-dim break-all"},it={class:"p-3 bg-preke-bg-surface rounded-lg"},ut={class:"flex items-center justify-between mb-1"},ct={class:"text-xs text-preke-text-dim break-all"},dt={class:"p-4 bg-preke-bg-surface rounded-lg"},pt={class:"flex items-center gap-3 mb-4"},mt=A({__name:"StreamingSettings",setup(h,{expose:w}){const r=Q(),a=d(!1),l=d(null),x=d(!1),g=d("youtube"),p=d("");d(""),d("");const m=R(()=>r.destinations),C=R(()=>P),b=R(()=>r.programOutputUrls);function D(){a.value=!0}function $(){a.value=!1,l.value=null,x.value=!1}function M(s){const t=r.addDestination(s);l.value=t,x.value=!1,r.saveDestinations()}function O(){l.value&&(r.updateDestination(l.value.id,l.value),r.saveDestinations(),l.value=null,S.success("Streaming destination saved"))}function k(s){r.removeDestination(s),r.saveDestinations(),S.info("Destination removed")}function c(s){r.updateDestination(s.id,{enabled:!s.enabled}),r.saveDestinations()}function f(s,t){navigator.clipboard.writeText(s),S.success(`${t} copied to clipboard`)}function _(s){const t=P.find(n=>n.id===s);return(t==null?void 0:t.icon)||"ðŸ“¡"}function L(s){const t=P.find(n=>n.id===s);return(t==null?void 0:t.name)||"Unknown"}function I(){const s=P.find(t=>t.id===g.value);return(s==null?void 0:s.streamKeyPlaceholder)||"Enter stream key"}function j(){switch(g.value){case"youtube":return"https://support.google.com/youtube/answer/2907883";case"twitch":return"https://help.twitch.tv/s/article/twitch-stream-key-faq";case"facebook":return"https://www.facebook.com/help/587160588142067";case"restream":return"https://support.restream.io/en/";default:return"#"}}function B(){if(!p.value.trim()){S.error("Please enter your stream key");return}const s=r.addDestination(g.value);r.updateDestination(s.id,{streamKey:p.value,enabled:!0}),r.saveDestinations(),p.value="",S.success(`${L(g.value)} configured and enabled!`)}return w({open:D}),(s,t)=>{var n;return i(),G(ne,{to:"body"},[a.value?(i(),u("div",ke,[e("div",{class:"absolute inset-0 bg-black/60",onClick:$}),e("div",_e,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-preke-bg-surface"},[t[13]||(t[13]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:$,class:"text-preke-text-dim hover:text-preke-text text-2xl"}," Ã— ")]),e("div",ye,[m.value.length===0?(i(),u("section",he,[t[16]||(t[16]=e("h3",{class:"text-xl font-semibold mb-2 flex items-center gap-2"}," ðŸ”´ Quick Setup: Stream to YouTube ",-1)),t[17]||(t[17]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Get streaming in seconds! Just paste your stream key below. ",-1)),e("div",we,[K(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>g.value=o),class:"px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg text-base"},[...t[14]||(t[14]=[e("option",{value:"youtube"},"â–¶ï¸ YouTube Live",-1),e("option",{value:"twitch"},"ðŸ“º Twitch",-1),e("option",{value:"facebook"},"ðŸ“˜ Facebook",-1),e("option",{value:"restream"},"ðŸ”„ Restream",-1)])],512),[[Z,g.value]]),K(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>p.value=o),type:"password",placeholder:I(),class:"flex-1 px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg font-mono text-base focus:border-amber-500 focus:outline-none"},null,8,Se),[[F,p.value]]),e("button",{onClick:B,class:"px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg font-semibold transition-colors"}," Save & Enable ")]),e("p",Ce,[t[15]||(t[15]=q(" ðŸ”’ Your stream key is stored locally on this device and never sent to any server. ",-1)),e("a",{href:j(),target:"_blank",class:"text-amber-400 hover:underline ml-2"}," Where do I find my stream key? â†’ ",8,$e)])])):y("",!0),e("section",Pe,[e("div",Re,[t[18]||(t[18]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[2]||(t[2]=o=>x.value=!x.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),x.value?(i(),u("div",Te,[t[19]||(t[19]=e("p",{class:"text-sm text-preke-text-dim mb-3"},"Select a streaming platform:",-1)),e("div",Oe,[(i(!0),u(H,null,W(C.value,o=>(i(),u("button",{key:o.id,onClick:U=>M(o.id),class:"flex items-center gap-2 p-3 bg-preke-bg-elevated hover:bg-preke-gold/20 rounded-lg transition-colors text-left"},[e("span",Me,v(o.icon),1),e("span",null,v(o.name),1)],8,De))),128))])])):y("",!0),m.value.length>0?(i(),u("div",Ue,[(i(!0),u(H,null,W(m.value,o=>(i(),u("div",{key:o.id,class:"flex items-center gap-3 p-3 bg-preke-bg-surface rounded-lg"},[e("button",{onClick:U=>c(o),class:E(["w-10 h-6 rounded-full transition-colors relative",o.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:E(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",o.enabled?"left-5":"left-1"])},null,2)],10,Le),e("span",Ie,v(_(o.platformId)),1),e("div",Ke,[e("div",Ee,v(o.name),1),e("div",Ve,v(o.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+o.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:U=>l.value={...o},class:"text-preke-gold hover:underline text-sm"}," Edit ",8,je),e("button",{onClick:U=>k(o.id),class:"text-preke-red hover:underline text-sm"}," Remove ",8,Be)]))),128))])):(i(),u("p",Fe," No streaming destinations configured. Add a platform above. "))]),l.value?(i(),u("section",Ne,[e("h3",qe," Edit "+v(L(l.value.platformId)),1),e("div",He,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Display Name",-1)),K(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.name=o),type:"text",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none"},null,512),[[F,l.value.name]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Stream Key",-1)),K(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>l.value.streamKey=o),type:"password",placeholder:(n=T(P).find(o=>o.id===l.value.platformId))==null?void 0:n.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,8,Ae),[[F,l.value.streamKey]]),t[22]||(t[22]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),l.value.platformId==="custom"?(i(),u("div",We,[t[23]||(t[23]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"RTMP URL",-1)),K(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>l.value.name=o),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,512),[[F,l.value.name]])])):y("",!0),e("div",ze,[e("button",{onClick:O,class:"btn btn-primary"}," Save "),e("button",{onClick:t[6]||(t[6]=o=>l.value=null),class:"btn"}," Cancel ")])])])):y("",!0),e("section",Ye,[t[32]||(t[32]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[33]||(t[33]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",Qe,[e("div",Je,[e("div",Xe,[t[24]||(t[24]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[7]||(t[7]=o=>f(b.value.srt,"SRT URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Ge,v(b.value.srt),1),t[25]||(t[25]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",Ze,[e("div",et,[t[26]||(t[26]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[8]||(t[8]=o=>f(b.value.rtmp,"RTMP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",tt,v(b.value.rtmp),1)]),e("div",st,[e("div",ot,[t[27]||(t[27]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[9]||(t[9]=o=>f(b.value.rtsp,"RTSP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",nt,v(b.value.rtsp),1)]),e("div",at,[e("div",rt,[t[28]||(t[28]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[10]||(t[10]=o=>f(b.value.hls,"HLS URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",lt,v(b.value.hls),1),t[29]||(t[29]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",it,[e("div",ut,[t[30]||(t[30]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[11]||(t[11]=o=>f(b.value.whep,"WHEP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",ct,v(b.value.whep),1),t[31]||(t[31]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[36]||(t[36]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",dt,[e("div",pt,[e("button",{onClick:t[12]||(t[12]=o=>T(r).toggleSrtOutput(!T(r).srtOutput.enabled)),class:E(["w-10 h-6 rounded-full transition-colors relative",T(r).srtOutput.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:E(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",T(r).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[34]||(t[34]=e("span",null,"Enable SRT Output",-1))]),t[35]||(t[35]=e("div",{class:"text-sm text-preke-text-dim"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-preke-bg-surface"},[e("button",{onClick:$,class:"btn"},"Close")])])])):y("",!0)])}}}),ft={class:"program-output space-y-3","data-testid":"program-output"},vt={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface rounded-lg","data-testid":"program-output-status"},gt={class:"text-sm font-medium","data-testid":"program-output-text"},xt={key:0,class:"space-y-2"},bt={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},kt={class:"flex-1 text-xs truncate text-preke-text-dim"},_t={key:0,class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},yt={class:"text-xs text-preke-text-dim"},ht={key:1,class:"text-xs text-preke-text-dim px-3"},wt={class:"hidden"},St=["src"],Ct=A({__name:"ProgramOutput",setup(h){const w=ee(),r=Q(),a=d(!1),l=d("idle"),x=d("");function g(){return"https://r58-mediamtx.itagenten.no/mixer_program/whip"}async function p(){if(a.value)return;l.value="connecting";const k=await me(g());if(!k){l.value="error",console.error("[ProgramOutput] Failed to build VDO.ninja URL - VDO.ninja not configured");return}x.value=k,a.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX:",k)}function m(){a.value&&(a.value=!1,x.value="",l.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function C(){a.value&&(l.value="live",console.log("[ProgramOutput] WHIP push connected"))}function b(){l.value="error",console.error("[ProgramOutput] WHIP push failed")}async function D(){m(),await new Promise(k=>setTimeout(k,500)),await p()}ae(()=>w.isLive,async k=>{k?await p():m()});function $(){switch(l.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function M(){switch(l.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function O(){const k=r.programOutputUrls.srt;navigator.clipboard.writeText(k),S.success("SRT URL copied")}return(k,c)=>(i(),u("div",ft,[e("div",vt,[e("span",{class:E(["w-2 h-2 rounded-full",$()]),"data-testid":"program-output-indicator"},null,2),e("span",gt,v(M()),1),l.value==="error"?(i(),u("button",{key:0,onClick:c[0]||(c[0]=f=>D()),class:"ml-auto text-xs text-preke-gold hover:underline"}," Retry ")):y("",!0)]),l.value==="live"?(i(),u("div",xt,[e("div",bt,[c[1]||(c[1]=e("span",{class:"text-xs text-preke-text-dim"},"ðŸ”´ SRT:",-1)),e("code",kt,v(T(r).programOutputUrls.srt),1),e("button",{onClick:O,class:"text-xs text-preke-gold hover:underline"},"Copy")]),T(r).enabledDestinations.length>0?(i(),u("div",_t,[c[2]||(c[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",yt,v(T(r).enabledDestinations.length)+" streaming destination"+v(T(r).enabledDestinations.length>1?"s":"")+" active ",1)])):y("",!0)])):y("",!0),l.value==="idle"?(i(),u("p",ht," Program output will start automatically when you go live. ")):y("",!0),e("div",wt,[a.value&&x.value?(i(),u("iframe",{key:0,src:x.value,onLoad:C,onError:b,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,St)):y("",!0)])]))}}),$t={class:"streaming-control-panel"},Pt={class:"control-bar"},Rt={key:0,class:"control-bar__room"},Tt={class:"control-bar__room-name"},Ot={key:0,class:"control-bar__camera-count"},Dt={key:1,class:"control-bar__divider"},Mt={class:"control-bar__status"},Ut={class:"control-bar__status-text"},Lt={key:0,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},It={key:1,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},Kt={key:3,class:"control-bar__destinations"},Et={class:"control-bar__destinations-list"},Vt=["title"],jt={key:0,class:"quick-setup"},Bt={class:"quick-setup__form"},Ft={class:"quick-setup__platform"},Nt={class:"quick-setup__platform-icon"},qt={class:"quick-setup__input-wrap"},Ht=["placeholder"],At={class:"hidden"},Wt=A({__name:"StreamingControlPanel",props:{roomName:{default:""},cameraCount:{default:0}},setup(h){const w=h,r=ee(),a=Q(),l=d(null),x=d(null),g=d(!1),p=d("youtube"),m=d(""),C=R(()=>r.isLive),b=R(()=>a.destinations.length>0),D=R(()=>a.enabledDestinations.length>0),$=R(()=>C.value?"live":"idle");function M(){C.value?k():O()}async function O(){if(r.setLive(!0),a.enabledDestinations.length>0){const t=await a.startRtmpRelay();t.success?S.success(t.message):S.error(`RTMP relay failed: ${t.message}`)}else S.success("Streaming started (no RTMP destinations configured)")}async function k(){if(r.setLive(!1),a.enabledDestinations.length>0){const t=await a.stopRtmpRelay();t.success||S.warning(`Note: ${t.message}`)}S.info("Streaming stopped")}function c(){fe(1)?S.success("Program window opened"):S.error("Popup blocked - please allow popups for this site")}function f(){var t;(t=l.value)==null||t.open()}function _(){g.value=!g.value}function L(){if(!m.value.trim()){S.error("Please enter your stream key");return}if(!P.find(o=>o.id===p.value))return;const n=a.destinations.find(o=>o.platformId===p.value);if(n)a.updateDestination(n.id,{streamKey:m.value,enabled:!0});else{const o=a.addDestination(p.value);a.updateDestination(o.id,{streamKey:m.value,enabled:!0})}a.saveDestinations(),g.value=!1,m.value="",O()}function I(){const t=P.find(n=>n.id===p.value);return(t==null?void 0:t.streamKeyPlaceholder)||"Enter your stream key"}function j(){const t=P.find(n=>n.id===p.value);return(t==null?void 0:t.icon)||"ðŸ“¡"}function B(){switch($.value){case"live":return"control-bar__dot--live";case"connecting":return"control-bar__dot--connecting";case"error":return"control-bar__dot--error";default:return"control-bar__dot--idle"}}function s(){switch($.value){case"live":return"LIVE";case"connecting":return"Connecting...";case"error":return"Error";default:return"Offline"}}return(t,n)=>(i(),u("div",$t,[e("div",Pt,[w.roomName?(i(),u("div",Rt,[n[3]||(n[3]=e("span",{class:"control-bar__room-label"},"Room",-1)),e("span",Tt,v(w.roomName),1),w.cameraCount>0?(i(),u("span",Ot,v(w.cameraCount)+" cam"+v(w.cameraCount!==1?"s":""),1)):y("",!0)])):y("",!0),w.roomName?(i(),u("div",Dt)):y("",!0),e("div",Mt,[e("span",{class:E(["control-bar__dot",B()])},null,2),e("span",Ut,v(s()),1)]),n[10]||(n[10]=e("div",{class:"control-bar__divider"},null,-1)),e("button",{onClick:M,class:E(["control-bar__btn",C.value?"control-bar__btn--stop":"control-bar__btn--start"])},[C.value?(i(),u("svg",Lt,[...n[4]||(n[4]=[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"},null,-1)])])):(i(),u("svg",It,[...n[5]||(n[5]=[e("path",{d:"M8 5.14v14l11-7-11-7z"},null,-1)])])),q(" "+v(C.value?"Stop":"Start Streaming"),1)],2),b.value?y("",!0):(i(),u("button",{key:2,onClick:_,class:E(["control-bar__btn control-bar__btn--dashed",g.value?"control-bar__btn--active":""])},[...n[6]||(n[6]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})],-1),q(" Add Stream Key ",-1)])],2)),e("button",{onClick:c,class:"control-bar__btn control-bar__btn--secondary",title:"Open program output in new window"},[...n[7]||(n[7]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),q(" Watch ",-1)])]),e("button",{onClick:f,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Configure streaming destinations"},[...n[8]||(n[8]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])]),D.value?(i(),u("div",Kt,[n[9]||(n[9]=e("span",{class:"control-bar__destinations-label"},"To:",-1)),e("div",Et,[(i(!0),u(H,null,W(T(a).enabledDestinations,o=>(i(),u("span",{key:o.id,class:"control-bar__destination",title:o.name},v(o.platformId==="youtube"?"â–¶ï¸":o.platformId==="twitch"?"ðŸ“º":"ðŸ”´"),9,Vt))),128))])])):y("",!0)]),V(z,{name:"slide"},{default:Y(()=>[g.value?(i(),u("div",jt,[e("div",Bt,[e("div",Ft,[e("span",Nt,v(j()),1),K(e("select",{"onUpdate:modelValue":n[0]||(n[0]=o=>p.value=o),class:"quick-setup__select"},[...n[11]||(n[11]=[e("option",{value:"youtube"},"YouTube",-1),e("option",{value:"twitch"},"Twitch",-1),e("option",{value:"facebook"},"Facebook",-1),e("option",{value:"restream"},"Restream",-1)])],512),[[Z,p.value]])]),e("div",qt,[K(e("input",{"onUpdate:modelValue":n[1]||(n[1]=o=>m.value=o),type:"password",placeholder:I(),class:"quick-setup__input",onKeyup:re(L,["enter"])},null,40,Ht),[[F,m.value]])]),e("button",{onClick:L,class:"quick-setup__go-live"}," ðŸ”´ Go Live "),e("button",{onClick:n[2]||(n[2]=o=>g.value=!1),class:"quick-setup__cancel"},"âœ•")])])):y("",!0)]),_:1}),e("div",At,[V(Ct,{ref_key:"programOutputRef",ref:x},null,512)]),V(mt,{ref_key:"streamingSettingsRef",ref:l},null,512)]))}}),zt=te(Wt,[["__scopeId","data-v-64be970d"]]),Yt={class:"h-full flex flex-col bg-preke-bg"},Qt={class:"flex-1 relative"},Jt=["src"],Xt={key:0,class:"absolute inset-0 flex items-center justify-center bg-preke-bg"},Gt=A({__name:"MixerView",setup(h){const w=pe(),r=le(),a=ie();function l(){w.push("/")}const x=d(!0),g=d(!1),p=d(!1),m=d("Starting mixer..."),C=R(()=>r.inputs.filter(c=>c.hasSignal)),b=d("");async function D(){const c=await ve()||"r58-vdo.itagenten.no",f=ge(),_=new URL(`${f}://${c}/mixer.html`);_.searchParams.set("room",X),_.searchParams.set("password",xe),_.searchParams.set("css",`${f}://${c}/css/preke-colors.css`),b.value=_.toString()}function $(){console.log("[Mixer] VDO.ninja mixer iframe loaded"),g.value=!0,m.value="Waiting for cameras..."}function M(){x.value=!1}async function O(){const c=performance.now();m.value="Starting camera bridge...";for(let f=0;f<40;f++){try{if((await(await fetch(await N("/api/mode/status"))).json()).current_mode==="mixer"){const I=Math.round((performance.now()-c)/1e3);if(I>=5){console.log(`[Mixer] Bridge likely ready after ${I}s`),p.value=!0,m.value="Cameras connecting...";return}}}catch{}await new Promise(_=>setTimeout(_,500)),m.value=`Starting camera bridge... (${Math.round((performance.now()-c)/1e3)}s)`}console.log("[Mixer] Bridge wait timeout - continuing anyway"),p.value=!0}async function k(){var f;if(!ce())return;m.value="Checking mode...",await a.fetchCapabilities();const c=(f=a.capabilities)==null?void 0:f.current_mode;if(c&&c!=="mixer"){console.log("[Mixer] Not in mixer mode, switching..."),m.value="Switching to mixer mode...";try{(await fetch(await N("/api/mode/mixer"),{method:"POST"})).ok&&(await a.fetchCapabilities(),S.success("Switched to Mixer mode"))}catch(_){console.warn("[Mixer] Failed to switch mode:",_)}}}return ue(async()=>{const c=performance.now();await D(),await Promise.all([k(),r.fetchInputs()]),await O(),console.log(`[Mixer] Total load time: ${Math.round(performance.now()-c)}ms`)}),(c,f)=>(i(),u(H,null,[V(z,{name:"fade"},{default:Y(()=>[x.value?(i(),G(be,{key:0,mode:"mixer","content-ready":g.value&&p.value,"min-time":2e3,"max-time":2e4,"show-cancel":!0,onReady:M,onCancel:l},null,8,["content-ready"])):y("",!0)]),_:1}),V(z,{name:"content-fade"},{default:Y(()=>[K(e("div",Yt,[V(zt,{"room-name":T(X),"camera-count":C.value.length},null,8,["room-name","camera-count"]),e("div",Qt,[e("iframe",{src:b.value,onLoad:$,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,Jt),g.value?y("",!0):(i(),u("div",Xt,[...f[0]||(f[0]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-8 h-8 border-2 border-preke-gold border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-preke-text-muted"},"Loading VDO.ninja mixer..."),e("span",{class:"text-xs text-preke-text-subtle"},"Cameras will appear when bridge is running")],-1)])]))])],512),[[de,!x.value]])]),_:1})],64))}}),ss=te(Gt,[["__scopeId","data-v-2b6dd812"]]);export{ss as default};
