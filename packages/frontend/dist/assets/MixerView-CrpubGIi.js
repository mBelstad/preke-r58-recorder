import{d as L,A as V,r as f,h as y,B as R,c as o,a as s,b as _,t as u,n as k,F as w,q as C,o as n,j as B,l as S,m as D,T as U,J as O,E,_ as N}from"./index-ClrCgZEF.js";import{b as $,g as P,a as F,V as M,c as H}from"./vdoninja-Ut60qcnL.js";import{M as T}from"./ModeLoadingScreen-B0ejQQ6I.js";const W={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"camera-push-bar"},z={class:"flex items-center gap-2"},q={class:"text-r58-text-secondary"},A={key:0,class:"px-4 pb-3"},J={key:0,class:"flex gap-3 flex-wrap"},G={class:"text-sm font-medium"},I={class:"text-xs text-r58-text-secondary"},K=["onClick"],Q={key:1,class:"text-sm text-r58-text-secondary py-2"},X={class:"hidden"},Y=["src","onLoad","onError"],Z=L({__name:"CameraPushBar",setup(j){const m=V(),a=f(new Map),i=f(!0),p=y(()=>m.inputs.filter(e=>e.hasSignal));function x(e){return P(e)}R(p,e=>{for(const t of e)if(!a.value.has(t.id)){const l=x(t.id),d=$(t.id,l,t.label);a.value.set(t.id,{cameraId:t.id,label:t.label,status:"connecting",iframeSrc:d})}const r=new Set(e.map(t=>t.id));for(const[t]of a.value)r.has(t)||a.value.delete(t)},{immediate:!0});function g(e){const r=a.value.get(e);r&&(r.status="connected",console.log(`[CameraPush] ${e} connected to VDO.ninja`))}function b(e){const r=a.value.get(e);r&&(r.status="error",console.error(`[CameraPush] ${e} failed to connect`))}function v(e){const r=m.inputs.find(d=>d.id===e);if(!r||!r.hasSignal)return;const t=x(e),l=$(e,t,r.label);a.value.set(e,{cameraId:e,label:r.label,status:"connecting",iframeSrc:l+`&_t=${Date.now()}`})}function h(e){switch(e){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function c(e){switch(e){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(e,r)=>(n(),o("div",W,[s("button",{onClick:r[0]||(r[0]=t=>i.value=!i.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[s("div",z,[r[1]||(r[1]=s("span",{class:"font-medium"},"Camera Sources",-1)),s("span",q,"("+u(p.value.length)+" active)",1)]),(n(),o("svg",{class:k(["w-4 h-4 transition-transform",{"rotate-180":i.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...r[2]||(r[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),i.value?(n(),o("div",A,[a.value.size>0?(n(),o("div",J,[(n(!0),o(w,null,C(a.value,([t,l])=>(n(),o("div",{key:t,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[s("span",{class:k(["w-2 h-2 rounded-full",h(l.status)])},null,2),s("span",G,u(l.label),1),s("span",I,u(c(l.status)),1),l.status==="error"?(n(),o("button",{key:0,onClick:d=>v(t),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,K)):_("",!0)]))),128))])):(n(),o("div",Q," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):_("",!0),s("div",X,[(n(!0),o(w,null,C(a.value,([t,l])=>(n(),o("iframe",{key:t,src:l.iframeSrc,onLoad:d=>g(t),onError:d=>b(t),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Y))),128))])]))}}),ee={class:"h-full flex flex-col bg-r58-bg-primary"},te={class:"flex items-center justify-between px-4 py-2 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},se={class:"flex items-center gap-3"},re={class:"text-sm text-r58-text-secondary"},ae={class:"flex items-center gap-2 text-xs text-r58-text-secondary"},ne={class:"px-2 py-1 bg-r58-bg-tertiary rounded"},oe={class:"flex-1 relative"},le=["src"],ie={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-primary"},ce=L({__name:"MixerView",setup(j){const m=V(),a=f(!0),i=f(!1),p=f(null),x=y(()=>F({room:M,mediamtxHost:H()})),g=y(()=>m.inputs.filter(h=>h.hasSignal).length);function b(){console.log("[Mixer] Native mixer iframe loaded"),i.value=!0}function v(){a.value=!1}return B(async()=>{await m.fetchInputs()}),(h,c)=>(n(),o(w,null,[S(U,{name:"fade"},{default:D(()=>[a.value?(n(),E(T,{key:0,mode:"mixer","content-ready":i.value,"min-time":1500,"max-time":1e4,onReady:v},null,8,["content-ready"])):_("",!0)]),_:1}),s("div",ee,[s("header",te,[s("div",se,[c[0]||(c[0]=s("span",{class:"text-lg font-semibold text-r58-mixer"},"Mixer",-1)),s("span",re,u(g.value)+" camera"+u(g.value!==1?"s":"")+" connected ",1)]),s("div",ae,[s("span",ne,"Room: "+u(O(M)),1)])]),s("div",oe,[s("iframe",{ref_key:"iframeRef",ref:p,src:x.value,onLoad:b,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,le),i.value?_("",!0):(n(),o("div",ie,[...c[1]||(c[1]=[s("div",{class:"flex flex-col items-center gap-4"},[s("div",{class:"w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full animate-spin"}),s("span",{class:"text-r58-text-secondary"},"Loading VDO.ninja mixer...")],-1)])]))]),S(Z)])],64))}}),fe=N(ce,[["__scopeId","data-v-1ace5c85"]]);export{fe as default};
