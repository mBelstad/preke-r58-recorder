import{C as te,r as _,h as U,e as se,f as ne,d as V,w as G,c as d,p as R,a as e,A as O,n as D,o as u,F as A,B as K,t as $,D as re,y as T,j as ae,s as W,v as F,m as ie,x as le,k as H}from"./index-DqooxEx-.js";import{u as oe}from"./recorder-Da4zr1s0.js";const N=te("mixer",()=>{const f=_(!1),r=_(null),a=_(null),i=_(null),t=_([]),s=U(()=>t.value.filter(c=>c.hasVideo||c.hasAudio));function C(){f.value=!f.value}function w(c){r.value=c}function x(c){a.value=c}function P(c){i.value=c}function k(c){t.value=c}function m(c,S){const g=t.value.find(L=>L.id===c);g&&(g.muted=S)}function p(c,S){const g=t.value.find(L=>L.id===c);g&&(g.audioLevel=S)}return{isLive:f,activeScene:r,programSource:a,previewSource:i,sources:t,activeSources:s,toggleLive:C,setScene:w,setProgram:x,setPreview:P,updateSourcesFromVdo:k,setSourceMute:m,updateAudioLevel:p}}),j=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],q=te("streaming",()=>{const f=_([]),r=_(!1),a=_(null),i=_({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),t=U(()=>f.value.find(l=>l.id===a.value)),s=U(()=>f.value.filter(l=>l.enabled)),C=U(()=>j),w=U(()=>{const l=window.location.hostname,v=l==="localhost"||l==="127.0.0.1"?"localhost":l.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${v}:1935/mixer_program`,rtsp:`rtsp://${v}:8554/mixer_program`,srt:`srt://${v}:8890?streamid=read:mixer_program`,hls:`https://${l}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function x(l,o){const v=j.find(I=>I.id===l);if(!v)throw new Error(`Unknown platform: ${l}`);const y={id:`dest-${Date.now()}`,platformId:l,name:o||v.name,streamKey:"",enabled:!1};return f.value.push(y),y}function P(l,o){const v=f.value.findIndex(y=>y.id===l);v!==-1&&(f.value[v]={...f.value[v],...o})}function k(l){const o=f.value.findIndex(v=>v.id===l);o!==-1&&f.value.splice(o,1),a.value===l&&(a.value=null)}function m(l){a.value=l}function p(l){i.value.enabled=l}function c(l){i.value={...i.value,...l}}function S(){r.value=!0}function g(){r.value=!1}function L(l){const o=j.find(v=>v.id===l.platformId);return o?l.platformId==="custom"?`${l.name}${l.streamKey}`:`${o.rtmpBaseUrl}${l.streamKey}`:""}function b(){const l=window.location.hostname;return`srt://${l==="localhost"||l==="127.0.0.1"?"localhost":l.replace("r58-api","r58-mediamtx")}:${i.value.port}?streamid=read:${i.value.streamId}`}function h(){try{const l=localStorage.getItem("r58-streaming-destinations");if(l){const o=JSON.parse(l);f.value=o.destinations||[],o.srtOutput&&(i.value={...i.value,...o.srtOutput})}}catch(l){console.warn("Failed to load saved streaming destinations:",l)}}function n(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:f.value,srtOutput:i.value}))}catch(l){console.warn("Failed to save streaming destinations:",l)}}return h(),{destinations:f,isStreaming:r,activeDestinationId:a,srtOutput:i,activeDestination:t,enabledDestinations:s,platforms:C,programOutputUrls:w,addDestination:x,updateDestination:P,removeDestination:k,setActiveDestination:m,toggleSrtOutput:p,updateSrtConfig:c,startStreaming:S,stopStreaming:g,buildRtmpUrl:L,getSrtOutputUrl:b,saveDestinations:n,loadSavedDestinations:h}});function z(){return"r58-vdo.itagenten.no"}function X(){return"https"}const M="studio",ce={director:{params:{director:M,hidesolo:!0,hideheader:!0,cleanoutput:!0,darkmode:!0,nologo:!0}},scene:{params:{scene:!0,room:M,cover:!0,fadein:500,animated:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0}},multiview:{params:{room:M,scene:!0,grid:!0,autoadd:"*",cleanoutput:!0,hideheader:!0,nologo:!0}},cameraContribution:{params:{room:M,videodevice:0,audiodevice:0,autostart:!0,noaudio:!1}},guestInvite:{params:{room:M,webcam:!0,mic:!0,quality:1,effects:!0}},soloView:{params:{room:M,cover:!0,cleanoutput:!0}},programOutput:{params:{scene:!0,room:M,cover:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0,autostart:!0}}};function J(){return`${window.location.origin}/static/css/vdo-theme.css`}function ue(f,r={}){const a=z(),i=X(),t=ce[f],s=new URL(`${i}://${a}/`);s.searchParams.set("css",J());for(const[C,w]of Object.entries(t.params))if(typeof w=="boolean")w&&s.searchParams.set(C,"");else if(typeof w=="number")s.searchParams.set(C,w.toString());else if(typeof w=="string"){let x=w;for(const[P,k]of Object.entries(r))x=x.replace(`{${P}}`,k);x.includes("{")||s.searchParams.set(C,x)}return r.push_id&&s.searchParams.set("push",r.push_id),r.view_id&&s.searchParams.set("view",r.view_id),r.source_ids&&s.searchParams.set("autoadd",r.source_ids),r.whep_url&&s.searchParams.set("whepshare",encodeURIComponent(r.whep_url)),r.label&&s.searchParams.set("label",r.label),s.toString()}function ee(f,r,a){const i=z(),t=X(),s=new URL(`${t}://${i}/`);return s.searchParams.set("push",f),s.searchParams.set("room",M),s.searchParams.set("whepshare",r),s.searchParams.set("label",a),s.searchParams.set("videodevice","0"),s.searchParams.set("audiodevice","0"),s.searchParams.set("autostart",""),s.searchParams.set("css",J()),s.toString()}function de(f){const r=z(),a=X(),i=new URL(`${a}://${r}/`);return i.searchParams.set("scene",""),i.searchParams.set("room",M),i.searchParams.set("cover",""),i.searchParams.set("quality","2"),i.searchParams.set("cleanoutput",""),i.searchParams.set("hideheader",""),i.searchParams.set("nologo",""),i.searchParams.set("whipout",f),i.searchParams.set("autostart",""),i.searchParams.set("videodevice","0"),i.searchParams.set("audiodevice","0"),i.searchParams.set("css",J()),i.toString()}function me(f){const r=_(!1),a=_(new Map),i=_(null),t=z();function s(o,v,y){var B;if(!((B=f.value)!=null&&B.contentWindow)){console.warn("VDO.ninja iframe not ready");return}const I={action:o};v&&(I.target=v),y!==void 0&&(I.value=y),f.value.contentWindow.postMessage(I,"*")}function C(o){s("changeScene",void 0,o),i.value=o}function w(o){s("soloVideo",o)}function x(o,v){s("pip",o,v?"enable":"disable")}function P(o,v){s("mute",o,v);const y=a.value.get(o);y&&(y.muted=v)}function k(o,v){s("volume",o,Math.max(0,Math.min(100,v)))}function m(o){s("soloChat",o)}function p(o){s("highlight",o)}function c(o,v){s("sendChat",o,v)}function S(o){s("hangup",o),a.value.delete(o)}function g(o){s("requestScreen",o)}function L(){s("record",void 0,!0)}function b(){s("record",void 0,!1)}function h(o){s("layout",void 0,o)}function n(o){s("reload",o)}function l(o){var I,B,Y,Q,Z;const v=o.origin;if(!v.includes(t.split(":")[0])&&!v.includes("vdo.ninja")&&!v.includes("localhost"))return;const y=o.data;if(!(!y||typeof y!="object"))switch(y.type){case"director-ready":case"loaded":case"ready":r.value=!0;break;case"new-guest":case"guest-connected":y.streamID&&a.value.set(y.streamID,{id:y.streamID,label:((I=y.data)==null?void 0:I.label)||y.streamID,type:((B=y.data)==null?void 0:B.type)||"guest",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0});break;case"guest-left":case"guest-disconnected":y.streamID&&a.value.delete(y.streamID);break;case"audio-level":if(y.streamID){const E=a.value.get(y.streamID);E&&(E.audioLevel=((Y=y.data)==null?void 0:Y.level)||0)}break;case"mute-state":if(y.streamID){const E=a.value.get(y.streamID);E&&(E.muted=((Q=y.data)==null?void 0:Q.muted)||!1)}break;case"scene-changed":i.value=((Z=y.data)==null?void 0:Z.scene)||null;break;case"error":console.error("[VDO.ninja Error]",y.data);break}}return se(()=>{window.addEventListener("message",l),setTimeout(()=>{!r.value&&f.value&&(r.value=!0)},5e3)}),ne(()=>{window.removeEventListener("message",l)}),{isReady:r,sources:a,activeScene:i,setScene:C,setProgram:w,togglePiP:x,setLayout:h,setMute:P,setVolume:k,soloAudio:m,highlightSource:p,sendToGuest:c,kickGuest:S,requestScreenShare:g,refreshSource:n,startRecording:L,stopRecording:b,sendCommand:s}}const pe={class:"vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden"},ve={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10"},fe=["src"],xe=V({__name:"VdoNinjaEmbed",props:{profile:{},sources:{}},setup(f,{expose:r}){const a=f,i=_(null),t=N(),{isReady:s,sources:C,setScene:w,setMute:x,setVolume:P}=me(i),k=U(()=>{const m={};return a.sources&&(m.source_ids=a.sources.join(",")),ue(a.profile,m)});return G(C,m=>{t.updateSourcesFromVdo(Array.from(m.values()))},{deep:!0}),r({isReady:s,setScene:w,setMute:x,setVolume:P}),(m,p)=>(u(),d("div",pe,[O(s)?R("",!0):(u(),d("div",ve,[...p[0]||(p[0]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"}),e("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja..."),e("p",{class:"text-xs text-r58-text-secondary mt-2"},"Local mixer on R58")],-1)])])),e("iframe",{ref_key:"iframeRef",ref:i,src:k.value,class:D(["w-full h-full border-0",{"opacity-0":!O(s)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:""},null,10,fe)]))}}),ge={class:"space-y-6"},be={class:"card"},he={key:0,class:"text-center py-8 text-r58-text-secondary"},ye={key:1,class:"space-y-2"},we={class:"flex items-center gap-3"},_e={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ke={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Se={key:2,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$e={class:"font-medium"},Ce={class:"text-xs text-r58-text-secondary capitalize"},Pe={class:"flex items-center gap-2"},Oe={class:"w-16 h-2 bg-r58-bg-primary rounded-full overflow-hidden"},Le=["onClick"],De={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Re={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ue={class:"card"},Te={class:"grid grid-cols-2 gap-2"},Me=V({__name:"SourcePanel",setup(f){const r=N(),a=U(()=>r.sources);return U(()=>r.activeSources),(i,t)=>(u(),d("div",ge,[e("div",be,[t[10]||(t[10]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Sources",-1)),a.value.length===0?(u(),d("div",he,[...t[4]||(t[4]=[e("p",null,"No sources connected",-1),e("p",{class:"text-sm mt-1"},"Sources will appear when they join the room",-1)])])):(u(),d("div",ye,[(u(!0),d(A,null,K(a.value,s=>(u(),d("div",{key:s.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary"},[e("div",we,[e("div",{class:D(["w-10 h-10 rounded bg-r58-bg-primary flex items-center justify-center",{"ring-2 ring-r58-accent-primary":O(r).programSource===s.id}])},[s.type==="camera"?(u(),d("svg",_e,[...t[5]||(t[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):s.type==="guest"?(u(),d("svg",ke,[...t[6]||(t[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):(u(),d("svg",Se,[...t[7]||(t[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])]))],2),e("div",null,[e("p",$e,$(s.label),1),e("p",Ce,$(s.type),1)])]),e("div",Pe,[e("div",Oe,[e("div",{class:"h-full bg-r58-accent-success rounded-full transition-all duration-100",style:re({width:`${s.audioLevel}%`})},null,4)]),e("button",{onClick:C=>O(r).setSourceMute(s.id,!s.muted),class:D(["p-2 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":s.muted}])},[s.muted?(u(),d("svg",De,[...t[8]||(t[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(u(),d("svg",Re,[...t[9]||(t[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,Le)])]))),128))]))]),t[12]||(t[12]=e("div",{class:"card"},[e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Guest Invite"),e("button",{class:"btn w-full justify-center"}," Generate Invite Link ")],-1)),e("div",Ue,[t[11]||(t[11]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Scenes",-1)),e("div",Te,[e("button",{onClick:t[0]||(t[0]=s=>O(r).setScene("scene1")),class:D(["btn",{"btn-primary":O(r).activeScene==="scene1"}])}," Scene 1 ",2),e("button",{onClick:t[1]||(t[1]=s=>O(r).setScene("scene2")),class:D(["btn",{"btn-primary":O(r).activeScene==="scene2"}])}," Scene 2 ",2),e("button",{onClick:t[2]||(t[2]=s=>O(r).setScene("pip")),class:D(["btn",{"btn-primary":O(r).activeScene==="pip"}])}," PiP ",2),e("button",{onClick:t[3]||(t[3]=s=>O(r).setScene("grid")),class:D(["btn",{"btn-primary":O(r).activeScene==="grid"}])}," Grid ",2)])])]))}}),Ie={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary"},je={class:"flex items-center gap-2"},Ve={class:"text-r58-text-secondary"},Be={key:0,class:"px-4 pb-3"},Ee={key:0,class:"flex gap-3 flex-wrap"},He={class:"text-sm font-medium"},Ae={class:"text-xs text-r58-text-secondary"},Ke=["onClick"],Ne={key:1,class:"text-sm text-r58-text-secondary py-2"},ze={class:"hidden"},We=["src","onLoad","onError"],Fe=V({__name:"CameraPushBar",setup(f){const r=oe(),a=_(new Map),i=_(!0),t=U(()=>r.inputs.filter(m=>m.hasSignal));function s(m){return`${window.location.origin}/api/v1/whep/${m}/whep`}G(t,m=>{for(const c of m)if(!a.value.has(c.id)){const S=s(c.id),g=ee(c.id,S,c.label);a.value.set(c.id,{cameraId:c.id,label:c.label,status:"connecting",iframeSrc:g})}const p=new Set(m.map(c=>c.id));for(const[c]of a.value)p.has(c)||a.value.delete(c)},{immediate:!0});function C(m){const p=a.value.get(m);p&&(p.status="connected",console.log(`[CameraPush] ${m} connected to VDO.ninja`))}function w(m){const p=a.value.get(m);p&&(p.status="error",console.error(`[CameraPush] ${m} failed to connect`))}function x(m){const p=r.inputs.find(g=>g.id===m);if(!p||!p.hasSignal)return;const c=s(m),S=ee(m,c,p.label);a.value.set(m,{cameraId:m,label:p.label,status:"connecting",iframeSrc:S+`&_t=${Date.now()}`})}function P(m){switch(m){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function k(m){switch(m){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(m,p)=>(u(),d("div",Ie,[e("button",{onClick:p[0]||(p[0]=c=>i.value=!i.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors"},[e("div",je,[p[1]||(p[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",Ve,"("+$(t.value.length)+" active)",1)]),(u(),d("svg",{class:D(["w-4 h-4 transition-transform",{"rotate-180":i.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...p[2]||(p[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),i.value?(u(),d("div",Be,[a.value.size>0?(u(),d("div",Ee,[(u(!0),d(A,null,K(a.value,([c,S])=>(u(),d("div",{key:c,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[e("span",{class:D(["w-2 h-2 rounded-full",P(S.status)])},null,2),e("span",He,$(S.label),1),e("span",Ae,$(k(S.status)),1),S.status==="error"?(u(),d("button",{key:0,onClick:g=>x(c),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,Ke)):R("",!0)]))),128))])):(u(),d("div",Ne," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):R("",!0),e("div",ze,[(u(!0),d(A,null,K(a.value,([c,S])=>(u(),d("iframe",{key:c,src:S.iframeSrc,onLoad:g=>C(c),onError:g=>w(c),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,We))),128))])]))}}),Ge={class:"program-output space-y-3"},qe={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},Xe={class:"text-sm font-medium"},Je={key:0,class:"space-y-2"},Ye={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},Qe={class:"flex-1 text-xs truncate text-r58-text-secondary"},Ze={key:0,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},et={class:"text-xs text-r58-text-secondary"},tt={key:1,class:"text-xs text-r58-text-secondary px-3"},st={class:"hidden"},nt=["src"],ot=V({__name:"ProgramOutput",setup(f){const r=N(),a=q(),i=_(!1),t=_("idle"),s=_("");function C(){return`${window.location.origin}/api/v1/whip/program/whip`}function w(){i.value||(t.value="connecting",s.value=de(C()),i.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function x(){i.value&&(i.value=!1,s.value="",t.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function P(){i.value&&(t.value="live",console.log("[ProgramOutput] WHIP push connected"))}function k(){t.value="error",console.error("[ProgramOutput] WHIP push failed")}function m(){x(),setTimeout(()=>w(),500)}G(()=>r.isLive,g=>{g?w():x()});function p(){switch(t.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function c(){switch(t.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function S(){const g=a.programOutputUrls.srt;navigator.clipboard.writeText(g),T.success("SRT URL copied")}return(g,L)=>(u(),d("div",Ge,[e("div",qe,[e("span",{class:D(["w-2 h-2 rounded-full",p()])},null,2),e("span",Xe,$(c()),1),t.value==="error"?(u(),d("button",{key:0,onClick:L[0]||(L[0]=b=>m()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"}," Retry ")):R("",!0)]),t.value==="live"?(u(),d("div",Je,[e("div",Ye,[L[1]||(L[1]=e("span",{class:"text-xs text-r58-text-secondary"},"ðŸ”´ SRT:",-1)),e("code",Qe,$(O(a).programOutputUrls.srt),1),e("button",{onClick:S,class:"text-xs text-r58-accent-primary hover:underline"},"Copy")]),O(a).enabledDestinations.length>0?(u(),d("div",Ze,[L[2]||(L[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",et,$(O(a).enabledDestinations.length)+" streaming destination"+$(O(a).enabledDestinations.length>1?"s":"")+" active ",1)])):R("",!0)])):R("",!0),t.value==="idle"?(u(),d("p",tt," Program output will start automatically when you go live. ")):R("",!0),e("div",st,[i.value&&s.value?(u(),d("iframe",{key:0,src:s.value,onLoad:P,onError:k,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,nt)):R("",!0)])]))}}),rt={class:"streaming-settings"},at={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},it={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},lt={class:"p-6 overflow-y-auto max-h-[60vh]"},ct={class:"mb-8"},ut={class:"flex items-center justify-between mb-4"},dt={key:0,class:"mb-4 p-4 bg-r58-bg-tertiary rounded-lg"},mt={class:"grid grid-cols-2 gap-2"},pt=["onClick"],vt={class:"text-xl"},ft={key:1,class:"space-y-3"},xt=["onClick"],gt={class:"text-xl"},bt={class:"flex-1"},ht={class:"font-medium"},yt={class:"text-xs text-r58-text-secondary"},wt=["onClick"],_t=["onClick"],kt={key:2,class:"text-r58-text-secondary text-sm"},St={key:0,class:"mb-8 p-4 bg-r58-bg-tertiary rounded-lg"},$t={class:"text-lg font-medium mb-4"},Ct={class:"space-y-4"},Pt=["placeholder"],Ot={key:0},Lt={class:"flex gap-2"},Dt={class:"mb-8"},Rt={class:"space-y-3"},Ut={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Tt={class:"flex items-center justify-between mb-1"},Mt={class:"text-xs text-r58-text-secondary break-all"},It={class:"p-3 bg-r58-bg-tertiary rounded-lg"},jt={class:"flex items-center justify-between mb-1"},Vt={class:"text-xs text-r58-text-secondary break-all"},Bt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Et={class:"flex items-center justify-between mb-1"},Ht={class:"text-xs text-r58-text-secondary break-all"},At={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Kt={class:"flex items-center justify-between mb-1"},Nt={class:"text-xs text-r58-text-secondary break-all"},zt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Wt={class:"flex items-center justify-between mb-1"},Ft={class:"text-xs text-r58-text-secondary break-all"},Gt={class:"p-4 bg-r58-bg-tertiary rounded-lg"},qt={class:"flex items-center gap-3 mb-4"},Xt=V({__name:"StreamingSettings",setup(f,{expose:r}){const a=q(),i=_(!1),t=_(null),s=_(!1);_(""),_("");const C=U(()=>a.destinations),w=U(()=>j),x=U(()=>a.programOutputUrls);function P(){i.value=!0}function k(){i.value=!1,t.value=null,s.value=!1}function m(h){const n=a.addDestination(h);t.value=n,s.value=!1,a.saveDestinations()}function p(){t.value&&(a.updateDestination(t.value.id,t.value),a.saveDestinations(),t.value=null,T.success("Streaming destination saved"))}function c(h){a.removeDestination(h),a.saveDestinations(),T.info("Destination removed")}function S(h){a.updateDestination(h.id,{enabled:!h.enabled}),a.saveDestinations()}function g(h,n){navigator.clipboard.writeText(h),T.success(`${n} copied to clipboard`)}function L(h){const n=j.find(l=>l.id===h);return(n==null?void 0:n.icon)||"ðŸ“¡"}function b(h){const n=j.find(l=>l.id===h);return(n==null?void 0:n.name)||"Unknown"}return r({open:P}),(h,n)=>{var l;return u(),d("div",rt,[e("button",{onClick:P,class:"btn btn-sm"}," âš™ï¸ Streaming Settings "),(u(),ae(ie,{to:"body"},[i.value?(u(),d("div",at,[e("div",{class:"absolute inset-0 bg-black/60",onClick:k}),e("div",it,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[n[11]||(n[11]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:k,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," Ã— ")]),e("div",lt,[e("section",ct,[e("div",ut,[n[12]||(n[12]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:n[0]||(n[0]=o=>s.value=!s.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),s.value?(u(),d("div",dt,[n[13]||(n[13]=e("p",{class:"text-sm text-r58-text-secondary mb-3"},"Select a streaming platform:",-1)),e("div",mt,[(u(!0),d(A,null,K(w.value,o=>(u(),d("button",{key:o.id,onClick:v=>m(o.id),class:"flex items-center gap-2 p-3 bg-r58-bg-secondary hover:bg-r58-accent-primary/20 rounded-lg transition-colors text-left"},[e("span",vt,$(o.icon),1),e("span",null,$(o.name),1)],8,pt))),128))])])):R("",!0),C.value.length>0?(u(),d("div",ft,[(u(!0),d(A,null,K(C.value,o=>(u(),d("div",{key:o.id,class:"flex items-center gap-3 p-3 bg-r58-bg-tertiary rounded-lg"},[e("button",{onClick:v=>S(o),class:D(["w-10 h-6 rounded-full transition-colors relative",o.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:D(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",o.enabled?"left-5":"left-1"])},null,2)],10,xt),e("span",gt,$(L(o.platformId)),1),e("div",bt,[e("div",ht,$(o.name),1),e("div",yt,$(o.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+o.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:v=>t.value={...o},class:"text-r58-accent-primary hover:underline text-sm"}," Edit ",8,wt),e("button",{onClick:v=>c(o.id),class:"text-r58-accent-danger hover:underline text-sm"}," Remove ",8,_t)]))),128))])):(u(),d("p",kt," No streaming destinations configured. Add a platform above. "))]),t.value?(u(),d("section",St,[e("h3",$t," Edit "+$(b(t.value.platformId)),1),e("div",Ct,[e("div",null,[n[14]||(n[14]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Display Name",-1)),W(e("input",{"onUpdate:modelValue":n[1]||(n[1]=o=>t.value.name=o),type:"text",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none"},null,512),[[F,t.value.name]])]),e("div",null,[n[15]||(n[15]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Stream Key",-1)),W(e("input",{"onUpdate:modelValue":n[2]||(n[2]=o=>t.value.streamKey=o),type:"password",placeholder:(l=O(j).find(o=>o.id===t.value.platformId))==null?void 0:l.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,8,Pt),[[F,t.value.streamKey]]),n[16]||(n[16]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),t.value.platformId==="custom"?(u(),d("div",Ot,[n[17]||(n[17]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"RTMP URL",-1)),W(e("input",{"onUpdate:modelValue":n[3]||(n[3]=o=>t.value.name=o),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,512),[[F,t.value.name]])])):R("",!0),e("div",Lt,[e("button",{onClick:p,class:"btn btn-primary"}," Save "),e("button",{onClick:n[4]||(n[4]=o=>t.value=null),class:"btn"}," Cancel ")])])])):R("",!0),e("section",Dt,[n[26]||(n[26]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),n[27]||(n[27]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",Rt,[e("div",Ut,[e("div",Tt,[n[18]||(n[18]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:n[5]||(n[5]=o=>g(x.value.srt,"SRT URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Mt,$(x.value.srt),1),n[19]||(n[19]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",It,[e("div",jt,[n[20]||(n[20]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:n[6]||(n[6]=o=>g(x.value.rtmp,"RTMP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Vt,$(x.value.rtmp),1)]),e("div",Bt,[e("div",Et,[n[21]||(n[21]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:n[7]||(n[7]=o=>g(x.value.rtsp,"RTSP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Ht,$(x.value.rtsp),1)]),e("div",At,[e("div",Kt,[n[22]||(n[22]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:n[8]||(n[8]=o=>g(x.value.hls,"HLS URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Nt,$(x.value.hls),1),n[23]||(n[23]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",zt,[e("div",Wt,[n[24]||(n[24]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:n[9]||(n[9]=o=>g(x.value.whep,"WHEP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Ft,$(x.value.whep),1),n[25]||(n[25]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[n[30]||(n[30]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",Gt,[e("div",qt,[e("button",{onClick:n[10]||(n[10]=o=>O(a).toggleSrtOutput(!O(a).srtOutput.enabled)),class:D(["w-10 h-6 rounded-full transition-colors relative",O(a).srtOutput.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:D(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",O(a).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),n[28]||(n[28]=e("span",null,"Enable SRT Output",-1))]),n[29]||(n[29]=e("div",{class:"text-sm text-r58-text-secondary"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-r58-bg-tertiary"},[e("button",{onClick:k,class:"btn"},"Close")])])])):R("",!0)]))])}}}),Jt={class:"h-full flex flex-col"},Yt={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},Qt={class:"flex items-center gap-4"},Zt={class:"flex items-center gap-2"},es={key:0,class:"badge badge-danger"},ts={key:1,class:"text-xs text-r58-text-secondary"},ss={class:"flex items-center gap-4"},ns={class:"flex-1 flex overflow-hidden"},os={class:"flex-1 p-4"},rs={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},as={class:"mt-6 pt-4 border-t border-r58-bg-tertiary"},cs=V({__name:"MixerView",setup(f){const r=N(),a=oe(),i=q(),{register:t}=le(),s=_(null),C=_(null),w=U(()=>r.isLive),x=U(()=>i.enabledDestinations.length);let P=null;const k=[];se(()=>{a.fetchInputs(),P=window.setInterval(()=>{a.fetchInputs()},5e3);for(let b=1;b<=9;b++){const h=t({key:String(b),description:`Switch to scene ${b}`,action:()=>m(b),context:"mixer"});k.push(h)}k.push(t({key:"t",description:"Cut to preview (transition)",action:()=>p(),context:"mixer"})),k.push(t({key:"a",description:"Auto-transition with fade",action:()=>c(),context:"mixer"})),k.push(t({key:"Tab",description:"Cycle through sources",action:()=>S(),context:"mixer"})),k.push(t({key:"g",description:"Toggle Go Live",action:()=>g(),context:"mixer"}))}),ne(()=>{k.forEach(b=>b()),P&&(clearInterval(P),P=null)});function m(b){const h=`scene-${b}`;r.setScene(h),s.value&&s.value.sendCommand("changeScene",{scene:b}),T.info(`Scene ${b}`)}function p(){r.previewSource&&(r.setProgram(r.previewSource),T.info("Cut"))}function c(){r.previewSource&&(s.value&&s.value.sendCommand("transition",{type:"fade",duration:500}),r.setProgram(r.previewSource),T.info("Fade"))}function S(){const b=r.activeSources;if(b.length===0)return;const n=(b.findIndex(l=>l.id===r.previewSource)+1)%b.length;r.setPreview(b[n].id)}function g(){if(r.isLive)r.toggleLive(),i.stopStreaming(),T.info("Session ended");else{r.toggleLive(),i.startStreaming();const b=i.enabledDestinations.length;b>0?T.success(`Live! Streaming to ${b} destination${b>1?"s":""}`):T.info("Live! (No streaming destinations configured)")}}function L(){var b;(b=C.value)==null||b.open()}return(b,h)=>(u(),d("div",Jt,[e("header",Yt,[e("div",Qt,[e("div",Zt,[e("span",{class:D(["w-3 h-3 rounded-full",w.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),h[0]||(h[0]=e("span",{class:"text-xl font-semibold text-r58-mixer"},"Mixer",-1))]),w.value?(u(),d("span",es,"ON AIR")):R("",!0),w.value&&x.value>0?(u(),d("span",ts," Streaming to "+$(x.value)+" platform"+$(x.value>1?"s":""),1)):R("",!0)]),e("div",ss,[e("button",{class:"btn btn-sm",onClick:L,title:"Streaming Settings"},[...h[1]||(h[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),e("button",{class:D(["btn",w.value?"btn-danger":"btn-primary"]),onClick:g},$(w.value?"End Session":"Go Live"),3)])]),e("div",ns,[e("div",os,[H(xe,{ref_key:"vdoEmbedRef",ref:s,profile:"director",class:"h-full"},null,512)]),e("aside",rs,[H(Me),e("div",as,[h[2]||(h[2]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Program Output",-1)),H(ot)])])]),H(Fe),H(Xt,{ref_key:"streamingSettingsRef",ref:C},null,512)]))}});export{cs as default};
