const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BHTfQ4rU.js","assets/index-B6KfFPuD.css"])))=>i.map(i=>d[i]);
import{J as le,r as $,h as N,f as z,d as H,N as de,j as B,k as q,c as a,a as e,I as c,t as v,b as T,n as A,p as G,F as E,q as U,e as ce,o as s,_ as ue,B as ee,w as I,O as te,P as ve,Q as re,y as se,R as K,i as pe,x as J,S as me,E as W,l as ae}from"./index-BHTfQ4rU.js";import{V as ne,g as fe}from"./vdoninja-D8mLQF_b.js";const _e={cam0:"HDMI 1",cam1:"HDMI 2",cam2:"HDMI 3",cam3:"HDMI 4"},be=le("capabilities",()=>{const R=$(null),p=$(!1),o=$(null),u=N(()=>{var i;return((i=R.value)==null?void 0:i.mixer_available)??!1}),f=N(()=>{var i;return((i=R.value)==null?void 0:i.recorder_available)??!0}),_=N(()=>{var i,d;return((d=(i=R.value)==null?void 0:i.vdoninja)==null?void 0:d.enabled)??!0}),b=N(()=>{if(!R.value||!R.value.storage_total_gb)return 0;const i=R.value.storage_total_gb-R.value.storage_available_gb;return Math.round(i/R.value.storage_total_gb*100)});async function m(){var i,d;p.value=!0,o.value=null;try{const[C,S,t]=await Promise.all([fetch(z("/health")),fetch(z("/api/mode/status")),fetch(z("/api/ingest/status"))]),n=C.ok?await C.json():{},h=S.ok?await S.json():{},F=t.ok?await t.json():{cameras:{}},L=Object.entries(F.cameras||{}).map(([M,V])=>{var O;return{id:M,type:"hdmi",label:_e[M]||M,max_resolution:((O=V.resolution)==null?void 0:O.formatted)||"4K",supports_audio:!0,device_path:V.device||null,status:V.status||"unknown",has_signal:V.has_signal||!1}});R.value={device_id:"r58-device",device_name:"Preke R58",platform:n.platform||"R58",api_version:"2.0",mixer_available:((i=h.available_modes)==null?void 0:i.includes("mixer"))??!0,recorder_available:((d=h.available_modes)==null?void 0:d.includes("recorder"))??!0,graphics_available:!0,fleet_agent_connected:!1,inputs:L,codecs:[{id:"h264",name:"H.264",hardware_accelerated:!0,max_bitrate_kbps:5e4}],preview_modes:[{id:"whep",protocol:"WebRTC",latency_ms:100,url_template:"/{cam_id}/whep"}],vdoninja:{enabled:!0,host:"r58-vdo.itagenten.no",port:443,room:"studio"},mediamtx_base_url:"rtsp://127.0.0.1:8554",max_simultaneous_recordings:4,max_output_resolution:"4K",storage_total_gb:0,storage_available_gb:0,current_mode:h.current_mode||"recorder"},o.value=null}catch(C){o.value=C instanceof Error?C.message:"Unknown error",console.error("Failed to fetch capabilities:",C)}finally{p.value=!1}}return{capabilities:R,loading:p,error:o,mixerEnabled:u,recorderEnabled:f,vdoNinjaEnabled:_,storagePercent:b,fetchCapabilities:m}}),xe={class:"grid gap-6 md:grid-cols-2 lg:grid-cols-3"},ye={class:"card"},ge={key:0,class:"text-r58-accent-danger"},he={key:1,class:"space-y-3"},we={class:"flex justify-between items-center"},ke={key:0,class:"skeleton w-24 h-5"},$e={key:1,class:"font-medium"},je={class:"flex justify-between items-center"},Se={key:0,class:"skeleton w-16 h-5"},Re={key:1,class:"capitalize"},Ce={class:"flex justify-between items-center"},De={key:0,class:"skeleton w-12 h-5"},Ae={key:1},Pe={class:"flex justify-between items-center"},Ne={key:0,class:"skeleton w-20 h-5"},Ve={key:1,class:"badge badge-success"},Te={class:"card"},Ee={class:"space-y-4"},Me={class:"flex items-center justify-between"},Oe={key:0,class:"skeleton w-20 h-5 rounded-full"},Ue={class:"flex gap-2"},Fe=["disabled"],Le={key:0,class:"inline-block animate-spin mr-1"},Ie=["disabled"],He={key:0,class:"inline-block animate-spin mr-1"},Be={key:0,class:"text-sm text-r58-accent-danger"},ze={class:"card"},Ge={class:"space-y-3"},Ke={class:"flex justify-between items-center"},Je={key:0,class:"skeleton w-20 h-5 rounded-full"},We={class:"flex justify-between items-center"},qe={key:0,class:"skeleton w-20 h-5 rounded-full"},Qe={class:"flex justify-between items-center"},Xe={key:0,class:"skeleton w-20 h-5 rounded-full"},Ye={key:1,class:"badge badge-success"},Ze={class:"flex justify-between items-center"},et={key:0,class:"skeleton w-20 h-5 rounded-full"},tt={key:1,class:"badge badge-success"},st={class:"card md:col-span-2 lg:col-span-3"},at={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4"},nt={class:"flex items-center justify-between mb-3"},ot={class:"flex items-center gap-2"},rt={class:"font-medium"},it={class:"space-y-1 text-sm text-r58-text-secondary"},lt={class:"flex justify-between"},dt={class:"text-r58-text-primary"},ct={class:"flex justify-between"},ut={class:"text-r58-text-primary"},vt={class:"flex justify-between"},pt={class:"text-r58-text-primary font-mono text-xs"},mt={key:0,class:"col-span-full text-center text-r58-text-secondary py-8"},ft=H({__name:"DeviceStatus",setup(R){const p=be(),{capabilities:o,loading:u,error:f}=de(p),_=$(!1),b=$(null);let m=null;async function i(S){if(!_.value){_.value=!0,b.value=null;try{const t=await fetch(z(`/api/mode/${S}`),{method:"POST"});if(!t.ok){const n=await t.json().catch(()=>({}));throw new Error(n.detail||`Failed to switch to ${S} mode`)}await p.fetchCapabilities()}catch(t){b.value=t instanceof Error?t.message:"Failed to switch mode",console.error("Mode switch error:",t)}finally{_.value=!1}}}function d(S,t){if(!t)return"bg-r58-text-secondary";switch(S){case"streaming":case"recording":return"bg-r58-accent-success";case"preview":return"bg-r58-accent-info";case"idle":return"bg-r58-text-secondary";case"error":return"bg-r58-accent-danger";default:return"bg-r58-text-secondary"}}function C(S,t){if(!t)return"No Signal";switch(S){case"streaming":return"Streaming";case"recording":return"Recording";case"preview":return"Preview";case"idle":return"Idle";case"error":return"Error";default:return S}}return B(()=>{p.fetchCapabilities(),m=setInterval(()=>{p.fetchCapabilities()},1e4)}),q(()=>{m&&clearInterval(m)}),(S,t)=>{var n,h,F,L,M,V,O,r,l,x,w,k,D,g;return s(),a("div",xe,[e("div",ye,[t[6]||(t[6]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Device Info",-1)),c(f)&&!c(o)?(s(),a("div",ge,v(c(f)),1)):(s(),a("div",he,[e("div",we,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"Device Name",-1)),c(u)&&!c(o)?(s(),a("div",ke)):(s(),a("span",$e,v(((n=c(o))==null?void 0:n.device_name)||"R58 Device"),1))]),e("div",je,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Platform",-1)),c(u)&&!c(o)?(s(),a("div",Se)):(s(),a("span",Re,v(((h=c(o))==null?void 0:h.platform)||"-"),1))]),e("div",Ce,[t[4]||(t[4]=e("span",{class:"text-r58-text-secondary"},"API Version",-1)),c(u)&&!c(o)?(s(),a("div",De)):(s(),a("span",Ae,v(((F=c(o))==null?void 0:F.api_version)||"-"),1))]),e("div",Pe,[t[5]||(t[5]=e("span",{class:"text-r58-text-secondary"},"GStreamer",-1)),c(u)&&!c(o)?(s(),a("div",Ne)):(s(),a("span",Ve,"Initialized"))])]))]),e("div",Te,[t[10]||(t[10]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Operating Mode",-1)),e("div",Ee,[e("div",Me,[t[7]||(t[7]=e("span",{class:"text-r58-text-secondary"},"Current Mode",-1)),c(u)&&!c(o)?(s(),a("div",Oe)):(s(),a("span",{key:1,class:A(["badge",((L=c(o))==null?void 0:L.current_mode)==="mixer"?"badge-info":"badge-success"])},v(((M=c(o))==null?void 0:M.current_mode)==="mixer"?"Mixer":"Recorder"),3))]),e("div",Ue,[e("button",{class:A(["btn btn-sm flex-1",((V=c(o))==null?void 0:V.current_mode)==="recorder"?"btn-primary":"btn-secondary"]),disabled:_.value||((O=c(o))==null?void 0:O.current_mode)==="recorder"||c(u)&&!c(o),onClick:t[0]||(t[0]=y=>i("recorder"))},[_.value&&((r=c(o))==null?void 0:r.current_mode)!=="recorder"?(s(),a("span",Le,"⟳")):T("",!0),t[8]||(t[8]=G(" Recorder ",-1))],10,Fe),e("button",{class:A(["btn btn-sm flex-1",((l=c(o))==null?void 0:l.current_mode)==="mixer"?"btn-primary":"btn-secondary"]),disabled:_.value||((x=c(o))==null?void 0:x.current_mode)==="mixer"||c(u)&&!c(o),onClick:t[1]||(t[1]=y=>i("mixer"))},[_.value&&((w=c(o))==null?void 0:w.current_mode)!=="mixer"?(s(),a("span",He,"⟳")):T("",!0),t[9]||(t[9]=G(" Mixer ",-1))],10,Ie)]),b.value?(s(),a("div",Be,v(b.value),1)):T("",!0)])]),e("div",ze,[t[15]||(t[15]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Available Features",-1)),e("div",Ge,[e("div",Ke,[t[11]||(t[11]=e("div",null,[e("span",null,"Mixer"),e("span",{class:"text-xs text-r58-text-secondary ml-1"},"(VDO.ninja)")],-1)),c(u)&&!c(o)?(s(),a("div",Je)):(s(),a("span",{key:1,class:A(["badge",c(p).mixerEnabled?"badge-success":"badge-warning"])},v(c(p).mixerEnabled?"Available":"Disabled"),3))]),e("div",We,[t[12]||(t[12]=e("span",null,"Recorder",-1)),c(u)&&!c(o)?(s(),a("div",qe)):(s(),a("span",{key:1,class:A(["badge",c(p).recorderEnabled?"badge-success":"badge-warning"])},v(c(p).recorderEnabled?"Available":"Disabled"),3))]),e("div",Qe,[t[13]||(t[13]=e("span",null,"Graphics Overlay",-1)),c(u)&&!c(o)?(s(),a("div",Xe)):(s(),a("span",Ye,"Available"))]),e("div",Ze,[t[14]||(t[14]=e("span",null,"WebRTC Preview",-1)),c(u)&&!c(o)?(s(),a("div",et)):(s(),a("span",tt,"Available"))])])]),e("div",st,[t[20]||(t[20]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Hardware Inputs",-1)),e("div",at,[c(u)&&!c(o)?(s(),a(E,{key:0},U(4,y=>e("div",{key:y,class:"p-4 rounded-lg bg-r58-bg-tertiary border border-r58-border"},[...t[16]||(t[16]=[ce('<div class="flex items-center justify-between mb-3" data-v-dc425660><div class="flex items-center gap-2" data-v-dc425660><div class="skeleton w-2 h-2 rounded-full" data-v-dc425660></div><div class="skeleton w-16 h-5" data-v-dc425660></div></div><div class="skeleton w-16 h-4 rounded-full" data-v-dc425660></div></div><div class="space-y-2" data-v-dc425660><div class="flex justify-between" data-v-dc425660><div class="skeleton w-8 h-4" data-v-dc425660></div><div class="skeleton w-12 h-4" data-v-dc425660></div></div><div class="flex justify-between" data-v-dc425660><div class="skeleton w-16 h-4" data-v-dc425660></div><div class="skeleton w-20 h-4" data-v-dc425660></div></div><div class="flex justify-between" data-v-dc425660><div class="skeleton w-10 h-4" data-v-dc425660></div><div class="skeleton w-14 h-4" data-v-dc425660></div></div></div>',2)])])),64)):(s(),a(E,{key:1},[(s(!0),a(E,null,U(((k=c(o))==null?void 0:k.inputs)||[],y=>{var P;return s(),a("div",{key:y.id,class:A(["p-4 rounded-lg bg-r58-bg-tertiary border border-r58-border",{"border-r58-accent-success/50":y.has_signal}])},[e("div",nt,[e("div",ot,[e("span",{class:A(["w-2 h-2 rounded-full animate-pulse",d(y.status,y.has_signal)])},null,2),e("span",rt,v(y.label),1)]),e("span",{class:A(["text-xs px-2 py-0.5 rounded-full",{"bg-r58-accent-success/20 text-r58-accent-success":y.has_signal&&(y.status==="streaming"||y.status==="recording"),"bg-r58-accent-info/20 text-r58-accent-info":y.has_signal&&y.status==="preview","bg-r58-bg-tertiary text-r58-text-secondary":!y.has_signal||y.status==="idle"}])},v(C(y.status,y.has_signal)),3)]),e("div",it,[e("div",lt,[t[17]||(t[17]=e("span",null,"Type",-1)),e("span",dt,v(y.type.toUpperCase()),1)]),e("div",ct,[t[18]||(t[18]=e("span",null,"Resolution",-1)),e("span",ut,v(y.max_resolution||"N/A"),1)]),e("div",vt,[t[19]||(t[19]=e("span",null,"Device",-1)),e("span",pt,v(((P=y.device_path)==null?void 0:P.split("/").pop())||"N/A"),1)])])],2)}),128)),(g=(D=c(o))==null?void 0:D.inputs)!=null&&g.length?T("",!0):(s(),a("div",mt," No inputs detected "))],64))])])])}}}),_t=ue(ft,[["__scopeId","data-v-dc425660"]]),bt={class:"space-y-4"},xt={class:"flex items-center gap-4 flex-wrap"},yt=["value"],gt={class:"flex items-center gap-2 cursor-pointer"},ht=["disabled"],wt={key:0},kt={key:1},$t={class:"bg-r58-bg-primary rounded-lg p-4 font-mono text-sm text-r58-text-secondary h-[500px] overflow-auto whitespace-pre-wrap"},jt=H({__name:"LogViewer",props:{service:{}},setup(R){const p=R,o=$(""),u=$(!1),f=$(p.service||"preke-recorder"),_=$(100),b=$(!1),m=[{id:"preke-recorder",label:"Preke Recorder"},{id:"mediamtx",label:"MediaMTX"}];let i=null;async function d(){u.value=!0;try{const n=await(await fetch(z(`/api/system/logs?service=${f.value}&lines=${_.value}`))).json();o.value=n.logs||"No logs available"}catch(t){o.value=`Error fetching logs: ${t}`}finally{u.value=!1}}function C(){i&&clearInterval(i),i=window.setInterval(d,5e3)}function S(){i&&(clearInterval(i),i=null)}return ee(b,t=>{t?C():S()}),ee([f,_],()=>{d()}),B(()=>{d()}),q(()=>{S()}),(t,n)=>(s(),a("div",bt,[e("div",xt,[I(e("select",{"onUpdate:modelValue":n[0]||(n[0]=h=>f.value=h),class:"input"},[(s(),a(E,null,U(m,h=>e("option",{key:h.id,value:h.id},v(h.label),9,yt)),64))],512),[[te,f.value]]),I(e("select",{"onUpdate:modelValue":n[1]||(n[1]=h=>_.value=h),class:"input"},[...n[3]||(n[3]=[e("option",{value:50},"50 lines",-1),e("option",{value:100},"100 lines",-1),e("option",{value:250},"250 lines",-1),e("option",{value:500},"500 lines",-1)])],512),[[te,_.value]]),e("label",gt,[I(e("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=h=>b.value=h),class:"w-4 h-4 rounded"},null,512),[[ve,b.value]]),n[4]||(n[4]=e("span",{class:"text-sm"},"Auto-refresh",-1))]),e("button",{onClick:d,disabled:u.value,class:"btn"},[u.value?(s(),a("span",wt,"Loading...")):(s(),a("span",kt,"Refresh"))],8,ht)]),e("pre",$t,v(o.value||"No logs available"),1)]))}}),St={class:"space-y-6"},Rt={class:"flex items-center justify-between"},Ct=["disabled"],Dt={key:0},At={key:1},Pt={key:0,class:"flex items-center justify-center py-12"},Nt={key:1,class:"text-center py-12 text-r58-text-secondary"},Vt={key:2,class:"grid gap-4 md:grid-cols-2 lg:grid-cols-3"},Tt=["onClick"],Et={class:"flex items-start justify-between mb-4"},Mt={class:"font-semibold"},Ot={class:"text-sm text-r58-text-secondary"},Ut={class:"space-y-2 text-sm"},Ft={class:"flex justify-between"},Lt={class:"font-mono"},It={class:"flex justify-between"},Ht=H({__name:"FleetOverview",setup(R){const p=$([]),o=$(!0),u=$(!1);async function f(){o.value=!0;try{const m=await fetch("/api/v1/lan-devices");if(m.ok){const i=await m.json();p.value=i.map(d=>({id:d.id,name:d.name,ip:d.ip,status:d.status,lastSeen:d.last_seen,version:d.api_version||"unknown"}))}}catch(m){console.error("Failed to fetch LAN devices:",m)}finally{o.value=!1}}B(f);async function _(){u.value=!0;try{const m=await fetch("/api/v1/lan-devices/scan",{method:"POST"});if(m.ok){const i=await m.json();for(const d of i)p.value.find(S=>S.id===d.id)||p.value.push({id:d.id,name:d.name,ip:d.ip,status:d.status,lastSeen:d.last_seen,version:d.api_version||"unknown"})}}catch(m){console.error("LAN network scan failed:",m)}finally{u.value=!1}}async function b(m){try{const d=await(await fetch(`/api/v1/lan-devices/${m.id}/connect`,{method:"POST"})).json();d.connected?window.open(`http://${m.ip}:8000`,"_blank"):alert(`Failed to connect: ${d.error||"Unknown error"}`)}catch(i){console.error("Failed to connect to device:",i)}}return(m,i)=>(s(),a("div",St,[e("div",Rt,[i[0]||(i[0]=e("h2",{class:"text-lg font-semibold"},"LAN Devices",-1)),e("button",{onClick:_,disabled:u.value,class:"btn"},[u.value?(s(),a("span",Dt,"Scanning...")):(s(),a("span",At,"Scan Network"))],8,Ct)]),o.value?(s(),a("div",Pt,[...i[1]||(i[1]=[e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full"},null,-1)])])):p.value.length===0?(s(),a("div",Nt,[...i[2]||(i[2]=[e("p",null,"No devices found",-1),e("p",{class:"text-sm mt-2"},'Click "Scan Network" to discover R58 devices',-1)])])):(s(),a("div",Vt,[(s(!0),a(E,null,U(p.value,d=>(s(),a("div",{key:d.id,class:"card hover:border-r58-accent-primary/50 transition-colors cursor-pointer",onClick:C=>b(d)},[e("div",Et,[e("div",null,[e("h3",Mt,v(d.name),1),e("p",Ot,v(d.id),1)]),e("span",{class:A(["badge",{"badge-success":d.status==="online","badge-danger":d.status==="offline","badge-warning":d.status==="unknown"}])},v(d.status),3)]),e("div",Ut,[e("div",Ft,[i[3]||(i[3]=e("span",{class:"text-r58-text-secondary"},"IP Address",-1)),e("span",Lt,v(d.ip),1)]),e("div",It,[i[4]||(i[4]=e("span",{class:"text-r58-text-secondary"},"Version",-1)),e("span",null,v(d.version),1)])])],8,Tt))),128))]))]))}}),Bt={class:"space-y-6"},zt={key:0,class:"flex items-center justify-center py-12"},Gt={key:1,class:"card bg-r58-accent-danger/10 border border-r58-accent-danger/30"},Kt={class:"text-r58-accent-danger"},Jt={class:"grid gap-4 md:grid-cols-2 lg:grid-cols-4"},Wt={class:"card"},qt={key:0,class:"space-y-3"},Qt={class:"relative w-full h-4 bg-r58-bg-tertiary rounded-full overflow-hidden"},Xt={class:"flex justify-between text-sm"},Yt={class:"font-mono"},Zt={key:1,class:"flex items-center justify-center py-4"},es={class:"card"},ts={key:0,class:"space-y-3"},ss={class:"relative w-full h-4 bg-r58-bg-tertiary rounded-full overflow-hidden"},as={class:"flex justify-between text-sm"},ns={key:1,class:"flex items-center justify-center py-4"},os={class:"card"},rs={class:"flex items-center justify-center py-2"},is={key:1,class:"text-r58-text-secondary"},ls={key:0,class:"text-center text-xs text-r58-text-secondary"},ds={class:"card"},cs={class:"flex items-center justify-center py-2"},us={key:0,class:"text-3xl font-bold text-r58-accent-primary"},vs={key:1,class:"text-r58-text-secondary"},ps={class:"text-center text-xs text-r58-text-secondary"},ms={class:"card"},fs={class:"flex items-center justify-between mb-4"},_s={class:"flex gap-2"},bs={class:"grid gap-3 sm:grid-cols-3"},xs={class:"flex items-center gap-3"},ys={class:"font-medium"},gs={class:"text-xs text-r58-text-secondary"},hs={key:0},ws=["onClick"],ks={key:1,class:"text-xs text-r58-text-secondary"},$s={class:"card"},js={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},Ss={class:"ml-2 text-r58-accent-primary"},Rs={key:0,class:"text-center py-8 text-r58-text-secondary"},Cs={key:1,class:"space-y-2"},Ds={class:"flex items-center gap-4"},As={class:"font-mono text-sm"},Ps={class:"text-xs text-r58-text-secondary"},Ns={key:0},Vs={class:"flex items-center gap-3"},Ts=["onClick"],Es=H({__name:"SystemMonitor",setup(R){const p=re(),o=$(!0),u=$(null),f=$(null),_=$(null),b=N(()=>{var x,w,k;const r=((k=(w=(x=f.value)==null?void 0:x.info)==null?void 0:w.load_average)==null?void 0:k[0])??0;return Math.min(100,r/8*100)}),m=N(()=>{var l,x;const r=(x=(l=f.value)==null?void 0:l.info)==null?void 0:x.memory_percent;return r!==void 0?r:0}),i=N(()=>{var x,w;const r=((w=(x=f.value)==null?void 0:x.info)==null?void 0:w.temperatures)??[];return r.length===0?null:r.find(k=>{var D;return(D=k.type)==null?void 0:D.toLowerCase().includes("cpu")})??r[0]}),d=N(()=>{var k,D;const r=((D=(k=f.value)==null?void 0:k.info)==null?void 0:D.uptime_seconds)??0,l=Math.floor(r/86400),x=Math.floor(r%86400/3600),w=Math.floor(r%3600/60);return l>0?`${l}d ${x}h`:x>0?`${x}h ${w}m`:`${w}m`}),C=N(()=>{var r;return((r=f.value)==null?void 0:r.services)??[]}),S=N(()=>{var r;return((r=f.value)==null?void 0:r.pipelines)??[]});async function t(){try{const{buildApiUrl:r}=await K(async()=>{const{buildApiUrl:y}=await import("./index-BHTfQ4rU.js").then(P=>P.V);return{buildApiUrl:y}},__vite__mapDeps([0,1])),[l,x,w]=await Promise.all([fetch(r("/health")),fetch(r("/api/ingest/status")),fetch(r("/api/system/info"))]),k=l.ok?await l.json():{status:"unknown"},D=x.ok?await x.json():{cameras:{}},g=w.ok?await w.json():null;f.value={info:{hostname:(g==null?void 0:g.hostname)||"R58 Device",platform:k.platform||"R58",gstreamer:k.gstreamer,load_average:(g==null?void 0:g.load_average)||[0,0,0],memory_percent:(g==null?void 0:g.memory_percent)||0,memory_total_mb:(g==null?void 0:g.memory_total_mb)||0,memory_used_mb:(g==null?void 0:g.memory_used_mb)||0,uptime_seconds:(g==null?void 0:g.uptime_seconds)||0,temperatures:(g==null?void 0:g.temperatures)||[]},services:[{name:"r58-recorder",active:k.status==="healthy",status:k.status},{name:"mediamtx",active:!0,status:"running"},{name:"vdo.ninja",active:!0,status:"running",note:"r58-vdo.itagenten.no"}],pipelines:Object.entries(D.cameras||{}).map(([y,P])=>({pipeline_id:y,pipeline_type:"ingest",device:P.device,state:P.status==="streaming"?"running":P.status}))},u.value=null}catch(r){u.value=r.message,console.error("Failed to fetch system status:",r)}finally{o.value=!1}}async function n(r){try{const{buildApiUrl:l}=await K(async()=>{const{buildApiUrl:k}=await import("./index-BHTfQ4rU.js").then(D=>D.V);return{buildApiUrl:k}},__vite__mapDeps([0,1])),w=await(await fetch(l(`/api/system/restart-service/${r}`),{method:"POST"})).json();w.success?(p.success(w.message||`Service ${r} restarted`),setTimeout(t,2e3)):p.error(w.message||`Failed to restart ${r}`)}catch(l){p.error(`Restart failed: ${l.message}`)}}async function h(){if(confirm("Are you sure you want to reboot the device? This will interrupt all recordings and streams."))try{const{buildApiUrl:r}=await K(async()=>{const{buildApiUrl:w}=await import("./index-BHTfQ4rU.js").then(k=>k.V);return{buildApiUrl:w}},__vite__mapDeps([0,1])),x=await(await fetch(r("/api/system/reboot"),{method:"POST"})).json();x.success?p.success("Device is rebooting..."):p.error(x.message||"Failed to reboot device")}catch(r){p.error(`Reboot failed: ${r.message}`)}}async function F(r){try{const{buildApiUrl:l}=await K(async()=>{const{buildApiUrl:k}=await import("./index-BHTfQ4rU.js").then(D=>D.V);return{buildApiUrl:k}},__vite__mapDeps([0,1])),x=await fetch(l(`/api/ingest/stop/${r}`),{method:"POST"}),w=await x.json();x.ok?(p.success(`Stopped pipeline: ${r}`),await t()):p.error(w.detail||"Stop failed")}catch(l){p.error(`Stop failed: ${l.message}`)}}function L(r){return r.active?"bg-r58-accent-success":"bg-r58-accent-danger"}function M(r){switch(r){case"running":return"text-r58-accent-success";case"starting":return"text-r58-accent-warning";case"stopping":return"text-r58-accent-warning";default:return"text-r58-text-secondary"}}function V(r){return r>90?"bg-r58-accent-danger":r>70?"bg-r58-accent-warning":"bg-r58-accent-success"}function O(r){return r>80?"text-r58-accent-danger":r>65?"text-r58-accent-warning":"text-r58-accent-success"}return B(()=>{t(),_.value=window.setInterval(t,1e4)}),q(()=>{_.value&&clearInterval(_.value)}),(r,l)=>{var x,w,k,D,g,y,P,Q,X,Y,Z;return s(),a("div",Bt,[o.value?(s(),a("div",zt,[...l[1]||(l[1]=[e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full"},null,-1)])])):u.value?(s(),a("div",Gt,[e("p",Kt,"Error loading system status: "+v(u.value),1),e("button",{onClick:t,class:"btn btn-secondary mt-4"},"Retry")])):(s(),a(E,{key:2},[e("div",Jt,[e("div",Wt,[l[4]||(l[4]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"CPU Load",-1)),(k=(w=(x=f.value)==null?void 0:x.info)==null?void 0:w.load_average)!=null&&k.some(j=>j>0)?(s(),a("div",qt,[e("div",Qt,[e("div",{class:A(["absolute left-0 top-0 h-full rounded-full transition-all duration-500",V(b.value)]),style:se({width:`${b.value}%`})},null,6)]),e("div",Xt,[l[2]||(l[2]=e("span",{class:"text-r58-text-secondary"},"Load Average",-1)),e("span",Yt,v((y=(g=(D=f.value)==null?void 0:D.info)==null?void 0:g.load_average)==null?void 0:y.map(j=>j.toFixed(2)).join(" / ")),1)])])):(s(),a("div",Zt,[...l[3]||(l[3]=[e("span",{class:"text-r58-text-secondary"},"N/A",-1)])]))]),e("div",es,[l[7]||(l[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Memory",-1)),m.value>0?(s(),a("div",ts,[e("div",ss,[e("div",{class:A(["absolute left-0 top-0 h-full rounded-full transition-all duration-500",V(m.value)]),style:se({width:`${m.value}%`})},null,6)]),e("div",as,[l[5]||(l[5]=e("span",{class:"text-r58-text-secondary"},"Used",-1)),e("span",null,v(m.value.toFixed(1))+"%",1)])])):(s(),a("div",ns,[...l[6]||(l[6]=[e("span",{class:"text-r58-text-secondary"},"N/A",-1)])]))]),e("div",os,[l[8]||(l[8]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Temperature",-1)),e("div",rs,[i.value?(s(),a("span",{key:0,class:A(["text-3xl font-bold",O(i.value.temp_celsius)])},v(i.value.temp_celsius.toFixed(1))+"°C ",3)):(s(),a("span",is,"N/A"))]),(P=i.value)!=null&&P.type?(s(),a("p",ls,v(i.value.type),1)):T("",!0)]),e("div",ds,[l[9]||(l[9]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Uptime",-1)),e("div",cs,[((X=(Q=f.value)==null?void 0:Q.info)==null?void 0:X.uptime_seconds)>0?(s(),a("span",us,v(d.value),1)):(s(),a("span",vs,"N/A"))]),e("p",ps,v(((Z=(Y=f.value)==null?void 0:Y.info)==null?void 0:Z.hostname)||"R58 Device"),1)])]),e("div",ms,[e("div",fs,[l[10]||(l[10]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide"},"Services",-1)),e("div",_s,[e("button",{onClick:l[0]||(l[0]=j=>n("preke-recorder")),class:"btn btn-sm btn-secondary",title:"Restart the main service"}," Restart Service "),e("button",{onClick:h,class:"btn btn-sm btn-danger",title:"Reboot the device"}," Reboot Device ")])]),e("div",bs,[(s(!0),a(E,null,U(C.value,j=>(s(),a("div",{key:j.name,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary"},[e("div",xs,[e("span",{class:A(["w-2.5 h-2.5 rounded-full",L(j)])},null,2),e("div",null,[e("p",ys,v(j.name),1),e("p",gs,[G(v(j.status)+" ",1),j.memory_mb?(s(),a("span",hs," · "+v(j.memory_mb.toFixed(0))+" MB",1)):T("",!0)])])]),j.name!=="vdo.ninja"?(s(),a("button",{key:0,onClick:ie=>n(j.name),class:"text-r58-text-secondary hover:text-r58-text-primary transition-colors",title:"Restart service"},[...l[11]||(l[11]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])],8,ws)):(s(),a("span",ks,"External"))]))),128))])]),e("div",$s,[e("h3",js,[l[12]||(l[12]=G(" Active Pipelines ",-1)),e("span",Ss,"("+v(S.value.length)+")",1)]),S.value.length===0?(s(),a("div",Rs," No active pipelines ")):(s(),a("div",Cs,[(s(!0),a(E,null,U(S.value,j=>(s(),a("div",{key:j.pipeline_id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary"},[e("div",Ds,[e("div",null,[e("p",As,v(j.pipeline_id),1),e("p",Ps,[G(" Type: "+v(j.pipeline_type)+" ",1),j.device?(s(),a("span",Ns," · "+v(j.device),1)):T("",!0)])])]),e("div",Vs,[e("span",{class:A(["text-sm font-medium capitalize",M(j.state)])},v(j.state),3),j.state==="running"?(s(),a("button",{key:0,onClick:ie=>F(j.pipeline_id),class:"btn btn-sm btn-danger",title:"Stop pipeline"}," Stop ",8,Ts)):T("",!0)])]))),128))]))])],64))])}}}),Ms={class:"space-y-6"},Os={class:"card"},Us={class:"space-y-4"},Fs={class:"card"},Ls={class:"space-y-4"},Is=["value"],Hs={class:"card"},Bs={class:"space-y-4"},zs=["value"],Gs={class:"flex items-center justify-between"},Ks={key:0},Js={class:"card bg-r58-bg-tertiary/50"},Ws={class:"space-y-2 text-sm"},qs={class:"flex justify-between"},oe="preke-settings",Qs=H({__name:"SettingsPanel",setup(R){const p=re(),o=$("Preke Device"),u=$(ne),f=$(fe()),_=$("/recordings"),b=$(!1),m=$(30),i=N(()=>pe());function d(){try{const t=localStorage.getItem(oe);if(t){const n=JSON.parse(t);o.value=n.deviceName||o.value,u.value=n.vdoRoom||u.value,b.value=n.autoCleanup||!1,m.value=n.cleanupDays||30}}catch{}}function C(){try{const t={deviceName:o.value,vdoRoom:u.value,autoCleanup:b.value,cleanupDays:m.value};localStorage.setItem(oe,JSON.stringify(t)),p.success("Settings saved")}catch(t){p.error("Failed to save settings"),console.error("Failed to save settings:",t)}}function S(){o.value="Preke Device",u.value=ne,b.value=!1,m.value=30,C(),p.info("Settings reset to defaults")}return B(()=>{d()}),(t,n)=>(s(),a("div",Ms,[e("div",Os,[n[6]||(n[6]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Device",-1)),e("div",Us,[e("div",null,[n[4]||(n[4]=e("label",{class:"block text-sm font-medium mb-2"},"Device Name",-1)),I(e("input",{"onUpdate:modelValue":n[0]||(n[0]=h=>o.value=h),type:"text",class:"input w-full",placeholder:"My Preke Device"},null,512),[[J,o.value]]),n[5]||(n[5]=e("p",{class:"text-xs text-r58-text-secondary mt-1"},"Display name for this device in the app",-1))])])]),e("div",Fs,[n[11]||(n[11]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"VDO.ninja / Mixer",-1)),e("div",Ls,[e("div",null,[n[7]||(n[7]=e("label",{class:"block text-sm font-medium mb-2"},"Room Name",-1)),I(e("input",{"onUpdate:modelValue":n[1]||(n[1]=h=>u.value=h),type:"text",class:"input w-full",placeholder:"r58studio"},null,512),[[J,u.value]]),n[8]||(n[8]=e("p",{class:"text-xs text-r58-text-secondary mt-1"},"VDO.ninja room for video mixing",-1))]),e("div",null,[n[9]||(n[9]=e("label",{class:"block text-sm font-medium mb-2"},"VDO Host",-1)),e("input",{value:f.value,type:"text",class:"input w-full bg-r58-bg-tertiary",readonly:"",disabled:""},null,8,Is),n[10]||(n[10]=e("p",{class:"text-xs text-r58-text-secondary mt-1"},"VDO.ninja server (read-only)",-1))])])]),e("div",Hs,[n[16]||(n[16]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"Storage",-1)),e("div",Bs,[e("div",null,[n[12]||(n[12]=e("label",{class:"block text-sm font-medium mb-2"},"Recording Path",-1)),e("input",{value:_.value,type:"text",class:"input w-full bg-r58-bg-tertiary",readonly:"",disabled:""},null,8,zs),n[13]||(n[13]=e("p",{class:"text-xs text-r58-text-secondary mt-1"},"Location where recordings are saved on device",-1))]),e("div",Gs,[n[14]||(n[14]=e("div",null,[e("label",{class:"block text-sm font-medium"},"Auto-cleanup old recordings"),e("p",{class:"text-xs text-r58-text-secondary"},"Automatically delete recordings older than specified days")],-1)),e("button",{onClick:n[2]||(n[2]=h=>b.value=!b.value),class:A(["relative inline-flex h-6 w-11 items-center rounded-full transition-colors",b.value?"bg-r58-accent-primary":"bg-r58-bg-tertiary"])},[e("span",{class:A(["inline-block h-4 w-4 transform rounded-full bg-white transition-transform",b.value?"translate-x-6":"translate-x-1"])},null,2)],2)]),b.value?(s(),a("div",Ks,[n[15]||(n[15]=e("label",{class:"block text-sm font-medium mb-2"},"Keep recordings for (days)",-1)),I(e("input",{"onUpdate:modelValue":n[3]||(n[3]=h=>m.value=h),type:"number",min:"1",max:"365",class:"input w-24"},null,512),[[J,m.value,void 0,{number:!0}]])])):T("",!0)])]),e("div",{class:"flex items-center justify-between"},[e("button",{onClick:S,class:"btn btn-secondary"}," Reset to Defaults "),e("button",{onClick:C,class:"btn btn-primary"}," Save Settings ")]),e("div",Js,[n[19]||(n[19]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-4"},"About",-1)),e("div",Ws,[n[18]||(n[18]=e("div",{class:"flex justify-between"},[e("span",{class:"text-r58-text-secondary"},"App Version"),e("span",null,"2.0.0")],-1)),e("div",qs,[n[17]||(n[17]=e("span",{class:"text-r58-text-secondary"},"Platform",-1)),e("span",null,v(i.value?"Desktop (Electron)":"Web Browser"),1)])])])]))}}),Xs={class:"h-full flex flex-col"},Ys={class:"px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},Zs={class:"flex gap-2"},ea=["onClick"],ta={class:"flex-1 p-6 overflow-y-auto"},sa={key:2,class:"card"},aa={key:3,class:"card"},ra=H({__name:"AdminView",setup(R){const p=me(),o=$("system"),u=[{id:"system",label:"System"},{id:"status",label:"Device Status"},{id:"logs",label:"Logs"},{id:"fleet",label:"Fleet"},{id:"settings",label:"Settings"}];return B(()=>{const f=p.query.tab;f&&u.some(_=>_.id===f)&&(o.value=f)}),(f,_)=>(s(),a("div",Xs,[e("header",Ys,[_[0]||(_[0]=e("h1",{class:"text-xl font-semibold mb-4"},"Admin",-1)),e("div",Zs,[(s(),a(E,null,U(u,b=>e("button",{key:b.id,onClick:m=>o.value=b.id,class:A(["px-4 py-2 rounded-t-lg transition-colors",[o.value===b.id?"bg-r58-bg-primary text-r58-text-primary":"text-r58-text-secondary hover:text-r58-text-primary"]])},v(b.label),11,ea)),64))])]),e("div",ta,[o.value==="system"?(s(),W(Es,{key:0})):o.value==="status"?(s(),W(_t,{key:1})):o.value==="logs"?(s(),a("div",sa,[_[1]||(_[1]=e("h2",{class:"text-lg font-semibold mb-4"},"System Logs",-1)),ae(jt)])):o.value==="fleet"?(s(),a("div",aa,[ae(Ht)])):o.value==="settings"?(s(),W(Qs,{key:4})):T("",!0)])]))}});export{ra as default};
