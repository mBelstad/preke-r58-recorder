import{J as Ee,r as S,e as j,f as oe,g as ie,d as Y,K as ne,z as se,c as a,n as P,k as T,a as e,H as B,t as w,l as te,o as r,_ as he,y as de,F as z,m as J,w as re,q as ae,L as ve,s as Me,G as U,C as ke,D as we,M as pe,E as Oe,h as X}from"./index-CUcT0yOH.js";import{g as Te,b as Le,a as fe,c as je,d as Ie}from"./vdoninja-D8mLQF_b.js";const ee=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],ue=Ee("streaming",()=>{const m=S([]),g=S(!1),s=S(null),c=S({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),l=j(()=>m.value.find(o=>o.id===s.value)),u=j(()=>m.value.filter(o=>o.enabled)),x=j(()=>ee),b=j(()=>{const o=window.location.hostname,C=o==="localhost"||o==="127.0.0.1"?"localhost":o.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${C}:1935/mixer_program`,rtsp:`rtsp://${C}:8554/mixer_program`,srt:`srt://${C}:8890?streamid=read:mixer_program`,hls:`https://${o}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function i(o,n){const C=ee.find(_=>_.id===o);if(!C)throw new Error(`Unknown platform: ${o}`);const K={id:`dest-${Date.now()}`,platformId:o,name:n||C.name,streamKey:"",enabled:!1};return m.value.push(K),K}function D(o,n){const C=m.value.findIndex(K=>K.id===o);C!==-1&&(m.value[C]={...m.value[C],...n})}function M(o){const n=m.value.findIndex(C=>C.id===o);n!==-1&&m.value.splice(n,1),s.value===o&&(s.value=null)}function y(o){s.value=o}function p(o){c.value.enabled=o}function f(o){c.value={...c.value,...o}}function E(){g.value=!0}function R(){g.value=!1}function h(o){const n=ee.find(C=>C.id===o.platformId);return n?o.platformId==="custom"?`${o.name}${o.streamKey}`:`${n.rtmpBaseUrl}${o.streamKey}`:""}function k(){const o=window.location.hostname;return`srt://${o==="localhost"||o==="127.0.0.1"?"localhost":o.replace("r58-api","r58-mediamtx")}:${c.value.port}?streamid=read:${c.value.streamId}`}function v(){try{const o=localStorage.getItem("r58-streaming-destinations");if(o){const n=JSON.parse(o);m.value=n.destinations||[],n.srtOutput&&(c.value={...c.value,...n.srtOutput})}}catch(o){console.warn("Failed to load saved streaming destinations:",o)}}function t(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:m.value,srtOutput:c.value}))}catch(o){console.warn("Failed to save streaming destinations:",o)}}return v(),{destinations:m,isStreaming:g,activeDestinationId:s,srtOutput:c,activeDestination:l,enabledDestinations:u,platforms:x,programOutputUrls:b,addDestination:i,updateDestination:D,removeDestination:M,setActiveDestination:y,toggleSrtOutput:p,updateSrtConfig:f,startStreaming:E,stopStreaming:R,buildRtmpUrl:h,getSrtOutputUrl:k,saveDestinations:t,loadSavedDestinations:v}}),ce="vdo-debug",Ue=500,F=[];let me=typeof localStorage<"u"&&localStorage.getItem(ce)==="true";function xe(m){me=m,typeof localStorage<"u"&&(m?localStorage.setItem(ce,"true"):localStorage.removeItem(ce)),console.log(`[VDO.ninja Debug] ${m?"Enabled":"Disabled"}`)}function le(m){if(F.push(m),F.length>Ue&&F.shift(),me){const g=new Date(m.timestamp).toISOString().split("T")[1].slice(0,-1),s=m.direction==="outgoing"?"âž¡ï¸ OUT":"â¬…ï¸ IN",c=m.direction==="outgoing"?"color: #3b82f6; font-weight: bold":"color: #22c55e; font-weight: bold";console.groupCollapsed(`%c[VDO.ninja ${s}] %c${m.type}`,c,"color: inherit"),console.log("Time:",g),m.target&&console.log("Target:",m.target),console.log("Data:",m.data),m.raw&&m.raw!==m.data&&console.log("Raw:",m.raw),console.groupEnd()}}function _e(){return[...F]}function Pe(){F.length=0,console.log("[VDO.ninja Debug] Event history cleared")}function Se(){const m={total:F.length,incoming:0,outgoing:0,byType:{},lastActivity:F.length>0?F[F.length-1].timestamp:null};for(const g of F)g.direction==="incoming"?m.incoming++:m.outgoing++,m.byType[g.type]=(m.byType[g.type]||0)+1;return m}typeof window<"u"&&(window.__VDO_DEBUG__={getHistory:_e,clearHistory:Pe,getStats:Se,enable:()=>xe(!0),disable:()=>xe(!1),isEnabled:()=>me});function He(m){const g=S(!1),s=S(new Map),c=S(null),l=S(!1),u=S("disconnected"),x=S(null),b=Te();function i(d,$,O,W){var I;if(!((I=m.value)!=null&&I.contentWindow)){console.warn("[VDO.ninja] Cannot send command - iframe not ready"),x.value="iframe not ready";return}const H={action:d};$&&(H.target=$),O!==void 0&&(H.value=O),W!==void 0&&(H.value2=W),le({timestamp:Date.now(),direction:"outgoing",type:d,target:$,data:{action:d,target:$,value:O,value2:W},raw:H});try{m.value.contentWindow.postMessage(H,"*")}catch(A){console.error("[VDO.ninja] Failed to send command:",A),x.value=String(A)}}function D(d,$){var W;if(!((W=m.value)!=null&&W.contentWindow)){console.warn("[VDO.ninja] Cannot send DOM command - iframe not ready");return}const O={action:"",target:d,...$};le({timestamp:Date.now(),direction:"outgoing",type:"dom-manipulation",target:d,data:$,raw:O});try{m.value.contentWindow.postMessage(O,"*")}catch(H){console.error("[VDO.ninja] Failed to send DOM command:",H)}}function M(d,$=1){i("addScene",d,$),c.value=$}function y(d,$=1){i("addScene",d,0)}function p(d){D(d,{replace:!0})}function f(d){D(d,{add:!0})}function E(d){D(d,{remove:!0})}function R(d,$){i("mic",d,!$);const O=s.value.get(d);O&&(O.muted=$)}function h(d){i("mic",d,"toggle");const $=s.value.get(d);$&&($.muted=!$.muted)}function k(d,$){i("volume",d,Math.max(0,Math.min(200,$)))}function v(d){i("soloChat",d)}function t(d){i("soloChatBidirectional",d)}function o(d,$){i("sendChat",d,$)}function n(d,$){i("sendDirectorChat",d,$)}function C(d){i("hangup",d),s.value.delete(d)}function K(d){d?i("togglescreenshare",d):i("togglescreenshare")}function _(d,$){i("forward",d,$)}function L(d="guests"){i("getGuestList",void 0,void 0)}function V(){i("record",void 0,!0),l.value=!0}function Q(){i("record",void 0,!1),l.value=!1}function N(d){i("layout",void 0,d)}function Z(d){d?i("reload",d):i("reload")}function G(d,$){i("mixorder",d,$==="up"?-1:1)}function q(d){i("camera",void 0,d)}function $e(d,$){i("camera",d,$)}function Ce(d,$=!1){$?i("zoom",void 0,d,"abs"):i("zoom",void 0,d)}function Re(d){i("pan",void 0,d)}function De(d){i("tilt",void 0,d)}function ge(d){const $=d.origin;if(!$.includes(b.split(":")[0])&&!$.includes("vdo.ninja")&&!$.includes("vdo.itagenten")&&!$.includes("localhost"))return;const O=d.data;if(!O||typeof O!="object")return;const W=O.type||O.action||"unknown",H=O.streamID||O.UUID||O.streamId;switch(le({timestamp:Date.now(),direction:"incoming",type:W,target:H,data:O.data||O.value,raw:O}),W){case"director-ready":case"loaded":case"ready":case"started":g.value=!0,u.value="connected",x.value=null;break;case"new-guest":case"guest-connected":case"push":case"view":case"joined":{if(H){const I=O.data,A={id:H,label:(I==null?void 0:I.label)||O.label||H,type:(I==null?void 0:I.type)||"guest",hasVideo:(I==null?void 0:I.video)!==!1,hasAudio:(I==null?void 0:I.audio)!==!1,muted:!1,audioLevel:0};s.value.set(H,A)}break}case"guest-left":case"guest-disconnected":case"left":case"disconnect":H&&s.value.delete(H);break;case"audio-level":case"loudness":{if(H){const I=s.value.get(H);if(I){const A=O.data;I.audioLevel=(A==null?void 0:A.level)||O.value||0}}break}case"mute-state":case"muted":{if(H){const I=s.value.get(H);if(I){const A=O.data;I.muted=(A==null?void 0:A.muted)??O.value??!1}}break}case"scene-changed":case"scene":{const I=O.data,A=(I==null?void 0:I.scene)||O.value;c.value=typeof A=="number"?A:null;break}case"recording-started":l.value=!0;break;case"recording-stopped":l.value=!1;break;case"error":console.error("[VDO.ninja Error]",O.data),x.value=String(O.data);break}}return oe(()=>{u.value="connecting",window.addEventListener("message",ge),setTimeout(()=>{!g.value&&m.value&&(g.value=!0,u.value="connected")},5e3)}),ie(()=>{window.removeEventListener("message",ge),u.value="disconnected"}),{isReady:g,sources:s,activeScene:c,isRecording:l,connectionState:u,lastError:x,addToScene:M,removeFromScene:y,setProgram:p,addSource:f,removeSource:E,setLayout:N,changeMixOrder:G,setMute:R,toggleMute:h,setVolume:k,soloAudio:v,soloChatBidirectional:t,sendToGuest:o,sendDirectorMessage:n,kickGuest:C,toggleScreenShare:K,transferGuest:_,getGuestList:L,refreshSource:Z,setCamera:q,setGuestCamera:$e,zoom:Ce,pan:Re,tilt:De,startRecording:V,stopRecording:Q,sendCommand:i,sendDomCommand:D,getEventHistory:_e,getEventStats:Se}}const Ve={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10","data-testid":"vdo-loading"},Be={class:"text-center"},Ae={class:"text-xs text-r58-text-secondary mt-2"},Ne={key:1,class:"absolute bottom-4 left-4 right-4 bg-red-500/90 text-white px-4 py-2 rounded-lg text-sm z-20"},ze=["src","title"],Ke=Y({__name:"VdoNinjaEmbed",props:{profile:{},sources:{},room:{},password:{}},setup(m,{expose:g}){const s=m,c=S(null),l=ne(),u=He(c),{isReady:x,sources:b,addToScene:i,removeFromScene:D,setMute:M,toggleMute:y,setVolume:p,sendCommand:f,sendDomCommand:E,isRecording:R,connectionState:h,lastError:k,startRecording:v,stopRecording:t,kickGuest:o,toggleScreenShare:n,setLayout:C,setProgram:K,addSource:_,removeSource:L,getEventHistory:V,getEventStats:Q}=u,N=j(()=>{const G={};return s.sources&&(G.source_ids=s.sources.join(",")),s.room&&(G.room=s.room),s.password&&(G.password=s.password),Le(s.profile,G)}),Z=j(()=>s.profile==="mixer");return se(b,G=>{l.updateSourcesFromVdo(Array.from(G.values()))},{deep:!0}),g({isReady:x,isRecording:R,connectionState:h,lastError:k,addToScene:i,removeFromScene:D,setLayout:C,setProgram:K,addSource:_,removeSource:L,setMute:M,toggleMute:y,setVolume:p,startRecording:v,stopRecording:t,kickGuest:o,toggleScreenShare:n,sendCommand:f,sendDomCommand:E,getEventHistory:V,getEventStats:Q}),(G,q)=>(r(),a("div",{class:P(["vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden",{"mixer-mode":Z.value}]),"data-testid":"vdo-embed-container"},[B(x)?T("",!0):(r(),a("div",Ve,[e("div",Be,[q[0]||(q[0]=e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"},null,-1)),q[1]||(q[1]=e("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja...",-1)),e("p",Ae,w(Z.value?"Loading mixer controls...":"Local mixer on R58"),1)])])),B(k)?(r(),a("div",Ne,[q[2]||(q[2]=e("strong",null,"Error:",-1)),te(" "+w(B(k)),1)])):T("",!0),e("iframe",{ref_key:"iframeRef",ref:c,src:N.value,class:P(["w-full h-full border-0",{"opacity-0":!B(x)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:"","data-testid":"vdo-iframe",title:Z.value?"VDO.ninja Mixer":"VDO.ninja"},null,10,ze)],2))}}),Fe=he(Ke,[["__scopeId","data-v-4a9e915e"]]),Ge={class:"space-y-4","data-testid":"source-panel"},We={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide","data-testid":"sources-heading"},Je={key:0,class:"ml-2 text-r58-accent-primary"},Ye={key:0,class:"px-3 py-2 bg-amber-500/10 border border-amber-500/30 rounded-lg text-xs text-amber-400"},qe={key:1,class:"text-center py-6 text-r58-text-secondary"},Xe={key:2,class:"space-y-2"},Qe={class:"flex items-center gap-3 min-w-0"},Ze={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},et={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},tt={key:2,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ot={key:3,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},nt={class:"min-w-0"},st={key:0,class:"flex items-center gap-1"},rt=["onDblclick"],at={class:"text-xs text-r58-text-secondary"},it={class:"flex items-center gap-2 flex-shrink-0"},lt={key:0,class:"w-12 h-1.5 bg-r58-bg-primary rounded-full overflow-hidden"},ct=["onClick","data-testid","title"],dt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ut={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},be="preke-source-names",mt=Y({__name:"SourcePanel",props:{vdoEmbed:{}},setup(m){function g(){try{const t=localStorage.getItem(be);return t?JSON.parse(t):{}}catch{return{}}}function s(t,o){const n=g();n[t]=o,localStorage.setItem(be,JSON.stringify(n))}const c=S(g()),l=S(null),u=S(""),x=m,b=ne(),i=de(),D=j(()=>b.sources.map(t=>{let o=t.label,n="VDO.ninja";const C=t.id.match(/cam(\d+)/i)||t.id.match(/hdmi[_-]?(\d+)/i);return C?(o=`HDMI ${parseInt(C[1])+1}`,n="Connected to device"):t.type==="guest"?(n="Remote guest",(!t.label||t.label.length>20||t.label.match(/^[a-z0-9]{8,}$/i))&&(o="Guest")):t.type==="screen"&&(n="Screen share"),{...t,label:o,subtitle:n}})),M={cam0:{name:"HDMI 1",subtitle:"Connected to device"},cam1:{name:"HDMI 2",subtitle:"Connected to device"},cam2:{name:"HDMI 3",subtitle:"Connected to device"},cam3:{name:"HDMI 4",subtitle:"Connected to device"}},y=j(()=>i.inputs.filter(t=>t.hasSignal).map(t=>{const o=M[t.id]||{name:t.label,subtitle:"HDMI Input"};return{id:t.id,label:o.name,subtitle:o.subtitle,type:"camera",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0}})),p=j(()=>D.value.length>0?D.value:y.value),f=j(()=>D.value.length===0&&y.value.length>0);function E(t){x.vdoEmbed&&x.vdoEmbed.toggleMute(t.id),b.setSourceMute(t.id,!t.muted)}function R(t){return c.value[t.id]||t.label}function h(t){l.value=t.id,u.value=c.value[t.id]||t.label}function k(){l.value&&u.value.trim()&&(s(l.value,u.value.trim()),c.value=g()),l.value=null}function v(){l.value=null,u.value=""}return(t,o)=>(r(),a("div",Ge,[e("h3",We,[o[1]||(o[1]=te(" Sources ",-1)),p.value.length>0?(r(),a("span",Je,"("+w(p.value.length)+")",1)):T("",!0)]),f.value?(r(),a("div",Ye," Showing HDMI cameras. VDO.ninja sources will appear when guests join. ")):T("",!0),p.value.length===0?(r(),a("div",qe,[...o[2]||(o[2]=[e("svg",{class:"w-8 h-8 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"text-sm"},"No sources connected",-1),e("p",{class:"text-xs mt-1 opacity-75"},"Connect HDMI sources or have guests join",-1)])])):(r(),a("div",Xe,[(r(!0),a(z,null,J(p.value,n=>(r(),a("div",{key:n.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary hover:bg-r58-bg-tertiary/80 transition-colors"},[e("div",Qe,[e("div",{class:P(["w-8 h-8 rounded bg-r58-bg-primary flex items-center justify-center flex-shrink-0",{"ring-2 ring-r58-accent-primary":B(b).programSource===n.id}])},[n.type==="camera"?(r(),a("svg",Ze,[...o[3]||(o[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):n.type==="guest"?(r(),a("svg",et,[...o[4]||(o[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):n.type==="screen"?(r(),a("svg",tt,[...o[5]||(o[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])])):(r(),a("svg",ot,[...o[6]||(o[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"},null,-1)])]))],2),e("div",nt,[l.value===n.id?(r(),a("div",st,[re(e("input",{"onUpdate:modelValue":o[0]||(o[0]=C=>u.value=C),onKeyup:[ve(k,["enter"]),ve(v,["escape"])],onBlur:k,class:"input text-sm py-0.5 px-1 w-24",autofocus:""},null,544),[[ae,u.value]])])):(r(),a("p",{key:1,onDblclick:C=>h(n),class:"font-medium text-sm truncate cursor-pointer hover:text-r58-accent-primary",title:"Double-click to rename"},w(R(n)),41,rt)),e("p",at,w(n.subtitle||n.type),1)])]),e("div",it,[n.hasAudio?(r(),a("div",lt,[e("div",{class:P(["h-full rounded-full transition-all duration-100",n.muted?"bg-r58-accent-danger":"bg-r58-accent-success"]),style:Me({width:`${n.audioLevel||0}%`})},null,6)])):T("",!0),n.hasAudio?(r(),a("button",{key:1,onClick:C=>E(n),class:P(["p-1.5 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":n.muted}]),"data-testid":`mute-button-${n.id}`,title:n.muted?"Unmute "+n.label:"Mute "+n.label},[n.muted?(r(),a("svg",dt,[...o[7]||(o[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(r(),a("svg",ut,[...o[8]||(o[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,ct)):T("",!0)])]))),128))])),o[9]||(o[9]=e("p",{class:"text-xs text-r58-text-secondary text-center pt-2"}," Full guest/source management available in the mixer above ",-1))]))}}),gt={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"camera-push-bar"},vt={class:"flex items-center gap-2"},pt={class:"text-r58-text-secondary"},ft={key:0,class:"px-4 pb-3"},xt={key:0,class:"flex gap-3 flex-wrap"},bt={class:"text-sm font-medium"},yt={class:"text-xs text-r58-text-secondary"},ht=["onClick"],kt={key:1,class:"text-sm text-r58-text-secondary py-2"},wt={class:"hidden"},_t=["src","onLoad","onError"],St=Y({__name:"CameraPushBar",setup(m){const g=de(),s=S(new Map),c=S(!0),l=j(()=>g.inputs.filter(y=>y.hasSignal));function u(y){return je(y)}se(l,y=>{for(const f of y)if(!s.value.has(f.id)){const E=u(f.id),R=fe(f.id,E,f.label);s.value.set(f.id,{cameraId:f.id,label:f.label,status:"connecting",iframeSrc:R})}const p=new Set(y.map(f=>f.id));for(const[f]of s.value)p.has(f)||s.value.delete(f)},{immediate:!0});function x(y){const p=s.value.get(y);p&&(p.status="connected",console.log(`[CameraPush] ${y} connected to VDO.ninja`))}function b(y){const p=s.value.get(y);p&&(p.status="error",console.error(`[CameraPush] ${y} failed to connect`))}function i(y){const p=g.inputs.find(R=>R.id===y);if(!p||!p.hasSignal)return;const f=u(y),E=fe(y,f,p.label);s.value.set(y,{cameraId:y,label:p.label,status:"connecting",iframeSrc:E+`&_t=${Date.now()}`})}function D(y){switch(y){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function M(y){switch(y){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(y,p)=>(r(),a("div",gt,[e("button",{onClick:p[0]||(p[0]=f=>c.value=!c.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[e("div",vt,[p[1]||(p[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",pt,"("+w(l.value.length)+" active)",1)]),(r(),a("svg",{class:P(["w-4 h-4 transition-transform",{"rotate-180":c.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...p[2]||(p[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),c.value?(r(),a("div",ft,[s.value.size>0?(r(),a("div",xt,[(r(!0),a(z,null,J(s.value,([f,E])=>(r(),a("div",{key:f,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[e("span",{class:P(["w-2 h-2 rounded-full",D(E.status)])},null,2),e("span",bt,w(E.label),1),e("span",yt,w(M(E.status)),1),E.status==="error"?(r(),a("button",{key:0,onClick:R=>i(f),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,ht)):T("",!0)]))),128))])):(r(),a("div",kt," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):T("",!0),e("div",wt,[(r(!0),a(z,null,J(s.value,([f,E])=>(r(),a("iframe",{key:f,src:E.iframeSrc,onLoad:R=>x(f),onError:R=>b(f),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,_t))),128))])]))}}),$t={class:"program-output space-y-3","data-testid":"program-output"},Ct={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg","data-testid":"program-output-status"},Rt={class:"text-sm font-medium","data-testid":"program-output-text"},Dt={key:0,class:"space-y-2"},Et={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},Mt={class:"flex-1 text-xs truncate text-r58-text-secondary"},Ot={key:0,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},Tt={class:"text-xs text-r58-text-secondary"},Lt={key:1,class:"text-xs text-r58-text-secondary px-3"},jt={class:"hidden"},It=["src"],Ut=Y({__name:"ProgramOutput",setup(m){const g=ne(),s=ue(),c=S(!1),l=S("idle"),u=S("");function x(){return`${window.location.origin}/api/v1/whip/program/whip`}function b(){c.value||(l.value="connecting",u.value=Ie(x()),c.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function i(){c.value&&(c.value=!1,u.value="",l.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function D(){c.value&&(l.value="live",console.log("[ProgramOutput] WHIP push connected"))}function M(){l.value="error",console.error("[ProgramOutput] WHIP push failed")}function y(){i(),setTimeout(()=>b(),500)}se(()=>g.isLive,R=>{R?b():i()});function p(){switch(l.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function f(){switch(l.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function E(){const R=s.programOutputUrls.srt;navigator.clipboard.writeText(R),U.success("SRT URL copied")}return(R,h)=>(r(),a("div",$t,[e("div",Ct,[e("span",{class:P(["w-2 h-2 rounded-full",p()]),"data-testid":"program-output-indicator"},null,2),e("span",Rt,w(f()),1),l.value==="error"?(r(),a("button",{key:0,onClick:h[0]||(h[0]=k=>y()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"}," Retry ")):T("",!0)]),l.value==="live"?(r(),a("div",Dt,[e("div",Et,[h[1]||(h[1]=e("span",{class:"text-xs text-r58-text-secondary"},"ðŸ”´ SRT:",-1)),e("code",Mt,w(B(s).programOutputUrls.srt),1),e("button",{onClick:E,class:"text-xs text-r58-accent-primary hover:underline"},"Copy")]),B(s).enabledDestinations.length>0?(r(),a("div",Ot,[h[2]||(h[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",Tt,w(B(s).enabledDestinations.length)+" streaming destination"+w(B(s).enabledDestinations.length>1?"s":"")+" active ",1)])):T("",!0)])):T("",!0),l.value==="idle"?(r(),a("p",Lt," Program output will start automatically when you go live. ")):T("",!0),e("div",jt,[c.value&&u.value?(r(),a("iframe",{key:0,src:u.value,onLoad:D,onError:M,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,It)):T("",!0)])]))}}),Pt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Ht={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},Vt={class:"p-6 overflow-y-auto max-h-[60vh]"},Bt={class:"mb-8"},At={class:"flex items-center justify-between mb-4"},Nt={key:0,class:"mb-4 p-4 bg-r58-bg-tertiary rounded-lg"},zt={class:"grid grid-cols-2 gap-2"},Kt=["onClick"],Ft={class:"text-xl"},Gt={key:1,class:"space-y-3"},Wt=["onClick"],Jt={class:"text-xl"},Yt={class:"flex-1"},qt={class:"font-medium"},Xt={class:"text-xs text-r58-text-secondary"},Qt=["onClick"],Zt=["onClick"],eo={key:2,class:"text-r58-text-secondary text-sm"},to={key:0,class:"mb-8 p-4 bg-r58-bg-tertiary rounded-lg"},oo={class:"text-lg font-medium mb-4"},no={class:"space-y-4"},so=["placeholder"],ro={key:0},ao={class:"flex gap-2"},io={class:"mb-8"},lo={class:"space-y-3"},co={class:"p-3 bg-r58-bg-tertiary rounded-lg"},uo={class:"flex items-center justify-between mb-1"},mo={class:"text-xs text-r58-text-secondary break-all"},go={class:"p-3 bg-r58-bg-tertiary rounded-lg"},vo={class:"flex items-center justify-between mb-1"},po={class:"text-xs text-r58-text-secondary break-all"},fo={class:"p-3 bg-r58-bg-tertiary rounded-lg"},xo={class:"flex items-center justify-between mb-1"},bo={class:"text-xs text-r58-text-secondary break-all"},yo={class:"p-3 bg-r58-bg-tertiary rounded-lg"},ho={class:"flex items-center justify-between mb-1"},ko={class:"text-xs text-r58-text-secondary break-all"},wo={class:"p-3 bg-r58-bg-tertiary rounded-lg"},_o={class:"flex items-center justify-between mb-1"},So={class:"text-xs text-r58-text-secondary break-all"},$o={class:"p-4 bg-r58-bg-tertiary rounded-lg"},Co={class:"flex items-center gap-3 mb-4"},Ro=Y({__name:"StreamingSettings",setup(m,{expose:g}){const s=ue(),c=S(!1),l=S(null),u=S(!1);S(""),S("");const x=j(()=>s.destinations),b=j(()=>ee),i=j(()=>s.programOutputUrls);function D(){c.value=!0}function M(){c.value=!1,l.value=null,u.value=!1}function y(v){const t=s.addDestination(v);l.value=t,u.value=!1,s.saveDestinations()}function p(){l.value&&(s.updateDestination(l.value.id,l.value),s.saveDestinations(),l.value=null,U.success("Streaming destination saved"))}function f(v){s.removeDestination(v),s.saveDestinations(),U.info("Destination removed")}function E(v){s.updateDestination(v.id,{enabled:!v.enabled}),s.saveDestinations()}function R(v,t){navigator.clipboard.writeText(v),U.success(`${t} copied to clipboard`)}function h(v){const t=ee.find(o=>o.id===v);return(t==null?void 0:t.icon)||"ðŸ“¡"}function k(v){const t=ee.find(o=>o.id===v);return(t==null?void 0:t.name)||"Unknown"}return g({open:D}),(v,t)=>{var o;return r(),ke(we,{to:"body"},[c.value?(r(),a("div",Pt,[e("div",{class:"absolute inset-0 bg-black/60",onClick:M}),e("div",Ht,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:M,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," Ã— ")]),e("div",Vt,[e("section",Bt,[e("div",At,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[0]||(t[0]=n=>u.value=!u.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),u.value?(r(),a("div",Nt,[t[13]||(t[13]=e("p",{class:"text-sm text-r58-text-secondary mb-3"},"Select a streaming platform:",-1)),e("div",zt,[(r(!0),a(z,null,J(b.value,n=>(r(),a("button",{key:n.id,onClick:C=>y(n.id),class:"flex items-center gap-2 p-3 bg-r58-bg-secondary hover:bg-r58-accent-primary/20 rounded-lg transition-colors text-left"},[e("span",Ft,w(n.icon),1),e("span",null,w(n.name),1)],8,Kt))),128))])])):T("",!0),x.value.length>0?(r(),a("div",Gt,[(r(!0),a(z,null,J(x.value,n=>(r(),a("div",{key:n.id,class:"flex items-center gap-3 p-3 bg-r58-bg-tertiary rounded-lg"},[e("button",{onClick:C=>E(n),class:P(["w-10 h-6 rounded-full transition-colors relative",n.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:P(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",n.enabled?"left-5":"left-1"])},null,2)],10,Wt),e("span",Jt,w(h(n.platformId)),1),e("div",Yt,[e("div",qt,w(n.name),1),e("div",Xt,w(n.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+n.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:C=>l.value={...n},class:"text-r58-accent-primary hover:underline text-sm"}," Edit ",8,Qt),e("button",{onClick:C=>f(n.id),class:"text-r58-accent-danger hover:underline text-sm"}," Remove ",8,Zt)]))),128))])):(r(),a("p",eo," No streaming destinations configured. Add a platform above. "))]),l.value?(r(),a("section",to,[e("h3",oo," Edit "+w(k(l.value.platformId)),1),e("div",no,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Display Name",-1)),re(e("input",{"onUpdate:modelValue":t[1]||(t[1]=n=>l.value.name=n),type:"text",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none"},null,512),[[ae,l.value.name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Stream Key",-1)),re(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>l.value.streamKey=n),type:"password",placeholder:(o=B(ee).find(n=>n.id===l.value.platformId))==null?void 0:o.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,8,so),[[ae,l.value.streamKey]]),t[16]||(t[16]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),l.value.platformId==="custom"?(r(),a("div",ro,[t[17]||(t[17]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"RTMP URL",-1)),re(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>l.value.name=n),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,512),[[ae,l.value.name]])])):T("",!0),e("div",ao,[e("button",{onClick:p,class:"btn btn-primary"}," Save "),e("button",{onClick:t[4]||(t[4]=n=>l.value=null),class:"btn"}," Cancel ")])])])):T("",!0),e("section",io,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[27]||(t[27]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",lo,[e("div",co,[e("div",uo,[t[18]||(t[18]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[5]||(t[5]=n=>R(i.value.srt,"SRT URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",mo,w(i.value.srt),1),t[19]||(t[19]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",go,[e("div",vo,[t[20]||(t[20]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[6]||(t[6]=n=>R(i.value.rtmp,"RTMP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",po,w(i.value.rtmp),1)]),e("div",fo,[e("div",xo,[t[21]||(t[21]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[7]||(t[7]=n=>R(i.value.rtsp,"RTSP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",bo,w(i.value.rtsp),1)]),e("div",yo,[e("div",ho,[t[22]||(t[22]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[8]||(t[8]=n=>R(i.value.hls,"HLS URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",ko,w(i.value.hls),1),t[23]||(t[23]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",wo,[e("div",_o,[t[24]||(t[24]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[9]||(t[9]=n=>R(i.value.whep,"WHEP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",So,w(i.value.whep),1),t[25]||(t[25]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[30]||(t[30]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",$o,[e("div",Co,[e("button",{onClick:t[10]||(t[10]=n=>B(s).toggleSrtOutput(!B(s).srtOutput.enabled)),class:P(["w-10 h-6 rounded-full transition-colors relative",B(s).srtOutput.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:P(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",B(s).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[28]||(t[28]=e("span",null,"Enable SRT Output",-1))]),t[29]||(t[29]=e("div",{class:"text-sm text-r58-text-secondary"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-r58-bg-tertiary"},[e("button",{onClick:M,class:"btn"},"Close")])])])):T("",!0)])}}}),Do={class:"recording-controls space-y-3","data-testid":"recording-controls"},Eo={class:"flex items-center gap-3 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},Mo={class:"text-sm font-medium flex-1","data-testid":"recording-status"},Oo={key:0,class:"text-lg font-mono font-bold text-r58-accent-danger","data-testid":"recording-duration"},To=["disabled"],Lo={key:0,class:"px-3 py-2 bg-r58-accent-success/10 border border-r58-accent-success/30 rounded-lg"},jo={class:"flex items-center justify-between"},Io=["href"],Uo=Y({__name:"RecordingControls",props:{vdoEmbed:{}},setup(m){const g=m,s=S(!1),c=S(null),l=S(0),u=S(null),x=S(!1);se(()=>{var h,k;return(k=(h=g.vdoEmbed)==null?void 0:h.isRecording)==null?void 0:k.value},h=>{h!==void 0&&(s.value=h,h&&!c.value?c.value=Date.now():!h&&c.value&&(c.value=null))});let b=null;function i(){b&&clearInterval(b),b=window.setInterval(()=>{c.value&&(l.value=Date.now()-c.value)},100)}function D(){b&&(clearInterval(b),b=null)}oe(()=>{i()}),ie(()=>{D()});const M=j(()=>{const h=Math.floor(l.value/1e3),k=Math.floor(h/3600),v=Math.floor(h%3600/60),t=h%60;return k>0?`${k}:${v.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`:`${v}:${t.toString().padStart(2,"0")}`});async function y(){if(!g.vdoEmbed){U.error("VDO.ninja not connected");return}x.value=!0;try{g.vdoEmbed.startRecording(),s.value=!0,c.value=Date.now(),l.value=0,u.value=null,U.success("Recording started")}catch(h){U.error("Failed to start recording"),console.error("[RecordingControls] Start recording error:",h)}finally{x.value=!1}}async function p(){if(!g.vdoEmbed){U.error("VDO.ninja not connected");return}x.value=!0;try{g.vdoEmbed.stopRecording(),s.value=!1,c.value=null,U.success(`Recording stopped (${M.value})`)}catch(h){U.error("Failed to stop recording"),console.error("[RecordingControls] Stop recording error:",h)}finally{x.value=!1}}function f(){s.value?p():y()}function E(){return s.value?"bg-r58-accent-danger animate-pulse":"bg-r58-bg-tertiary"}function R(){return x.value?"Processing...":s.value?`Recording â€¢ ${M.value}`:"Ready to record"}return(h,k)=>(r(),a("div",Do,[e("div",Eo,[e("span",{class:P(["w-3 h-3 rounded-full",E()]),"data-testid":"recording-indicator"},null,2),e("span",Mo,w(R()),1),s.value?(r(),a("span",Oo,w(M.value),1)):T("",!0)]),e("div",null,[e("button",{onClick:f,disabled:x.value,class:P(["btn w-full justify-center",s.value?"btn-danger":"btn-primary"]),"data-testid":"recording-toggle-button"},[x.value?(r(),a(z,{key:0},[k[0]||(k[0]=e("svg",{class:"animate-spin w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)),k[1]||(k[1]=te(" Processing... ",-1))],64)):s.value?(r(),a(z,{key:1},[k[2]||(k[2]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})],-1)),k[3]||(k[3]=te(" Stop Recording ",-1))],64)):(r(),a(z,{key:2},[k[4]||(k[4]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"8"})],-1)),k[5]||(k[5]=te(" Start Recording ",-1))],64))],10,To)]),u.value?(r(),a("div",Lo,[e("div",jo,[k[6]||(k[6]=e("span",{class:"text-sm text-r58-accent-success"},"Recording ready!",-1)),e("a",{href:u.value,download:"",class:"text-sm text-r58-accent-primary hover:underline"}," Download ",8,Io)])])):T("",!0),k[7]||(k[7]=e("p",{class:"text-xs text-r58-text-secondary px-1"}," Records the mixed output locally in your browser. Recording is saved when stopped. ",-1))]))}}),Po=he(Uo,[["__scopeId","data-v-14707e66"]]),Ho={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Vo={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-3xl max-h-[80vh] overflow-hidden shadow-2xl","data-testid":"hotkey-settings-modal"},Bo={class:"flex border-b border-r58-bg-tertiary"},Ao=["onClick"],No={class:"p-6 overflow-y-auto max-h-[55vh]"},zo={key:0,class:"text-center py-12 text-r58-text-secondary"},Ko={key:1,class:"space-y-6"},Fo={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},Go={class:"space-y-2"},Wo={class:"flex-1"},Jo={class:"text-sm"},Yo={key:0,class:"ml-2 text-xs text-r58-accent-primary"},qo={class:"flex items-center gap-2"},Xo={key:0,class:"flex items-center gap-2"},Qo={key:0,class:"px-3 py-1 bg-r58-accent-primary text-white rounded text-sm font-mono"},Zo={key:1,class:"text-sm text-r58-text-secondary animate-pulse"},en={class:"px-3 py-1 bg-r58-bg-secondary border border-r58-bg-tertiary rounded text-sm font-mono"},tn=["onClick"],on=["onClick"],ye="r58-hotkey-customizations",nn=Y({__name:"HotkeySettings",setup(m,{expose:g}){const s=[{id:"help",key:"?",modifiers:["shift"],description:"Show keyboard shortcuts",context:"global",category:"Navigation",editable:!1},{id:"goto-recorder",key:"r",description:"Go to Recorder",context:"global",category:"Navigation",editable:!0},{id:"goto-mixer",key:"m",description:"Go to Mixer",context:"global",category:"Navigation",editable:!0},{id:"escape",key:"Escape",description:"Close modal / Cancel",context:"global",category:"Navigation",editable:!1},{id:"scene-1",key:"1",description:"Switch to Scene 1",context:"mixer",category:"Scenes",editable:!0},{id:"scene-2",key:"2",description:"Switch to Scene 2",context:"mixer",category:"Scenes",editable:!0},{id:"scene-3",key:"3",description:"Switch to Scene 3",context:"mixer",category:"Scenes",editable:!0},{id:"scene-4",key:"4",description:"Switch to Scene 4",context:"mixer",category:"Scenes",editable:!0},{id:"scene-5",key:"5",description:"Switch to Scene 5",context:"mixer",category:"Scenes",editable:!0},{id:"scene-6",key:"6",description:"Switch to Scene 6",context:"mixer",category:"Scenes",editable:!0},{id:"scene-7",key:"7",description:"Switch to Scene 7",context:"mixer",category:"Scenes",editable:!0},{id:"scene-8",key:"8",description:"Switch to Scene 8",context:"mixer",category:"Scenes",editable:!0},{id:"scene-9",key:"9",description:"Switch to Scene 9",context:"mixer",category:"Scenes",editable:!0},{id:"cut",key:"t",description:"Cut transition",context:"mixer",category:"Transitions",editable:!0},{id:"fade",key:"a",description:"Auto-transition (fade)",context:"mixer",category:"Transitions",editable:!0},{id:"cycle-sources",key:"Tab",description:"Cycle through sources",context:"mixer",category:"Transitions",editable:!0},{id:"go-live",key:"g",description:"Toggle Go Live",context:"mixer",category:"Control",editable:!0},{id:"toggle-recording",key:"r",modifiers:["ctrl"],description:"Toggle local recording",context:"mixer",category:"Control",editable:!0},{id:"mute-all",key:"m",modifiers:["ctrl"],description:"Mute all sources",context:"mixer",category:"Control",editable:!0},{id:"source-1",key:"F1",description:"Select source 1",context:"mixer",category:"Sources",editable:!0},{id:"source-2",key:"F2",description:"Select source 2",context:"mixer",category:"Sources",editable:!0},{id:"source-3",key:"F3",description:"Select source 3",context:"mixer",category:"Sources",editable:!0},{id:"source-4",key:"F4",description:"Select source 4",context:"mixer",category:"Sources",editable:!0},{id:"start-stop-recording",key:" ",description:"Start/Stop recording",context:"recorder",category:"Recording",editable:!0},{id:"mark-chapter",key:"c",description:"Mark chapter point",context:"recorder",category:"Recording",editable:!0}],c=S(!1),l=S("mixer"),u=S({}),x=S(null),b=S(null);function i(){try{const _=localStorage.getItem(ye);_&&(u.value=JSON.parse(_))}catch(_){console.warn("[HotkeySettings] Failed to load customizations:",_)}}function D(){try{localStorage.setItem(ye,JSON.stringify(u.value))}catch(_){console.warn("[HotkeySettings] Failed to save customizations:",_)}}function M(_){const L=u.value[_.id];return L?{..._,key:L.key,modifiers:L.modifiers}:_}const y=j(()=>{const _={global:{},mixer:{},recorder:{}};for(const L of s){const V=M(L);_[L.context][V.category]||(_[L.context][V.category]=[]),_[L.context][V.category].push(V)}return _}),p=j(()=>y.value[l.value]||{});function f(_){return pe(_.key,_.modifiers)}function E(_){return!!u.value[_]}function R(_){const L=s.find(V=>V.id===_);L!=null&&L.editable&&(x.value=_,b.value=null,document.addEventListener("keydown",h))}function h(_){if(_.preventDefault(),_.stopPropagation(),["Control","Alt","Shift","Meta"].includes(_.key))return;const L=[];_.ctrlKey&&L.push("ctrl"),_.altKey&&L.push("alt"),_.shiftKey&&L.push("shift"),_.metaKey&&L.push("meta"),b.value={key:_.key,modifiers:L},document.removeEventListener("keydown",h)}function k(){!x.value||!b.value||(u.value[x.value]={key:b.value.key,modifiers:b.value.modifiers.length>0?b.value.modifiers:void 0},D(),U.success("Hotkey updated"),x.value=null,b.value=null)}function v(){x.value=null,b.value=null,document.removeEventListener("keydown",h)}function t(_){delete u.value[_],D(),U.info("Hotkey reset to default")}function o(){confirm("Reset all hotkeys to defaults?")&&(u.value={},D(),U.info("All hotkeys reset to defaults"))}function n(){i(),c.value=!0}function C(){v(),c.value=!1}oe(()=>{i()});function K(){return{...u.value}}return g({open:n,getCustomBindings:K}),(_,L)=>(r(),ke(we,{to:"body"},[c.value?(r(),a("div",Ho,[e("div",{class:"absolute inset-0 bg-black/60",onClick:C}),e("div",Vo,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[L[0]||(L[0]=e("h2",{class:"text-xl font-semibold"},"Keyboard Shortcuts",-1)),e("div",{class:"flex items-center gap-4"},[e("button",{onClick:o,class:"text-sm text-r58-text-secondary hover:text-r58-text-primary"}," Reset All "),e("button",{onClick:C,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," Ã— ")])]),e("div",Bo,[(r(),a(z,null,J(["mixer","global","recorder"],V=>e("button",{key:V,onClick:Q=>l.value=V,class:P(["px-6 py-3 text-sm font-medium capitalize transition-colors",l.value===V?"text-r58-accent-primary border-b-2 border-r58-accent-primary":"text-r58-text-secondary hover:text-r58-text-primary"])},w(V),11,Ao)),64))]),e("div",No,[Object.keys(p.value).length===0?(r(),a("div",zo," No shortcuts defined for this context. ")):(r(),a("div",Ko,[(r(!0),a(z,null,J(p.value,(V,Q)=>(r(),a("div",{key:Q},[e("h3",Fo,w(Q),1),e("div",Go,[(r(!0),a(z,null,J(V,N=>(r(),a("div",{key:N.id,class:P(["flex items-center justify-between p-3 bg-r58-bg-tertiary rounded-lg",{"ring-2 ring-r58-accent-primary":x.value===N.id}])},[e("div",Wo,[e("span",Jo,w(N.description),1),E(N.id)?(r(),a("span",Yo,"(customized)")):T("",!0)]),e("div",qo,[x.value===N.id?(r(),a("div",Xo,[b.value?(r(),a("kbd",Qo,w(B(pe)(b.value.key,b.value.modifiers)),1)):(r(),a("span",Zo," Press a key... ")),b.value?(r(),a("button",{key:2,onClick:k,class:"btn btn-sm btn-primary"}," Save ")):T("",!0),e("button",{onClick:v,class:"btn btn-sm"}," Cancel ")])):(r(),a(z,{key:1},[e("kbd",en,w(f(N)),1),N.editable?(r(),a("button",{key:0,onClick:Z=>R(N.id),class:"text-xs text-r58-accent-primary hover:underline"}," Edit ",8,tn)):T("",!0),E(N.id)?(r(),a("button",{key:1,onClick:Z=>t(N.id),class:"text-xs text-r58-text-secondary hover:text-r58-accent-danger"}," Reset ",8,on)):T("",!0)],64))])],2))),128))])]))),128))]))]),e("div",{class:"flex items-center justify-between px-6 py-4 border-t border-r58-bg-tertiary"},[L[1]||(L[1]=e("div",{class:"text-sm text-r58-text-secondary"},' Click "Edit" to customize a shortcut. Press any key combination to set. ',-1)),e("button",{onClick:C,class:"btn"},"Close")])])])):T("",!0)]))}}),sn={class:"connection-status","data-testid":"connection-status"},rn={class:"text-xs text-r58-text-secondary"},an={key:0,class:"text-xs text-r58-accent-danger",title:"Click for details"},ln={key:0,class:"mt-2 p-3 bg-r58-bg-tertiary rounded-lg text-xs space-y-2"},cn={class:"grid grid-cols-2 gap-2"},dn={class:"ml-1 font-medium"},un={class:"ml-1"},mn={class:"ml-1"},gn={key:0,class:"p-2 bg-r58-accent-danger/10 border border-r58-accent-danger/30 rounded text-r58-accent-danger"},vn={class:"flex gap-2 pt-2 border-t border-r58-bg-tertiary"},pn=["disabled"],fn={key:1,class:"text-r58-text-secondary text-center"},xn=Y({__name:"ConnectionStatus",props:{vdoEmbed:{}},setup(m){const g=m;ne();const s=S(!1),c=S("never"),l=S(0),u=S(!1),x=j(()=>{var v,t;return((t=(v=g.vdoEmbed)==null?void 0:v.connectionState)==null?void 0:t.value)||"disconnected"}),b=j(()=>{var v,t;return((t=(v=g.vdoEmbed)==null?void 0:v.isReady)==null?void 0:t.value)||!1}),i=j(()=>{var v,t;return((t=(v=g.vdoEmbed)==null?void 0:v.lastError)==null?void 0:t.value)||null}),D=j(()=>x.value==="disconnected"||!b.value?"disconnected":i.value?"error":x.value==="connecting"?"degraded":"healthy"),M=j(()=>{switch(D.value){case"healthy":return"bg-r58-accent-success";case"degraded":return"bg-amber-500";case"error":return"bg-r58-accent-danger";case"disconnected":return"bg-r58-text-secondary";default:return"bg-r58-text-secondary"}}),y=j(()=>{switch(D.value){case"healthy":return"Connected";case"degraded":return"Connecting...";case"error":return"Error";case"disconnected":return"Disconnected";default:return"Unknown"}});let p=null;function f(){if(g.vdoEmbed){const v=g.vdoEmbed.getEventStats();if(v.lastActivity){const t=Date.now()-v.lastActivity;t<1e3?c.value="just now":t<6e4?c.value=`${Math.floor(t/1e3)}s ago`:t<36e5?c.value=`${Math.floor(t/6e4)}m ago`:c.value="over 1h ago"}}}oe(()=>{f(),p=window.setInterval(f,1e3)}),ie(()=>{p&&clearInterval(p)});async function E(){if(!u.value){u.value=!0,l.value++,U.info("Attempting to reconnect...");try{g.vdoEmbed&&g.vdoEmbed.sendCommand("ping"),await new Promise(v=>setTimeout(v,2e3)),b.value&&!i.value?(U.success("Reconnected successfully"),l.value=0):U.error("Reconnection failed. Try refreshing the page.")}catch(v){U.error("Reconnection error"),console.error("[ConnectionStatus] Reconnect error:",v)}finally{u.value=!1}}}function R(){confirm("This will refresh the page and may interrupt active streams. Continue?")&&window.location.reload()}function h(){s.value=!s.value}const k=j(()=>g.vdoEmbed?g.vdoEmbed.getEventStats():{total:0,incoming:0,outgoing:0,lastActivity:null});return(v,t)=>(r(),a("div",sn,[e("div",{class:"flex items-center gap-2 cursor-pointer",onClick:h},[e("span",{class:P(["w-2 h-2 rounded-full",[M.value,{"animate-pulse":D.value==="degraded"}]]),"data-testid":"status-indicator"},null,2),e("span",rn,w(y.value),1),i.value?(r(),a("span",an," âš ï¸ ")):T("",!0),(r(),a("svg",{class:P(["w-3 h-3 text-r58-text-secondary transition-transform",{"rotate-180":s.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[0]||(t[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),s.value?(r(),a("div",ln,[e("div",cn,[e("div",null,[t[1]||(t[1]=e("span",{class:"text-r58-text-secondary"},"VDO.ninja:",-1)),e("span",{class:P(["ml-1 font-medium",b.value?"text-r58-accent-success":"text-r58-accent-danger"])},w(b.value?"Ready":"Not Ready"),3)]),e("div",null,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"State:",-1)),e("span",dn,w(x.value),1)]),e("div",null,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Last activity:",-1)),e("span",un,w(c.value),1)]),e("div",null,[t[4]||(t[4]=e("span",{class:"text-r58-text-secondary"},"Events:",-1)),e("span",mn,w(k.value.total),1)])]),i.value?(r(),a("div",gn,[t[5]||(t[5]=e("strong",null,"Error:",-1)),te(" "+w(i.value),1)])):T("",!0),e("div",vn,[e("button",{onClick:E,disabled:u.value,class:P(["btn btn-sm flex-1",{"opacity-50":u.value}])},w(u.value?"Reconnecting...":"ðŸ”„ Reconnect"),11,pn),e("button",{onClick:R,class:"btn btn-sm",title:"Refresh the page (last resort)"}," ðŸ”ƒ Refresh ")]),l.value>0?(r(),a("div",fn," Reconnect attempts: "+w(l.value),1)):T("",!0)])):T("",!0)]))}}),bn={class:"h-full flex flex-col"},yn={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"mixer-header"},hn={class:"flex items-center gap-4"},kn={class:"flex items-center gap-2"},wn={key:0,class:"badge badge-danger","data-testid":"on-air-badge"},_n={key:1,class:"text-xs text-r58-text-secondary"},Sn={class:"flex items-center gap-4"},$n={class:"flex-1 flex overflow-hidden"},Cn={class:"flex-1 p-4"},Rn={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},Dn={class:"mb-6"},En={class:"grid grid-cols-4 gap-2"},Mn=["onClick","data-testid"],On={class:"mb-6 pt-4 border-t border-r58-bg-tertiary"},Tn={class:"mb-6 pt-4 border-t border-r58-bg-tertiary"},Ln={class:"pt-4 border-t border-r58-bg-tertiary"},Un=Y({__name:"MixerView",setup(m){const g=ne(),s=de(),c=ue(),{register:l}=Oe(),u=S(null),x=S(null),b=S(null),i=j(()=>g.isLive),D=j(()=>c.enabledDestinations.length);let M=null;function y(){return s.isRecording?5e3:15e3}function p(){M&&clearInterval(M),M=window.setInterval(()=>{s.fetchInputs()},y())}const f=[];se(()=>s.isRecording,()=>{p()}),oe(()=>{s.fetchInputs(),p();for(let t=1;t<=4;t++){const o=l({key:String(t),description:`Switch to scene ${t}`,action:()=>E(t),context:"mixer"});f.push(o)}f.push(l({key:"g",description:"Toggle Go Live",action:()=>h(),context:"mixer"})),f.push(l({key:"r",description:"Toggle recording",action:()=>R(),context:"mixer"}))}),ie(()=>{f.forEach(t=>t()),M&&(clearInterval(M),M=null)});function E(t){u.value&&u.value.sendCommand("addScene","*",t),g.setScene(`scene-${t}`),U.info(`Scene ${t}`)}function R(){var t;u.value&&((t=u.value.isRecording)!=null&&t.value?(u.value.stopRecording(),U.info("Recording stopped")):(u.value.startRecording(),U.success("Recording started")))}function h(){if(g.isLive)g.toggleLive(),c.stopStreaming(),U.info("Session ended");else{g.toggleLive(),c.startStreaming();const t=c.enabledDestinations.length;t>0?U.success(`Live! Streaming to ${t} destination${t>1?"s":""}`):U.info("Live! (No streaming destinations configured)")}}function k(){var t;(t=x.value)==null||t.open()}function v(){var t;(t=b.value)==null||t.open()}return(t,o)=>(r(),a("div",bn,[e("header",yn,[e("div",hn,[e("div",kn,[e("span",{class:P(["w-3 h-3 rounded-full",i.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"]),"data-testid":"live-indicator"},null,2),o[0]||(o[0]=e("span",{class:"text-xl font-semibold text-r58-mixer","data-testid":"mixer-title"},"Mixer",-1))]),i.value?(r(),a("span",wn,"ON AIR")):T("",!0),i.value&&D.value>0?(r(),a("span",_n," Streaming to "+w(D.value)+" platform"+w(D.value>1?"s":""),1)):T("",!0),X(xn,{"vdo-embed":u.value},null,8,["vdo-embed"])]),e("div",Sn,[e("button",{class:"btn btn-sm",onClick:v,title:"Keyboard Shortcuts (Shift+?)","data-testid":"hotkey-settings-button"},[...o[1]||(o[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)])]),e("button",{class:"btn btn-sm",onClick:k,title:"Streaming Settings","data-testid":"streaming-settings-button"},[...o[2]||(o[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),e("button",{class:P(["btn",i.value?"btn-danger":"btn-primary"]),onClick:h,"data-testid":"go-live-button"},w(i.value?"End Session":"Go Live"),3)])]),e("div",$n,[e("div",Cn,[X(Fe,{ref_key:"vdoEmbedRef",ref:u,profile:"director",class:"h-full"},null,512)]),e("aside",Rn,[e("div",Dn,[o[3]||(o[3]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Quick Scenes",-1)),e("div",En,[(r(),a(z,null,J(4,n=>e("button",{key:n,class:P(["btn btn-sm",B(g).currentScene===`scene-${n}`?"btn-primary":""]),onClick:C=>E(n),"data-testid":`scene-btn-${n}`},w(n),11,Mn)),64))]),o[4]||(o[4]=e("p",{class:"text-xs text-r58-text-secondary mt-2"}," Press 1-4 for quick switch. Full layout control is in the mixer above. ",-1))]),e("div",On,[X(mt,{"vdo-embed":u.value},null,8,["vdo-embed"])]),e("div",Tn,[o[5]||(o[5]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Program Output",-1)),X(Ut)]),e("div",Ln,[o[6]||(o[6]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Local Recording",-1)),X(Po,{"vdo-embed":u.value},null,8,["vdo-embed"])])])]),X(St),X(Ro,{ref_key:"streamingSettingsRef",ref:x},null,512),X(nn,{ref_key:"hotkeySettingsRef",ref:b},null,512)]))}});export{Un as default};
