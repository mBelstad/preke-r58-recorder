import{A as D,B as L,j as V,k as ne,C as Se,r as h,h as x,D as $e,d as M,E as se,l as I,T as q,m as K,G as ce,c as m,b as $,a as e,t as y,n as w,s as ue,o as v,w as Ce,x as Re,_ as ae,H as Te,g as j,F as G,p as O,I as k,f as Ie,e as Be,q as de,u as Ae}from"./index-CssX6Kh2.js";import{M as Ee}from"./ModeLoadingScreen-MCz4vPXX.js";const P=h(!1),H=h(!1);let F=null;function Me(){const p=D();L(()=>p.status,r=>{P.value=r==="recording"},{immediate:!0});function l(r){if(P.value)return r.preventDefault(),r.returnValue="Recording in progress. Are you sure you want to leave?",r.returnValue}V(()=>{window.addEventListener("beforeunload",l)}),ne(()=>{window.removeEventListener("beforeunload",l)}),Se((r,i,o)=>{P.value?(F=()=>o(),H.value=!0,o(!1)):o()});function c(){H.value=!1,P.value=!1,p.stopRecording().finally(()=>{F&&(F(),F=null)})}function b(){H.value=!1,F=null}return{isGuardActive:P,showLeaveConfirmation:H,confirmLeave:c,cancelLeave:b}}const C=h(null),J=h(!1),le=h(null),X=h(null),Le=10,Z=2,De=25;function Ne(){const p=x(()=>C.value?C.value.available_gb<Z?"critical":C.value.available_gb<Le?"warning":"ok":"unknown"),l=x(()=>C.value?C.value.available_gb>=Z:!0),c=x(()=>{if(!C.value)return null;const u=C.value.available_gb*1024*1024*1024,f=De*1024*1024,s=u/f,t=Math.floor(s/3600),n=Math.floor(s%3600/60);return t>24?`${Math.floor(t/24)}d ${t%24}h`:t>0?`${t}h ${n}m`:`${n}m`}),b=x(()=>{switch(p.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),r=x(()=>C.value?p.value==="critical"?`Disk space critically low (${C.value.available_gb.toFixed(1)} GB). Cannot start recording.`:p.value==="warning"?`Low disk space (${C.value.available_gb.toFixed(1)} GB). Estimated recording time: ${c.value}`:null:null);async function i(){J.value=!0,X.value=null;try{const u=await $e.getDegradation();if(u.resources&&u.resources.disk_free_gb!==void 0){const f=u.resources.disk_free_gb,s=f*3;C.value={available_gb:f,total_gb:s,used_percent:100-f/s*100,recording_path:"/opt/r58-app/shared/recordings"}}return le.value=new Date,C.value}catch(u){return X.value=u.message||"Failed to check disk space",console.error("Failed to check disk space:",u),null}finally{J.value=!1}}async function o(){return await i(),C.value?p.value==="critical"?{ok:!1,message:`Insufficient disk space (${C.value.available_gb.toFixed(1)} GB). Need at least ${Z} GB to start recording.`}:p.value==="warning"?{ok:!0,message:`Low disk space warning: ${C.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${c.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:C,isLoading:J,lastCheck:le,error:X,status:p,statusColor:b,canStartRecording:l,estimatedRecordingTime:c,warningMessage:r,checkDiskSpace:i,preflightCheck:o}}const A=h(localStorage.getItem("r58_audio_feedback")!=="false");let ee=null;function je(){return ee||(ee=new(window.AudioContext||window.webkitAudioContext)),ee}function B(p,l,c="sine",b=.3){if(A.value)try{const r=je();r.state==="suspended"&&r.resume();const i=r.createOscillator(),o=r.createGain();i.connect(o),o.connect(r.destination),i.type=c,i.frequency.value=p;const u=r.currentTime;o.gain.setValueAtTime(0,u),o.gain.linearRampToValueAtTime(b,u+.01),o.gain.linearRampToValueAtTime(0,u+l),i.start(u),i.stop(u+l)}catch(r){console.warn("Audio feedback failed:",r)}}function Pe(){A.value&&(B(440,.1,"sine",.2),setTimeout(()=>B(554,.1,"sine",.2),100),setTimeout(()=>B(659,.15,"sine",.25),200))}function Fe(){A.value&&(B(880,.08,"sine",.3),setTimeout(()=>B(880,.15,"sine",.3),120))}function Ge(){A.value&&(B(659,.1,"sine",.25),setTimeout(()=>B(554,.1,"sine",.2),100),setTimeout(()=>B(440,.15,"sine",.2),200))}function Ve(){A.value&&(B(200,.15,"square",.15),setTimeout(()=>B(180,.2,"square",.15),180))}function We(){A.value&&(B(1e3,.08,"sine",.2),setTimeout(()=>B(1e3,.08,"sine",.2),150))}function ie(){A.value&&B(1200,.03,"sine",.1)}function ze(p=50){if(A.value&&"vibrate"in navigator)try{navigator.vibrate(p)}catch{}}function fe(){function p(c){A.value=c,localStorage.setItem("r58_audio_feedback",String(c))}function l(){p(!A.value),A.value&&ie()}return{enabled:A,setEnabled:p,toggle:l,playSuccess:Pe,playError:Ve,playWarning:We,playClick:ie,playRecordStart:Fe,playRecordStop:Ge,vibrate:ze}}const He={class:"bg-r58-bg-secondary rounded-lg shadow-xl max-w-md w-full p-6"},Ue={class:"text-lg font-semibold mb-2"},Oe={class:"text-r58-text-secondary mb-6"},qe={class:"flex justify-end gap-3"},ge=M({__name:"ConfirmDialog",props:{title:{},message:{},confirmText:{},cancelText:{},danger:{type:Boolean}},emits:["confirm","cancel"],setup(p,{expose:l,emit:c}){const b=c,r=h(!1);function i(){r.value=!0}function o(){r.value=!1}function u(){b("confirm"),o()}function f(){b("cancel"),o()}return l({open:i,close:o}),(s,t)=>(v(),se(ce,{to:"body"},[I(q,{name:"fade"},{default:K(()=>[r.value?(v(),m("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ue(f,["self"])},[e("div",He,[e("h2",Ue,y(p.title),1),e("p",Oe,y(p.message),1),e("div",qe,[e("button",{onClick:f,class:"btn"},y(p.cancelText||"Cancel"),1),e("button",{onClick:u,class:w(["btn",p.danger?"btn-danger":"btn-primary"])},y(p.confirmText||"Confirm"),3)])])])):$("",!0)]),_:1})]))}}),Ke={class:"bg-r58-bg-secondary rounded-lg shadow-xl max-w-md w-full p-6"},Qe=["placeholder"],Ye={class:"text-xs text-r58-text-secondary mt-2"},Je=M({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(p,{emit:l}){const c=p,b=l,r=h(""),i=h(null),o=x(()=>{const d=new Date,a=d.toLocaleDateString("en-CA"),g=d.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${a}_${g}`}),u=x(()=>c.suggestedName||o.value);L(()=>c.open,d=>{d&&(r.value=u.value,setTimeout(()=>{var a,g;(a=i.value)==null||a.focus(),(g=i.value)==null||g.select()},100))});function f(){b("confirm",r.value.trim()||u.value)}function s(){b("skip")}function t(){b("cancel")}function n(d){d.key==="Enter"?f():d.key==="Escape"&&t()}return(d,a)=>(v(),se(ce,{to:"body"},[I(q,{name:"fade"},{default:K(()=>[p.open?(v(),m("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ue(t,["self"]),onKeydown:n},[e("div",Ke,[a[1]||(a[1]=e("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),a[2]||(a[2]=e("p",{class:"text-r58-text-secondary text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),Ce(e("input",{ref_key:"inputRef",ref:i,"onUpdate:modelValue":a[0]||(a[0]=g=>r.value=g),type:"text",placeholder:u.value,class:"w-full px-4 py-2 bg-r58-bg-tertiary border border-r58-bg-tertiary rounded-lg text-r58-text-primary placeholder-r58-text-secondary focus:outline-none focus:ring-2 focus:ring-r58-accent-primary"},null,8,Qe),[[Re,r.value]]),e("p",Ye," Suggested: "+y(u.value),1),e("div",{class:"flex justify-between mt-6"},[e("button",{onClick:s,class:"text-sm text-r58-text-secondary hover:text-r58-text-primary transition-colors"}," Skip (use default) "),e("div",{class:"flex gap-3"},[e("button",{onClick:t,class:"btn"}," Cancel "),e("button",{onClick:f,class:"btn btn-primary"}," Start Recording ")])])])],32)):$("",!0)]),_:1})]))}}),Xe=ae(Je,[["__scopeId","data-v-df8c0a50"]]),Ze={class:"flex items-center gap-4"},et={key:0,class:"font-mono text-xl text-r58-accent-danger"},tt=["disabled","title"],nt={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},st={key:0,class:"w-3 h-3 bg-white rounded-sm"},at={key:1,class:"w-3 h-3 bg-white rounded-full"},rt={class:"text-xs text-r58-text-secondary hidden md:inline"},ot=M({__name:"RecorderControls",setup(p){const l=D(),{register:c}=Te(),{preflightCheck:b,status:r,canStartRecording:i}=Ne(),{playRecordStart:o,playRecordStop:u,playError:f,playWarning:s,vibrate:t}=fe(),n=h(null),d=h(!1),a=h(!1),g=h(!1),_=h(!1),E=h(void 0),S=x(()=>l.status==="recording"),N=x(()=>l.status==="starting"),W=x(()=>l.status==="stopping"),Q=x(()=>l.formattedDuration),pe=x(()=>N.value||W.value||a.value),me=x(()=>N.value?"Starting recording...":W.value?"Stopping recording...":a.value?"Checking disk space...":!S.value&&!i.value?"Insufficient disk space":"");let Y=null;V(()=>{Y=c({key:" ",description:"Toggle Recording",action:be,context:"recorder",enabled:()=>!N.value&&!W.value})}),ne(()=>{Y&&Y()});async function be(){S.value?oe():await z()}async function z(R){a.value=!0;try{const T=await b();if(!T.ok){f(),t(200),j.error("Cannot start recording",T.message||"Preflight check failed");return}if(T.message&&r.value==="warning"&&(s(),j.warning("Low disk space",T.message)),_.value&&!R){E.value=void 0,g.value=!0;return}await re(R||E.value)}finally{a.value=!1}}async function re(R){try{await l.startRecording(R);const T=R||l.sessionId;o(),t([50,30,50]),j.success("Recording started",`Session: ${T}`)}catch(T){f(),t(200),j.error("Failed to start recording",T.message||"Unknown error",{label:"Retry",onClick:()=>z(R)})}}function he(R){g.value=!1,E.value=R,z(R)}function xe(){g.value=!1,E.value=void 0,z()}function ye(){g.value=!1,a.value=!1}async function _e(){try{await l.stopRecording(),u(),t(100),j.success("Recording stopped",`Duration: ${Q.value}`)}catch(R){f(),t(200),j.error("Failed to stop recording",R.message||"Unknown error")}}function oe(){var R;d.value=!1,(R=n.value)==null||R.open(),setTimeout(()=>{d.value=!0},500)}function we(){d.value&&_e()}async function ke(){S.value?oe():await re()}return(R,T)=>(v(),m(G,null,[e("div",Ze,[S.value?(v(),m("div",et,y(Q.value),1)):$("",!0),e("button",{onClick:ke,disabled:pe.value,class:w(["flex items-center gap-2 px-6 py-2 rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",[S.value?"bg-r58-accent-danger hover:bg-red-600 text-white":"bg-r58-accent-success hover:bg-green-600 text-white"]]),title:me.value||(S.value?"Stop Recording (Space)":"Start Recording (Space)")},[N.value||W.value||a.value?(v(),m("span",nt)):(v(),m(G,{key:1},[S.value?(v(),m("span",st)):(v(),m("span",at))],64)),e("span",null,y(a.value?"Checking...":S.value?"Stop":"Start Recording"),1)],10,tt),e("span",rt,[T[0]||(T[0]=O(" Press ",-1)),T[1]||(T[1]=e("kbd",{class:"px-1 py-0.5 bg-r58-bg-tertiary rounded text-xs font-mono"},"Space",-1)),O(" to "+y(S.value?"stop":"start"),1)])]),I(ge,{ref_key:"stopConfirmDialog",ref:n,title:"Stop Recording?",message:`You have been recording for ${Q.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:we},null,8,["message"]),I(Xe,{open:g.value,onConfirm:he,onSkip:xe,onCancel:ye},null,8,["open"])],64))}}),U=h(localStorage.getItem("r58_performance_mode")==="true"),te=h(localStorage.getItem("r58_performance_mode_auto")!=="false"),lt=3,it=100,ct=500;function ve(){const p=D(),l=x(()=>U.value?!0:te.value&&p.isRecording?p.inputs.filter(n=>n.isRecording).length>=lt:!1),c=x(()=>l.value?ct:it);L(l,t=>{t?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function b(t){U.value=t,localStorage.setItem("r58_performance_mode",String(t))}function r(t){te.value=t,localStorage.setItem("r58_performance_mode_auto",String(t))}function i(){b(!U.value)}function o(t,n){let d=0,a=null;return(...g)=>{const _=Date.now(),E=n??c.value,S=_-d;S>=E?(d=_,t(...g)):a||(a=window.setTimeout(()=>{d=Date.now(),a=null,t(...g)},E-S))}}function u(t,n){let d=null;return(...a)=>{d&&clearTimeout(d),d=window.setTimeout(()=>{t(...a),d=null},n??c.value)}}function f(t){return l.value?window.setTimeout(()=>t(performance.now()),c.value):requestAnimationFrame(t)}function s(t){l.value?clearTimeout(t):cancelAnimationFrame(t)}return{enabled:U,autoEnable:te,isActive:l,updateInterval:c,setEnabled:b,setAutoEnable:r,toggle:i,throttle:o,debounce:u,requestFrame:f,cancelFrame:s}}const ut=["title"],dt={class:"flex items-center gap-1.5 text-sm"},ft={key:0,class:"flex items-center gap-1.5 text-sm"},gt={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},vt={class:"font-mono"},pt=M({__name:"RecordingHealth",setup(p,{expose:l}){const c=D(),{isActive:b}=ve(),r=h({}),i=h(0),o=h(0),u=h(0);let f=null;function s(){const g={};let _=0;c.inputs.forEach(S=>{g[S.id]=S.bytesWritten;const N=r.value[S.id]||0;_+=S.bytesWritten-N});const E=b.value?2:1;i.value=Math.round(_/(1024*1024)/E*10)/10,r.value=g}L(()=>c.isRecording,g=>{if(g){r.value={},i.value=0,o.value=0,u.value=0;const _=b.value?2e3:1e3;f=window.setInterval(s,_)}else f&&(clearInterval(f),f=null)},{immediate:!0}),L(b,g=>{if(c.isRecording&&f){clearInterval(f);const _=g?2e3:1e3;f=window.setInterval(s,_)}}),ne(()=>{f&&clearInterval(f)});const t=x(()=>c.isRecording?u.value>0||o.value>90?"critical":i.value<1||o.value>70?"warning":"healthy":"idle"),n=x(()=>{switch(t.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});x(()=>{switch(t.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const d=x(()=>{if(!c.isRecording)return"Not recording";const g=[`Write speed: ${i.value} MB/s`,`Buffer: ${o.value}%`];return u.value>0&&g.push(`Frames dropped: ${u.value}`),g.join(`
`)});function a(g){g.buffer_percent!==void 0&&(o.value=g.buffer_percent),g.frames_dropped!==void 0&&(u.value=g.frames_dropped)}return l({updateFromMetrics:a}),(g,_)=>k(c).isRecording?(v(),m("div",{key:0,class:w(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":n.value==="emerald","bg-amber-500/10":n.value==="amber","bg-red-500/10":n.value==="red"}]),title:d.value},[e("span",{class:w(["w-2 h-2 rounded-full",n.value==="emerald"?"bg-emerald-500":"",n.value==="amber"?"bg-amber-500 animate-pulse":"",n.value==="red"?"bg-red-500 animate-pulse":""])},null,2),e("div",dt,[_[0]||(_[0]=e("svg",{class:"w-3.5 h-3.5 text-r58-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),e("span",{class:w(["font-mono",n.value==="emerald"?"text-emerald-400":"",n.value==="amber"?"text-amber-400":"",n.value==="red"?"text-red-400":""])},y(i.value)+" MB/s ",3)]),o.value>0?(v(),m("div",ft,[_[1]||(_[1]=e("span",{class:"text-r58-text-secondary"},"Buf:",-1)),e("span",{class:w(["font-mono",o.value<50?"text-emerald-400":"",o.value>=50&&o.value<80?"text-amber-400":"",o.value>=80?"text-red-400":""])},y(o.value)+"% ",3)])):$("",!0),u.value>0?(v(),m("div",gt,[_[2]||(_[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",vt,y(u.value)+" dropped",1)])):$("",!0)],10,ut)):$("",!0)}}),mt={class:"relative w-full h-full bg-black"},bt={key:0,class:"absolute inset-0 flex items-center justify-center bg-black/50"},ht={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/80"},xt={class:"text-center text-r58-text-secondary"},yt={class:"text-sm"},_t=M({__name:"InputPreview",props:{inputId:{},protocol:{}},setup(p){const l=p,c=D(),b=x(()=>c.status==="recording"),r=h(null),i=h(!0),o=h(null);function u(){return Ie(`/${l.inputId}/whep`)}let f=null;async function s(){if(r.value){f&&(f.close(),f=null),i.value=!0,o.value=null;try{const t=u(),n=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});f=n,n.ontrack=_=>{r.value&&_.streams[0]&&(r.value.srcObject=_.streams[0],i.value=!1)},n.oniceconnectionstatechange=()=>{(n.iceConnectionState==="failed"||n.iceConnectionState==="disconnected")&&(o.value="Connection lost")},n.addTransceiver("video",{direction:"recvonly"}),n.addTransceiver("audio",{direction:"recvonly"});const d=await n.createOffer();await n.setLocalDescription(d);const a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/sdp"},body:d.sdp});if(!a.ok)throw new Error(`WHEP request failed: ${a.status}`);const g=await a.text();await n.setRemoteDescription({type:"answer",sdp:g})}catch(t){console.error("WHEP playback error:",t),o.value=t instanceof Error?t.message:"Failed to connect",i.value=!1}}}return V(()=>{s()}),L(()=>l.inputId,()=>{s()}),L(b,(t,n)=>{n&&!t&&o.value?(console.log("[InputPreview] Recording stopped, reconnecting preview..."),s()):!n&&t&&(console.log("[InputPreview] Recording started, will try to reconnect preview after delay..."),setTimeout(()=>{b.value&&(console.log("[InputPreview] Attempting to reconnect preview during recording..."),s())},2e3))}),(t,n)=>(v(),m("div",mt,[e("video",{ref_key:"videoRef",ref:r,autoplay:"",muted:"",playsinline:"",class:"w-full h-full object-contain"},null,512),i.value?(v(),m("div",bt,[...n[0]||(n[0]=[e("div",{class:"animate-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full"},null,-1)])])):$("",!0),o.value?(v(),m("div",ht,[e("div",xt,[e("p",yt,y(o.value),1),e("button",{onClick:s,class:"mt-2 text-xs text-r58-accent-primary hover:underline"}," Retry ")])])):$("",!0)]))}}),wt={key:0,class:"h-full flex items-center justify-center"},kt={key:1,class:"h-full flex flex-col gap-2"},St={key:0,class:"flex items-center gap-2 px-3 py-1.5 bg-amber-500/10 border border-amber-500/30 rounded-lg text-amber-400 text-sm"},$t=["title"],Ct={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},Rt={class:"flex items-center justify-between"},Tt={class:"flex items-center gap-2"},It={class:"font-medium"},Bt={key:0,class:"flex items-center gap-2 text-sm"},At={class:"text-r58-text-secondary"},Et={key:0,class:"mt-2 flex items-center justify-between"},Mt={class:"text-sm font-mono text-r58-text-secondary"},Lt=M({__name:"InputGrid",setup(p){const l=D(),c=x(()=>l.inputs.filter(s=>s.hasSignal)),b=x(()=>l.framerateMismatch);function r(s){return s.isRecording?"border-r58-accent-danger ring-2 ring-r58-accent-danger/20":s.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-r58-bg-tertiary/50 opacity-60"}function i(s){return s.hasSignal?s.framerate>=29?"excellent":s.framerate>=24?"good":"unstable":"none"}function o(s){switch(i(s)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-r58-text-secondary"}}function u(s){if(s===0)return"0 B";const t=1024,n=["B","KB","MB","GB"],d=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,d)).toFixed(1))+" "+n[d]}function f(s){if(!s.hasSignal)return`${s.label}: No signal detected`;const t=[`${s.label}`,`Resolution: ${s.resolution}`,`Framerate: ${s.framerate} fps`,`Quality: ${i(s)}`];return s.isRecording&&t.push(`Written: ${u(s.bytesWritten)}`),t.join(`
`)}return(s,t)=>c.value.length===0?(v(),m("div",wt,[...t[0]||(t[0]=[Be('<div class="text-center text-r58-text-secondary"><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><p class="text-lg font-medium">No Video Sources Connected</p><p class="text-sm mt-2">Connect HDMI cables to begin recording</p></div>',1)])])):(v(),m("div",kt,[b.value?(v(),m("div",St,[t[1]||(t[1]=e("svg",{class:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,y(b.value),1)])):$("",!0),e("div",{class:w(["flex-1 grid gap-4",c.value.length===1?"grid-cols-1":"grid-cols-2"])},[(v(!0),m(G,null,de(c.value,n=>(v(),m("div",{key:n.id,class:w(["relative rounded-lg overflow-hidden border-2 transition-all cursor-pointer aspect-video bg-black",r(n)]),title:f(n)},[I(_t,{"input-id":n.id,class:"w-full h-full"},null,8,["input-id"]),e("div",Ct,[e("div",Rt,[e("div",Tt,[e("span",{class:w(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":i(n)==="excellent"||i(n)==="good","bg-amber-500 animate-pulse":i(n)==="unstable","bg-r58-text-secondary":i(n)==="none"}])},null,2),e("span",It,y(n.label),1)]),n.hasSignal?(v(),m("div",Bt,[e("span",At,y(n.resolution),1),e("span",{class:w(o(n))},y(n.framerate)+"fps",3)])):$("",!0)]),n.isRecording?(v(),m("div",Et,[t[2]||(t[2]=e("div",{class:"flex items-center gap-2 text-r58-accent-danger"},[e("span",{class:"w-2 h-2 rounded-full bg-r58-accent-danger animate-recording"}),e("span",{class:"text-sm font-medium"},"REC")],-1)),e("span",Mt,y(u(n.bytesWritten)),1)])):$("",!0)])],10,$t))),128))],2)]))}}),Dt={class:"space-y-4"},Nt={class:"flex items-center justify-between py-2 cursor-pointer"},jt=["aria-checked"],Pt={class:"flex items-center justify-between py-2 cursor-pointer"},Ft=["aria-checked"],Gt={class:"flex items-center justify-between py-2 cursor-pointer"},Vt={class:"text-xs text-r58-text-secondary"},Wt={key:0,class:"text-amber-400"},zt=["aria-checked"],Ht={class:"flex items-center justify-between py-2 pl-4 cursor-pointer opacity-80"},Ut=["aria-checked"],Ot=M({__name:"SettingsPanel",setup(p){const{enabled:l,toggle:c,playClick:b}=fe(),{enabled:r,autoEnable:i,isActive:o,setEnabled:u,setAutoEnable:f}=ve(),s=h(!1);function t(){s.value=!s.value,s.value?(document.body.classList.add("touch-mode"),localStorage.setItem("r58_touch_mode","true")):(document.body.classList.remove("touch-mode"),localStorage.setItem("r58_touch_mode","false"))}V(()=>{const d=localStorage.getItem("r58_touch_mode")==="true";s.value=d,d&&document.body.classList.add("touch-mode")});function n(){c(),l.value&&b()}return(d,a)=>(v(),m("div",Dt,[a[7]||(a[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide"}," Interface Settings ",-1)),e("label",Nt,[a[2]||(a[2]=e("div",null,[e("span",{class:"text-r58-text-primary"},"Audio Feedback"),e("p",{class:"text-xs text-r58-text-secondary"},"Play sounds for recording start/stop")],-1)),e("button",{onClick:n,class:w(["relative w-12 h-7 rounded-full transition-colors",k(l)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":k(l)},[e("span",{class:w(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",k(l)?"translate-x-6":"translate-x-1"])},null,2)],10,jt)]),e("label",Pt,[a[3]||(a[3]=e("div",null,[e("span",{class:"text-r58-text-primary"},"Touch Mode"),e("p",{class:"text-xs text-r58-text-secondary"},"Larger buttons for touchscreen")],-1)),e("button",{onClick:t,class:w(["relative w-12 h-7 rounded-full transition-colors",s.value?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":s.value},[e("span",{class:w(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",s.value?"translate-x-6":"translate-x-1"])},null,2)],10,Ft)]),e("label",Gt,[e("div",null,[a[5]||(a[5]=e("span",{class:"text-r58-text-primary"},"Performance Mode",-1)),e("p",Vt,[a[4]||(a[4]=O(" Reduce UI updates during recording ",-1)),k(o)&&!k(r)?(v(),m("span",Wt,"(auto-enabled)")):$("",!0)])]),e("button",{onClick:a[0]||(a[0]=g=>k(u)(!k(r))),class:w(["relative w-12 h-7 rounded-full transition-colors",k(r)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":k(r)},[e("span",{class:w(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",k(r)?"translate-x-6":"translate-x-1"])},null,2)],10,zt)]),e("label",Ht,[a[6]||(a[6]=e("div",null,[e("span",{class:"text-sm text-r58-text-primary"},"Auto-enable when recording 3+ inputs")],-1)),e("button",{onClick:a[1]||(a[1]=g=>k(f)(!k(i))),class:w(["relative w-10 h-6 rounded-full transition-colors",k(i)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":k(i)},[e("span",{class:w(["absolute top-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform",k(i)?"translate-x-4":"translate-x-0.5"])},null,2)],10,Ut)])]))}}),qt={class:"space-y-6"},Kt={key:0,class:"card"},Qt={class:"space-y-2"},Yt={class:"flex justify-between"},Jt={class:"flex justify-between"},Xt={class:"font-mono"},Zt={class:"flex justify-between"},en={class:"card"},tn={class:"space-y-3"},nn={class:"flex items-center gap-2"},sn={key:0,class:"text-sm text-r58-text-secondary"},an={key:0,class:"text-r58-accent-danger"},rn={key:1},on={key:1,class:"text-sm text-r58-text-secondary"},ln={class:"card"},cn={class:"space-y-2"},un=["disabled","title"],dn={key:0,class:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-r58-bg-tertiary text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none"},fn={key:0,class:"card"},gn=M({__name:"SessionInfo",setup(p){const l=Ae(),c=D(),b=x(()=>c.currentSession),r=x(()=>c.activeInputs),i=x(()=>c.isRecording),o=h(!1);function u(s){if(s===0)return"0 B";const t=1024,n=["B","KB","MB","GB","TB"],d=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,d)).toFixed(2))+" "+n[d]}function f(){l.push({name:"admin",query:{tab:"settings"}})}return(s,t)=>(v(),m("div",qt,[b.value?(v(),m("div",Kt,[t[4]||(t[4]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Current Session",-1)),e("div",Qt,[e("div",Yt,[t[1]||(t[1]=e("span",{class:"text-r58-text-secondary"},"Started",-1)),e("span",null,y(b.value.startedAt.toLocaleTimeString()),1)]),e("div",Jt,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"Duration",-1)),e("span",Xt,y(k(c).formattedDuration),1)]),e("div",Zt,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Inputs",-1)),e("span",null,y(r.value.length)+" active",1)])])])):$("",!0),e("div",en,[t[5]||(t[5]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Input Status",-1)),e("div",tn,[(v(!0),m(G,null,de(k(c).inputs,n=>(v(),m("div",{key:n.id,class:"flex items-center justify-between py-2 border-b border-r58-bg-tertiary last:border-0"},[e("div",nn,[e("span",{class:w(["w-2 h-2 rounded-full",n.hasSignal?"bg-r58-accent-success":"bg-r58-text-secondary"])},null,2),e("span",{class:w(n.hasSignal?"":"text-r58-text-secondary")},y(n.label),3)]),n.hasSignal?(v(),m("div",sn,[n.isRecording?(v(),m("span",an,y(u(n.bytesWritten)),1)):(v(),m("span",rn,y(n.resolution),1))])):(v(),m("span",on,"No signal"))]))),128))])]),e("div",ln,[t[7]||(t[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Quick Actions",-1)),e("div",cn,[e("button",{onClick:f,class:"btn w-full justify-center disabled:opacity-50 disabled:cursor-not-allowed group relative",disabled:i.value,title:i.value?"Cannot configure while recording":"Open input configuration"},[t[6]||(t[6]=O(" Configure Inputs ",-1)),i.value?(v(),m("span",dn," Stop recording first ")):$("",!0)],8,un),e("button",{onClick:t[0]||(t[0]=n=>o.value=!o.value),class:"btn w-full justify-center"},y(o.value?"Hide Settings":"Interface Settings"),1)])]),I(q,{name:"slide-fade"},{default:K(()=>[o.value?(v(),m("div",fn,[I(Ot)])):$("",!0)]),_:1})]))}}),vn=ae(gn,[["__scopeId","data-v-8910ebdc"]]),pn={class:"h-full flex flex-col"},mn={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},bn={class:"flex items-center gap-4"},hn={class:"flex items-center gap-2"},xn={key:0,class:"badge badge-danger"},yn={class:"flex-1 flex overflow-hidden"},_n={class:"flex-1 p-4"},wn={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},kn=M({__name:"RecorderView",setup(p){const l=D(),{showLeaveConfirmation:c,confirmLeave:b,cancelLeave:r}=Me(),i=x(()=>l.status==="recording"),o=x(()=>l.formattedDuration),u=h(!0),f=x(()=>l.inputs.filter(d=>d.hasSignal).length),s=x(()=>l.inputs.length||4);function t(){u.value=!1}V(async()=>{await l.fetchInputs(),await l.fetchStatus()});const n=h(null);return L(c,d=>{var a,g;d?(a=n.value)==null||a.open():(g=n.value)==null||g.close()}),(d,a)=>(v(),m(G,null,[I(q,{name:"fade"},{default:K(()=>[u.value?(v(),se(Ee,{key:0,mode:"recorder","cameras-ready":f.value,"total-cameras":s.value,onReady:t},null,8,["cameras-ready","total-cameras"])):$("",!0)]),_:1}),e("div",pn,[e("header",mn,[e("div",bn,[e("div",hn,[e("span",{class:w(["w-3 h-3 rounded-full",i.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),a[0]||(a[0]=e("span",{class:"text-xl font-semibold"},"Recorder",-1))]),i.value?(v(),m("span",xn,"RECORDING")):$("",!0),I(pt)]),I(ot)]),e("div",yn,[e("div",_n,[I(Lt)]),e("aside",wn,[I(vn)])]),I(ge,{ref_key:"leaveDialog",ref:n,title:"Recording in Progress",message:`You are currently recording (${o.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:k(b),onCancel:k(r)},null,8,["message","onConfirm","onCancel"])])],64))}}),Cn=ae(kn,[["__scopeId","data-v-5aa79df4"]]);export{Cn as default};
