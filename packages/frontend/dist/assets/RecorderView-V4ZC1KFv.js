import{u as M}from"./recorder-qAqjxP0C.js";import{y as L,f as G,g as ee,z as Se,r as h,e as y,A as $e,d as D,B as le,h as B,T as te,j as ne,C as ie,c as p,k as R,a as e,t as x,n as w,p as ce,o as g,w as Ce,q as Re,_ as ue,D as Te,E as j,F as q,l as z,G as k,b as Ie,m as de,u as Be}from"./index-DRWQA2kW.js";const P=h(!1),O=h(!1);let F=null;function Ae(){const f=M();L(()=>f.status,a=>{P.value=a==="recording"},{immediate:!0});function i(a){if(P.value)return a.preventDefault(),a.returnValue="Recording in progress. Are you sure you want to leave?",a.returnValue}G(()=>{window.addEventListener("beforeunload",i)}),ee(()=>{window.removeEventListener("beforeunload",i)}),Se((a,d,r)=>{P.value?(F=()=>r(),O.value=!0,r(!1)):r()});function c(){O.value=!1,P.value=!1,f.stopRecording().finally(()=>{F&&(F(),F=null)})}function m(){O.value=!1,F=null}return{isGuardActive:P,showLeaveConfirmation:O,confirmLeave:c,cancelLeave:m}}const $=h(null),Q=h(!1),re=h(null),Y=h(null),Ee=10,J=2,De=25;function Le(){const f=y(()=>$.value?$.value.available_gb<J?"critical":$.value.available_gb<Ee?"warning":"ok":"unknown"),i=y(()=>$.value?$.value.available_gb>=J:!0),c=y(()=>{if(!$.value)return null;const u=$.value.available_gb*1024*1024*1024,n=De*1024*1024,o=u/n,t=Math.floor(o/3600),s=Math.floor(o%3600/60);return t>24?`${Math.floor(t/24)}d ${t%24}h`:t>0?`${t}h ${s}m`:`${s}m`}),m=y(()=>{switch(f.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),a=y(()=>$.value?f.value==="critical"?`Disk space critically low (${$.value.available_gb.toFixed(1)} GB). Cannot start recording.`:f.value==="warning"?`Low disk space (${$.value.available_gb.toFixed(1)} GB). Estimated recording time: ${c.value}`:null:null);async function d(){Q.value=!0,Y.value=null;try{const u=await $e.getDegradation();if(u.resources&&u.resources.disk_free_gb!==void 0){const n=u.resources.disk_free_gb,o=n*3;$.value={available_gb:n,total_gb:o,used_percent:100-n/o*100,recording_path:"/opt/r58-app/shared/recordings"}}return re.value=new Date,$.value}catch(u){return Y.value=u.message||"Failed to check disk space",console.error("Failed to check disk space:",u),null}finally{Q.value=!1}}async function r(){return await d(),$.value?f.value==="critical"?{ok:!1,message:`Insufficient disk space (${$.value.available_gb.toFixed(1)} GB). Need at least ${J} GB to start recording.`}:f.value==="warning"?{ok:!0,message:`Low disk space warning: ${$.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${c.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:$,isLoading:Q,lastCheck:re,error:Y,status:f,statusColor:m,canStartRecording:i,estimatedRecordingTime:c,warningMessage:a,checkDiskSpace:d,preflightCheck:r}}const A=h(localStorage.getItem("r58_audio_feedback")!=="false");let X=null;function Me(){return X||(X=new(window.AudioContext||window.webkitAudioContext)),X}function I(f,i,c="sine",m=.3){if(A.value)try{const a=Me();a.state==="suspended"&&a.resume();const d=a.createOscillator(),r=a.createGain();d.connect(r),r.connect(a.destination),d.type=c,d.frequency.value=f;const u=a.currentTime;r.gain.setValueAtTime(0,u),r.gain.linearRampToValueAtTime(m,u+.01),r.gain.linearRampToValueAtTime(0,u+i),d.start(u),d.stop(u+i)}catch(a){console.warn("Audio feedback failed:",a)}}function Ne(){A.value&&(I(440,.1,"sine",.2),setTimeout(()=>I(554,.1,"sine",.2),100),setTimeout(()=>I(659,.15,"sine",.25),200))}function je(){A.value&&(I(880,.08,"sine",.3),setTimeout(()=>I(880,.15,"sine",.3),120))}function Pe(){A.value&&(I(659,.1,"sine",.25),setTimeout(()=>I(554,.1,"sine",.2),100),setTimeout(()=>I(440,.15,"sine",.2),200))}function Fe(){A.value&&(I(200,.15,"square",.15),setTimeout(()=>I(180,.2,"square",.15),180))}function Ge(){A.value&&(I(1e3,.08,"sine",.2),setTimeout(()=>I(1e3,.08,"sine",.2),150))}function oe(){A.value&&I(1200,.03,"sine",.1)}function Ve(f=50){if(A.value&&"vibrate"in navigator)try{navigator.vibrate(f)}catch{}}function fe(){function f(c){A.value=c,localStorage.setItem("r58_audio_feedback",String(c))}function i(){f(!A.value),A.value&&oe()}return{enabled:A,setEnabled:f,toggle:i,playSuccess:Ne,playError:Fe,playWarning:Ge,playClick:oe,playRecordStart:je,playRecordStop:Pe,vibrate:Ve}}const We={class:"bg-r58-bg-secondary rounded-lg shadow-xl max-w-md w-full p-6"},Oe={class:"text-lg font-semibold mb-2"},Ue={class:"text-r58-text-secondary mb-6"},qe={class:"flex justify-end gap-3"},ge=D({__name:"ConfirmDialog",props:{title:{},message:{},confirmText:{},cancelText:{},danger:{type:Boolean}},emits:["confirm","cancel"],setup(f,{expose:i,emit:c}){const m=c,a=h(!1);function d(){a.value=!0}function r(){a.value=!1}function u(){m("confirm"),r()}function n(){m("cancel"),r()}return i({open:d,close:r}),(o,t)=>(g(),le(ie,{to:"body"},[B(te,{name:"fade"},{default:ne(()=>[a.value?(g(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ce(n,["self"])},[e("div",We,[e("h2",Oe,x(f.title),1),e("p",Ue,x(f.message),1),e("div",qe,[e("button",{onClick:n,class:"btn"},x(f.cancelText||"Cancel"),1),e("button",{onClick:u,class:w(["btn",f.danger?"btn-danger":"btn-primary"])},x(f.confirmText||"Confirm"),3)])])])):R("",!0)]),_:1})]))}}),ze={class:"bg-r58-bg-secondary rounded-lg shadow-xl max-w-md w-full p-6"},He=["placeholder"],Ke={class:"text-xs text-r58-text-secondary mt-2"},Qe=D({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(f,{emit:i}){const c=f,m=i,a=h(""),d=h(null),r=y(()=>{const b=new Date,l=b.toLocaleDateString("en-CA"),v=b.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${l}_${v}`}),u=y(()=>c.suggestedName||r.value);L(()=>c.open,b=>{b&&(a.value=u.value,setTimeout(()=>{var l,v;(l=d.value)==null||l.focus(),(v=d.value)==null||v.select()},100))});function n(){m("confirm",a.value.trim()||u.value)}function o(){m("skip")}function t(){m("cancel")}function s(b){b.key==="Enter"?n():b.key==="Escape"&&t()}return(b,l)=>(g(),le(ie,{to:"body"},[B(te,{name:"fade"},{default:ne(()=>[f.open?(g(),p("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:ce(t,["self"]),onKeydown:s},[e("div",ze,[l[1]||(l[1]=e("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),l[2]||(l[2]=e("p",{class:"text-r58-text-secondary text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),Ce(e("input",{ref_key:"inputRef",ref:d,"onUpdate:modelValue":l[0]||(l[0]=v=>a.value=v),type:"text",placeholder:u.value,class:"w-full px-4 py-2 bg-r58-bg-tertiary border border-r58-bg-tertiary rounded-lg text-r58-text-primary placeholder-r58-text-secondary focus:outline-none focus:ring-2 focus:ring-r58-accent-primary"},null,8,He),[[Re,a.value]]),e("p",Ke," Suggested: "+x(u.value),1),e("div",{class:"flex justify-between mt-6"},[e("button",{onClick:o,class:"text-sm text-r58-text-secondary hover:text-r58-text-primary transition-colors"}," Skip (use default) "),e("div",{class:"flex gap-3"},[e("button",{onClick:t,class:"btn"}," Cancel "),e("button",{onClick:n,class:"btn btn-primary"}," Start Recording ")])])])],32)):R("",!0)]),_:1})]))}}),Ye=ue(Qe,[["__scopeId","data-v-df8c0a50"]]),Je={class:"flex items-center gap-4"},Xe={key:0,class:"font-mono text-xl text-r58-accent-danger"},Ze=["disabled","title"],et={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},tt={key:0,class:"w-3 h-3 bg-white rounded-sm"},nt={key:1,class:"w-3 h-3 bg-white rounded-full"},st={class:"text-xs text-r58-text-secondary hidden md:inline"},at=D({__name:"RecorderControls",setup(f){const i=M(),{register:c}=Te(),{preflightCheck:m,status:a,canStartRecording:d}=Le(),{playRecordStart:r,playRecordStop:u,playError:n,playWarning:o,vibrate:t}=fe(),s=h(null),b=h(!1),l=h(!1),v=h(!1),_=h(!1),E=h(void 0),S=y(()=>i.status==="recording"),N=y(()=>i.status==="starting"),V=y(()=>i.status==="stopping"),H=y(()=>i.formattedDuration),pe=y(()=>N.value||V.value||l.value),me=y(()=>N.value?"Starting recording...":V.value?"Stopping recording...":l.value?"Checking disk space...":!S.value&&!d.value?"Insufficient disk space":"");let K=null;G(()=>{K=c({key:" ",description:"Toggle Recording",action:be,context:"recorder",enabled:()=>!N.value&&!V.value})}),ee(()=>{K&&K()});async function be(){S.value?ae():await W()}async function W(C){l.value=!0;try{const T=await m();if(!T.ok){n(),t(200),j.error("Cannot start recording",T.message||"Preflight check failed");return}if(T.message&&a.value==="warning"&&(o(),j.warning("Low disk space",T.message)),_.value&&!C){E.value=void 0,v.value=!0;return}await se(C||E.value)}finally{l.value=!1}}async function se(C){try{await i.startRecording(C);const T=C||i.sessionId;r(),t([50,30,50]),j.success("Recording started",`Session: ${T}`)}catch(T){n(),t(200),j.error("Failed to start recording",T.message||"Unknown error",{label:"Retry",onClick:()=>W(C)})}}function he(C){v.value=!1,E.value=C,W(C)}function ye(){v.value=!1,E.value=void 0,W()}function xe(){v.value=!1,l.value=!1}async function _e(){try{await i.stopRecording(),u(),t(100),j.success("Recording stopped",`Duration: ${H.value}`)}catch(C){n(),t(200),j.error("Failed to stop recording",C.message||"Unknown error")}}function ae(){var C;b.value=!1,(C=s.value)==null||C.open(),setTimeout(()=>{b.value=!0},500)}function we(){b.value&&_e()}async function ke(){S.value?ae():await se()}return(C,T)=>(g(),p(q,null,[e("div",Je,[S.value?(g(),p("div",Xe,x(H.value),1)):R("",!0),e("button",{onClick:ke,disabled:pe.value,class:w(["flex items-center gap-2 px-6 py-2 rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",[S.value?"bg-r58-accent-danger hover:bg-red-600 text-white":"bg-r58-accent-success hover:bg-green-600 text-white"]]),title:me.value||(S.value?"Stop Recording (Space)":"Start Recording (Space)")},[N.value||V.value||l.value?(g(),p("span",et)):(g(),p(q,{key:1},[S.value?(g(),p("span",tt)):(g(),p("span",nt))],64)),e("span",null,x(l.value?"Checking...":S.value?"Stop":"Start Recording"),1)],10,Ze),e("span",st,[T[0]||(T[0]=z(" Press ",-1)),T[1]||(T[1]=e("kbd",{class:"px-1 py-0.5 bg-r58-bg-tertiary rounded text-xs font-mono"},"Space",-1)),z(" to "+x(S.value?"stop":"start"),1)])]),B(ge,{ref_key:"stopConfirmDialog",ref:s,title:"Stop Recording?",message:`You have been recording for ${H.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:we},null,8,["message"]),B(Ye,{open:v.value,onConfirm:he,onSkip:ye,onCancel:xe},null,8,["open"])],64))}}),U=h(localStorage.getItem("r58_performance_mode")==="true"),Z=h(localStorage.getItem("r58_performance_mode_auto")!=="false"),rt=3,ot=100,lt=500;function ve(){const f=M(),i=y(()=>U.value?!0:Z.value&&f.isRecording?f.inputs.filter(s=>s.isRecording).length>=rt:!1),c=y(()=>i.value?lt:ot);L(i,t=>{t?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function m(t){U.value=t,localStorage.setItem("r58_performance_mode",String(t))}function a(t){Z.value=t,localStorage.setItem("r58_performance_mode_auto",String(t))}function d(){m(!U.value)}function r(t,s){let b=0,l=null;return(...v)=>{const _=Date.now(),E=s??c.value,S=_-b;S>=E?(b=_,t(...v)):l||(l=window.setTimeout(()=>{b=Date.now(),l=null,t(...v)},E-S))}}function u(t,s){let b=null;return(...l)=>{b&&clearTimeout(b),b=window.setTimeout(()=>{t(...l),b=null},s??c.value)}}function n(t){return i.value?window.setTimeout(()=>t(performance.now()),c.value):requestAnimationFrame(t)}function o(t){i.value?clearTimeout(t):cancelAnimationFrame(t)}return{enabled:U,autoEnable:Z,isActive:i,updateInterval:c,setEnabled:m,setAutoEnable:a,toggle:d,throttle:r,debounce:u,requestFrame:n,cancelFrame:o}}const it=["title"],ct={class:"flex items-center gap-1.5 text-sm"},ut={key:0,class:"flex items-center gap-1.5 text-sm"},dt={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},ft={class:"font-mono"},gt=D({__name:"RecordingHealth",setup(f,{expose:i}){const c=M(),{isActive:m}=ve(),a=h({}),d=h(0),r=h(0),u=h(0);let n=null;function o(){const v={};let _=0;c.inputs.forEach(S=>{v[S.id]=S.bytesWritten;const N=a.value[S.id]||0;_+=S.bytesWritten-N});const E=m.value?2:1;d.value=Math.round(_/(1024*1024)/E*10)/10,a.value=v}L(()=>c.isRecording,v=>{if(v){a.value={},d.value=0,r.value=0,u.value=0;const _=m.value?2e3:1e3;n=window.setInterval(o,_)}else n&&(clearInterval(n),n=null)},{immediate:!0}),L(m,v=>{if(c.isRecording&&n){clearInterval(n);const _=v?2e3:1e3;n=window.setInterval(o,_)}}),ee(()=>{n&&clearInterval(n)});const t=y(()=>c.isRecording?u.value>0||r.value>90?"critical":d.value<1||r.value>70?"warning":"healthy":"idle"),s=y(()=>{switch(t.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});y(()=>{switch(t.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const b=y(()=>{if(!c.isRecording)return"Not recording";const v=[`Write speed: ${d.value} MB/s`,`Buffer: ${r.value}%`];return u.value>0&&v.push(`Frames dropped: ${u.value}`),v.join(`
`)});function l(v){v.buffer_percent!==void 0&&(r.value=v.buffer_percent),v.frames_dropped!==void 0&&(u.value=v.frames_dropped)}return i({updateFromMetrics:l}),(v,_)=>k(c).isRecording?(g(),p("div",{key:0,class:w(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":s.value==="emerald","bg-amber-500/10":s.value==="amber","bg-red-500/10":s.value==="red"}]),title:b.value},[e("span",{class:w(["w-2 h-2 rounded-full",s.value==="emerald"?"bg-emerald-500":"",s.value==="amber"?"bg-amber-500 animate-pulse":"",s.value==="red"?"bg-red-500 animate-pulse":""])},null,2),e("div",ct,[_[0]||(_[0]=e("svg",{class:"w-3.5 h-3.5 text-r58-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),e("span",{class:w(["font-mono",s.value==="emerald"?"text-emerald-400":"",s.value==="amber"?"text-amber-400":"",s.value==="red"?"text-red-400":""])},x(d.value)+" MB/s ",3)]),r.value>0?(g(),p("div",ut,[_[1]||(_[1]=e("span",{class:"text-r58-text-secondary"},"Buf:",-1)),e("span",{class:w(["font-mono",r.value<50?"text-emerald-400":"",r.value>=50&&r.value<80?"text-amber-400":"",r.value>=80?"text-red-400":""])},x(r.value)+"% ",3)])):R("",!0),u.value>0?(g(),p("div",dt,[_[2]||(_[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",ft,x(u.value)+" dropped",1)])):R("",!0)],10,it)):R("",!0)}}),vt={class:"relative w-full h-full bg-black"},pt={key:0,class:"absolute inset-0 flex items-center justify-center bg-black/50"},mt={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/80"},bt={class:"text-center text-r58-text-secondary"},ht={class:"text-sm"},yt=D({__name:"InputPreview",props:{inputId:{},protocol:{}},setup(f){const i=f,c=M(),m=y(()=>c.status==="recording"),a=h(null),d=h(!0),r=h(null);function u(){return`${window.location.origin}/api/v1/whep/${i.inputId}/whep`}let n=null;async function o(){if(a.value){n&&(n.close(),n=null),d.value=!0,r.value=null;try{const t=u(),s=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"}]});n=s,s.ontrack=_=>{a.value&&_.streams[0]&&(a.value.srcObject=_.streams[0],d.value=!1)},s.oniceconnectionstatechange=()=>{(s.iceConnectionState==="failed"||s.iceConnectionState==="disconnected")&&(r.value="Connection lost")},s.addTransceiver("video",{direction:"recvonly"}),s.addTransceiver("audio",{direction:"recvonly"});const b=await s.createOffer();await s.setLocalDescription(b);const l=await fetch(t,{method:"POST",headers:{"Content-Type":"application/sdp"},body:b.sdp});if(!l.ok)throw new Error(`WHEP request failed: ${l.status}`);const v=await l.text();await s.setRemoteDescription({type:"answer",sdp:v})}catch(t){console.error("WHEP playback error:",t),r.value=t instanceof Error?t.message:"Failed to connect",d.value=!1}}}return G(()=>{o()}),L(()=>i.inputId,()=>{o()}),L(m,(t,s)=>{s&&!t&&r.value?(console.log("[InputPreview] Recording stopped, reconnecting preview..."),o()):!s&&t&&(console.log("[InputPreview] Recording started, will try to reconnect preview after delay..."),setTimeout(()=>{m.value&&(console.log("[InputPreview] Attempting to reconnect preview during recording..."),o())},2e3))}),(t,s)=>(g(),p("div",vt,[e("video",{ref_key:"videoRef",ref:a,autoplay:"",muted:"",playsinline:"",class:"w-full h-full object-contain"},null,512),d.value?(g(),p("div",pt,[...s[0]||(s[0]=[e("div",{class:"animate-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full"},null,-1)])])):R("",!0),r.value?(g(),p("div",mt,[e("div",bt,[e("p",ht,x(r.value),1),e("button",{onClick:o,class:"mt-2 text-xs text-r58-accent-primary hover:underline"}," Retry ")])])):R("",!0)]))}}),xt={key:0,class:"h-full flex items-center justify-center"},_t=["title"],wt={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},kt={class:"flex items-center justify-between"},St={class:"flex items-center gap-2"},$t={class:"font-medium"},Ct={key:0,class:"flex items-center gap-2 text-sm"},Rt={class:"text-r58-text-secondary"},Tt={key:0,class:"mt-2 flex items-center justify-between"},It={class:"text-sm font-mono text-r58-text-secondary"},Bt=D({__name:"InputGrid",setup(f){const i=M(),c=y(()=>i.inputs.filter(n=>n.hasSignal));function m(n){return n.isRecording?"border-r58-accent-danger ring-2 ring-r58-accent-danger/20":n.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-r58-bg-tertiary/50 opacity-60"}function a(n){return n.hasSignal?n.framerate>=29?"excellent":n.framerate>=24?"good":"unstable":"none"}function d(n){switch(a(n)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-r58-text-secondary"}}function r(n){if(n===0)return"0 B";const o=1024,t=["B","KB","MB","GB"],s=Math.floor(Math.log(n)/Math.log(o));return parseFloat((n/Math.pow(o,s)).toFixed(1))+" "+t[s]}function u(n){if(!n.hasSignal)return`${n.label}: No signal detected`;const o=[`${n.label}`,`Resolution: ${n.resolution}`,`Framerate: ${n.framerate} fps`,`Quality: ${a(n)}`];return n.isRecording&&o.push(`Written: ${r(n.bytesWritten)}`),o.join(`
`)}return(n,o)=>c.value.length===0?(g(),p("div",xt,[...o[0]||(o[0]=[Ie('<div class="text-center text-r58-text-secondary"><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg><p class="text-lg font-medium">No Video Sources Connected</p><p class="text-sm mt-2">Connect HDMI cables to begin recording</p></div>',1)])])):(g(),p("div",{key:1,class:w(["h-full grid gap-4",c.value.length===1?"grid-cols-1":"grid-cols-2"])},[(g(!0),p(q,null,de(c.value,t=>(g(),p("div",{key:t.id,class:w(["relative rounded-lg overflow-hidden border-2 transition-all cursor-pointer aspect-video bg-black",m(t)]),title:u(t)},[B(yt,{"input-id":t.id,class:"w-full h-full"},null,8,["input-id"]),e("div",wt,[e("div",kt,[e("div",St,[e("span",{class:w(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":a(t)==="excellent"||a(t)==="good","bg-amber-500 animate-pulse":a(t)==="unstable","bg-r58-text-secondary":a(t)==="none"}])},null,2),e("span",$t,x(t.label),1)]),t.hasSignal?(g(),p("div",Ct,[e("span",Rt,x(t.resolution),1),e("span",{class:w(d(t))},x(t.framerate)+"fps",3)])):R("",!0)]),t.isRecording?(g(),p("div",Tt,[o[1]||(o[1]=e("div",{class:"flex items-center gap-2 text-r58-accent-danger"},[e("span",{class:"w-2 h-2 rounded-full bg-r58-accent-danger animate-recording"}),e("span",{class:"text-sm font-medium"},"REC")],-1)),e("span",It,x(r(t.bytesWritten)),1)])):R("",!0)])],10,_t))),128))],2))}}),At={class:"space-y-4"},Et={class:"flex items-center justify-between py-2 cursor-pointer"},Dt=["aria-checked"],Lt={class:"flex items-center justify-between py-2 cursor-pointer"},Mt=["aria-checked"],Nt={class:"flex items-center justify-between py-2 cursor-pointer"},jt={class:"text-xs text-r58-text-secondary"},Pt={key:0,class:"text-amber-400"},Ft=["aria-checked"],Gt={class:"flex items-center justify-between py-2 pl-4 cursor-pointer opacity-80"},Vt=["aria-checked"],Wt=D({__name:"SettingsPanel",setup(f){const{enabled:i,toggle:c,playClick:m}=fe(),{enabled:a,autoEnable:d,isActive:r,setEnabled:u,setAutoEnable:n}=ve(),o=h(!1);function t(){o.value=!o.value,o.value?(document.body.classList.add("touch-mode"),localStorage.setItem("r58_touch_mode","true")):(document.body.classList.remove("touch-mode"),localStorage.setItem("r58_touch_mode","false"))}G(()=>{const b=localStorage.getItem("r58_touch_mode")==="true";o.value=b,b&&document.body.classList.add("touch-mode")});function s(){c(),i.value&&m()}return(b,l)=>(g(),p("div",At,[l[7]||(l[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide"}," Interface Settings ",-1)),e("label",Et,[l[2]||(l[2]=e("div",null,[e("span",{class:"text-r58-text-primary"},"Audio Feedback"),e("p",{class:"text-xs text-r58-text-secondary"},"Play sounds for recording start/stop")],-1)),e("button",{onClick:s,class:w(["relative w-12 h-7 rounded-full transition-colors",k(i)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":k(i)},[e("span",{class:w(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",k(i)?"translate-x-6":"translate-x-1"])},null,2)],10,Dt)]),e("label",Lt,[l[3]||(l[3]=e("div",null,[e("span",{class:"text-r58-text-primary"},"Touch Mode"),e("p",{class:"text-xs text-r58-text-secondary"},"Larger buttons for touchscreen")],-1)),e("button",{onClick:t,class:w(["relative w-12 h-7 rounded-full transition-colors",o.value?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":o.value},[e("span",{class:w(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",o.value?"translate-x-6":"translate-x-1"])},null,2)],10,Mt)]),e("label",Nt,[e("div",null,[l[5]||(l[5]=e("span",{class:"text-r58-text-primary"},"Performance Mode",-1)),e("p",jt,[l[4]||(l[4]=z(" Reduce UI updates during recording ",-1)),k(r)&&!k(a)?(g(),p("span",Pt,"(auto-enabled)")):R("",!0)])]),e("button",{onClick:l[0]||(l[0]=v=>k(u)(!k(a))),class:w(["relative w-12 h-7 rounded-full transition-colors",k(a)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":k(a)},[e("span",{class:w(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",k(a)?"translate-x-6":"translate-x-1"])},null,2)],10,Ft)]),e("label",Gt,[l[6]||(l[6]=e("div",null,[e("span",{class:"text-sm text-r58-text-primary"},"Auto-enable when recording 3+ inputs")],-1)),e("button",{onClick:l[1]||(l[1]=v=>k(n)(!k(d))),class:w(["relative w-10 h-6 rounded-full transition-colors",k(d)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":k(d)},[e("span",{class:w(["absolute top-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform",k(d)?"translate-x-4":"translate-x-0.5"])},null,2)],10,Vt)])]))}}),Ot={class:"space-y-6"},Ut={key:0,class:"card"},qt={class:"space-y-2"},zt={class:"flex justify-between"},Ht={class:"flex justify-between"},Kt={class:"font-mono"},Qt={class:"flex justify-between"},Yt={class:"card"},Jt={class:"space-y-3"},Xt={class:"flex items-center gap-2"},Zt={key:0,class:"text-sm text-r58-text-secondary"},en={key:0,class:"text-r58-accent-danger"},tn={key:1},nn={key:1,class:"text-sm text-r58-text-secondary"},sn={class:"card"},an={class:"space-y-2"},rn=["disabled","title"],on={key:0,class:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-r58-bg-tertiary text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none"},ln={key:0,class:"card"},cn=D({__name:"SessionInfo",setup(f){const i=Be(),c=M(),m=y(()=>c.currentSession),a=y(()=>c.activeInputs),d=y(()=>c.isRecording),r=h(!1);function u(o){if(o===0)return"0 B";const t=1024,s=["B","KB","MB","GB","TB"],b=Math.floor(Math.log(o)/Math.log(t));return parseFloat((o/Math.pow(t,b)).toFixed(2))+" "+s[b]}function n(){i.push({name:"admin",query:{tab:"settings"}})}return(o,t)=>(g(),p("div",Ot,[m.value?(g(),p("div",Ut,[t[4]||(t[4]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Current Session",-1)),e("div",qt,[e("div",zt,[t[1]||(t[1]=e("span",{class:"text-r58-text-secondary"},"Started",-1)),e("span",null,x(m.value.startedAt.toLocaleTimeString()),1)]),e("div",Ht,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"Duration",-1)),e("span",Kt,x(k(c).formattedDuration),1)]),e("div",Qt,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Inputs",-1)),e("span",null,x(a.value.length)+" active",1)])])])):R("",!0),e("div",Yt,[t[5]||(t[5]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Input Status",-1)),e("div",Jt,[(g(!0),p(q,null,de(k(c).inputs,s=>(g(),p("div",{key:s.id,class:"flex items-center justify-between py-2 border-b border-r58-bg-tertiary last:border-0"},[e("div",Xt,[e("span",{class:w(["w-2 h-2 rounded-full",s.hasSignal?"bg-r58-accent-success":"bg-r58-text-secondary"])},null,2),e("span",{class:w(s.hasSignal?"":"text-r58-text-secondary")},x(s.label),3)]),s.hasSignal?(g(),p("div",Zt,[s.isRecording?(g(),p("span",en,x(u(s.bytesWritten)),1)):(g(),p("span",tn,x(s.resolution),1))])):(g(),p("span",nn,"No signal"))]))),128))])]),e("div",sn,[t[7]||(t[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Quick Actions",-1)),e("div",an,[e("button",{onClick:n,class:"btn w-full justify-center disabled:opacity-50 disabled:cursor-not-allowed group relative",disabled:d.value,title:d.value?"Cannot configure while recording":"Open input configuration"},[t[6]||(t[6]=z(" Configure Inputs ",-1)),d.value?(g(),p("span",on," Stop recording first ")):R("",!0)],8,rn),e("button",{onClick:t[0]||(t[0]=s=>r.value=!r.value),class:"btn w-full justify-center"},x(r.value?"Hide Settings":"Interface Settings"),1)])]),B(te,{name:"slide-fade"},{default:ne(()=>[r.value?(g(),p("div",ln,[B(Wt)])):R("",!0)]),_:1})]))}}),un=ue(cn,[["__scopeId","data-v-8910ebdc"]]),dn={class:"h-full flex flex-col"},fn={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},gn={class:"flex items-center gap-4"},vn={class:"flex items-center gap-2"},pn={key:0,class:"badge badge-danger"},mn={class:"flex-1 flex overflow-hidden"},bn={class:"flex-1 p-4"},hn={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},_n=D({__name:"RecorderView",setup(f){const i=M(),{showLeaveConfirmation:c,confirmLeave:m,cancelLeave:a}=Ae(),d=y(()=>i.status==="recording"),r=y(()=>i.formattedDuration);G(async()=>{await i.fetchInputs(),await i.fetchStatus()});const u=h(null);return L(c,n=>{var o,t;n?(o=u.value)==null||o.open():(t=u.value)==null||t.close()}),(n,o)=>(g(),p("div",dn,[e("header",fn,[e("div",gn,[e("div",vn,[e("span",{class:w(["w-3 h-3 rounded-full",d.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),o[0]||(o[0]=e("span",{class:"text-xl font-semibold"},"Recorder",-1))]),d.value?(g(),p("span",pn,"RECORDING")):R("",!0),B(gt)]),B(at)]),e("div",mn,[e("div",bn,[B(Bt)]),e("aside",hn,[B(un)])]),B(ge,{ref_key:"leaveDialog",ref:u,title:"Recording in Progress",message:`You are currently recording (${r.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:k(m),onCancel:k(a)},null,8,["message","onConfirm","onCancel"])]))}});export{_n as default};
