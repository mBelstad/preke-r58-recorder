import{X as Fe,r as v,l as U,b as le,d as re,K as pe,c,f as D,e,q as oe,P as Oe,B as de,y as ie,F as te,z as se,t as $,n as q,s as X,L as He,j as F,k as i,Y as De,H as ue,Z as Te,o as ge,_ as fe,g as ne,T as he,w as ke,W as Ae,p as We,G as Ue,u as Ke,$ as qe,V as $e,v as Ne,i as ze}from"./index-DmBbGiO-.js";import{b as Le,a as we,o as Ge,c as Xe,V as me,g as je,d as Pe,e as Me,f as Ve,h as Ye,i as Qe,j as Ze}from"./vdoninja-Ozf9EHAV.js";import{u as Je,P as et,C as tt,p as ot,M as nt}from"./ModeLoadingScreen-H7DQ8mx7.js";import"./AnimatedBackground-Cjmy2OHl.js";const Q=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],be=Fe("streaming",()=>{const f=v([]),y=v(!1),s=v(null),m=v("alpha"),l=v(null),O=v(null),k=v(null),h=v({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),S=U(()=>f.value.find(r=>r.id===s.value)),j=U(()=>f.value.filter(r=>r.enabled)),n=U(()=>Q),x=U(()=>{const r=window.location.hostname,M=r==="localhost"||r==="127.0.0.1",H=M?"localhost":"app.itagenten.no";return{rtmp:M?"rtmp://localhost:1935/mixer_program":"rtmp://app.itagenten.no:1935/mixer_program",rtsp:M?"rtsp://localhost:8554/mixer_program":"rtsp://app.itagenten.no:8554/mixer_program",srt:M?"srt://localhost:8890?streamid=read:mixer_program":"srt://app.itagenten.no:8890?streamid=read:mixer_program",hls:`https://${H}/hls/mixer_program/index.m3u8`,whep:`https://${H}/mixer_program/whep`}});function u(r,M){const H=Q.find(ae=>ae.id===r);if(!H)throw new Error(`Unknown platform: ${r}`);const J={id:`dest-${Date.now()}`,platformId:r,name:M||H.name,streamKey:"",enabled:!1};return f.value.push(J),J}function w(r,M){const H=f.value.findIndex(J=>J.id===r);H!==-1&&(f.value[H]={...f.value[H],...M})}function P(r){const M=f.value.findIndex(H=>H.id===r);M!==-1&&f.value.splice(M,1),s.value===r&&(s.value=null)}function A(r){s.value=r}function N(r){h.value.enabled=r}function I(r){h.value={...h.value,...r}}function B(){y.value=!0}function W(){y.value=!1}function K(r){const M=Q.find(H=>H.id===r.platformId);return M?r.platformId==="custom"?`${r.name}${r.streamKey}`:`${M.rtmpBaseUrl}${r.streamKey}`:""}function R(){const r=window.location.hostname;return`srt://${r==="localhost"||r==="127.0.0.1"?"localhost":"app.itagenten.no"}:${h.value.port}?streamid=read:${h.value.streamId}`}function g(){try{const r=localStorage.getItem("r58-streaming-destinations");if(r){const M=JSON.parse(r);f.value=M.destinations||[],M.srtOutput&&(h.value={...h.value,...M.srtOutput}),M.programOutputMode&&(m.value=M.programOutputMode)}}catch(r){console.warn("Failed to load saved streaming destinations:",r)}}function b(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:f.value,srtOutput:h.value,programOutputMode:m.value}))}catch(r){console.warn("Failed to save streaming destinations:",r)}}async function L(){try{const r=j.value;if(r.length===0)return console.warn("[Streaming] No enabled destinations to stream to"),{success:!1,message:"No destinations configured"};const M=r.map(ae=>{var ve;return{platform:ae.platformId,rtmp_url:((ve=Q.find(xe=>xe.id===ae.platformId))==null?void 0:ve.rtmpBaseUrl)||"",stream_key:ae.streamKey,enabled:!0}}),H=await fetch(await le("/api/streaming/rtmp/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinations:M})}),J=await H.json();if(!H.ok)throw new Error(J.detail||"Failed to start RTMP relay");return console.log("[Streaming] RTMP relay configured via MediaMTX runOnReady:",J),{success:!0,message:J.message||`Streaming to ${r.length} destination(s)`}}catch(r){const M=r instanceof Error?r.message:"Failed to start RTMP relay";return console.error("[Streaming] Failed to start RTMP relay:",r),{success:!1,message:M}}}async function p(){try{const r=await fetch(await le("/api/streaming/rtmp/stop"),{method:"POST"}),M=await r.json();if(!r.ok)throw new Error(M.detail||"Failed to stop RTMP relay");return console.log("[Streaming] RTMP relay stopped"),{success:!0,message:"RTMP relay stopped"}}catch(r){const M=r instanceof Error?r.message:"Failed to stop RTMP relay";return console.error("[Streaming] Failed to stop RTMP relay:",r),{success:!1,message:M}}}async function t(){try{const r=await fetch(await le("/api/streaming/status"));if(!r.ok)throw new Error("Failed to get streaming status");return await r.json()}catch(r){return console.error("[Streaming] Failed to get streaming status:",r),null}}async function o(){try{const r=await fetch(await le("/api/streaming/stats"));if(!r.ok)throw new Error("Failed to get streaming stats");return await r.json()}catch(r){return console.error("[Streaming] Failed to get streaming stats:",r),null}}function a(r){m.value=r,b()}function G(r){r?l.value||(l.value=Date.now()):l.value=null}return g(),{destinations:f,isStreaming:y,activeDestinationId:s,srtOutput:h,programOutputMode:m,streamStartTime:l,streamStatus:O,streamStats:k,activeDestination:S,enabledDestinations:j,platforms:n,programOutputUrls:x,addDestination:u,updateDestination:w,removeDestination:P,setActiveDestination:A,toggleSrtOutput:N,updateSrtConfig:I,startStreaming:B,stopStreaming:W,setProgramOutputMode:a,markStreamActive:G,buildRtmpUrl:K,getSrtOutputUrl:R,saveDestinations:b,loadSavedDestinations:g,startRtmpRelay:L,stopRtmpRelay:p,getStreamingStatus:t,getStreamingStats:o}}),st={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},at={class:"relative bg-preke-bg-elevated border border-preke-bg-surface rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},rt={class:"p-6 overflow-y-auto max-h-[60vh]"},lt={key:0,class:"mb-8 p-6 bg-gradient-to-br from-amber-600/20 to-red-600/20 rounded-xl border border-amber-500/30"},it={class:"flex gap-3 mb-4"},ut=["placeholder"],ct={class:"text-xs text-preke-text-dim"},dt=["href"],pt={class:"mb-8"},mt={class:"flex items-center justify-between mb-4"},gt={key:0,class:"mb-4 p-4 bg-preke-bg-surface rounded-lg"},vt={class:"grid grid-cols-2 gap-2"},ft=["onClick"],bt={class:"text-xl"},xt={key:1,class:"space-y-3"},ht=["onClick"],kt={class:"text-xl"},yt={class:"flex-1"},wt={class:"font-medium"},_t={class:"text-xs text-preke-text-dim"},St=["onClick"],Ct=["onClick"],$t={key:2,class:"text-preke-text-dim text-sm"},Pt={key:1,class:"mb-8 p-4 bg-preke-bg-surface rounded-lg"},Mt={class:"text-lg font-medium mb-4"},Rt={class:"space-y-4"},Ot=["placeholder"],Dt={key:0},Tt={class:"flex gap-2"},Ut={class:"mb-8"},Lt={class:"space-y-3"},jt={class:"p-3 bg-preke-bg-surface rounded-lg"},Vt={class:"flex items-center justify-between mb-1"},It={class:"text-xs text-preke-text-dim break-all"},Et={class:"p-3 bg-preke-bg-surface rounded-lg"},Bt={class:"flex items-center justify-between mb-1"},Ft={class:"text-xs text-preke-text-dim break-all"},Ht={class:"p-3 bg-preke-bg-surface rounded-lg"},At={class:"flex items-center justify-between mb-1"},Wt={class:"text-xs text-preke-text-dim break-all"},Kt={class:"p-3 bg-preke-bg-surface rounded-lg"},qt={class:"flex items-center justify-between mb-1"},Nt={class:"text-xs text-preke-text-dim break-all"},zt={class:"p-3 bg-preke-bg-surface rounded-lg"},Gt={class:"flex items-center justify-between mb-1"},Xt={class:"text-xs text-preke-text-dim break-all"},Yt={class:"mb-8"},Qt={class:"p-4 bg-preke-bg-surface rounded-lg space-y-3"},Zt={class:"flex items-center gap-3 text-sm"},Jt=["checked"],eo={class:"flex items-center gap-3 text-sm"},to=["checked"],oo={class:"p-4 bg-preke-bg-surface rounded-lg"},no={class:"flex items-center gap-3 mb-4"},so=re({__name:"StreamingSettings",setup(f,{expose:y}){const s=be(),m=v(!1),l=v(null),O=v(!1),k=v("youtube"),h=v("");v(""),v("");const S=U(()=>s.destinations),j=U(()=>Q),n=U(()=>s.programOutputUrls),x=U(()=>s.programOutputMode);function u(){m.value=!0}function w(){m.value=!1,l.value=null,O.value=!1}function P(p){const t=s.addDestination(p);l.value=t,O.value=!1,s.saveDestinations()}function A(){l.value&&(s.updateDestination(l.value.id,l.value),s.saveDestinations(),l.value=null,F.success("Streaming destination saved"))}function N(p){s.removeDestination(p),s.saveDestinations(),F.info("Destination removed")}function I(p){s.updateDestination(p.id,{enabled:!p.enabled}),s.saveDestinations()}function B(p,t){navigator.clipboard.writeText(p),F.success(`${t} copied to clipboard`)}function W(p){const t=Q.find(o=>o.id===p);return(t==null?void 0:t.icon)||"ðŸ“¡"}function K(p){const t=Q.find(o=>o.id===p);return(t==null?void 0:t.name)||"Unknown"}function R(){const p=Q.find(t=>t.id===k.value);return(p==null?void 0:p.streamKeyPlaceholder)||"Enter stream key"}function g(){switch(k.value){case"youtube":return"https://support.google.com/youtube/answer/2907883";case"twitch":return"https://help.twitch.tv/s/article/twitch-stream-key-faq";case"facebook":return"https://www.facebook.com/help/587160588142067";case"restream":return"https://support.restream.io/en/";default:return"#"}}function b(){if(!h.value.trim()){F.error("Please enter your stream key");return}const p=s.addDestination(k.value);s.updateDestination(p.id,{streamKey:h.value,enabled:!0}),s.saveDestinations(),h.value="",F.success(`${K(k.value)} configured and enabled!`)}function L(p){s.setProgramOutputMode(p),F.success(`Program output mode set to ${p==="alpha"?"Alpha publish":"WHIP output"}`)}return y({open:u}),(p,t)=>{var o;return i(),pe(He,{to:"body"},[m.value?(i(),c("div",st,[e("div",{class:"absolute inset-0 bg-black/60",onClick:w}),e("div",at,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-preke-bg-surface"},[t[15]||(t[15]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:w,class:"text-preke-text-dim hover:text-preke-text text-2xl"}," Ã— ")]),e("div",rt,[S.value.length===0?(i(),c("section",lt,[t[18]||(t[18]=e("h3",{class:"text-xl font-semibold mb-2 flex items-center gap-2"}," ðŸ”´ Quick Setup: Stream to YouTube ",-1)),t[19]||(t[19]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Get streaming in seconds! Just paste your stream key below. ",-1)),e("div",it,[oe(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>k.value=a),class:"px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg text-base"},[...t[16]||(t[16]=[e("option",{value:"youtube"},"â–¶ï¸ YouTube Live",-1),e("option",{value:"twitch"},"ðŸ“º Twitch",-1),e("option",{value:"facebook"},"ðŸ“˜ Facebook",-1),e("option",{value:"restream"},"ðŸ”„ Restream",-1)])],512),[[Oe,k.value]]),oe(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>h.value=a),type:"password",placeholder:R(),class:"flex-1 px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg font-mono text-base focus:border-amber-500 focus:outline-none"},null,8,ut),[[de,h.value]]),e("button",{onClick:b,class:"px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg font-semibold transition-colors"}," Save & Enable ")]),e("p",ct,[t[17]||(t[17]=ie(" ðŸ”’ Your stream key is stored locally on this device and never sent to any server. ",-1)),e("a",{href:g(),target:"_blank",class:"text-amber-400 hover:underline ml-2"}," Where do I find my stream key? â†’ ",8,dt)])])):D("",!0),e("section",pt,[e("div",mt,[t[20]||(t[20]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[2]||(t[2]=a=>O.value=!O.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),O.value?(i(),c("div",gt,[t[21]||(t[21]=e("p",{class:"text-sm text-preke-text-dim mb-3"},"Select a streaming platform:",-1)),e("div",vt,[(i(!0),c(te,null,se(j.value,a=>(i(),c("button",{key:a.id,onClick:G=>P(a.id),class:"flex items-center gap-2 p-3 bg-preke-bg-elevated hover:bg-preke-gold/20 rounded-lg transition-colors text-left"},[e("span",bt,$(a.icon),1),e("span",null,$(a.name),1)],8,ft))),128))])])):D("",!0),S.value.length>0?(i(),c("div",xt,[(i(!0),c(te,null,se(S.value,a=>(i(),c("div",{key:a.id,class:"flex items-center gap-3 p-3 bg-preke-bg-surface rounded-lg"},[e("button",{onClick:G=>I(a),class:q(["w-10 h-6 rounded-full transition-colors relative",a.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:q(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",a.enabled?"left-5":"left-1"])},null,2)],10,ht),e("span",kt,$(W(a.platformId)),1),e("div",yt,[e("div",wt,$(a.name),1),e("div",_t,$(a.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+a.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:G=>l.value={...a},class:"text-preke-gold hover:underline text-sm"}," Edit ",8,St),e("button",{onClick:G=>N(a.id),class:"text-preke-red hover:underline text-sm"}," Remove ",8,Ct)]))),128))])):(i(),c("p",$t," No streaming destinations configured. Add a platform above. "))]),l.value?(i(),c("section",Pt,[e("h3",Mt," Edit "+$(K(l.value.platformId)),1),e("div",Rt,[e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Display Name",-1)),oe(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>l.value.name=a),type:"text",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none"},null,512),[[de,l.value.name]])]),e("div",null,[t[23]||(t[23]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Stream Key",-1)),oe(e("input",{"onUpdate:modelValue":t[4]||(t[4]=a=>l.value.streamKey=a),type:"password",placeholder:(o=X(Q).find(a=>a.id===l.value.platformId))==null?void 0:o.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,8,Ot),[[de,l.value.streamKey]]),t[24]||(t[24]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),l.value.platformId==="custom"?(i(),c("div",Dt,[t[25]||(t[25]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"RTMP URL",-1)),oe(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>l.value.name=a),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,512),[[de,l.value.name]])])):D("",!0),e("div",Tt,[e("button",{onClick:A,class:"btn btn-primary"}," Save "),e("button",{onClick:t[6]||(t[6]=a=>l.value=null),class:"btn"}," Cancel ")])])])):D("",!0),e("section",Ut,[t[34]||(t[34]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[35]||(t[35]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",Lt,[e("div",jt,[e("div",Vt,[t[26]||(t[26]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[7]||(t[7]=a=>B(n.value.srt,"SRT URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",It,$(n.value.srt),1),t[27]||(t[27]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",Et,[e("div",Bt,[t[28]||(t[28]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[8]||(t[8]=a=>B(n.value.rtmp,"RTMP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Ft,$(n.value.rtmp),1)]),e("div",Ht,[e("div",At,[t[29]||(t[29]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[9]||(t[9]=a=>B(n.value.rtsp,"RTSP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Wt,$(n.value.rtsp),1)]),e("div",Kt,[e("div",qt,[t[30]||(t[30]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[10]||(t[10]=a=>B(n.value.hls,"HLS URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Nt,$(n.value.hls),1),t[31]||(t[31]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",zt,[e("div",Gt,[t[32]||(t[32]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[11]||(t[11]=a=>B(n.value.whep,"WHEP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Xt,$(n.value.whep),1),t[33]||(t[33]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",Yt,[t[39]||(t[39]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output Mode",-1)),e("div",Qt,[e("label",Zt,[e("input",{type:"radio",name:"program-output-mode",value:"alpha",checked:x.value==="alpha",onChange:t[12]||(t[12]=a=>L("alpha"))},null,40,Jt),t[36]||(t[36]=e("span",null,"Alpha publish mode (`&publish&mediamtx=`)",-1))]),e("label",eo,[e("input",{type:"radio",name:"program-output-mode",value:"whipout",checked:x.value==="whipout",onChange:t[13]||(t[13]=a=>L("whipout"))},null,40,to),t[37]||(t[37]=e("span",null,"WHIP output mode (`&whipout=`)",-1))]),t[38]||(t[38]=e("p",{class:"text-xs text-preke-text-dim"}," Alpha publish mode matches the newest VDO.Ninja alpha workflow and is recommended for MediaMTX. ",-1))])]),e("section",null,[t[42]||(t[42]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",oo,[e("div",no,[e("button",{onClick:t[14]||(t[14]=a=>X(s).toggleSrtOutput(!X(s).srtOutput.enabled)),class:q(["w-10 h-6 rounded-full transition-colors relative",X(s).srtOutput.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:q(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",X(s).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[40]||(t[40]=e("span",null,"Enable SRT Output",-1))]),t[41]||(t[41]=e("div",{class:"text-sm text-preke-text-dim"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-preke-bg-surface"},[e("button",{onClick:w,class:"btn"},"Close")])])])):D("",!0)])}}}),ao={class:"program-output space-y-3","data-testid":"program-output"},ro={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface rounded-lg","data-testid":"program-output-status"},lo={class:"text-sm font-medium","data-testid":"program-output-text"},io={key:0,class:"space-y-2"},uo={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},co={class:"flex-1 text-xs truncate text-preke-text-dim"},po={key:0,class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},mo={class:"text-xs text-preke-text-dim"},go={key:1,class:"text-xs text-preke-text-dim px-3"},vo={class:"hidden"},fo=["src"],bo=re({__name:"ProgramOutput",setup(f){const y=De(),s=be(),m=v(!1),l=v("idle"),O=v(""),k=v(null),h=v(null);let S=null;const j=U(()=>s.programOutputMode==="alpha");function n(){return"https://app.itagenten.no/mixer_program/whip"}async function x(){if(m.value)return;l.value="connecting";const R=j.value?await Le():await we(n());if(!R){l.value="error",console.error("[ProgramOutput] Failed to build VDO.ninja URL - VDO.ninja not configured");return}O.value=R,m.value=!0,console.log("[ProgramOutput] Starting program output:",R)}function u(){m.value&&(m.value=!1,O.value="",l.value="idle",k.value=null,h.value=null,I(),console.log("[ProgramOutput] Stopped WHIP push"))}function w(){m.value&&(l.value="live",console.log("[ProgramOutput] WHIP push connected"))}function P(){l.value="error",console.error("[ProgramOutput] WHIP push failed")}async function A(){u(),await new Promise(R=>setTimeout(R,500)),await x()}ue(()=>y.isLive,async R=>{R?(await x(),N()):u()});function N(){S||(S=setInterval(async()=>{try{const R=await s.getStreamingStatus();if(!R)return;k.value=R,h.value=R.error||null,R.mixer_program_active?l.value="live":R.error?l.value="error":m.value&&(l.value="connecting")}catch(R){h.value=R instanceof Error?R.message:"Status polling failed"}},2e3))}function I(){S&&(clearInterval(S),S=null)}Te(()=>{I()});function B(){switch(l.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function W(){switch(l.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function K(){const R=s.programOutputUrls.srt;navigator.clipboard.writeText(R),F.success("SRT URL copied")}return(R,g)=>(i(),c("div",ao,[e("div",ro,[e("span",{class:q(["w-2 h-2 rounded-full",B()]),"data-testid":"program-output-indicator"},null,2),e("span",lo,$(W()),1),l.value==="error"?(i(),c("button",{key:0,onClick:g[0]||(g[0]=b=>A()),class:"ml-auto text-xs text-preke-gold hover:underline"}," Retry ")):D("",!0)]),l.value==="live"?(i(),c("div",io,[e("div",uo,[g[1]||(g[1]=e("span",{class:"text-xs text-preke-text-dim"},"ðŸ”´ SRT:",-1)),e("code",co,$(X(s).programOutputUrls.srt),1),e("button",{onClick:K,class:"text-xs text-preke-gold hover:underline"},"Copy")]),X(s).enabledDestinations.length>0?(i(),c("div",po,[g[2]||(g[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",mo,$(X(s).enabledDestinations.length)+" streaming destination"+$(X(s).enabledDestinations.length>1?"s":"")+" active ",1)])):D("",!0)])):D("",!0),l.value==="idle"?(i(),c("p",go," Program output will start automatically when you go live. ")):D("",!0),e("div",vo,[m.value&&O.value?(i(),c("iframe",{key:0,src:O.value,onLoad:w,onError:P,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,fo)):D("",!0)])]))}}),xo={class:"stream-health space-y-3"},ho={class:"flex items-center gap-2"},ko={class:"text-sm font-medium"},yo={key:0,class:"text-xs text-preke-green"},wo={class:"grid grid-cols-2 gap-3 text-xs text-preke-text-dim"},_o={class:"flex items-center justify-between bg-preke-bg-surface/50 rounded-md px-3 py-2"},So={class:"text-preke-text"},Co={class:"flex items-center justify-between bg-preke-bg-surface/50 rounded-md px-3 py-2"},$o={class:"text-preke-text"},Po={class:"flex items-center justify-between bg-preke-bg-surface/50 rounded-md px-3 py-2"},Mo={class:"text-preke-text"},Ro={class:"flex items-center justify-between bg-preke-bg-surface/50 rounded-md px-3 py-2"},Oo={class:"text-preke-text"},Do={class:"flex items-center justify-between bg-preke-bg-surface/50 rounded-md px-3 py-2"},To={class:"text-preke-text"},Uo={key:0,class:"text-xs text-preke-text-dim bg-preke-bg-surface/50 rounded-md px-3 py-2"},Lo={class:"block truncate text-preke-text"},jo={key:1,class:"text-xs text-preke-text-dim bg-preke-bg-surface/50 rounded-md px-3 py-2"},Vo={class:"flex items-center justify-between gap-2"},Io={class:"block truncate text-preke-text"},Eo={key:2,class:"text-xs text-preke-red bg-preke-bg-surface/50 rounded-md px-3 py-2"},Bo=re({__name:"StreamHealthMonitor",setup(f){const y=be(),s=v(Date.now()),m=v(null),l=v(null);let O=null,k=null;const h=v(""),S=U(()=>{var g;return((g=m.value)==null?void 0:g.mixer_program_active)===!0}),j=U(()=>{var g;return((g=m.value)==null?void 0:g.rtmp_relay_configured)===!0}),n=U(()=>{var g;return((g=m.value)==null?void 0:g.run_on_ready)||null}),x=U(()=>{var g,b;return((g=m.value)==null?void 0:g.error)||((b=l.value)==null?void 0:b.error)||null}),u=U(()=>{var b,L;const g=((b=l.value)==null?void 0:b.bitrate_bps)||((L=l.value)==null?void 0:L.bitrate)||null;return typeof g=="number"?g:null}),w=U(()=>{var g,b,L,p;return((g=l.value)==null?void 0:g.resolution)||((p=(L=(b=l.value)==null?void 0:b.source)==null?void 0:L.video)==null?void 0:p.resolution)||null}),P=U(()=>{var g,b,L,p;return((g=l.value)==null?void 0:g.fps)||((p=(L=(b=l.value)==null?void 0:b.source)==null?void 0:L.video)==null?void 0:p.fps)||null}),A=U(()=>{const g=y.streamStartTime;if(!g)return"â€”";const b=s.value-g;if(b<0)return"â€”";const L=Math.floor(b/1e3),p=Math.floor(L/3600),t=Math.floor(L%3600/60),o=L%60;return p>0?`${p}:${t.toString().padStart(2,"0")}:${o.toString().padStart(2,"0")}`:`${t}:${o.toString().padStart(2,"0")}`}),N=U(()=>{if(!u.value)return"â€”";const g=u.value/1e3;return g<1e3?`${g.toFixed(0)} kbps`:`${(g/1e3).toFixed(2)} Mbps`}),I=U(()=>S.value?u.value?u.value>=2e6?"Good":u.value>=8e5?"Fair":"Poor":"Connecting":"Offline");async function B(){const g=await y.getStreamingStatus();g&&(m.value=g,y.streamStatus=g,y.markStreamActive(g.mixer_program_active===!0));const b=await y.getStreamingStats();b&&(l.value=b,y.streamStats=b)}async function W(){const b=y.programOutputMode==="alpha"?await Le():await we("https://app.itagenten.no/mixer_program/whip");h.value=b||""}function K(){O||(O=setInterval(B,2e3))}function R(){O&&(clearInterval(O),O=null)}return ge(()=>{B(),W(),K(),k=setInterval(()=>{s.value=Date.now()},1e3)}),Te(()=>{R(),k&&(clearInterval(k),k=null)}),ue(S,g=>{y.markStreamActive(g)}),ue(()=>y.programOutputMode,()=>{W()}),(g,b)=>(i(),c("div",xo,[e("div",ho,[e("span",{class:q(["w-2 h-2 rounded-full",S.value?"bg-emerald-500":"bg-gray-500"])},null,2),e("span",ko,$(S.value?"Program output active":"Program output inactive"),1),j.value?(i(),c("span",yo,"RTMP relay on")):D("",!0)]),e("div",wo,[e("div",_o,[b[1]||(b[1]=e("span",null,"Duration",-1)),e("span",So,$(A.value),1)]),e("div",Co,[b[2]||(b[2]=e("span",null,"Quality",-1)),e("span",$o,$(I.value),1)]),e("div",Po,[b[3]||(b[3]=e("span",null,"Bitrate",-1)),e("span",Mo,$(N.value),1)]),e("div",Ro,[b[4]||(b[4]=e("span",null,"Resolution",-1)),e("span",Oo,$(w.value||"â€”"),1)]),e("div",Do,[b[5]||(b[5]=e("span",null,"FPS",-1)),e("span",To,$(P.value||"â€”"),1)])]),n.value?(i(),c("div",Uo,[b[6]||(b[6]=e("span",{class:"block text-preke-text-muted"},"RTMP relay",-1)),e("code",Lo,$(n.value),1)])):D("",!0),h.value?(i(),c("div",jo,[e("div",Vo,[b[7]||(b[7]=e("span",{class:"text-preke-text-muted"},"Program output URL",-1)),e("button",{class:"text-preke-gold hover:underline",onClick:b[0]||(b[0]=L=>g.navigator.clipboard.writeText(h.value))}," Copy ")]),e("code",Io,$(h.value),1)])):D("",!0),x.value?(i(),c("div",Eo,$(x.value),1)):D("",!0)]))}}),Fo=fe(Bo,[["__scopeId","data-v-9e82c88e"]]),Ho={class:"streaming-control-panel"},Ao={class:"control-bar"},Wo={key:0,class:"control-bar__room"},Ko={class:"control-bar__room-name"},qo={key:0,class:"control-bar__camera-count"},No={key:1,class:"control-bar__divider"},zo={class:"control-bar__status"},Go={class:"control-bar__status-text"},Xo={key:0,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},Yo={key:1,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},Qo={key:3,class:"control-bar__destinations"},Zo={class:"control-bar__destinations-list"},Jo=["title"],en={key:0,class:"quick-setup"},tn={class:"quick-setup__form"},on={class:"quick-setup__platform"},nn={class:"quick-setup__platform-icon"},sn={class:"quick-setup__input-wrap"},an=["placeholder"],rn={key:0,class:"px-4 py-3"},ln={class:"hidden"},un=re({__name:"StreamingControlPanel",props:{roomName:{default:""},cameraCount:{default:0}},setup(f){const y=f,s=De(),m=be(),l=v(null),O=v(null),k=v(!1),h=v("youtube"),S=v(""),j=U(()=>s.isLive),n=U(()=>m.destinations.length>0),x=U(()=>m.enabledDestinations.length>0),u=U(()=>j.value?"live":"idle");function w(){j.value?A():P()}async function P(){if(s.setLive(!0),m.enabledDestinations.length>0){const t=await m.startRtmpRelay();t.success?F.success(t.message):F.error(`RTMP relay failed: ${t.message}`)}else F.success("Streaming started (no RTMP destinations configured)")}async function A(){if(s.setLive(!1),m.enabledDestinations.length>0){const t=await m.stopRtmpRelay();t.success||F.warning(`Note: ${t.message}`)}F.info("Streaming stopped")}function N(){Ge(0)?F.success("Program window opened"):F.error("Popup blocked - please allow popups for this site")}async function I(){const o=await we("https://app.itagenten.no/mixer_program/whip");if(!o){F.error("Failed to build scene output URL");return}window.open(o,"vdo-scene-output","width=1280,height=720,menubar=no,toolbar=no")?F.success("Scene output window opened - streaming to MediaMTX"):F.error("Popup blocked - please allow popups for this site")}async function B(){const t=await Xe(0,{room:y.roomName||me});if(!t){F.error("Failed to build scene view URL");return}await navigator.clipboard.writeText(t),F.success('Scene view link copied! Open this URL, then use "Publishing setup" in the mixer to screen-share it to MediaMTX')}function W(){var t;(t=l.value)==null||t.open()}function K(){k.value=!k.value}function R(){if(!S.value.trim()){F.error("Please enter your stream key");return}if(!Q.find(a=>a.id===h.value))return;const o=m.destinations.find(a=>a.platformId===h.value);if(o)m.updateDestination(o.id,{streamKey:S.value,enabled:!0});else{const a=m.addDestination(h.value);m.updateDestination(a.id,{streamKey:S.value,enabled:!0})}m.saveDestinations(),k.value=!1,S.value="",P()}function g(){const t=Q.find(o=>o.id===h.value);return(t==null?void 0:t.streamKeyPlaceholder)||"Enter your stream key"}function b(){const t=Q.find(o=>o.id===h.value);return(t==null?void 0:t.icon)||"ðŸ“¡"}function L(){switch(u.value){case"live":return"control-bar__dot--live";case"connecting":return"control-bar__dot--connecting";case"error":return"control-bar__dot--error";default:return"control-bar__dot--idle"}}function p(){switch(u.value){case"live":return"LIVE";case"connecting":return"Connecting...";case"error":return"Error";default:return"Offline"}}return(t,o)=>(i(),c("div",Ho,[e("div",Ao,[y.roomName?(i(),c("div",Wo,[o[3]||(o[3]=e("span",{class:"control-bar__room-label"},"Room",-1)),e("span",Ko,$(y.roomName),1),y.cameraCount>0?(i(),c("span",qo,$(y.cameraCount)+" cam"+$(y.cameraCount!==1?"s":""),1)):D("",!0)])):D("",!0),y.roomName?(i(),c("div",No)):D("",!0),e("div",zo,[e("span",{class:q(["control-bar__dot",L()])},null,2),e("span",Go,$(p()),1)]),o[12]||(o[12]=e("div",{class:"control-bar__divider"},null,-1)),e("button",{onClick:w,class:q(["control-bar__btn",j.value?"control-bar__btn--stop":"control-bar__btn--start"])},[j.value?(i(),c("svg",Xo,[...o[4]||(o[4]=[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"},null,-1)])])):(i(),c("svg",Yo,[...o[5]||(o[5]=[e("path",{d:"M8 5.14v14l11-7-11-7z"},null,-1)])])),ie(" "+$(j.value?"Stop":"Start Streaming"),1)],2),n.value?D("",!0):(i(),c("button",{key:2,onClick:K,class:q(["control-bar__btn control-bar__btn--dashed",k.value?"control-bar__btn--active":""])},[...o[6]||(o[6]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})],-1),ie(" Add Stream Key ",-1)])],2)),e("button",{onClick:N,class:"control-bar__btn control-bar__btn--secondary",title:"Open program output in new window"},[...o[7]||(o[7]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),ie(" Watch ",-1)])]),e("button",{onClick:I,class:"control-bar__btn control-bar__btn--secondary",title:"Open scene output window - pushes mixed scene to MediaMTX for streaming (uses &whipout parameter)"},[...o[8]||(o[8]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),ie(" Scene Output ",-1)])]),e("button",{onClick:B,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Copy scene view link - open this URL, then use 'Publishing setup' to screen-share it to MediaMTX"},[...o[9]||(o[9]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})],-1)])]),e("button",{onClick:W,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Configure streaming destinations"},[...o[10]||(o[10]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])]),x.value?(i(),c("div",Qo,[o[11]||(o[11]=e("span",{class:"control-bar__destinations-label"},"To:",-1)),e("div",Zo,[(i(!0),c(te,null,se(X(m).enabledDestinations,a=>(i(),c("span",{key:a.id,class:"control-bar__destination",title:a.name},$(a.platformId==="youtube"?"â–¶ï¸":a.platformId==="twitch"?"ðŸ“º":"ðŸ”´"),9,Jo))),128))])])):D("",!0)]),ne(he,{name:"slide"},{default:ke(()=>[k.value?(i(),c("div",en,[e("div",tn,[e("div",on,[e("span",nn,$(b()),1),oe(e("select",{"onUpdate:modelValue":o[0]||(o[0]=a=>h.value=a),class:"quick-setup__select"},[...o[13]||(o[13]=[e("option",{value:"youtube"},"YouTube",-1),e("option",{value:"twitch"},"Twitch",-1),e("option",{value:"facebook"},"Facebook",-1),e("option",{value:"restream"},"Restream",-1)])],512),[[Oe,h.value]])]),e("div",sn,[oe(e("input",{"onUpdate:modelValue":o[1]||(o[1]=a=>S.value=a),type:"password",placeholder:g(),class:"quick-setup__input",onKeyup:Ae(R,["enter"])},null,40,an),[[de,S.value]])]),e("button",{onClick:R,class:"quick-setup__go-live"}," ðŸ”´ Go Live "),e("button",{onClick:o[2]||(o[2]=a=>k.value=!1),class:"quick-setup__cancel"},"âœ•")])])):D("",!0)]),_:1}),j.value?(i(),c("div",rn,[ne(Fo)])):D("",!0),e("div",ln,[ne(bo,{ref_key:"programOutputRef",ref:O},null,512)]),ne(so,{ref_key:"streamingSettingsRef",ref:l},null,512)]))}}),cn=fe(un,[["__scopeId","data-v-3a2ce3ea"]]),ye="vdo-debug",dn=500,ee=[];let _e=typeof localStorage<"u"&&localStorage.getItem(ye)==="true";function Re(f){_e=f,typeof localStorage<"u"&&(f?localStorage.setItem(ye,"true"):localStorage.removeItem(ye)),console.log(`[VDO.ninja Debug] ${f?"Enabled":"Disabled"}`)}function ce(f){if(ee.push(f),ee.length>dn&&ee.shift(),_e){const y=new Date(f.timestamp).toISOString().split("T")[1].slice(0,-1),s=f.direction==="outgoing"?"âž¡ï¸ OUT":"â¬…ï¸ IN",m=f.direction==="outgoing"?"color: #3b82f6; font-weight: bold":"color: #22c55e; font-weight: bold";console.groupCollapsed(`%c[VDO.ninja ${s}] %c${f.type}`,m,"color: inherit"),console.log("Time:",y),f.target&&console.log("Target:",f.target),console.log("Data:",f.data),f.raw&&f.raw!==f.data&&console.log("Raw:",f.raw),console.groupEnd()}}function Ie(){return[...ee]}function pn(){ee.length=0,console.log("[VDO.ninja Debug] Event history cleared")}function Ee(){const f={total:ee.length,incoming:0,outgoing:0,byType:{},lastActivity:ee.length>0?ee[ee.length-1].timestamp:null};for(const y of ee)y.direction==="incoming"?f.incoming++:f.outgoing++,f.byType[y.type]=(f.byType[y.type]||0)+1;return f}typeof window<"u"&&(window.__VDO_DEBUG__={getHistory:Ie,clearHistory:pn,getStats:Ee,enable:()=>Re(!0),disable:()=>Re(!1),isEnabled:()=>_e});function mn(f){const y=v(!1),s=v(new Map),m=v(0),l=v(null),O=v(!1),k=v("disconnected"),h=v(null),S=je(),j=new Map;function n(d,C,_,z){var T;if(!((T=f.value)!=null&&T.contentWindow)){console.warn("[VDO.ninja] Cannot send command - iframe not ready"),h.value="iframe not ready";return}const E={action:d};C&&(E.target=C),_!==void 0&&(E.value=_),z!==void 0&&(E.value2=z),ce({timestamp:Date.now(),direction:"outgoing",type:d,target:C,data:{action:d,target:C,value:_,value2:z},raw:E});try{f.value.contentWindow.postMessage(E,"*")}catch(V){console.error("[VDO.ninja] Failed to send command:",V),h.value=String(V)}}function x(d,C){var z;if(!((z=f.value)!=null&&z.contentWindow)){console.warn("[VDO.ninja] Cannot send DOM command - iframe not ready");return}const _={action:"",target:d,...C};ce({timestamp:Date.now(),direction:"outgoing",type:"dom-manipulation",target:d,data:C,raw:_});try{f.value.contentWindow.postMessage(_,"*")}catch(E){console.error("[VDO.ninja] Failed to send DOM command:",E)}}function u(d,C=1){var E;const _=j.get(d)||d;if(_!==d&&console.log(`[VDO.ninja] Resolved UUID ${d} to stream ID ${_} for addToScene`),!((E=f.value)!=null&&E.contentWindow)){console.warn("[VDO.ninja] Cannot send addToScene - iframe not ready");return}const z={addToScene:C,target:_};ce({timestamp:Date.now(),direction:"outgoing",type:"addToScene",target:_,data:{sceneNumber:C},raw:z});try{f.value.contentWindow.postMessage(z,"*"),l.value=C}catch(T){console.error("[VDO.ninja] Failed to send addToScene:",T)}}function w(d,C=1){var E;const _=j.get(d)||d;if(!((E=f.value)!=null&&E.contentWindow)){console.warn("[VDO.ninja] Cannot send removeFromScene - iframe not ready");return}const z={removeFromScene:C,target:_};ce({timestamp:Date.now(),direction:"outgoing",type:"removeFromScene",target:_,data:{sceneNumber:C},raw:z});try{f.value.contentWindow.postMessage(z,"*")}catch(T){console.error("[VDO.ninja] Failed to send removeFromScene:",T)}}function P(d){x(d,{replace:!0})}function A(d){x(d,{add:!0})}function N(d){x(d,{remove:!0})}function I(d,C){n("mic",d,!C);const _=s.value.get(d);_&&(_.muted=C)}function B(d){n("mic",d,"toggle");const C=s.value.get(d);C&&(C.muted=!C.muted)}function W(d,C){n("volume",d,Math.max(0,Math.min(200,C)))}function K(d){n("soloChat",d)}function R(d){n("soloChatBidirectional",d)}function g(d,C){n("sendChat",d,C)}function b(d,C){n("sendDirectorChat",d,C)}function L(d){n("hangup",d),s.value.delete(d)}function p(d){d?n("togglescreenshare",d):n("togglescreenshare")}function t(d,C){n("forward",d,C)}function o(d="guests"){n("getGuestList",void 0,void 0)}function a(){n("record",void 0,!0),O.value=!0}function G(){n("record",void 0,!1),O.value=!1}function r(d){n("layout",void 0,d)}function M(d){d?n("reload",d):n("reload")}function H(d,C){n("mixorder",d,C==="up"?-1:1)}function J(d){n("camera",void 0,d)}function ae(d,C){n("camera",d,C)}function ve(d,C=!1){C?n("zoom",void 0,d,"abs"):n("zoom",void 0,d)}function xe(d){n("pan",void 0,d)}function Be(d){n("tilt",void 0,d)}function Se(d){const C=d.origin;if(!C.includes(S.split(":")[0])&&!C.includes("vdo.ninja")&&!C.includes("vdo.itagenten")&&!C.includes("localhost"))return;const _=d.data;if(!_||typeof _!="object")return;const z=_.type||_.action||"unknown",E=_.streamID||_.UUID||_.streamId;switch(ce({timestamp:Date.now(),direction:"incoming",type:z,target:E,data:_.data||_.value,raw:_}),z){case"director-ready":case"mixer-ready":case"loaded":case"ready":case"started":case"director":case"joined-room-complete":case"seeding-started":y.value=!0,k.value="connected",h.value=null,console.log("[VDO.ninja] Ready event received:",z);break;case"stream-id-detected":{const T=_.value||_.data,V=_.UUID;if(T){if(V){j.set(V,T),console.log(`[VDO.ninja] Stream ID mapping: ${V} -> ${T}`);const Z=s.value.get(V);Z&&(s.value.delete(V),Z.id=T,s.value.set(T,Z),m.value++,console.log(`[VDO.ninja] Updated source ID from UUID to stream ID: ${T}`))}if(!s.value.has(T)){const Z={id:T,label:_.label||T,type:"guest",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0};s.value.set(T,Z),m.value++,console.log(`[VDO.ninja] Source added via stream-id-detected: ${T}`)}}break}case"new-guest":case"guest-connected":case"push":case"view":case"joined":case"new-push-connection":case"push-connection":case"new-view-connection":case"view-connection":{const T=_.UUID,V=_.streamID,Z=V||T||E;if(Z){T&&V&&j.set(T,V);const Y=_.data,Ce={id:Z,label:(Y==null?void 0:Y.label)||_.label||Z,type:(Y==null?void 0:Y.type)||"guest",hasVideo:(Y==null?void 0:Y.video)!==!1,hasAudio:(Y==null?void 0:Y.audio)!==!1,muted:!1,audioLevel:0};s.value.set(Z,Ce),m.value++,console.log(`[VDO.ninja] Source added: ${Z} (${Ce.label})${T&&!V?" (UUID, awaiting stream ID)":""}`)}break}case"guest-left":case"guest-disconnected":case"left":case"disconnect":E&&(s.value.delete(E),m.value++);break;case"audio-level":case"loudness":{if(E){const T=s.value.get(E);if(T){const V=_.data;T.audioLevel=(V==null?void 0:V.level)||_.value||0}}break}case"mute-state":case"muted":{if(E){const T=s.value.get(E);if(T){const V=_.data;T.muted=(V==null?void 0:V.muted)??_.value??!1}}break}case"scene-changed":case"scene":{const T=_.data,V=(T==null?void 0:T.scene)||_.value;l.value=typeof V=="number"?V:null;break}case"recording-started":O.value=!0;break;case"recording-stopped":O.value=!1;break;case"error":console.error("[VDO.ninja Error]",_.data),h.value=String(_.data);break}}return ge(()=>{k.value="connecting",window.addEventListener("message",Se),setTimeout(()=>{!y.value&&f.value&&(y.value=!0,k.value="connected")},5e3)}),We(()=>{window.removeEventListener("message",Se),k.value="disconnected"}),{isReady:y,sources:s,sourcesVersion:m,activeScene:l,isRecording:O,connectionState:k,lastError:h,addToScene:u,removeFromScene:w,setProgram:P,addSource:A,removeSource:N,setLayout:r,changeMixOrder:H,setMute:I,toggleMute:B,setVolume:W,soloAudio:K,soloChatBidirectional:R,sendToGuest:g,sendDirectorMessage:b,kickGuest:L,toggleScreenShare:p,transferGuest:t,getGuestList:o,refreshSource:M,setCamera:J,setGuestCamera:ae,zoom:ve,pan:xe,tilt:Be,startRecording:a,stopRecording:G,sendCommand:n,sendDomCommand:x,getEventHistory:Ie,getEventStats:Ee}}const gn={class:"flex items-center justify-between p-3 border-b border-preke-border"},vn={key:0,class:"text-sm font-semibold text-preke-text"},fn=["title"],bn={key:0,class:"p-3 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto"},xn={class:"grid grid-cols-3 gap-2"},hn=["onClick"],kn={class:"flex items-center justify-center gap-2"},yn={key:0,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},wn={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},_n={key:0},Sn={class:"space-y-2"},Cn={class:"flex items-center justify-between mb-1"},$n={class:"text-xs text-preke-text"},Pn=["onClick","title"],Mn={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Rn={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},On=["value","onInput"],Dn={key:1},Tn={class:"space-y-1"},Un=["onClick"],Ln={class:"flex items-center justify-between"},jn={key:1,class:"mt-2"},Vn={key:1,class:"p-2 space-y-2"},In=["title"],En=re({__name:"MixerControlPanel",props:{iframeRef:{}},emits:["close"],setup(f,{emit:y}){const s=f,m=v(null),l=mn(m);ue(()=>{var p;return(p=s.iframeRef)==null?void 0:p.value},p=>{p?(console.log("[MixerControlPanel] Iframe ref available, updating:",p),m.value=p):m.value=null},{immediate:!0}),ge(()=>{var p;(p=s.iframeRef)!=null&&p.value&&(console.log("[MixerControlPanel] On mount, iframe ref:",s.iframeRef.value),m.value=s.iframeRef.value)});const O=U(()=>l.sources.value),k=U(()=>l.isRecording.value),h=l.setLayout,S=l.toggleMute,j=l.setVolume,n=l.startRecording,x=l.stopRecording,{cameras:u}=Je(),w=v(null),P=v(!1),A=v(!1),N=v(null),I=v(!1);function B(p){var o,a,G;if(console.log("[MixerControlPanel] Switching to scene",p,"setLayout:",h,"iframeRef:",(o=s.iframeRef)==null?void 0:o.value,"dummyRef:",m.value,"vdo.isReady:",l.isReady.value),!h){console.warn("[MixerControlPanel] setLayout not available");return}if(l.isReady.value||(console.warn("[MixerControlPanel] VDO.ninja not ready yet (isReady:",l.isReady.value,"connectionState:",l.connectionState.value,")"),console.warn("[MixerControlPanel] Attempting anyway - VDO.ninja might queue the command")),!((G=(a=s.iframeRef)==null?void 0:a.value)!=null&&G.contentWindow)){console.error("[MixerControlPanel] Iframe contentWindow not available!");return}const t=p-1;console.log("[MixerControlPanel] Calling setLayout with layout number",t,"for scene",p),console.log("[MixerControlPanel] Iframe:",s.iframeRef.value,"ContentWindow:",s.iframeRef.value.contentWindow);try{h(t),N.value=p,console.log("[MixerControlPanel] setLayout called successfully")}catch(r){console.error("[MixerControlPanel] Error calling setLayout:",r)}}function W(p){console.log("[MixerControlPanel] Toggling mute for",p,"toggleMute:",S),S?S(p):console.warn("[MixerControlPanel] toggleMute not available")}function K(p,t){j&&j(p,t)}function R(){console.log("[MixerControlPanel] Recording toggle, current:",k.value,"startRecording:",n,"stopRecording:",x),k.value?x?x():console.warn("[MixerControlPanel] stopRecording not available"):n?n():console.warn("[MixerControlPanel] startRecording not available")}function g(p){w.value=p,P.value=!0}function b(){P.value=!1,w.value=null}const L=U(()=>Array.from(O.value.values()));return U(()=>u.value.filter(p=>L.value.some(t=>{var o;return((o=t.label)==null?void 0:o.toLowerCase().includes(p.name.toLowerCase()))||t.id===p.name}))),(p,t)=>(i(),c("div",{class:q(["mixer-control-panel fixed top-4 right-4 z-50 bg-preke-bg-surface border border-preke-border rounded-lg shadow-lg transition-all duration-300",I.value?"w-12":"w-80"])},[e("div",gn,[I.value?D("",!0):(i(),c("h3",vn,"Mixer Controls")),e("button",{onClick:t[0]||(t[0]=o=>I.value=!I.value),class:"p-1 rounded hover:bg-preke-bg-elevated transition-colors",title:I.value?"Expand":"Collapse"},[(i(),c("svg",{class:q(["w-4 h-4 transition-transform",{"rotate-180":I.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[4]||(t[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,fn)]),I.value?(i(),c("div",Vn,[e("button",{onClick:t[3]||(t[3]=o=>B(1)),class:"w-full aspect-square flex items-center justify-center text-xs font-bold rounded bg-preke-bg-elevated hover:bg-preke-bg-elevated/80",title:"Scene 1"}," 1 "),e("button",{onClick:R,class:q(["w-full aspect-square flex items-center justify-center rounded",k.value.value?"bg-red-600 text-white":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80"]),title:k.value.value?"Stop Recording":"Start Recording"},[...t[16]||(t[16]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"6"})],-1)])],10,In)])):(i(),c("div",bn,[e("div",null,[t[5]||(t[5]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Scenes",-1)),e("div",xn,[(i(),c(te,null,se(9,o=>e("button",{key:o,onClick:a=>B(o),class:q(["aspect-square flex items-center justify-center text-sm font-bold rounded transition-all",N.value===o?"bg-preke-purple text-white ring-2 ring-preke-purple":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 text-preke-text"])},$(o),11,hn)),64))])]),e("div",null,[t[8]||(t[8]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Recording",-1)),e("button",{onClick:R,class:q(["w-full px-4 py-2 rounded transition-all",k.value.value?"bg-red-600 hover:bg-red-700 text-white":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 text-preke-text"])},[e("span",kn,[k.value.value?(i(),c("svg",yn,[...t[6]||(t[6]=[e("circle",{cx:"12",cy:"12",r:"6"},null,-1)])])):(i(),c("svg",wn,[...t[7]||(t[7]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1)])])),ie(" "+$(k.value.value?"Stop Recording":"Start Recording"),1)])],2)]),L.value.length>0?(i(),c("div",_n,[t[11]||(t[11]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Sources",-1)),e("div",Sn,[(i(!0),c(te,null,se(L.value,o=>(i(),c("div",{key:o.id,class:"p-2 bg-preke-bg-elevated rounded"},[e("div",Cn,[e("span",$n,$(o.label||o.id),1),e("button",{onClick:a=>W(o.id),class:q(["p-1 rounded hover:bg-preke-bg-surface transition-colors",o.muted?"text-red-400":"text-preke-text-dim"]),title:o.muted?"Unmute":"Mute"},[o.muted?(i(),c("svg",Mn,[...t[9]||(t[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(i(),c("svg",Rn,[...t[10]||(t[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},null,-1)])]))],10,Pn)]),o.hasAudio?(i(),c("input",{key:0,type:"range",value:o.audioLevel||100,onInput:a=>K(o.id,Number(a.target.value)),min:"0",max:"200",class:"w-full h-1 bg-preke-bg-base rounded-lg appearance-none cursor-pointer accent-preke-gold"},null,40,On)):D("",!0)]))),128))])])):D("",!0),X(u).length>0?(i(),c("div",Dn,[t[13]||(t[13]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Camera Controls",-1)),e("div",Tn,[(i(!0),c(te,null,se(X(u),o=>(i(),c("button",{key:o.name,onClick:a=>g(o.name),class:"w-full px-3 py-2 text-left text-xs bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 rounded transition-colors"},[e("span",Ln,[e("span",null,$(o.name),1),t[12]||(t[12]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])],8,Un))),128))])])):D("",!0),e("div",null,[t[15]||(t[15]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"PTZ Controller",-1)),A.value?(i(),c("div",jn,[ne(et,{"camera-name":w.value,onClose:t[2]||(t[2]=o=>A.value=!1)},null,8,["camera-name"])])):(i(),c("button",{key:0,onClick:t[1]||(t[1]=o=>A.value=!0),class:"w-full px-3 py-2 text-left text-xs bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 rounded transition-colors"},[...t[14]||(t[14]=[e("span",{class:"flex items-center justify-between"},[e("span",null,"Open PTZ Controller"),e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})])],-1)])]))])])),P.value&&w.value?(i(),pe(tt,{key:2,"camera-name":w.value,onClose:b},null,8,["camera-name"])):D("",!0)],2))}}),Bn=fe(En,[["__scopeId","data-v-5be44a96"]]),Fn={class:"camera-push-bar border-t border-preke-bg-surface bg-preke-bg-elevated","data-testid":"camera-push-bar"},Hn={class:"flex items-center gap-2"},An={class:"text-preke-text-dim"},Wn={key:0,class:"px-4 pb-3"},Kn={key:0,class:"flex gap-3 flex-wrap"},qn={class:"text-sm font-medium"},Nn={class:"text-xs text-preke-text-dim"},zn=["onClick"],Gn={key:1,class:"text-sm text-preke-text-dim py-2"},Xn={class:"fixed -left-[9999px] -top-[9999px] w-[10px] h-[10px] overflow-hidden pointer-events-none opacity-0"},Yn=["src","onLoad","onError","title"],Qn=re({__name:"CameraPushBar",setup(f){const y=Ue(),s=v(new Map),m=v(!0),l=U(()=>y.inputs.filter(n=>n.hasSignal));ge(()=>{console.log("[CameraPush] Component mounted"),console.log("[CameraPush] Initial inputs:",y.inputs.length),console.log("[CameraPush] Initial cameras with signal:",l.value.length),console.log("[CameraPush] Inputs loaded:",y.inputsLoaded)}),ue(()=>y.inputsLoaded,n=>{if(n){console.log("[CameraPush] Inputs loaded, checking for cameras with signal");const x=l.value;x.length>0&&console.log(`[CameraPush] Found ${x.length} cameras with signal after inputs loaded`)}}),ue(l,async n=>{console.log(`[CameraPush] Cameras with signal changed: ${n.length}`,n.map(u=>u.id));for(const u of n)if(!s.value.has(u.id))try{console.log(`[CameraPush] Setting up ${u.id} (${u.label})`);const w=await Pe(u.id);if(!w){console.error(`[CameraPush] No WHEP URL for ${u.id}`);continue}console.log(`[CameraPush] WHEP URL for ${u.id}:`,w);const P=await Me(u.id,w,u.label,{useMediamtx:!1});if(!P){console.error(`[CameraPush] Failed to build contribution URL for ${u.id}`);continue}console.log(`[CameraPush] Contribution URL for ${u.id}:`,P),console.log("[CameraPush] Full URL breakdown:",{cameraId:u.id,label:u.label,whepUrl:w,iframeSrc:P.substring(0,300)+"...",room:me,password:Ve.substring(0,4)+"..."}),s.value.set(u.id,{cameraId:u.id,label:u.label,status:"connecting",iframeSrc:P})}catch(w){console.error(`[CameraPush] Error setting up ${u.id}:`,w)}const x=new Set(n.map(u=>u.id));for(const[u]of s.value)x.has(u)||s.value.delete(u)},{immediate:!0});function O(n){const x=s.value.get(n);x&&(x.status="connected",console.log(`[CameraPush] ${n} iframe loaded - URL:`,x.iframeSrc.substring(0,200)+"..."),setTimeout(()=>{var w;const u=document.querySelector(`iframe[title*="${x.label}"]`);if(u)try{(u.contentDocument||((w=u.contentWindow)==null?void 0:w.document))&&console.log(`[CameraPush] ${n} iframe document accessible`)}catch{console.log(`[CameraPush] ${n} iframe loaded (cross-origin, cannot inspect content)`)}},2e3))}function k(n){const x=s.value.get(n);x&&(x.status="error",console.error(`[CameraPush] ${n} iframe failed to load - URL:`,x.iframeSrc.substring(0,200)+"..."))}async function h(n){const x=y.inputs.find(u=>u.id===n);if(!(!x||!x.hasSignal))try{const u=await Pe(n);if(!u){console.error(`[CameraPush] No WHEP URL for ${n}`);return}const w=await Me(n,u,x.label,{useMediamtx:!1});if(!w){console.error(`[CameraPush] Failed to build contribution URL for ${n}`);return}s.value.set(n,{cameraId:n,label:x.label,status:"connecting",iframeSrc:w+`&_t=${Date.now()}`})}catch(u){console.error(`[CameraPush] Error retrying ${n}:`,u)}}function S(n){switch(n){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function j(n){switch(n){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(n,x)=>(i(),c("div",Fn,[e("button",{onClick:x[0]||(x[0]=u=>m.value=!m.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-preke-bg-surface/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[e("div",Hn,[x[1]||(x[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",An,"("+$(l.value.length)+" active)",1)]),(i(),c("svg",{class:q(["w-4 h-4 transition-transform",{"rotate-180":m.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...x[2]||(x[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),m.value?(i(),c("div",Wn,[s.value.size>0?(i(),c("div",Kn,[(i(!0),c(te,null,se(s.value,([u,w])=>(i(),c("div",{key:u,class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface rounded-lg"},[e("span",{class:q(["w-2 h-2 rounded-full",S(w.status)])},null,2),e("span",qn,$(w.label),1),e("span",Nn,$(j(w.status)),1),w.status==="error"?(i(),c("button",{key:0,onClick:P=>h(u),class:"ml-2 text-xs text-preke-gold hover:underline"}," Retry ",8,zn)):D("",!0)]))),128))])):(i(),c("div",Gn," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):D("",!0),e("div",Xn,[(i(!0),c(te,null,se(s.value,([u,w])=>(i(),c("iframe",{key:u,src:w.iframeSrc,onLoad:P=>O(u),onError:P=>k(u),allow:"camera; microphone; autoplay; display-capture",class:"w-full h-full border-0",title:`Camera push for ${w.label}`,sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"},null,40,Yn))),128))])]))}}),Zn={class:"h-full flex flex-col bg-preke-bg"},Jn={key:0,class:"px-4 py-2 bg-preke-bg-elevated border-b border-preke-bg-surface flex items-center justify-between text-xs text-preke-text-dim"},es=["title"],ts={class:"flex-1 relative"},os=["src"],ns={key:0,class:"absolute inset-0 flex items-center justify-center bg-preke-bg"},ss=["title"],as=re({__name:"MixerView",setup(f){const y=ze(),s=Ue(),m=Ke();function l(){y.push("/")}const O=v(!0),k=v(!1),h=v(!1),S=v("Starting mixer..."),j=v(void 0),n=v(void 0),x=v(null),u=v(!0),w=U(()=>qe.isElectron()),P=v(!0),A=U(()=>w.value&&P.value);function N(){if(typeof window>"u")return;const t=window.localStorage.getItem("preke_mixer_use_local_bridge");t!==null?P.value=t==="true":P.value=!0,console.log("[Mixer] Local bridge preference:",P.value)}async function I(){P.value=!P.value,typeof window<"u"&&window.localStorage.setItem("preke_mixer_use_local_bridge",String(P.value)),k.value=!1,await K()}const B=U(()=>s.inputs.filter(t=>t.hasSignal)),W=v("");async function K(){const t=!(w.value&&P.value),o=t?await Ye():null,a=await Qe({mediamtxHost:o||void 0,room:me,useMediamtx:t});if(a)W.value=a,console.log("[Mixer] Mixer URL initialized with API key");else{const G=await je()||"app.itagenten.no",r=Ze(),M=new URL(`${r}://${G}/mixer.html`);M.searchParams.set("room",me),M.searchParams.set("password",Ve),M.searchParams.set("css",`${r}://${G}/css/preke-colors.css`),W.value=M.toString(),console.warn("[Mixer] Using fallback URL without API key")}}function R(){console.log("[Mixer] VDO.ninja mixer iframe loaded"),k.value=!0,S.value="Waiting for cameras..."}function g(){O.value=!1}async function b(){const t=performance.now();S.value="Starting camera bridge...";for(let o=0;o<40;o++){try{if((await(await fetch(await le("/api/mode/status"))).json()).current_mode==="mixer"){const r=Math.round((performance.now()-t)/1e3);if(r>=5){console.log(`[Mixer] Bridge likely ready after ${r}s`),h.value=!0,S.value="Cameras connecting...";return}}}catch{}await new Promise(a=>setTimeout(a,500)),S.value=`Starting camera bridge... (${Math.round((performance.now()-t)/1e3)}s)`}console.log("[Mixer] Bridge wait timeout - continuing anyway"),h.value=!0}async function L(){var o;if(!$e())return;S.value="Checking mode...",await m.fetchCapabilities();const t=(o=m.capabilities)==null?void 0:o.current_mode;if(t&&t!=="mixer"){console.log("[Mixer] Not in mixer mode, switching..."),S.value="Switching to mixer mode...";try{(await fetch(await le("/api/mode/mixer"),{method:"POST"})).ok&&(await m.fetchCapabilities(),F.success("Switched to Mixer mode"))}catch(a){console.warn("[Mixer] Failed to switch mode:",a)}}}async function p(){if(!$e()){S.value="No device configured";return}S.value="Finding best connection...";const t=await ot(o=>{S.value=o});n.value=t.method.toUpperCase()}return ge(async()=>{const t=performance.now();w.value&&(N(),console.log("[Mixer] Electron app detected, useLocalBridge:",P.value,"showCameraPushBar:",A.value));const o=p();await Promise.all([o,L(),s.fetchInputs(),K()]),await b(),console.log(`[Mixer] Total load time: ${Math.round(performance.now()-t)}ms`)}),(t,o)=>(i(),c(te,null,[ne(he,{name:"fade"},{default:ke(()=>[O.value?(i(),pe(nt,{key:0,mode:"mixer","content-ready":k.value&&h.value,"min-time":2e3,"max-time":2e4,"show-cancel":!0,"status-text":S.value,progress:j.value,"connection-method":n.value,onReady:g,onCancel:l},null,8,["content-ready","status-text","progress","connection-method"])):D("",!0)]),_:1}),ne(he,{name:"content-fade"},{default:ke(()=>[oe(e("div",Zn,[ne(cn,{"room-name":X(me),"camera-count":B.value.length},null,8,["room-name","camera-count"]),w.value?(i(),c("div",Jn,[e("span",null,"Camera sources: "+$(P.value?"Local bridge":"External bridge"),1),e("button",{class:"text-preke-gold hover:underline",onClick:I,title:P.value?"Disable local bridge to use external fallback":"Enable local bridge for Electron"},$(P.value?"Use fallback":"Use local bridge"),9,es)])):D("",!0),e("div",ts,[e("iframe",{ref_key:"iframeRef",ref:x,src:W.value,onLoad:R,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,os),k.value?D("",!0):(i(),c("div",ns,[...o[1]||(o[1]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-8 h-8 border-2 border-preke-gold border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-preke-text-muted"},"Loading VDO.ninja mixer..."),e("span",{class:"text-xs text-preke-text-subtle"},"Cameras will appear when bridge is running")],-1)])])),k.value?(i(),c("button",{key:1,onClick:o[0]||(o[0]=a=>u.value=!u.value),class:"absolute top-4 left-4 z-40 p-2 bg-preke-bg-surface border border-preke-border rounded-lg shadow-lg hover:bg-preke-bg-elevated transition-colors",title:u.value?"Hide Controls":"Show Controls"},[...o[2]||(o[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)])],8,ss)):D("",!0),u.value&&k.value?(i(),pe(Bn,{"iframe-ref":x.value,key:k.value?"ready":"loading"},null,8,["iframe-ref"])):D("",!0)]),A.value?(i(),pe(Qn,{key:1})):D("",!0)],512),[[Ne,!O.value]])]),_:1})],64))}}),cs=fe(as,[["__scopeId","data-v-475510f8"]]);export{cs as default};
