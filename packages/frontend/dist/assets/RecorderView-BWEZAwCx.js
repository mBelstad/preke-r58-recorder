import{e as $e,r as h,f as _,g as z,w as N,h as Q,i as se,j as Re,d as j,k as ae,l as L,T as re,m as oe,p as de,c as b,q as E,a as e,t as k,n as R,s as fe,o as p,v as Ce,x as Ie,_ as ge,y as Te,z as W,F as q,A as K,B as $,C as ve}from"./index-DVhIzN-T.js";const P=$e("recorder",()=>{const d=h("idle"),r=h(null),c=h(null),g=h(0),s=h(0),l=h([{id:"cam1",label:"HDMI 1",hasSignal:!0,isRecording:!1,bytesWritten:0,resolution:"1920x1080",framerate:30},{id:"cam2",label:"HDMI 2",hasSignal:!0,isRecording:!1,bytesWritten:0,resolution:"1920x1080",framerate:30},{id:"cam3",label:"HDMI 3",hasSignal:!1,isRecording:!1,bytesWritten:0,resolution:"",framerate:0},{id:"cam4",label:"HDMI 4",hasSignal:!1,isRecording:!1,bytesWritten:0,resolution:"",framerate:0}]),u=_(()=>d.value==="recording"),o=_(()=>{const i=Math.floor(g.value/1e3),x=Math.floor(i/3600),w=Math.floor(i%3600/60),I=i%60;return`${x.toString().padStart(2,"0")}:${w.toString().padStart(2,"0")}:${I.toString().padStart(2,"0")}`}),t=_(()=>l.value.filter(i=>i.hasSignal)),a=h(null);async function n(i){d.value="starting",a.value=null;try{const x=await z.startRecording({name:i,inputs:t.value.map(w=>w.id)});r.value=x.session_id,c.value={id:x.session_id,name:i||null,startedAt:new Date(x.started_at),duration:0,inputs:l.value.filter(w=>w.hasSignal)},l.value.forEach(w=>{w.hasSignal&&(w.isRecording=!0)}),d.value="recording",m(),console.log(`[Recorder] Started recording: ${x.session_id}`)}catch(x){throw console.error("Failed to start recording:",x),a.value=x.message||"Failed to start recording",d.value="idle",x}}async function y(){d.value="stopping",a.value=null;try{const i=await z.stopRecording(r.value||void 0);return console.log(`[Recorder] Stopped recording: ${i.session_id}, duration: ${i.duration_ms}ms`),l.value.forEach(x=>{x.isRecording=!1}),c.value=null,r.value=null,g.value=0,s.value=0,d.value="idle",v&&(clearInterval(v),v=null),{duration_ms:i.duration_ms,files:i.files}}catch(i){throw console.error("Failed to stop recording:",i),a.value=i.message||"Failed to stop recording",d.value="recording",i}}async function f(){try{const i=await z.getRecorderStatus();i.status==="recording"?(d.value="recording",r.value=i.session_id||null,g.value=i.duration_ms,s.value=i.duration_ms,i.inputs.forEach(x=>{const w=l.value.find(I=>I.id===x);w&&(w.isRecording=!0)}),m()):(d.value="idle",r.value=null)}catch(i){console.error("Failed to fetch recorder status:",i)}}let v=null;function m(){v&&clearInterval(v),v=window.setInterval(()=>{c.value&&(g.value=Date.now()-c.value.startedAt.getTime())},100)}function S(i){if(i.duration_ms!==void 0&&(g.value=i.duration_ms,s.value=i.duration_ms),i.session_id&&(r.value=i.session_id),i.bytes_written)for(const[x,w]of Object.entries(i.bytes_written)){const I=l.value.find(F=>F.id===x);I&&(I.bytesWritten=w)}i.inputs&&i.inputs.forEach(x=>{const w=l.value.find(I=>I.id===x.id);w&&Object.assign(w,x)})}function M(i,x,w,I){const F=l.value.find(Y=>Y.id===i);F&&(F.hasSignal=x,w&&(F.resolution=w),I&&(F.framerate=I))}return{status:d,sessionId:r,currentSession:c,duration:g,durationMs:s,inputs:l,lastError:a,isRecording:u,formattedDuration:o,activeInputs:t,startRecording:n,stopRecording:y,fetchStatus:f,updateFromEvent:S,updateInputSignal:M}}),G=h(!1),V=h(!1);let H=null;function Ee(){const d=P();N(()=>d.status,s=>{G.value=s==="recording"},{immediate:!0});function r(s){if(G.value)return s.preventDefault(),s.returnValue="Recording in progress. Are you sure you want to leave?",s.returnValue}Q(()=>{window.addEventListener("beforeunload",r)}),se(()=>{window.removeEventListener("beforeunload",r)}),Re((s,l,u)=>{G.value?(H=()=>u(),V.value=!0,u(!1)):u()});function c(){V.value=!1,G.value=!1,d.stopRecording().finally(()=>{H&&(H(),H=null)})}function g(){V.value=!1,H=null}return{isGuardActive:G,showLeaveConfirmation:V,confirmLeave:c,cancelLeave:g}}const C=h(null),X=h(!1),ce=h(null),Z=h(null),Be=10,ee=2,Ae=25;function De(){const d=_(()=>C.value?C.value.available_gb<ee?"critical":C.value.available_gb<Be?"warning":"ok":"unknown"),r=_(()=>C.value?C.value.available_gb>=ee:!0),c=_(()=>{if(!C.value)return null;const o=C.value.available_gb*1024*1024*1024,t=Ae*1024*1024,a=o/t,n=Math.floor(a/3600),y=Math.floor(a%3600/60);return n>24?`${Math.floor(n/24)}d ${n%24}h`:n>0?`${n}h ${y}m`:`${y}m`}),g=_(()=>{switch(d.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),s=_(()=>C.value?d.value==="critical"?`Disk space critically low (${C.value.available_gb.toFixed(1)} GB). Cannot start recording.`:d.value==="warning"?`Low disk space (${C.value.available_gb.toFixed(1)} GB). Estimated recording time: ${c.value}`:null:null);async function l(){X.value=!0,Z.value=null;try{const o=await z.getDegradation();if(o.resources&&o.resources.disk_free_gb!==void 0){const t=o.resources.disk_free_gb,a=t*3;C.value={available_gb:t,total_gb:a,used_percent:100-t/a*100,recording_path:"/opt/r58-app/shared/recordings"}}return ce.value=new Date,C.value}catch(o){return Z.value=o.message||"Failed to check disk space",console.error("Failed to check disk space:",o),null}finally{X.value=!1}}async function u(){return await l(),C.value?d.value==="critical"?{ok:!1,message:`Insufficient disk space (${C.value.available_gb.toFixed(1)} GB). Need at least ${ee} GB to start recording.`}:d.value==="warning"?{ok:!0,message:`Low disk space warning: ${C.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${c.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:C,isLoading:X,lastCheck:ce,error:Z,status:d,statusColor:g,canStartRecording:r,estimatedRecordingTime:c,warningMessage:s,checkDiskSpace:l,preflightCheck:u}}const D=h(localStorage.getItem("r58_audio_feedback")!=="false");let te=null;function Me(){return te||(te=new(window.AudioContext||window.webkitAudioContext)),te}function A(d,r,c="sine",g=.3){if(D.value)try{const s=Me();s.state==="suspended"&&s.resume();const l=s.createOscillator(),u=s.createGain();l.connect(u),u.connect(s.destination),l.type=c,l.frequency.value=d;const o=s.currentTime;u.gain.setValueAtTime(0,o),u.gain.linearRampToValueAtTime(g,o+.01),u.gain.linearRampToValueAtTime(0,o+r),l.start(o),l.stop(o+r)}catch(s){console.warn("Audio feedback failed:",s)}}function Le(){D.value&&(A(440,.1,"sine",.2),setTimeout(()=>A(554,.1,"sine",.2),100),setTimeout(()=>A(659,.15,"sine",.25),200))}function je(){D.value&&(A(880,.08,"sine",.3),setTimeout(()=>A(880,.15,"sine",.3),120))}function Fe(){D.value&&(A(659,.1,"sine",.25),setTimeout(()=>A(554,.1,"sine",.2),100),setTimeout(()=>A(440,.15,"sine",.2),200))}function Ne(){D.value&&(A(200,.15,"square",.15),setTimeout(()=>A(180,.2,"square",.15),180))}function Pe(){D.value&&(A(1e3,.08,"sine",.2),setTimeout(()=>A(1e3,.08,"sine",.2),150))}function ue(){D.value&&A(1200,.03,"sine",.1)}function We(d=50){if(D.value&&"vibrate"in navigator)try{navigator.vibrate(d)}catch{}}function pe(){function d(c){D.value=c,localStorage.setItem("r58_audio_feedback",String(c))}function r(){d(!D.value),D.value&&ue()}return{enabled:D,setEnabled:d,toggle:r,playSuccess:Le,playError:Ne,playWarning:Pe,playClick:ue,playRecordStart:je,playRecordStop:Fe,vibrate:We}}const Ge={class:"bg-r58-bg-secondary rounded-lg shadow-xl max-w-md w-full p-6"},He={class:"text-lg font-semibold mb-2"},Oe={class:"text-r58-text-secondary mb-6"},Ve={class:"flex justify-end gap-3"},me=j({__name:"ConfirmDialog",props:{title:{},message:{},confirmText:{},cancelText:{},danger:{type:Boolean}},emits:["confirm","cancel"],setup(d,{expose:r,emit:c}){const g=c,s=h(!1);function l(){s.value=!0}function u(){s.value=!1}function o(){g("confirm"),u()}function t(){g("cancel"),u()}return r({open:l,close:u}),(a,n)=>(p(),ae(de,{to:"body"},[L(re,{name:"fade"},{default:oe(()=>[s.value?(p(),b("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:fe(t,["self"])},[e("div",Ge,[e("h2",He,k(d.title),1),e("p",Oe,k(d.message),1),e("div",Ve,[e("button",{onClick:t,class:"btn"},k(d.cancelText||"Cancel"),1),e("button",{onClick:o,class:R(["btn",d.danger?"btn-danger":"btn-primary"])},k(d.confirmText||"Confirm"),3)])])])):E("",!0)]),_:1})]))}}),Ue={class:"bg-r58-bg-secondary rounded-lg shadow-xl max-w-md w-full p-6"},ze=["placeholder"],qe={class:"text-xs text-r58-text-secondary mt-2"},Ke=j({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(d,{emit:r}){const c=d,g=r,s=h(""),l=h(null),u=_(()=>{const f=new Date,v=f.toLocaleDateString("en-CA"),m=f.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${v}_${m}`}),o=_(()=>c.suggestedName||u.value);N(()=>c.open,f=>{f&&(s.value=o.value,setTimeout(()=>{var v,m;(v=l.value)==null||v.focus(),(m=l.value)==null||m.select()},100))});function t(){g("confirm",s.value.trim()||o.value)}function a(){g("skip")}function n(){g("cancel")}function y(f){f.key==="Enter"?t():f.key==="Escape"&&n()}return(f,v)=>(p(),ae(de,{to:"body"},[L(re,{name:"fade"},{default:oe(()=>[d.open?(p(),b("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:fe(n,["self"]),onKeydown:y},[e("div",Ue,[v[1]||(v[1]=e("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),v[2]||(v[2]=e("p",{class:"text-r58-text-secondary text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),Ce(e("input",{ref_key:"inputRef",ref:l,"onUpdate:modelValue":v[0]||(v[0]=m=>s.value=m),type:"text",placeholder:o.value,class:"w-full px-4 py-2 bg-r58-bg-tertiary border border-r58-bg-tertiary rounded-lg text-r58-text-primary placeholder-r58-text-secondary focus:outline-none focus:ring-2 focus:ring-r58-accent-primary"},null,8,ze),[[Ie,s.value]]),e("p",qe," Suggested: "+k(o.value),1),e("div",{class:"flex justify-between mt-6"},[e("button",{onClick:a,class:"text-sm text-r58-text-secondary hover:text-r58-text-primary transition-colors"}," Skip (use default) "),e("div",{class:"flex gap-3"},[e("button",{onClick:n,class:"btn"}," Cancel "),e("button",{onClick:t,class:"btn btn-primary"}," Start Recording ")])])])],32)):E("",!0)]),_:1})]))}}),Qe=ge(Ke,[["__scopeId","data-v-df8c0a50"]]),Ye={class:"flex items-center gap-4"},Je={key:0,class:"font-mono text-xl text-r58-accent-danger"},Xe=["disabled","title"],Ze={key:0,class:"animate-spin w-4 h-4 border-2 border-white border-t-transparent rounded-full"},et={key:0,class:"w-3 h-3 bg-white rounded-sm"},tt={key:1,class:"w-3 h-3 bg-white rounded-full"},nt={class:"text-xs text-r58-text-secondary hidden md:inline"},st=j({__name:"RecorderControls",setup(d){const r=P(),{register:c}=Te(),{preflightCheck:g,status:s,canStartRecording:l}=De(),{playRecordStart:u,playRecordStop:o,playError:t,playWarning:a,vibrate:n}=pe(),y=h(null),f=h(!1),v=h(!1),m=h(!1),S=h(!1),M=h(void 0),i=_(()=>r.status==="recording"),x=_(()=>r.status==="starting"),w=_(()=>r.status==="stopping"),I=_(()=>r.formattedDuration),F=_(()=>x.value||w.value||v.value),Y=_(()=>x.value?"Starting recording...":w.value?"Stopping recording...":v.value?"Checking disk space...":!i.value&&!l.value?"Insufficient disk space":"");let J=null;Q(()=>{J=c({key:" ",description:"Toggle Recording",action:he,context:"recorder",enabled:()=>!x.value&&!w.value})}),se(()=>{J&&J()});async function he(){i.value?le():await O()}async function O(T){v.value=!0;try{const B=await g();if(!B.ok){t(),n(200),W.error("Cannot start recording",B.message||"Preflight check failed");return}if(B.message&&s.value==="warning"&&(a(),W.warning("Low disk space",B.message)),S.value&&!T){M.value=void 0,m.value=!0;return}await ie(T||M.value)}finally{v.value=!1}}async function ie(T){try{await r.startRecording(T);const B=T||r.sessionId;u(),n([50,30,50]),W.success("Recording started",`Session: ${B}`)}catch(B){t(),n(200),W.error("Failed to start recording",B.message||"Unknown error",{label:"Retry",onClick:()=>O(T)})}}function ye(T){m.value=!1,M.value=T,O(T)}function _e(){m.value=!1,M.value=void 0,O()}function xe(){m.value=!1,v.value=!1}async function we(){try{await r.stopRecording(),o(),n(100),W.success("Recording stopped",`Duration: ${I.value}`)}catch(T){t(),n(200),W.error("Failed to stop recording",T.message||"Unknown error")}}function le(){var T;f.value=!1,(T=y.value)==null||T.open(),setTimeout(()=>{f.value=!0},500)}function ke(){f.value&&we()}async function Se(){i.value?le():await ie()}return(T,B)=>(p(),b(q,null,[e("div",Ye,[i.value?(p(),b("div",Je,k(I.value),1)):E("",!0),e("button",{onClick:Se,disabled:F.value,class:R(["flex items-center gap-2 px-6 py-2 rounded-lg font-medium transition-all disabled:opacity-50 disabled:cursor-not-allowed",[i.value?"bg-r58-accent-danger hover:bg-red-600 text-white":"bg-r58-accent-success hover:bg-green-600 text-white"]]),title:Y.value||(i.value?"Stop Recording (Space)":"Start Recording (Space)")},[x.value||w.value||v.value?(p(),b("span",Ze)):(p(),b(q,{key:1},[i.value?(p(),b("span",et)):(p(),b("span",tt))],64)),e("span",null,k(v.value?"Checking...":i.value?"Stop":"Start Recording"),1)],10,Xe),e("span",nt,[B[0]||(B[0]=K(" Press ",-1)),B[1]||(B[1]=e("kbd",{class:"px-1 py-0.5 bg-r58-bg-tertiary rounded text-xs font-mono"},"Space",-1)),K(" to "+k(i.value?"stop":"start"),1)])]),L(me,{ref_key:"stopConfirmDialog",ref:y,title:"Stop Recording?",message:`You have been recording for ${I.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:ke},null,8,["message"]),L(Qe,{open:m.value,onConfirm:ye,onSkip:_e,onCancel:xe},null,8,["open"])],64))}}),U=h(localStorage.getItem("r58_performance_mode")==="true"),ne=h(localStorage.getItem("r58_performance_mode_auto")!=="false"),at=3,rt=100,ot=500;function be(){const d=P(),r=_(()=>U.value?!0:ne.value&&d.isRecording?d.inputs.filter(y=>y.isRecording).length>=at:!1),c=_(()=>r.value?ot:rt);N(r,n=>{n?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function g(n){U.value=n,localStorage.setItem("r58_performance_mode",String(n))}function s(n){ne.value=n,localStorage.setItem("r58_performance_mode_auto",String(n))}function l(){g(!U.value)}function u(n,y){let f=0,v=null;return(...m)=>{const S=Date.now(),M=y??c.value,i=S-f;i>=M?(f=S,n(...m)):v||(v=window.setTimeout(()=>{f=Date.now(),v=null,n(...m)},M-i))}}function o(n,y){let f=null;return(...v)=>{f&&clearTimeout(f),f=window.setTimeout(()=>{n(...v),f=null},y??c.value)}}function t(n){return r.value?window.setTimeout(()=>n(performance.now()),c.value):requestAnimationFrame(n)}function a(n){r.value?clearTimeout(n):cancelAnimationFrame(n)}return{enabled:U,autoEnable:ne,isActive:r,updateInterval:c,setEnabled:g,setAutoEnable:s,toggle:l,throttle:u,debounce:o,requestFrame:t,cancelFrame:a}}const it=["title"],lt={class:"flex items-center gap-1.5 text-sm"},ct={key:0,class:"flex items-center gap-1.5 text-sm"},ut={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},dt={class:"font-mono"},ft=j({__name:"RecordingHealth",setup(d,{expose:r}){const c=P(),{isActive:g}=be(),s=h({}),l=h(0),u=h(0),o=h(0);let t=null;function a(){const m={};let S=0;c.inputs.forEach(i=>{m[i.id]=i.bytesWritten;const x=s.value[i.id]||0;S+=i.bytesWritten-x});const M=g.value?2:1;l.value=Math.round(S/(1024*1024)/M*10)/10,s.value=m}N(()=>c.isRecording,m=>{if(m){s.value={},l.value=0,u.value=0,o.value=0;const S=g.value?2e3:1e3;t=window.setInterval(a,S)}else t&&(clearInterval(t),t=null)},{immediate:!0}),N(g,m=>{if(c.isRecording&&t){clearInterval(t);const S=m?2e3:1e3;t=window.setInterval(a,S)}}),se(()=>{t&&clearInterval(t)});const n=_(()=>c.isRecording?o.value>0||u.value>90?"critical":l.value<1||u.value>70?"warning":"healthy":"idle"),y=_(()=>{switch(n.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});_(()=>{switch(n.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const f=_(()=>{if(!c.isRecording)return"Not recording";const m=[`Write speed: ${l.value} MB/s`,`Buffer: ${u.value}%`];return o.value>0&&m.push(`Frames dropped: ${o.value}`),m.join(`
`)});function v(m){m.buffer_percent!==void 0&&(u.value=m.buffer_percent),m.frames_dropped!==void 0&&(o.value=m.frames_dropped)}return r({updateFromMetrics:v}),(m,S)=>$(c).isRecording?(p(),b("div",{key:0,class:R(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":y.value==="emerald","bg-amber-500/10":y.value==="amber","bg-red-500/10":y.value==="red"}]),title:f.value},[e("span",{class:R(["w-2 h-2 rounded-full",y.value==="emerald"?"bg-emerald-500":"",y.value==="amber"?"bg-amber-500 animate-pulse":"",y.value==="red"?"bg-red-500 animate-pulse":""])},null,2),e("div",lt,[S[0]||(S[0]=e("svg",{class:"w-3.5 h-3.5 text-r58-text-secondary",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),e("span",{class:R(["font-mono",y.value==="emerald"?"text-emerald-400":"",y.value==="amber"?"text-amber-400":"",y.value==="red"?"text-red-400":""])},k(l.value)+" MB/s ",3)]),u.value>0?(p(),b("div",ct,[S[1]||(S[1]=e("span",{class:"text-r58-text-secondary"},"Buf:",-1)),e("span",{class:R(["font-mono",u.value<50?"text-emerald-400":"",u.value>=50&&u.value<80?"text-amber-400":"",u.value>=80?"text-red-400":""])},k(u.value)+"% ",3)])):E("",!0),o.value>0?(p(),b("div",ut,[S[2]||(S[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",dt,k(o.value)+" dropped",1)])):E("",!0)],10,it)):E("",!0)}}),gt={class:"relative w-full h-full bg-black"},vt={key:0,class:"absolute inset-0 flex items-center justify-center bg-black/50"},pt={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/80"},mt={class:"text-center text-r58-text-secondary"},bt={class:"text-sm"},ht=j({__name:"InputPreview",props:{inputId:{},protocol:{}},setup(d){const r=d,c=h(null),g=h(!0),s=h(null);function l(){return r.protocol,`http://${window.location.hostname}:8889/${r.inputId}/whep`}async function u(){if(c.value){g.value=!0,s.value=null;try{const o=l(),t=new RTCPeerConnection({iceServers:[]});t.ontrack=f=>{c.value&&f.streams[0]&&(c.value.srcObject=f.streams[0],g.value=!1)},t.oniceconnectionstatechange=()=>{(t.iceConnectionState==="failed"||t.iceConnectionState==="disconnected")&&(s.value="Connection lost")},t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const a=await t.createOffer();await t.setLocalDescription(a);const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/sdp"},body:a.sdp});if(!n.ok)throw new Error(`WHEP request failed: ${n.status}`);const y=await n.text();await t.setRemoteDescription({type:"answer",sdp:y})}catch(o){console.error("WHEP playback error:",o),s.value=o instanceof Error?o.message:"Failed to connect",g.value=!1}}}return Q(()=>{u()}),N(()=>r.inputId,()=>{u()}),(o,t)=>(p(),b("div",gt,[e("video",{ref_key:"videoRef",ref:c,autoplay:"",muted:"",playsinline:"",class:"w-full h-full object-cover"},null,512),g.value?(p(),b("div",vt,[...t[0]||(t[0]=[e("div",{class:"animate-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full"},null,-1)])])):E("",!0),s.value?(p(),b("div",pt,[e("div",mt,[e("p",bt,k(s.value),1),e("button",{onClick:u,class:"mt-2 text-xs text-r58-accent-primary hover:underline"}," Retry ")])])):E("",!0)]))}}),yt={class:"h-full grid grid-cols-2 gap-4"},_t=["title"],xt={key:1,class:"w-full h-full bg-r58-bg-secondary flex items-center justify-center"},wt={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},kt={class:"flex items-center justify-between"},St={class:"flex items-center gap-2"},$t={class:"font-medium"},Rt={key:0,class:"flex items-center gap-2 text-sm"},Ct={class:"text-r58-text-secondary"},It={key:0,class:"mt-2 flex items-center justify-between"},Tt={class:"text-sm font-mono text-r58-text-secondary"},Et=j({__name:"InputGrid",setup(d){const r=P(),c=_(()=>r.inputs);function g(t){return t.isRecording?"border-r58-accent-danger ring-2 ring-r58-accent-danger/20":t.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-r58-bg-tertiary/50 opacity-60"}function s(t){return t.hasSignal?t.framerate>=29?"excellent":t.framerate>=24?"good":"unstable":"none"}function l(t){switch(s(t)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-r58-text-secondary"}}function u(t){if(t===0)return"0 B";const a=1024,n=["B","KB","MB","GB"],y=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,y)).toFixed(1))+" "+n[y]}function o(t){if(!t.hasSignal)return`${t.label}: No signal detected`;const a=[`${t.label}`,`Resolution: ${t.resolution}`,`Framerate: ${t.framerate} fps`,`Quality: ${s(t)}`];return t.isRecording&&a.push(`Written: ${u(t.bytesWritten)}`),a.join(`
`)}return(t,a)=>(p(),b("div",yt,[(p(!0),b(q,null,ve(c.value,n=>(p(),b("div",{key:n.id,class:R(["relative rounded-lg overflow-hidden border-2 transition-all cursor-pointer",g(n)]),title:o(n)},[n.hasSignal?(p(),ae(ht,{key:0,"input-id":n.id,class:"w-full h-full object-cover"},null,8,["input-id"])):(p(),b("div",xt,[...a[0]||(a[0]=[e("div",{class:"text-center text-r58-text-secondary"},[e("svg",{class:"w-12 h-12 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})]),e("p",null,"No Signal")],-1)])])),e("div",wt,[e("div",kt,[e("div",St,[e("span",{class:R(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":s(n)==="excellent"||s(n)==="good","bg-amber-500 animate-pulse":s(n)==="unstable","bg-r58-text-secondary":s(n)==="none"}])},null,2),e("span",$t,k(n.label),1)]),n.hasSignal?(p(),b("div",Rt,[e("span",Ct,k(n.resolution),1),e("span",{class:R(l(n))},k(n.framerate)+"fps",3)])):E("",!0)]),n.isRecording?(p(),b("div",It,[a[1]||(a[1]=e("div",{class:"flex items-center gap-2 text-r58-accent-danger"},[e("span",{class:"w-2 h-2 rounded-full bg-r58-accent-danger animate-recording"}),e("span",{class:"text-sm font-medium"},"REC")],-1)),e("span",Tt,k(u(n.bytesWritten)),1)])):E("",!0)])],10,_t))),128))]))}}),Bt={class:"space-y-4"},At={class:"flex items-center justify-between py-2 cursor-pointer"},Dt=["aria-checked"],Mt={class:"flex items-center justify-between py-2 cursor-pointer"},Lt=["aria-checked"],jt={class:"flex items-center justify-between py-2 cursor-pointer"},Ft={class:"text-xs text-r58-text-secondary"},Nt={key:0,class:"text-amber-400"},Pt=["aria-checked"],Wt={class:"flex items-center justify-between py-2 pl-4 cursor-pointer opacity-80"},Gt=["aria-checked"],Ht=j({__name:"SettingsPanel",setup(d){const{enabled:r,toggle:c,playClick:g}=pe(),{enabled:s,autoEnable:l,isActive:u,setEnabled:o,setAutoEnable:t}=be(),a=_({get:()=>document.body.classList.contains("touch-mode"),set:y=>{y?(document.body.classList.add("touch-mode"),localStorage.setItem("r58_touch_mode","true")):(document.body.classList.remove("touch-mode"),localStorage.setItem("r58_touch_mode","false"))}});Q(()=>{localStorage.getItem("r58_touch_mode")==="true"&&document.body.classList.add("touch-mode")});function n(){c(),r.value&&g()}return(y,f)=>(p(),b("div",Bt,[f[8]||(f[8]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide"}," Interface Settings ",-1)),e("label",At,[f[3]||(f[3]=e("div",null,[e("span",{class:"text-r58-text-primary"},"Audio Feedback"),e("p",{class:"text-xs text-r58-text-secondary"},"Play sounds for recording start/stop")],-1)),e("button",{onClick:n,class:R(["relative w-12 h-7 rounded-full transition-colors",$(r)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":$(r)},[e("span",{class:R(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",$(r)?"translate-x-6":"translate-x-1"])},null,2)],10,Dt)]),e("label",Mt,[f[4]||(f[4]=e("div",null,[e("span",{class:"text-r58-text-primary"},"Touch Mode"),e("p",{class:"text-xs text-r58-text-secondary"},"Larger buttons for touchscreen")],-1)),e("button",{onClick:f[0]||(f[0]=v=>a.value=!a.value),class:R(["relative w-12 h-7 rounded-full transition-colors",a.value?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":a.value},[e("span",{class:R(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",a.value?"translate-x-6":"translate-x-1"])},null,2)],10,Lt)]),e("label",jt,[e("div",null,[f[6]||(f[6]=e("span",{class:"text-r58-text-primary"},"Performance Mode",-1)),e("p",Ft,[f[5]||(f[5]=K(" Reduce UI updates during recording ",-1)),$(u)&&!$(s)?(p(),b("span",Nt,"(auto-enabled)")):E("",!0)])]),e("button",{onClick:f[1]||(f[1]=v=>$(o)(!$(s))),class:R(["relative w-12 h-7 rounded-full transition-colors",$(s)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":$(s)},[e("span",{class:R(["absolute top-1 w-5 h-5 bg-white rounded-full shadow transition-transform",$(s)?"translate-x-6":"translate-x-1"])},null,2)],10,Pt)]),e("label",Wt,[f[7]||(f[7]=e("div",null,[e("span",{class:"text-sm text-r58-text-primary"},"Auto-enable when recording 3+ inputs")],-1)),e("button",{onClick:f[2]||(f[2]=v=>$(t)(!$(l))),class:R(["relative w-10 h-6 rounded-full transition-colors",$(l)?"bg-r58-accent-primary":"bg-r58-bg-tertiary"]),role:"switch","aria-checked":$(l)},[e("span",{class:R(["absolute top-0.5 w-5 h-5 bg-white rounded-full shadow transition-transform",$(l)?"translate-x-4":"translate-x-0.5"])},null,2)],10,Gt)])]))}}),Ot={class:"space-y-6"},Vt={key:0,class:"card"},Ut={class:"space-y-2"},zt={class:"flex justify-between"},qt={class:"flex justify-between"},Kt={class:"font-mono"},Qt={class:"flex justify-between"},Yt={class:"card"},Jt={class:"space-y-3"},Xt={class:"flex items-center gap-2"},Zt={key:0,class:"text-sm text-r58-text-secondary"},en={key:0,class:"text-r58-accent-danger"},tn={key:1},nn={key:1,class:"text-sm text-r58-text-secondary"},sn={class:"card"},an={class:"space-y-2"},rn=["disabled","title"],on={key:0,class:"absolute -top-8 left-1/2 -translate-x-1/2 px-2 py-1 bg-r58-bg-tertiary text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none"},ln={key:0,class:"card"},cn=j({__name:"SessionInfo",setup(d){const r=P(),c=_(()=>r.currentSession),g=_(()=>r.activeInputs),s=_(()=>r.isRecording),l=h(!1);function u(o){if(o===0)return"0 B";const t=1024,a=["B","KB","MB","GB","TB"],n=Math.floor(Math.log(o)/Math.log(t));return parseFloat((o/Math.pow(t,n)).toFixed(2))+" "+a[n]}return(o,t)=>(p(),b("div",Ot,[c.value?(p(),b("div",Vt,[t[4]||(t[4]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Current Session",-1)),e("div",Ut,[e("div",zt,[t[1]||(t[1]=e("span",{class:"text-r58-text-secondary"},"Started",-1)),e("span",null,k(c.value.startedAt.toLocaleTimeString()),1)]),e("div",qt,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"Duration",-1)),e("span",Kt,k($(r).formattedDuration),1)]),e("div",Qt,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Inputs",-1)),e("span",null,k(g.value.length)+" active",1)])])])):E("",!0),e("div",Yt,[t[5]||(t[5]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Input Status",-1)),e("div",Jt,[(p(!0),b(q,null,ve($(r).inputs,a=>(p(),b("div",{key:a.id,class:"flex items-center justify-between py-2 border-b border-r58-bg-tertiary last:border-0"},[e("div",Xt,[e("span",{class:R(["w-2 h-2 rounded-full",a.hasSignal?"bg-r58-accent-success":"bg-r58-text-secondary"])},null,2),e("span",{class:R(a.hasSignal?"":"text-r58-text-secondary")},k(a.label),3)]),a.hasSignal?(p(),b("div",Zt,[a.isRecording?(p(),b("span",en,k(u(a.bytesWritten)),1)):(p(),b("span",tn,k(a.resolution),1))])):(p(),b("span",nn,"No signal"))]))),128))])]),e("div",sn,[t[7]||(t[7]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Quick Actions",-1)),e("div",an,[e("button",{class:"btn w-full justify-center disabled:opacity-50 disabled:cursor-not-allowed group relative",disabled:s.value,title:s.value?"Cannot configure while recording":"Open input configuration"},[t[6]||(t[6]=K(" Configure Inputs ",-1)),s.value?(p(),b("span",on," Stop recording first ")):E("",!0)],8,rn),e("button",{onClick:t[0]||(t[0]=a=>l.value=!l.value),class:"btn w-full justify-center"},k(l.value?"Hide Settings":"Interface Settings"),1)])]),L(re,{name:"slide-fade"},{default:oe(()=>[l.value?(p(),b("div",ln,[L(Ht)])):E("",!0)]),_:1})]))}}),un=ge(cn,[["__scopeId","data-v-52419595"]]),dn={class:"h-full flex flex-col"},fn={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},gn={class:"flex items-center gap-4"},vn={class:"flex items-center gap-2"},pn={key:0,class:"badge badge-danger"},mn={class:"flex-1 flex overflow-hidden"},bn={class:"flex-1 p-4"},hn={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},_n=j({__name:"RecorderView",setup(d){const r=P(),{showLeaveConfirmation:c,confirmLeave:g,cancelLeave:s}=Ee(),l=_(()=>r.status==="recording"),u=_(()=>r.formattedDuration),o=h(null);return N(c,t=>{var a,n;t?(a=o.value)==null||a.open():(n=o.value)==null||n.close()}),(t,a)=>(p(),b("div",dn,[e("header",fn,[e("div",gn,[e("div",vn,[e("span",{class:R(["w-3 h-3 rounded-full",l.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),a[0]||(a[0]=e("span",{class:"text-xl font-semibold"},"Recorder",-1))]),l.value?(p(),b("span",pn,"RECORDING")):E("",!0),L(ft)]),L(st)]),e("div",mn,[e("div",bn,[L(Et)]),e("aside",hn,[L(un)])]),L(me,{ref_key:"leaveDialog",ref:o,title:"Recording in Progress",message:`You are currently recording (${u.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:$(g),onCancel:$(s)},null,8,["message","onConfirm","onCancel"])]))}});export{_n as default};
