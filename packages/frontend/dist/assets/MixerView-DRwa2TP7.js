import{X as Ie,r as b,l as I,b as ae,d as oe,K as re,c as d,f as M,e,q as Q,P as ye,B as se,y as te,F as Y,z as Z,t as C,n as B,s as W,L as Ee,j as V,k as u,Y as _e,H as ie,g as J,T as de,w as pe,W as Be,_ as ge,o as ue,p as He,G as Ce,u as Fe,Z as We,V as Ke,v as Ae,i as qe}from"./index-DZOHfCnv.js";import{b as Se,o as Ne,a as ze,V as le,g as $e,c as he,d as ke,e as Pe,f as Ge,h as Xe,i as Ye}from"./vdoninja-X8SGicu1.js";import{u as Qe,P as Ze,C as Je,M as et}from"./ModeLoadingScreen-C0vLlrzC.js";const q=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],fe=Ie("streaming",()=>{const g=b([]),w=b(!1),r=b(null),m=b({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),p=I(()=>g.value.find(n=>n.id===r.value)),$=I(()=>g.value.filter(n=>n.enabled)),x=I(()=>q),y=I(()=>{const n=window.location.hostname,t=n==="localhost"||n==="127.0.0.1",c=t?"localhost":"app.itagenten.no";return{rtmp:t?"rtmp://localhost:1935/mixer_program":"rtmp://app.itagenten.no:1935/mixer_program",rtsp:t?"rtsp://localhost:8554/mixer_program":"rtsp://app.itagenten.no:8554/mixer_program",srt:t?"srt://localhost:8890?streamid=read:mixer_program":"srt://app.itagenten.no:8890?streamid=read:mixer_program",hls:`https://${c}/hls/mixer_program/index.m3u8`,whep:`https://${c}/mixer_program/whep`}});function S(n,t){const c=q.find(s=>s.id===n);if(!c)throw new Error(`Unknown platform: ${n}`);const o={id:`dest-${Date.now()}`,platformId:n,name:t||c.name,streamKey:"",enabled:!1};return g.value.push(o),o}function D(n,t){const c=g.value.findIndex(o=>o.id===n);c!==-1&&(g.value[c]={...g.value[c],...t})}function a(n){const t=g.value.findIndex(c=>c.id===n);t!==-1&&g.value.splice(t,1),r.value===n&&(r.value=null)}function f(n){r.value=n}function l(n){m.value.enabled=n}function k(n){m.value={...m.value,...n}}function R(){w.value=!0}function O(){w.value=!1}function j(n){const t=q.find(c=>c.id===n.platformId);return t?n.platformId==="custom"?`${n.name}${n.streamKey}`:`${t.rtmpBaseUrl}${n.streamKey}`:""}function T(){const n=window.location.hostname;return`srt://${n==="localhost"||n==="127.0.0.1"?"localhost":"app.itagenten.no"}:${m.value.port}?streamid=read:${m.value.streamId}`}function H(){try{const n=localStorage.getItem("r58-streaming-destinations");if(n){const t=JSON.parse(n);g.value=t.destinations||[],t.srtOutput&&(m.value={...m.value,...t.srtOutput})}}catch(n){console.warn("Failed to load saved streaming destinations:",n)}}function K(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:g.value,srtOutput:m.value}))}catch(n){console.warn("Failed to save streaming destinations:",n)}}async function N(){try{const n=$.value;if(n.length===0)return console.warn("[Streaming] No enabled destinations to stream to"),{success:!1,message:"No destinations configured"};const t=n.map(s=>{var P;return{platform:s.platformId,rtmp_url:((P=q.find(ee=>ee.id===s.platformId))==null?void 0:P.rtmpBaseUrl)||"",stream_key:s.streamKey,enabled:!0}}),c=await fetch(await ae("/api/streaming/rtmp/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinations:t})}),o=await c.json();if(!c.ok)throw new Error(o.detail||"Failed to start RTMP relay");return console.log("[Streaming] RTMP relay configured via MediaMTX runOnReady:",o),{success:!0,message:o.message||`Streaming to ${n.length} destination(s)`}}catch(n){const t=n instanceof Error?n.message:"Failed to start RTMP relay";return console.error("[Streaming] Failed to start RTMP relay:",n),{success:!1,message:t}}}async function F(){try{const n=await fetch(await ae("/api/streaming/rtmp/stop"),{method:"POST"}),t=await n.json();if(!n.ok)throw new Error(t.detail||"Failed to stop RTMP relay");return console.log("[Streaming] RTMP relay stopped"),{success:!0,message:"RTMP relay stopped"}}catch(n){const t=n instanceof Error?n.message:"Failed to stop RTMP relay";return console.error("[Streaming] Failed to stop RTMP relay:",n),{success:!1,message:t}}}async function z(){try{const n=await fetch(await ae("/api/streaming/status"));if(!n.ok)throw new Error("Failed to get streaming status");return await n.json()}catch(n){return console.error("[Streaming] Failed to get streaming status:",n),null}}return H(),{destinations:g,isStreaming:w,activeDestinationId:r,srtOutput:m,activeDestination:p,enabledDestinations:$,platforms:x,programOutputUrls:y,addDestination:S,updateDestination:D,removeDestination:a,setActiveDestination:f,toggleSrtOutput:l,updateSrtConfig:k,startStreaming:R,stopStreaming:O,buildRtmpUrl:j,getSrtOutputUrl:T,saveDestinations:K,loadSavedDestinations:H,startRtmpRelay:N,stopRtmpRelay:F,getStreamingStatus:z}}),tt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},ot={class:"relative bg-preke-bg-elevated border border-preke-bg-surface rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},nt={class:"p-6 overflow-y-auto max-h-[60vh]"},st={key:0,class:"mb-8 p-6 bg-gradient-to-br from-amber-600/20 to-red-600/20 rounded-xl border border-amber-500/30"},at={class:"flex gap-3 mb-4"},rt=["placeholder"],lt={class:"text-xs text-preke-text-dim"},it=["href"],ut={class:"mb-8"},ct={class:"flex items-center justify-between mb-4"},dt={key:0,class:"mb-4 p-4 bg-preke-bg-surface rounded-lg"},pt={class:"grid grid-cols-2 gap-2"},mt=["onClick"],gt={class:"text-xl"},ft={key:1,class:"space-y-3"},vt=["onClick"],bt={class:"text-xl"},xt={class:"flex-1"},ht={class:"font-medium"},kt={class:"text-xs text-preke-text-dim"},wt=["onClick"],yt=["onClick"],_t={key:2,class:"text-preke-text-dim text-sm"},Ct={key:1,class:"mb-8 p-4 bg-preke-bg-surface rounded-lg"},St={class:"text-lg font-medium mb-4"},$t={class:"space-y-4"},Pt=["placeholder"],Mt={key:0},Rt={class:"flex gap-2"},Dt={class:"mb-8"},Ot={class:"space-y-3"},Tt={class:"p-3 bg-preke-bg-surface rounded-lg"},Ut={class:"flex items-center justify-between mb-1"},Lt={class:"text-xs text-preke-text-dim break-all"},Vt={class:"p-3 bg-preke-bg-surface rounded-lg"},jt={class:"flex items-center justify-between mb-1"},It={class:"text-xs text-preke-text-dim break-all"},Et={class:"p-3 bg-preke-bg-surface rounded-lg"},Bt={class:"flex items-center justify-between mb-1"},Ht={class:"text-xs text-preke-text-dim break-all"},Ft={class:"p-3 bg-preke-bg-surface rounded-lg"},Wt={class:"flex items-center justify-between mb-1"},Kt={class:"text-xs text-preke-text-dim break-all"},At={class:"p-3 bg-preke-bg-surface rounded-lg"},qt={class:"flex items-center justify-between mb-1"},Nt={class:"text-xs text-preke-text-dim break-all"},zt={class:"p-4 bg-preke-bg-surface rounded-lg"},Gt={class:"flex items-center gap-3 mb-4"},Xt=oe({__name:"StreamingSettings",setup(g,{expose:w}){const r=fe(),m=b(!1),p=b(null),$=b(!1),x=b("youtube"),y=b("");b(""),b("");const S=I(()=>r.destinations),D=I(()=>q),a=I(()=>r.programOutputUrls);function f(){m.value=!0}function l(){m.value=!1,p.value=null,$.value=!1}function k(n){const t=r.addDestination(n);p.value=t,$.value=!1,r.saveDestinations()}function R(){p.value&&(r.updateDestination(p.value.id,p.value),r.saveDestinations(),p.value=null,V.success("Streaming destination saved"))}function O(n){r.removeDestination(n),r.saveDestinations(),V.info("Destination removed")}function j(n){r.updateDestination(n.id,{enabled:!n.enabled}),r.saveDestinations()}function T(n,t){navigator.clipboard.writeText(n),V.success(`${t} copied to clipboard`)}function H(n){const t=q.find(c=>c.id===n);return(t==null?void 0:t.icon)||"ðŸ“¡"}function K(n){const t=q.find(c=>c.id===n);return(t==null?void 0:t.name)||"Unknown"}function N(){const n=q.find(t=>t.id===x.value);return(n==null?void 0:n.streamKeyPlaceholder)||"Enter stream key"}function F(){switch(x.value){case"youtube":return"https://support.google.com/youtube/answer/2907883";case"twitch":return"https://help.twitch.tv/s/article/twitch-stream-key-faq";case"facebook":return"https://www.facebook.com/help/587160588142067";case"restream":return"https://support.restream.io/en/";default:return"#"}}function z(){if(!y.value.trim()){V.error("Please enter your stream key");return}const n=r.addDestination(x.value);r.updateDestination(n.id,{streamKey:y.value,enabled:!0}),r.saveDestinations(),y.value="",V.success(`${K(x.value)} configured and enabled!`)}return w({open:f}),(n,t)=>{var c;return u(),re(Ee,{to:"body"},[m.value?(u(),d("div",tt,[e("div",{class:"absolute inset-0 bg-black/60",onClick:l}),e("div",ot,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-preke-bg-surface"},[t[13]||(t[13]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:l,class:"text-preke-text-dim hover:text-preke-text text-2xl"}," Ã— ")]),e("div",nt,[S.value.length===0?(u(),d("section",st,[t[16]||(t[16]=e("h3",{class:"text-xl font-semibold mb-2 flex items-center gap-2"}," ðŸ”´ Quick Setup: Stream to YouTube ",-1)),t[17]||(t[17]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Get streaming in seconds! Just paste your stream key below. ",-1)),e("div",at,[Q(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>x.value=o),class:"px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg text-base"},[...t[14]||(t[14]=[e("option",{value:"youtube"},"â–¶ï¸ YouTube Live",-1),e("option",{value:"twitch"},"ðŸ“º Twitch",-1),e("option",{value:"facebook"},"ðŸ“˜ Facebook",-1),e("option",{value:"restream"},"ðŸ”„ Restream",-1)])],512),[[ye,x.value]]),Q(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>y.value=o),type:"password",placeholder:N(),class:"flex-1 px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg font-mono text-base focus:border-amber-500 focus:outline-none"},null,8,rt),[[se,y.value]]),e("button",{onClick:z,class:"px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg font-semibold transition-colors"}," Save & Enable ")]),e("p",lt,[t[15]||(t[15]=te(" ðŸ”’ Your stream key is stored locally on this device and never sent to any server. ",-1)),e("a",{href:F(),target:"_blank",class:"text-amber-400 hover:underline ml-2"}," Where do I find my stream key? â†’ ",8,it)])])):M("",!0),e("section",ut,[e("div",ct,[t[18]||(t[18]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[2]||(t[2]=o=>$.value=!$.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),$.value?(u(),d("div",dt,[t[19]||(t[19]=e("p",{class:"text-sm text-preke-text-dim mb-3"},"Select a streaming platform:",-1)),e("div",pt,[(u(!0),d(Y,null,Z(D.value,o=>(u(),d("button",{key:o.id,onClick:s=>k(o.id),class:"flex items-center gap-2 p-3 bg-preke-bg-elevated hover:bg-preke-gold/20 rounded-lg transition-colors text-left"},[e("span",gt,C(o.icon),1),e("span",null,C(o.name),1)],8,mt))),128))])])):M("",!0),S.value.length>0?(u(),d("div",ft,[(u(!0),d(Y,null,Z(S.value,o=>(u(),d("div",{key:o.id,class:"flex items-center gap-3 p-3 bg-preke-bg-surface rounded-lg"},[e("button",{onClick:s=>j(o),class:B(["w-10 h-6 rounded-full transition-colors relative",o.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:B(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",o.enabled?"left-5":"left-1"])},null,2)],10,vt),e("span",bt,C(H(o.platformId)),1),e("div",xt,[e("div",ht,C(o.name),1),e("div",kt,C(o.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+o.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:s=>p.value={...o},class:"text-preke-gold hover:underline text-sm"}," Edit ",8,wt),e("button",{onClick:s=>O(o.id),class:"text-preke-red hover:underline text-sm"}," Remove ",8,yt)]))),128))])):(u(),d("p",_t," No streaming destinations configured. Add a platform above. "))]),p.value?(u(),d("section",Ct,[e("h3",St," Edit "+C(K(p.value.platformId)),1),e("div",$t,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Display Name",-1)),Q(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>p.value.name=o),type:"text",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none"},null,512),[[se,p.value.name]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Stream Key",-1)),Q(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>p.value.streamKey=o),type:"password",placeholder:(c=W(q).find(o=>o.id===p.value.platformId))==null?void 0:c.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,8,Pt),[[se,p.value.streamKey]]),t[22]||(t[22]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),p.value.platformId==="custom"?(u(),d("div",Mt,[t[23]||(t[23]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"RTMP URL",-1)),Q(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>p.value.name=o),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,512),[[se,p.value.name]])])):M("",!0),e("div",Rt,[e("button",{onClick:R,class:"btn btn-primary"}," Save "),e("button",{onClick:t[6]||(t[6]=o=>p.value=null),class:"btn"}," Cancel ")])])])):M("",!0),e("section",Dt,[t[32]||(t[32]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[33]||(t[33]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",Ot,[e("div",Tt,[e("div",Ut,[t[24]||(t[24]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[7]||(t[7]=o=>T(a.value.srt,"SRT URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Lt,C(a.value.srt),1),t[25]||(t[25]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",Vt,[e("div",jt,[t[26]||(t[26]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[8]||(t[8]=o=>T(a.value.rtmp,"RTMP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",It,C(a.value.rtmp),1)]),e("div",Et,[e("div",Bt,[t[27]||(t[27]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[9]||(t[9]=o=>T(a.value.rtsp,"RTSP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Ht,C(a.value.rtsp),1)]),e("div",Ft,[e("div",Wt,[t[28]||(t[28]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[10]||(t[10]=o=>T(a.value.hls,"HLS URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Kt,C(a.value.hls),1),t[29]||(t[29]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",At,[e("div",qt,[t[30]||(t[30]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[11]||(t[11]=o=>T(a.value.whep,"WHEP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Nt,C(a.value.whep),1),t[31]||(t[31]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[36]||(t[36]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",zt,[e("div",Gt,[e("button",{onClick:t[12]||(t[12]=o=>W(r).toggleSrtOutput(!W(r).srtOutput.enabled)),class:B(["w-10 h-6 rounded-full transition-colors relative",W(r).srtOutput.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:B(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",W(r).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[34]||(t[34]=e("span",null,"Enable SRT Output",-1))]),t[35]||(t[35]=e("div",{class:"text-sm text-preke-text-dim"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-preke-bg-surface"},[e("button",{onClick:l,class:"btn"},"Close")])])])):M("",!0)])}}}),Yt={class:"program-output space-y-3","data-testid":"program-output"},Qt={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface rounded-lg","data-testid":"program-output-status"},Zt={class:"text-sm font-medium","data-testid":"program-output-text"},Jt={key:0,class:"space-y-2"},eo={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},to={class:"flex-1 text-xs truncate text-preke-text-dim"},oo={key:0,class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},no={class:"text-xs text-preke-text-dim"},so={key:1,class:"text-xs text-preke-text-dim px-3"},ao={class:"hidden"},ro=["src"],lo=oe({__name:"ProgramOutput",setup(g){const w=_e(),r=fe(),m=b(!1),p=b("idle"),$=b("");function x(){return"https://app.itagenten.no/mixer_program/whip"}async function y(){if(m.value)return;p.value="connecting";const O=await Se(x());if(!O){p.value="error",console.error("[ProgramOutput] Failed to build VDO.ninja URL - VDO.ninja not configured");return}$.value=O,m.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX:",O)}function S(){m.value&&(m.value=!1,$.value="",p.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function D(){m.value&&(p.value="live",console.log("[ProgramOutput] WHIP push connected"))}function a(){p.value="error",console.error("[ProgramOutput] WHIP push failed")}async function f(){S(),await new Promise(O=>setTimeout(O,500)),await y()}ie(()=>w.isLive,async O=>{O?await y():S()});function l(){switch(p.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function k(){switch(p.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function R(){const O=r.programOutputUrls.srt;navigator.clipboard.writeText(O),V.success("SRT URL copied")}return(O,j)=>(u(),d("div",Yt,[e("div",Qt,[e("span",{class:B(["w-2 h-2 rounded-full",l()]),"data-testid":"program-output-indicator"},null,2),e("span",Zt,C(k()),1),p.value==="error"?(u(),d("button",{key:0,onClick:j[0]||(j[0]=T=>f()),class:"ml-auto text-xs text-preke-gold hover:underline"}," Retry ")):M("",!0)]),p.value==="live"?(u(),d("div",Jt,[e("div",eo,[j[1]||(j[1]=e("span",{class:"text-xs text-preke-text-dim"},"ðŸ”´ SRT:",-1)),e("code",to,C(W(r).programOutputUrls.srt),1),e("button",{onClick:R,class:"text-xs text-preke-gold hover:underline"},"Copy")]),W(r).enabledDestinations.length>0?(u(),d("div",oo,[j[2]||(j[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",no,C(W(r).enabledDestinations.length)+" streaming destination"+C(W(r).enabledDestinations.length>1?"s":"")+" active ",1)])):M("",!0)])):M("",!0),p.value==="idle"?(u(),d("p",so," Program output will start automatically when you go live. ")):M("",!0),e("div",ao,[m.value&&$.value?(u(),d("iframe",{key:0,src:$.value,onLoad:D,onError:a,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,ro)):M("",!0)])]))}}),io={class:"streaming-control-panel"},uo={class:"control-bar"},co={key:0,class:"control-bar__room"},po={class:"control-bar__room-name"},mo={key:0,class:"control-bar__camera-count"},go={key:1,class:"control-bar__divider"},fo={class:"control-bar__status"},vo={class:"control-bar__status-text"},bo={key:0,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},xo={key:1,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},ho={key:3,class:"control-bar__destinations"},ko={class:"control-bar__destinations-list"},wo=["title"],yo={key:0,class:"quick-setup"},_o={class:"quick-setup__form"},Co={class:"quick-setup__platform"},So={class:"quick-setup__platform-icon"},$o={class:"quick-setup__input-wrap"},Po=["placeholder"],Mo={class:"hidden"},Ro=oe({__name:"StreamingControlPanel",props:{roomName:{default:""},cameraCount:{default:0}},setup(g){const w=g,r=_e(),m=fe(),p=b(null),$=b(null),x=b(!1),y=b("youtube"),S=b(""),D=I(()=>r.isLive),a=I(()=>m.destinations.length>0),f=I(()=>m.enabledDestinations.length>0),l=I(()=>D.value?"live":"idle");function k(){D.value?O():R()}async function R(){if(r.setLive(!0),m.enabledDestinations.length>0){const o=await m.startRtmpRelay();o.success?V.success(o.message):V.error(`RTMP relay failed: ${o.message}`)}else V.success("Streaming started (no RTMP destinations configured)")}async function O(){if(r.setLive(!1),m.enabledDestinations.length>0){const o=await m.stopRtmpRelay();o.success||V.warning(`Note: ${o.message}`)}V.info("Streaming stopped")}function j(){Ne(1)?V.success("Program window opened"):V.error("Popup blocked - please allow popups for this site")}async function T(){const s=await Se("https://app.itagenten.no/mixer_program/whip");if(!s){V.error("Failed to build scene output URL");return}window.open(s,"vdo-scene-output","width=1280,height=720,menubar=no,toolbar=no")?V.success("Scene output window opened - streaming to MediaMTX"):V.error("Popup blocked - please allow popups for this site")}async function H(){const o=await ze(0,{room:w.roomName||le});if(!o){V.error("Failed to build scene view URL");return}await navigator.clipboard.writeText(o),V.success('Scene view link copied! Open this URL, then use "Publishing setup" in the mixer to screen-share it to MediaMTX')}function K(){var o;(o=p.value)==null||o.open()}function N(){x.value=!x.value}function F(){if(!S.value.trim()){V.error("Please enter your stream key");return}if(!q.find(P=>P.id===y.value))return;const s=m.destinations.find(P=>P.platformId===y.value);if(s)m.updateDestination(s.id,{streamKey:S.value,enabled:!0});else{const P=m.addDestination(y.value);m.updateDestination(P.id,{streamKey:S.value,enabled:!0})}m.saveDestinations(),x.value=!1,S.value="",R()}function z(){const o=q.find(s=>s.id===y.value);return(o==null?void 0:o.streamKeyPlaceholder)||"Enter your stream key"}function n(){const o=q.find(s=>s.id===y.value);return(o==null?void 0:o.icon)||"ðŸ“¡"}function t(){switch(l.value){case"live":return"control-bar__dot--live";case"connecting":return"control-bar__dot--connecting";case"error":return"control-bar__dot--error";default:return"control-bar__dot--idle"}}function c(){switch(l.value){case"live":return"LIVE";case"connecting":return"Connecting...";case"error":return"Error";default:return"Offline"}}return(o,s)=>(u(),d("div",io,[e("div",uo,[w.roomName?(u(),d("div",co,[s[3]||(s[3]=e("span",{class:"control-bar__room-label"},"Room",-1)),e("span",po,C(w.roomName),1),w.cameraCount>0?(u(),d("span",mo,C(w.cameraCount)+" cam"+C(w.cameraCount!==1?"s":""),1)):M("",!0)])):M("",!0),w.roomName?(u(),d("div",go)):M("",!0),e("div",fo,[e("span",{class:B(["control-bar__dot",t()])},null,2),e("span",vo,C(c()),1)]),s[12]||(s[12]=e("div",{class:"control-bar__divider"},null,-1)),e("button",{onClick:k,class:B(["control-bar__btn",D.value?"control-bar__btn--stop":"control-bar__btn--start"])},[D.value?(u(),d("svg",bo,[...s[4]||(s[4]=[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"},null,-1)])])):(u(),d("svg",xo,[...s[5]||(s[5]=[e("path",{d:"M8 5.14v14l11-7-11-7z"},null,-1)])])),te(" "+C(D.value?"Stop":"Start Streaming"),1)],2),a.value?M("",!0):(u(),d("button",{key:2,onClick:N,class:B(["control-bar__btn control-bar__btn--dashed",x.value?"control-bar__btn--active":""])},[...s[6]||(s[6]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})],-1),te(" Add Stream Key ",-1)])],2)),e("button",{onClick:j,class:"control-bar__btn control-bar__btn--secondary",title:"Open program output in new window"},[...s[7]||(s[7]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),te(" Watch ",-1)])]),e("button",{onClick:T,class:"control-bar__btn control-bar__btn--secondary",title:"Open scene output window - pushes mixed scene to MediaMTX for streaming (uses &whipout parameter)"},[...s[8]||(s[8]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),te(" Scene Output ",-1)])]),e("button",{onClick:H,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Copy scene view link - open this URL, then use 'Publishing setup' to screen-share it to MediaMTX"},[...s[9]||(s[9]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})],-1)])]),e("button",{onClick:K,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Configure streaming destinations"},[...s[10]||(s[10]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])]),f.value?(u(),d("div",ho,[s[11]||(s[11]=e("span",{class:"control-bar__destinations-label"},"To:",-1)),e("div",ko,[(u(!0),d(Y,null,Z(W(m).enabledDestinations,P=>(u(),d("span",{key:P.id,class:"control-bar__destination",title:P.name},C(P.platformId==="youtube"?"â–¶ï¸":P.platformId==="twitch"?"ðŸ“º":"ðŸ”´"),9,wo))),128))])])):M("",!0)]),J(de,{name:"slide"},{default:pe(()=>[x.value?(u(),d("div",yo,[e("div",_o,[e("div",Co,[e("span",So,C(n()),1),Q(e("select",{"onUpdate:modelValue":s[0]||(s[0]=P=>y.value=P),class:"quick-setup__select"},[...s[13]||(s[13]=[e("option",{value:"youtube"},"YouTube",-1),e("option",{value:"twitch"},"Twitch",-1),e("option",{value:"facebook"},"Facebook",-1),e("option",{value:"restream"},"Restream",-1)])],512),[[ye,y.value]])]),e("div",$o,[Q(e("input",{"onUpdate:modelValue":s[1]||(s[1]=P=>S.value=P),type:"password",placeholder:z(),class:"quick-setup__input",onKeyup:Be(F,["enter"])},null,40,Po),[[se,S.value]])]),e("button",{onClick:F,class:"quick-setup__go-live"}," ðŸ”´ Go Live "),e("button",{onClick:s[2]||(s[2]=P=>x.value=!1),class:"quick-setup__cancel"},"âœ•")])])):M("",!0)]),_:1}),e("div",Mo,[J(lo,{ref_key:"programOutputRef",ref:$},null,512)]),J(Xt,{ref_key:"streamingSettingsRef",ref:p},null,512)]))}}),Do=ge(Ro,[["__scopeId","data-v-14999ed3"]]),me="vdo-debug",Oo=500,X=[];let ve=typeof localStorage<"u"&&localStorage.getItem(me)==="true";function we(g){ve=g,typeof localStorage<"u"&&(g?localStorage.setItem(me,"true"):localStorage.removeItem(me)),console.log(`[VDO.ninja Debug] ${g?"Enabled":"Disabled"}`)}function ne(g){if(X.push(g),X.length>Oo&&X.shift(),ve){const w=new Date(g.timestamp).toISOString().split("T")[1].slice(0,-1),r=g.direction==="outgoing"?"âž¡ï¸ OUT":"â¬…ï¸ IN",m=g.direction==="outgoing"?"color: #3b82f6; font-weight: bold":"color: #22c55e; font-weight: bold";console.groupCollapsed(`%c[VDO.ninja ${r}] %c${g.type}`,m,"color: inherit"),console.log("Time:",w),g.target&&console.log("Target:",g.target),console.log("Data:",g.data),g.raw&&g.raw!==g.data&&console.log("Raw:",g.raw),console.groupEnd()}}function Me(){return[...X]}function To(){X.length=0,console.log("[VDO.ninja Debug] Event history cleared")}function Re(){const g={total:X.length,incoming:0,outgoing:0,byType:{},lastActivity:X.length>0?X[X.length-1].timestamp:null};for(const w of X)w.direction==="incoming"?g.incoming++:g.outgoing++,g.byType[w.type]=(g.byType[w.type]||0)+1;return g}typeof window<"u"&&(window.__VDO_DEBUG__={getHistory:Me,clearHistory:To,getStats:Re,enable:()=>we(!0),disable:()=>we(!1),isEnabled:()=>ve});function Uo(g){const w=b(!1),r=b(new Map),m=b(0),p=b(null),$=b(!1),x=b("disconnected"),y=b(null),S=$e(),D=new Map;function a(i,h,v,E){var _;if(!((_=g.value)!=null&&_.contentWindow)){console.warn("[VDO.ninja] Cannot send command - iframe not ready"),y.value="iframe not ready";return}const L={action:i};h&&(L.target=h),v!==void 0&&(L.value=v),E!==void 0&&(L.value2=E),ne({timestamp:Date.now(),direction:"outgoing",type:i,target:h,data:{action:i,target:h,value:v,value2:E},raw:L});try{g.value.contentWindow.postMessage(L,"*")}catch(U){console.error("[VDO.ninja] Failed to send command:",U),y.value=String(U)}}function f(i,h){var E;if(!((E=g.value)!=null&&E.contentWindow)){console.warn("[VDO.ninja] Cannot send DOM command - iframe not ready");return}const v={action:"",target:i,...h};ne({timestamp:Date.now(),direction:"outgoing",type:"dom-manipulation",target:i,data:h,raw:v});try{g.value.contentWindow.postMessage(v,"*")}catch(L){console.error("[VDO.ninja] Failed to send DOM command:",L)}}function l(i,h=1){var L;const v=D.get(i)||i;if(v!==i&&console.log(`[VDO.ninja] Resolved UUID ${i} to stream ID ${v} for addToScene`),!((L=g.value)!=null&&L.contentWindow)){console.warn("[VDO.ninja] Cannot send addToScene - iframe not ready");return}const E={addToScene:h,target:v};ne({timestamp:Date.now(),direction:"outgoing",type:"addToScene",target:v,data:{sceneNumber:h},raw:E});try{g.value.contentWindow.postMessage(E,"*"),p.value=h}catch(_){console.error("[VDO.ninja] Failed to send addToScene:",_)}}function k(i,h=1){var L;const v=D.get(i)||i;if(!((L=g.value)!=null&&L.contentWindow)){console.warn("[VDO.ninja] Cannot send removeFromScene - iframe not ready");return}const E={removeFromScene:h,target:v};ne({timestamp:Date.now(),direction:"outgoing",type:"removeFromScene",target:v,data:{sceneNumber:h},raw:E});try{g.value.contentWindow.postMessage(E,"*")}catch(_){console.error("[VDO.ninja] Failed to send removeFromScene:",_)}}function R(i){f(i,{replace:!0})}function O(i){f(i,{add:!0})}function j(i){f(i,{remove:!0})}function T(i,h){a("mic",i,!h);const v=r.value.get(i);v&&(v.muted=h)}function H(i){a("mic",i,"toggle");const h=r.value.get(i);h&&(h.muted=!h.muted)}function K(i,h){a("volume",i,Math.max(0,Math.min(200,h)))}function N(i){a("soloChat",i)}function F(i){a("soloChatBidirectional",i)}function z(i,h){a("sendChat",i,h)}function n(i,h){a("sendDirectorChat",i,h)}function t(i){a("hangup",i),r.value.delete(i)}function c(i){i?a("togglescreenshare",i):a("togglescreenshare")}function o(i,h){a("forward",i,h)}function s(i="guests"){a("getGuestList",void 0,void 0)}function P(){a("record",void 0,!0),$.value=!0}function ee(){a("record",void 0,!1),$.value=!1}function ce(i){a("layout",void 0,i)}function De(i){i?a("reload",i):a("reload")}function Oe(i,h){a("mixorder",i,h==="up"?-1:1)}function Te(i){a("camera",void 0,i)}function Ue(i,h){a("camera",i,h)}function Le(i,h=!1){h?a("zoom",void 0,i,"abs"):a("zoom",void 0,i)}function Ve(i){a("pan",void 0,i)}function je(i){a("tilt",void 0,i)}function be(i){const h=i.origin;if(!h.includes(S.split(":")[0])&&!h.includes("vdo.ninja")&&!h.includes("vdo.itagenten")&&!h.includes("localhost"))return;const v=i.data;if(!v||typeof v!="object")return;const E=v.type||v.action||"unknown",L=v.streamID||v.UUID||v.streamId;switch(ne({timestamp:Date.now(),direction:"incoming",type:E,target:L,data:v.data||v.value,raw:v}),E){case"director-ready":case"mixer-ready":case"loaded":case"ready":case"started":case"director":case"joined-room-complete":case"seeding-started":w.value=!0,x.value="connected",y.value=null,console.log("[VDO.ninja] Ready event received:",E);break;case"stream-id-detected":{const _=v.value||v.data,U=v.UUID;if(_){if(U){D.set(U,_),console.log(`[VDO.ninja] Stream ID mapping: ${U} -> ${_}`);const G=r.value.get(U);G&&(r.value.delete(U),G.id=_,r.value.set(_,G),m.value++,console.log(`[VDO.ninja] Updated source ID from UUID to stream ID: ${_}`))}if(!r.value.has(_)){const G={id:_,label:v.label||_,type:"guest",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0};r.value.set(_,G),m.value++,console.log(`[VDO.ninja] Source added via stream-id-detected: ${_}`)}}break}case"new-guest":case"guest-connected":case"push":case"view":case"joined":case"new-push-connection":case"push-connection":case"new-view-connection":case"view-connection":{const _=v.UUID,U=v.streamID,G=U||_||L;if(G){_&&U&&D.set(_,U);const A=v.data,xe={id:G,label:(A==null?void 0:A.label)||v.label||G,type:(A==null?void 0:A.type)||"guest",hasVideo:(A==null?void 0:A.video)!==!1,hasAudio:(A==null?void 0:A.audio)!==!1,muted:!1,audioLevel:0};r.value.set(G,xe),m.value++,console.log(`[VDO.ninja] Source added: ${G} (${xe.label})${_&&!U?" (UUID, awaiting stream ID)":""}`)}break}case"guest-left":case"guest-disconnected":case"left":case"disconnect":L&&(r.value.delete(L),m.value++);break;case"audio-level":case"loudness":{if(L){const _=r.value.get(L);if(_){const U=v.data;_.audioLevel=(U==null?void 0:U.level)||v.value||0}}break}case"mute-state":case"muted":{if(L){const _=r.value.get(L);if(_){const U=v.data;_.muted=(U==null?void 0:U.muted)??v.value??!1}}break}case"scene-changed":case"scene":{const _=v.data,U=(_==null?void 0:_.scene)||v.value;p.value=typeof U=="number"?U:null;break}case"recording-started":$.value=!0;break;case"recording-stopped":$.value=!1;break;case"error":console.error("[VDO.ninja Error]",v.data),y.value=String(v.data);break}}return ue(()=>{x.value="connecting",window.addEventListener("message",be),setTimeout(()=>{!w.value&&g.value&&(w.value=!0,x.value="connected")},5e3)}),He(()=>{window.removeEventListener("message",be),x.value="disconnected"}),{isReady:w,sources:r,sourcesVersion:m,activeScene:p,isRecording:$,connectionState:x,lastError:y,addToScene:l,removeFromScene:k,setProgram:R,addSource:O,removeSource:j,setLayout:ce,changeMixOrder:Oe,setMute:T,toggleMute:H,setVolume:K,soloAudio:N,soloChatBidirectional:F,sendToGuest:z,sendDirectorMessage:n,kickGuest:t,toggleScreenShare:c,transferGuest:o,getGuestList:s,refreshSource:De,setCamera:Te,setGuestCamera:Ue,zoom:Le,pan:Ve,tilt:je,startRecording:P,stopRecording:ee,sendCommand:a,sendDomCommand:f,getEventHistory:Me,getEventStats:Re}}const Lo={class:"flex items-center justify-between p-3 border-b border-preke-border"},Vo={key:0,class:"text-sm font-semibold text-preke-text"},jo=["title"],Io={key:0,class:"p-3 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto"},Eo={class:"grid grid-cols-3 gap-2"},Bo=["onClick"],Ho={class:"flex items-center justify-center gap-2"},Fo={key:0,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},Wo={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},Ko={key:0},Ao={class:"space-y-2"},qo={class:"flex items-center justify-between mb-1"},No={class:"text-xs text-preke-text"},zo=["onClick","title"],Go={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Xo={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Yo=["value","onInput"],Qo={key:1},Zo={class:"space-y-1"},Jo=["onClick"],en={class:"flex items-center justify-between"},tn={key:1,class:"mt-2"},on={key:1,class:"p-2 space-y-2"},nn=["title"],sn=oe({__name:"MixerControlPanel",props:{iframeRef:{}},emits:["close"],setup(g,{emit:w}){const r=g,m=b(null),p=Uo(m);ie(()=>{var c;return(c=r.iframeRef)==null?void 0:c.value},c=>{c?(console.log("[MixerControlPanel] Iframe ref available, updating:",c),m.value=c):m.value=null},{immediate:!0}),ue(()=>{var c;(c=r.iframeRef)!=null&&c.value&&(console.log("[MixerControlPanel] On mount, iframe ref:",r.iframeRef.value),m.value=r.iframeRef.value)});const $=I(()=>p.sources.value),x=I(()=>p.isRecording.value),y=p.setLayout,S=p.toggleMute,D=p.setVolume,a=p.startRecording,f=p.stopRecording,{cameras:l}=Qe(),k=b(null),R=b(!1),O=b(!1),j=b(null),T=b(!1);function H(c){var s,P,ee;if(console.log("[MixerControlPanel] Switching to scene",c,"setLayout:",y,"iframeRef:",(s=r.iframeRef)==null?void 0:s.value,"dummyRef:",m.value,"vdo.isReady:",p.isReady.value),!y){console.warn("[MixerControlPanel] setLayout not available");return}if(p.isReady.value||(console.warn("[MixerControlPanel] VDO.ninja not ready yet (isReady:",p.isReady.value,"connectionState:",p.connectionState.value,")"),console.warn("[MixerControlPanel] Attempting anyway - VDO.ninja might queue the command")),!((ee=(P=r.iframeRef)==null?void 0:P.value)!=null&&ee.contentWindow)){console.error("[MixerControlPanel] Iframe contentWindow not available!");return}const o=c-1;console.log("[MixerControlPanel] Calling setLayout with layout number",o,"for scene",c),console.log("[MixerControlPanel] Iframe:",r.iframeRef.value,"ContentWindow:",r.iframeRef.value.contentWindow);try{y(o),j.value=c,console.log("[MixerControlPanel] setLayout called successfully")}catch(ce){console.error("[MixerControlPanel] Error calling setLayout:",ce)}}function K(c){console.log("[MixerControlPanel] Toggling mute for",c,"toggleMute:",S),S?S(c):console.warn("[MixerControlPanel] toggleMute not available")}function N(c,o){D&&D(c,o)}function F(){console.log("[MixerControlPanel] Recording toggle, current:",x.value,"startRecording:",a,"stopRecording:",f),x.value?f?f():console.warn("[MixerControlPanel] stopRecording not available"):a?a():console.warn("[MixerControlPanel] startRecording not available")}function z(c){k.value=c,R.value=!0}function n(){R.value=!1,k.value=null}const t=I(()=>Array.from($.value.values()));return I(()=>l.value.filter(c=>t.value.some(o=>{var s;return((s=o.label)==null?void 0:s.toLowerCase().includes(c.name.toLowerCase()))||o.id===c.name}))),(c,o)=>(u(),d("div",{class:B(["mixer-control-panel fixed top-4 right-4 z-50 bg-preke-bg-surface border border-preke-border rounded-lg shadow-lg transition-all duration-300",T.value?"w-12":"w-80"])},[e("div",Lo,[T.value?M("",!0):(u(),d("h3",Vo,"Mixer Controls")),e("button",{onClick:o[0]||(o[0]=s=>T.value=!T.value),class:"p-1 rounded hover:bg-preke-bg-elevated transition-colors",title:T.value?"Expand":"Collapse"},[(u(),d("svg",{class:B(["w-4 h-4 transition-transform",{"rotate-180":T.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...o[4]||(o[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,jo)]),T.value?(u(),d("div",on,[e("button",{onClick:o[3]||(o[3]=s=>H(1)),class:"w-full aspect-square flex items-center justify-center text-xs font-bold rounded bg-preke-bg-elevated hover:bg-preke-bg-elevated/80",title:"Scene 1"}," 1 "),e("button",{onClick:F,class:B(["w-full aspect-square flex items-center justify-center rounded",x.value.value?"bg-red-600 text-white":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80"]),title:x.value.value?"Stop Recording":"Start Recording"},[...o[16]||(o[16]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"6"})],-1)])],10,nn)])):(u(),d("div",Io,[e("div",null,[o[5]||(o[5]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Scenes",-1)),e("div",Eo,[(u(),d(Y,null,Z(9,s=>e("button",{key:s,onClick:P=>H(s),class:B(["aspect-square flex items-center justify-center text-sm font-bold rounded transition-all",j.value===s?"bg-preke-purple text-white ring-2 ring-preke-purple":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 text-preke-text"])},C(s),11,Bo)),64))])]),e("div",null,[o[8]||(o[8]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Recording",-1)),e("button",{onClick:F,class:B(["w-full px-4 py-2 rounded transition-all",x.value.value?"bg-red-600 hover:bg-red-700 text-white":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 text-preke-text"])},[e("span",Ho,[x.value.value?(u(),d("svg",Fo,[...o[6]||(o[6]=[e("circle",{cx:"12",cy:"12",r:"6"},null,-1)])])):(u(),d("svg",Wo,[...o[7]||(o[7]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1)])])),te(" "+C(x.value.value?"Stop Recording":"Start Recording"),1)])],2)]),t.value.length>0?(u(),d("div",Ko,[o[11]||(o[11]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Sources",-1)),e("div",Ao,[(u(!0),d(Y,null,Z(t.value,s=>(u(),d("div",{key:s.id,class:"p-2 bg-preke-bg-elevated rounded"},[e("div",qo,[e("span",No,C(s.label||s.id),1),e("button",{onClick:P=>K(s.id),class:B(["p-1 rounded hover:bg-preke-bg-surface transition-colors",s.muted?"text-red-400":"text-preke-text-dim"]),title:s.muted?"Unmute":"Mute"},[s.muted?(u(),d("svg",Go,[...o[9]||(o[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(u(),d("svg",Xo,[...o[10]||(o[10]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},null,-1)])]))],10,zo)]),s.hasAudio?(u(),d("input",{key:0,type:"range",value:s.audioLevel||100,onInput:P=>N(s.id,Number(P.target.value)),min:"0",max:"200",class:"w-full h-1 bg-preke-bg-base rounded-lg appearance-none cursor-pointer accent-preke-gold"},null,40,Yo)):M("",!0)]))),128))])])):M("",!0),W(l).length>0?(u(),d("div",Qo,[o[13]||(o[13]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Camera Controls",-1)),e("div",Zo,[(u(!0),d(Y,null,Z(W(l),s=>(u(),d("button",{key:s.name,onClick:P=>z(s.name),class:"w-full px-3 py-2 text-left text-xs bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 rounded transition-colors"},[e("span",en,[e("span",null,C(s.name),1),o[12]||(o[12]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])],8,Jo))),128))])])):M("",!0),e("div",null,[o[15]||(o[15]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"PTZ Controller",-1)),O.value?(u(),d("div",tn,[J(Ze,{"camera-name":k.value,onClose:o[2]||(o[2]=s=>O.value=!1)},null,8,["camera-name"])])):(u(),d("button",{key:0,onClick:o[1]||(o[1]=s=>O.value=!0),class:"w-full px-3 py-2 text-left text-xs bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 rounded transition-colors"},[...o[14]||(o[14]=[e("span",{class:"flex items-center justify-between"},[e("span",null,"Open PTZ Controller"),e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})])],-1)])]))])])),R.value&&k.value?(u(),re(Je,{key:2,"camera-name":k.value,onClose:n},null,8,["camera-name"])):M("",!0)],2))}}),an=ge(sn,[["__scopeId","data-v-5be44a96"]]),rn={class:"camera-push-bar border-t border-preke-bg-surface bg-preke-bg-elevated","data-testid":"camera-push-bar"},ln={class:"flex items-center gap-2"},un={class:"text-preke-text-dim"},cn={key:0,class:"px-4 pb-3"},dn={key:0,class:"flex gap-3 flex-wrap"},pn={class:"text-sm font-medium"},mn={class:"text-xs text-preke-text-dim"},gn=["onClick"],fn={key:1,class:"text-sm text-preke-text-dim py-2"},vn={class:"fixed -left-[9999px] -top-[9999px] w-[10px] h-[10px] overflow-hidden pointer-events-none opacity-0"},bn=["src","onLoad","onError","title"],xn=oe({__name:"CameraPushBar",setup(g){const w=Ce(),r=b(new Map),m=b(!0),p=I(()=>w.inputs.filter(a=>a.hasSignal));ue(()=>{console.log("[CameraPush] Component mounted"),console.log("[CameraPush] Initial inputs:",w.inputs.length),console.log("[CameraPush] Initial cameras with signal:",p.value.length),console.log("[CameraPush] Inputs loaded:",w.inputsLoaded)}),ie(()=>w.inputsLoaded,a=>{if(a){console.log("[CameraPush] Inputs loaded, checking for cameras with signal");const f=p.value;f.length>0&&console.log(`[CameraPush] Found ${f.length} cameras with signal after inputs loaded`)}}),ie(p,async a=>{console.log(`[CameraPush] Cameras with signal changed: ${a.length}`,a.map(l=>l.id));for(const l of a)if(!r.value.has(l.id))try{console.log(`[CameraPush] Setting up ${l.id} (${l.label})`);const k=await he(l.id);if(!k){console.error(`[CameraPush] No WHEP URL for ${l.id}`);continue}console.log(`[CameraPush] WHEP URL for ${l.id}:`,k);const R=await ke(l.id,k,l.label);if(!R){console.error(`[CameraPush] Failed to build contribution URL for ${l.id}`);continue}console.log(`[CameraPush] Contribution URL for ${l.id}:`,R),console.log("[CameraPush] Full URL breakdown:",{cameraId:l.id,label:l.label,whepUrl:k,iframeSrc:R.substring(0,300)+"...",room:le,password:Pe.substring(0,4)+"..."}),r.value.set(l.id,{cameraId:l.id,label:l.label,status:"connecting",iframeSrc:R})}catch(k){console.error(`[CameraPush] Error setting up ${l.id}:`,k)}const f=new Set(a.map(l=>l.id));for(const[l]of r.value)f.has(l)||r.value.delete(l)},{immediate:!0});function $(a){const f=r.value.get(a);f&&(f.status="connected",console.log(`[CameraPush] ${a} iframe loaded - URL:`,f.iframeSrc.substring(0,200)+"..."),setTimeout(()=>{var k;const l=document.querySelector(`iframe[title*="${f.label}"]`);if(l)try{(l.contentDocument||((k=l.contentWindow)==null?void 0:k.document))&&console.log(`[CameraPush] ${a} iframe document accessible`)}catch{console.log(`[CameraPush] ${a} iframe loaded (cross-origin, cannot inspect content)`)}},2e3))}function x(a){const f=r.value.get(a);f&&(f.status="error",console.error(`[CameraPush] ${a} iframe failed to load - URL:`,f.iframeSrc.substring(0,200)+"..."))}async function y(a){const f=w.inputs.find(l=>l.id===a);if(!(!f||!f.hasSignal))try{const l=await he(a);if(!l){console.error(`[CameraPush] No WHEP URL for ${a}`);return}const k=await ke(a,l,f.label);if(!k){console.error(`[CameraPush] Failed to build contribution URL for ${a}`);return}r.value.set(a,{cameraId:a,label:f.label,status:"connecting",iframeSrc:k+`&_t=${Date.now()}`})}catch(l){console.error(`[CameraPush] Error retrying ${a}:`,l)}}function S(a){switch(a){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function D(a){switch(a){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(a,f)=>(u(),d("div",rn,[e("button",{onClick:f[0]||(f[0]=l=>m.value=!m.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-preke-bg-surface/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[e("div",ln,[f[1]||(f[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",un,"("+C(p.value.length)+" active)",1)]),(u(),d("svg",{class:B(["w-4 h-4 transition-transform",{"rotate-180":m.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...f[2]||(f[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),m.value?(u(),d("div",cn,[r.value.size>0?(u(),d("div",dn,[(u(!0),d(Y,null,Z(r.value,([l,k])=>(u(),d("div",{key:l,class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface rounded-lg"},[e("span",{class:B(["w-2 h-2 rounded-full",S(k.status)])},null,2),e("span",pn,C(k.label),1),e("span",mn,C(D(k.status)),1),k.status==="error"?(u(),d("button",{key:0,onClick:R=>y(l),class:"ml-2 text-xs text-preke-gold hover:underline"}," Retry ",8,gn)):M("",!0)]))),128))])):(u(),d("div",fn," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):M("",!0),e("div",vn,[(u(!0),d(Y,null,Z(r.value,([l,k])=>(u(),d("iframe",{key:l,src:k.iframeSrc,onLoad:R=>$(l),onError:R=>x(l),allow:"camera; microphone; autoplay; display-capture",class:"w-full h-full border-0",title:`Camera push for ${k.label}`,sandbox:"allow-same-origin allow-scripts allow-forms allow-popups allow-popups-to-escape-sandbox"},null,40,bn))),128))])]))}}),hn={class:"h-full flex flex-col bg-preke-bg"},kn={key:0,class:"px-4 py-2 bg-preke-bg-elevated border-b border-preke-bg-surface flex items-center justify-between text-xs text-preke-text-dim"},wn=["title"],yn={class:"flex-1 relative"},_n=["src"],Cn={key:0,class:"absolute inset-0 flex items-center justify-center bg-preke-bg"},Sn=["title"],$n=oe({__name:"MixerView",setup(g){const w=qe(),r=Ce(),m=Fe();function p(){w.push("/")}const $=b(!0),x=b(!1),y=b(!1),S=b("Starting mixer..."),D=b(null),a=b(!0),f=I(()=>We.isElectron()),l=b(!0),k=I(()=>f.value&&l.value);function R(){if(typeof window>"u")return;const n=window.localStorage.getItem("preke_mixer_use_local_bridge");n!==null?l.value=n==="true":l.value=!0,console.log("[Mixer] Local bridge preference:",l.value)}function O(){l.value=!l.value,typeof window<"u"&&window.localStorage.setItem("preke_mixer_use_local_bridge",String(l.value))}const j=I(()=>r.inputs.filter(n=>n.hasSignal)),T=b("");async function H(){const n=await Ge(),t=await Xe({mediamtxHost:n||void 0,room:le});if(t)T.value=t,console.log("[Mixer] Mixer URL initialized with API key");else{const c=await $e()||"r58-vdo.itagenten.no",o=Ye(),s=new URL(`${o}://${c}/mixer.html`);s.searchParams.set("room",le),s.searchParams.set("password",Pe),s.searchParams.set("css",`${o}://${c}/css/preke-colors.css`),T.value=s.toString(),console.warn("[Mixer] Using fallback URL without API key")}}function K(){console.log("[Mixer] VDO.ninja mixer iframe loaded"),x.value=!0,S.value="Waiting for cameras..."}function N(){$.value=!1}async function F(){const n=performance.now();S.value="Starting camera bridge...";for(let t=0;t<40;t++){try{if((await(await fetch(await ae("/api/mode/status"))).json()).current_mode==="mixer"){const s=Math.round((performance.now()-n)/1e3);if(s>=5){console.log(`[Mixer] Bridge likely ready after ${s}s`),y.value=!0,S.value="Cameras connecting...";return}}}catch{}await new Promise(c=>setTimeout(c,500)),S.value=`Starting camera bridge... (${Math.round((performance.now()-n)/1e3)}s)`}console.log("[Mixer] Bridge wait timeout - continuing anyway"),y.value=!0}async function z(){var t;if(!Ke())return;S.value="Checking mode...",await m.fetchCapabilities();const n=(t=m.capabilities)==null?void 0:t.current_mode;if(n&&n!=="mixer"){console.log("[Mixer] Not in mixer mode, switching..."),S.value="Switching to mixer mode...";try{(await fetch(await ae("/api/mode/mixer"),{method:"POST"})).ok&&(await m.fetchCapabilities(),V.success("Switched to Mixer mode"))}catch(c){console.warn("[Mixer] Failed to switch mode:",c)}}}return ue(async()=>{const n=performance.now();f.value&&(R(),console.log("[Mixer] Electron app detected, useLocalBridge:",l.value,"showCameraPushBar:",k.value)),await H(),await Promise.all([z(),r.fetchInputs()]),await F(),console.log(`[Mixer] Total load time: ${Math.round(performance.now()-n)}ms`)}),(n,t)=>(u(),d(Y,null,[J(de,{name:"fade"},{default:pe(()=>[$.value?(u(),re(et,{key:0,mode:"mixer","content-ready":x.value&&y.value,"min-time":2e3,"max-time":2e4,"show-cancel":!0,onReady:N,onCancel:p},null,8,["content-ready"])):M("",!0)]),_:1}),J(de,{name:"content-fade"},{default:pe(()=>[Q(e("div",hn,[J(Do,{"room-name":W(le),"camera-count":j.value.length},null,8,["room-name","camera-count"]),f.value?(u(),d("div",kn,[e("span",null,"Camera sources: "+C(l.value?"Local bridge":"External bridge"),1),e("button",{class:"text-preke-gold hover:underline",onClick:O,title:l.value?"Disable local bridge to use external fallback":"Enable local bridge for Electron"},C(l.value?"Use fallback":"Use local bridge"),9,wn)])):M("",!0),e("div",yn,[e("iframe",{ref_key:"iframeRef",ref:D,src:T.value,onLoad:K,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,_n),x.value?M("",!0):(u(),d("div",Cn,[...t[1]||(t[1]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-8 h-8 border-2 border-preke-gold border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-preke-text-muted"},"Loading VDO.ninja mixer..."),e("span",{class:"text-xs text-preke-text-subtle"},"Cameras will appear when bridge is running")],-1)])])),x.value?(u(),d("button",{key:1,onClick:t[0]||(t[0]=c=>a.value=!a.value),class:"absolute top-4 left-4 z-40 p-2 bg-preke-bg-surface border border-preke-border rounded-lg shadow-lg hover:bg-preke-bg-elevated transition-colors",title:a.value?"Hide Controls":"Show Controls"},[...t[2]||(t[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)])],8,Sn)):M("",!0),a.value&&x.value?(u(),re(an,{"iframe-ref":D.value,key:x.value?"ready":"loading"},null,8,["iframe-ref"])):M("",!0)]),k.value?(u(),re(xn,{key:1})):M("",!0)],512),[[Ae,!$.value]])]),_:1})],64))}}),Dn=ge($n,[["__scopeId","data-v-1f056b95"]]);export{Dn as default};
