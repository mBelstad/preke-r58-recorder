import{X as Ue,r as b,j as A,b as se,d as ae,I as le,c as m,f as C,e,w as Y,Q as xe,A as ne,x as J,F as Q,y as Z,t as S,n as W,q,J as Le,h as V,i as u,Y as ke,E as he,m as ee,T as ie,p as ue,Z as Ve,_ as de,o as pe,l as je,D as Ie,u as Ee,W as Be,v as He,g as Fe}from"./index-DUBhsRZp.js";import{b as ye,o as Ae,a as Ke,V as re,g as we,c as We,d as qe,e as ze,f as Ne}from"./vdoninja-BtEraQ-W.js";import{u as Ge,C as Xe,M as Ye}from"./ModeLoadingScreen-gxfWckTm.js";const N=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],me=Ue("streaming",()=>{const c=b([]),h=b(!1),r=b(null),d=b({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),i=A(()=>c.value.find(n=>n.id===r.value)),w=A(()=>c.value.filter(n=>n.enabled)),f=A(()=>N),k=A(()=>{const n=window.location.hostname,t=n==="localhost"||n==="127.0.0.1",a=t?"localhost":"app.itagenten.no";return{rtmp:t?"rtmp://localhost:1935/mixer_program":"rtmp://app.itagenten.no:1935/mixer_program",rtsp:t?"rtsp://localhost:8554/mixer_program":"rtsp://app.itagenten.no:8554/mixer_program",srt:t?"srt://localhost:8890?streamid=read:mixer_program":"srt://app.itagenten.no:8890?streamid=read:mixer_program",hls:`https://${a}/hls/mixer_program/index.m3u8`,whep:`https://${a}/mixer_program/whep`}});function y(n,t){const a=N.find(l=>l.id===n);if(!a)throw new Error(`Unknown platform: ${n}`);const o={id:`dest-${Date.now()}`,platformId:n,name:t||a.name,streamKey:"",enabled:!1};return c.value.push(o),o}function O(n,t){const a=c.value.findIndex(o=>o.id===n);a!==-1&&(c.value[a]={...c.value[a],...t})}function p(n){const t=c.value.findIndex(a=>a.id===n);t!==-1&&c.value.splice(t,1),r.value===n&&(r.value=null)}function j(n){r.value=n}function L(n){d.value.enabled=n}function B(n){d.value={...d.value,...n}}function H(){h.value=!0}function D(){h.value=!1}function M(n){const t=N.find(a=>a.id===n.platformId);return t?n.platformId==="custom"?`${n.name}${n.streamKey}`:`${t.rtmpBaseUrl}${n.streamKey}`:""}function I(){const n=window.location.hostname;return`srt://${n==="localhost"||n==="127.0.0.1"?"localhost":"app.itagenten.no"}:${d.value.port}?streamid=read:${d.value.streamId}`}function P(){try{const n=localStorage.getItem("r58-streaming-destinations");if(n){const t=JSON.parse(n);c.value=t.destinations||[],t.srtOutput&&(d.value={...d.value,...t.srtOutput})}}catch(n){console.warn("Failed to load saved streaming destinations:",n)}}function _(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:c.value,srtOutput:d.value}))}catch(n){console.warn("Failed to save streaming destinations:",n)}}async function U(){try{const n=w.value;if(n.length===0)return console.warn("[Streaming] No enabled destinations to stream to"),{success:!1,message:"No destinations configured"};const t=n.map(l=>{var $;return{platform:l.platformId,rtmp_url:(($=N.find(te=>te.id===l.platformId))==null?void 0:$.rtmpBaseUrl)||"",stream_key:l.streamKey,enabled:!0}}),a=await fetch(await se("/api/streaming/rtmp/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({destinations:t})}),o=await a.json();if(!a.ok)throw new Error(o.detail||"Failed to start RTMP relay");return console.log("[Streaming] RTMP relay configured via MediaMTX runOnReady:",o),{success:!0,message:o.message||`Streaming to ${n.length} destination(s)`}}catch(n){const t=n instanceof Error?n.message:"Failed to start RTMP relay";return console.error("[Streaming] Failed to start RTMP relay:",n),{success:!1,message:t}}}async function K(){try{const n=await fetch(await se("/api/streaming/rtmp/stop"),{method:"POST"}),t=await n.json();if(!n.ok)throw new Error(t.detail||"Failed to stop RTMP relay");return console.log("[Streaming] RTMP relay stopped"),{success:!0,message:"RTMP relay stopped"}}catch(n){const t=n instanceof Error?n.message:"Failed to stop RTMP relay";return console.error("[Streaming] Failed to stop RTMP relay:",n),{success:!1,message:t}}}async function E(){try{const n=await fetch(await se("/api/streaming/status"));if(!n.ok)throw new Error("Failed to get streaming status");return await n.json()}catch(n){return console.error("[Streaming] Failed to get streaming status:",n),null}}return P(),{destinations:c,isStreaming:h,activeDestinationId:r,srtOutput:d,activeDestination:i,enabledDestinations:w,platforms:f,programOutputUrls:k,addDestination:y,updateDestination:O,removeDestination:p,setActiveDestination:j,toggleSrtOutput:L,updateSrtConfig:B,startStreaming:H,stopStreaming:D,buildRtmpUrl:M,getSrtOutputUrl:I,saveDestinations:_,loadSavedDestinations:P,startRtmpRelay:U,stopRtmpRelay:K,getStreamingStatus:E}}),Qe={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Je={class:"relative bg-preke-bg-elevated border border-preke-bg-surface rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},Ze={class:"p-6 overflow-y-auto max-h-[60vh]"},et={key:0,class:"mb-8 p-6 bg-gradient-to-br from-amber-600/20 to-red-600/20 rounded-xl border border-amber-500/30"},tt={class:"flex gap-3 mb-4"},ot=["placeholder"],nt={class:"text-xs text-preke-text-dim"},st=["href"],at={class:"mb-8"},rt={class:"flex items-center justify-between mb-4"},lt={key:0,class:"mb-4 p-4 bg-preke-bg-surface rounded-lg"},it={class:"grid grid-cols-2 gap-2"},ut=["onClick"],ct={class:"text-xl"},dt={key:1,class:"space-y-3"},pt=["onClick"],mt={class:"text-xl"},gt={class:"flex-1"},vt={class:"font-medium"},ft={class:"text-xs text-preke-text-dim"},bt=["onClick"],xt=["onClick"],kt={key:2,class:"text-preke-text-dim text-sm"},ht={key:1,class:"mb-8 p-4 bg-preke-bg-surface rounded-lg"},yt={class:"text-lg font-medium mb-4"},wt={class:"space-y-4"},_t=["placeholder"],St={key:0},Ct={class:"flex gap-2"},Mt={class:"mb-8"},$t={class:"space-y-3"},Rt={class:"p-3 bg-preke-bg-surface rounded-lg"},Dt={class:"flex items-center justify-between mb-1"},Pt={class:"text-xs text-preke-text-dim break-all"},Ot={class:"p-3 bg-preke-bg-surface rounded-lg"},Tt={class:"flex items-center justify-between mb-1"},Ut={class:"text-xs text-preke-text-dim break-all"},Lt={class:"p-3 bg-preke-bg-surface rounded-lg"},Vt={class:"flex items-center justify-between mb-1"},jt={class:"text-xs text-preke-text-dim break-all"},It={class:"p-3 bg-preke-bg-surface rounded-lg"},Et={class:"flex items-center justify-between mb-1"},Bt={class:"text-xs text-preke-text-dim break-all"},Ht={class:"p-3 bg-preke-bg-surface rounded-lg"},Ft={class:"flex items-center justify-between mb-1"},At={class:"text-xs text-preke-text-dim break-all"},Kt={class:"p-4 bg-preke-bg-surface rounded-lg"},Wt={class:"flex items-center gap-3 mb-4"},qt=ae({__name:"StreamingSettings",setup(c,{expose:h}){const r=me(),d=b(!1),i=b(null),w=b(!1),f=b("youtube"),k=b("");b(""),b("");const y=A(()=>r.destinations),O=A(()=>N),p=A(()=>r.programOutputUrls);function j(){d.value=!0}function L(){d.value=!1,i.value=null,w.value=!1}function B(n){const t=r.addDestination(n);i.value=t,w.value=!1,r.saveDestinations()}function H(){i.value&&(r.updateDestination(i.value.id,i.value),r.saveDestinations(),i.value=null,V.success("Streaming destination saved"))}function D(n){r.removeDestination(n),r.saveDestinations(),V.info("Destination removed")}function M(n){r.updateDestination(n.id,{enabled:!n.enabled}),r.saveDestinations()}function I(n,t){navigator.clipboard.writeText(n),V.success(`${t} copied to clipboard`)}function P(n){const t=N.find(a=>a.id===n);return(t==null?void 0:t.icon)||"ðŸ“¡"}function _(n){const t=N.find(a=>a.id===n);return(t==null?void 0:t.name)||"Unknown"}function U(){const n=N.find(t=>t.id===f.value);return(n==null?void 0:n.streamKeyPlaceholder)||"Enter stream key"}function K(){switch(f.value){case"youtube":return"https://support.google.com/youtube/answer/2907883";case"twitch":return"https://help.twitch.tv/s/article/twitch-stream-key-faq";case"facebook":return"https://www.facebook.com/help/587160588142067";case"restream":return"https://support.restream.io/en/";default:return"#"}}function E(){if(!k.value.trim()){V.error("Please enter your stream key");return}const n=r.addDestination(f.value);r.updateDestination(n.id,{streamKey:k.value,enabled:!0}),r.saveDestinations(),k.value="",V.success(`${_(f.value)} configured and enabled!`)}return h({open:j}),(n,t)=>{var a;return u(),le(Le,{to:"body"},[d.value?(u(),m("div",Qe,[e("div",{class:"absolute inset-0 bg-black/60",onClick:L}),e("div",Je,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-preke-bg-surface"},[t[13]||(t[13]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:L,class:"text-preke-text-dim hover:text-preke-text text-2xl"}," Ã— ")]),e("div",Ze,[y.value.length===0?(u(),m("section",et,[t[16]||(t[16]=e("h3",{class:"text-xl font-semibold mb-2 flex items-center gap-2"}," ðŸ”´ Quick Setup: Stream to YouTube ",-1)),t[17]||(t[17]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Get streaming in seconds! Just paste your stream key below. ",-1)),e("div",tt,[Y(e("select",{"onUpdate:modelValue":t[0]||(t[0]=o=>f.value=o),class:"px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg text-base"},[...t[14]||(t[14]=[e("option",{value:"youtube"},"â–¶ï¸ YouTube Live",-1),e("option",{value:"twitch"},"ðŸ“º Twitch",-1),e("option",{value:"facebook"},"ðŸ“˜ Facebook",-1),e("option",{value:"restream"},"ðŸ”„ Restream",-1)])],512),[[xe,f.value]]),Y(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>k.value=o),type:"password",placeholder:U(),class:"flex-1 px-4 py-3 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg font-mono text-base focus:border-amber-500 focus:outline-none"},null,8,ot),[[ne,k.value]]),e("button",{onClick:E,class:"px-6 py-3 bg-red-600 hover:bg-red-500 text-white rounded-lg font-semibold transition-colors"}," Save & Enable ")]),e("p",nt,[t[15]||(t[15]=J(" ðŸ”’ Your stream key is stored locally on this device and never sent to any server. ",-1)),e("a",{href:K(),target:"_blank",class:"text-amber-400 hover:underline ml-2"}," Where do I find my stream key? â†’ ",8,st)])])):C("",!0),e("section",at,[e("div",rt,[t[18]||(t[18]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[2]||(t[2]=o=>w.value=!w.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),w.value?(u(),m("div",lt,[t[19]||(t[19]=e("p",{class:"text-sm text-preke-text-dim mb-3"},"Select a streaming platform:",-1)),e("div",it,[(u(!0),m(Q,null,Z(O.value,o=>(u(),m("button",{key:o.id,onClick:l=>B(o.id),class:"flex items-center gap-2 p-3 bg-preke-bg-elevated hover:bg-preke-gold/20 rounded-lg transition-colors text-left"},[e("span",ct,S(o.icon),1),e("span",null,S(o.name),1)],8,ut))),128))])])):C("",!0),y.value.length>0?(u(),m("div",dt,[(u(!0),m(Q,null,Z(y.value,o=>(u(),m("div",{key:o.id,class:"flex items-center gap-3 p-3 bg-preke-bg-surface rounded-lg"},[e("button",{onClick:l=>M(o),class:W(["w-10 h-6 rounded-full transition-colors relative",o.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:W(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",o.enabled?"left-5":"left-1"])},null,2)],10,pt),e("span",mt,S(P(o.platformId)),1),e("div",gt,[e("div",vt,S(o.name),1),e("div",ft,S(o.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+o.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:l=>i.value={...o},class:"text-preke-gold hover:underline text-sm"}," Edit ",8,bt),e("button",{onClick:l=>D(o.id),class:"text-preke-red hover:underline text-sm"}," Remove ",8,xt)]))),128))])):(u(),m("p",kt," No streaming destinations configured. Add a platform above. "))]),i.value?(u(),m("section",ht,[e("h3",yt," Edit "+S(_(i.value.platformId)),1),e("div",wt,[e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Display Name",-1)),Y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>i.value.name=o),type:"text",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none"},null,512),[[ne,i.value.name]])]),e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"Stream Key",-1)),Y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>i.value.streamKey=o),type:"password",placeholder:(a=q(N).find(o=>o.id===i.value.platformId))==null?void 0:a.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,8,_t),[[ne,i.value.streamKey]]),t[22]||(t[22]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),i.value.platformId==="custom"?(u(),m("div",St,[t[23]||(t[23]=e("label",{class:"block text-sm text-preke-text-dim mb-1"},"RTMP URL",-1)),Y(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>i.value.name=o),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-bg-surface rounded-lg focus:border-preke-gold focus:outline-none font-mono"},null,512),[[ne,i.value.name]])])):C("",!0),e("div",Ct,[e("button",{onClick:H,class:"btn btn-primary"}," Save "),e("button",{onClick:t[6]||(t[6]=o=>i.value=null),class:"btn"}," Cancel ")])])])):C("",!0),e("section",Mt,[t[32]||(t[32]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[33]||(t[33]=e("p",{class:"text-sm text-preke-text-dim mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",$t,[e("div",Rt,[e("div",Dt,[t[24]||(t[24]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[7]||(t[7]=o=>I(p.value.srt,"SRT URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Pt,S(p.value.srt),1),t[25]||(t[25]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",Ot,[e("div",Tt,[t[26]||(t[26]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[8]||(t[8]=o=>I(p.value.rtmp,"RTMP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Ut,S(p.value.rtmp),1)]),e("div",Lt,[e("div",Vt,[t[27]||(t[27]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[9]||(t[9]=o=>I(p.value.rtsp,"RTSP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",jt,S(p.value.rtsp),1)]),e("div",It,[e("div",Et,[t[28]||(t[28]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[10]||(t[10]=o=>I(p.value.hls,"HLS URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",Bt,S(p.value.hls),1),t[29]||(t[29]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",Ht,[e("div",Ft,[t[30]||(t[30]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[11]||(t[11]=o=>I(p.value.whep,"WHEP URL")),class:"text-xs text-preke-gold hover:underline"}," Copy ")]),e("code",At,S(p.value.whep),1),t[31]||(t[31]=e("p",{class:"text-xs text-preke-text-dim mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[36]||(t[36]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",Kt,[e("div",Wt,[e("button",{onClick:t[12]||(t[12]=o=>q(r).toggleSrtOutput(!q(r).srtOutput.enabled)),class:W(["w-10 h-6 rounded-full transition-colors relative",q(r).srtOutput.enabled?"bg-preke-green":"bg-preke-bg-elevated"])},[e("span",{class:W(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",q(r).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[34]||(t[34]=e("span",null,"Enable SRT Output",-1))]),t[35]||(t[35]=e("div",{class:"text-sm text-preke-text-dim"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-preke-bg-surface"},[e("button",{onClick:L,class:"btn"},"Close")])])])):C("",!0)])}}}),zt={class:"program-output space-y-3","data-testid":"program-output"},Nt={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface rounded-lg","data-testid":"program-output-status"},Gt={class:"text-sm font-medium","data-testid":"program-output-text"},Xt={key:0,class:"space-y-2"},Yt={class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},Qt={class:"flex-1 text-xs truncate text-preke-text-dim"},Jt={key:0,class:"flex items-center gap-2 px-3 py-2 bg-preke-bg-surface/50 rounded-lg"},Zt={class:"text-xs text-preke-text-dim"},eo={key:1,class:"text-xs text-preke-text-dim px-3"},to={class:"hidden"},oo=["src"],no=ae({__name:"ProgramOutput",setup(c){const h=ke(),r=me(),d=b(!1),i=b("idle"),w=b("");function f(){return"https://app.itagenten.no/mixer_program/whip"}async function k(){if(d.value)return;i.value="connecting";const D=await ye(f());if(!D){i.value="error",console.error("[ProgramOutput] Failed to build VDO.ninja URL - VDO.ninja not configured");return}w.value=D,d.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX:",D)}function y(){d.value&&(d.value=!1,w.value="",i.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function O(){d.value&&(i.value="live",console.log("[ProgramOutput] WHIP push connected"))}function p(){i.value="error",console.error("[ProgramOutput] WHIP push failed")}async function j(){y(),await new Promise(D=>setTimeout(D,500)),await k()}he(()=>h.isLive,async D=>{D?await k():y()});function L(){switch(i.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function B(){switch(i.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function H(){const D=r.programOutputUrls.srt;navigator.clipboard.writeText(D),V.success("SRT URL copied")}return(D,M)=>(u(),m("div",zt,[e("div",Nt,[e("span",{class:W(["w-2 h-2 rounded-full",L()]),"data-testid":"program-output-indicator"},null,2),e("span",Gt,S(B()),1),i.value==="error"?(u(),m("button",{key:0,onClick:M[0]||(M[0]=I=>j()),class:"ml-auto text-xs text-preke-gold hover:underline"}," Retry ")):C("",!0)]),i.value==="live"?(u(),m("div",Xt,[e("div",Yt,[M[1]||(M[1]=e("span",{class:"text-xs text-preke-text-dim"},"ðŸ”´ SRT:",-1)),e("code",Qt,S(q(r).programOutputUrls.srt),1),e("button",{onClick:H,class:"text-xs text-preke-gold hover:underline"},"Copy")]),q(r).enabledDestinations.length>0?(u(),m("div",Jt,[M[2]||(M[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",Zt,S(q(r).enabledDestinations.length)+" streaming destination"+S(q(r).enabledDestinations.length>1?"s":"")+" active ",1)])):C("",!0)])):C("",!0),i.value==="idle"?(u(),m("p",eo," Program output will start automatically when you go live. ")):C("",!0),e("div",to,[d.value&&w.value?(u(),m("iframe",{key:0,src:w.value,onLoad:O,onError:p,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,oo)):C("",!0)])]))}}),so={class:"streaming-control-panel"},ao={class:"control-bar"},ro={key:0,class:"control-bar__room"},lo={class:"control-bar__room-name"},io={key:0,class:"control-bar__camera-count"},uo={key:1,class:"control-bar__divider"},co={class:"control-bar__status"},po={class:"control-bar__status-text"},mo={key:0,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},go={key:1,class:"control-bar__btn-icon",fill:"currentColor",viewBox:"0 0 24 24"},vo={key:3,class:"control-bar__destinations"},fo={class:"control-bar__destinations-list"},bo=["title"],xo={key:0,class:"quick-setup"},ko={class:"quick-setup__form"},ho={class:"quick-setup__platform"},yo={class:"quick-setup__platform-icon"},wo={class:"quick-setup__input-wrap"},_o=["placeholder"],So={class:"hidden"},Co=ae({__name:"StreamingControlPanel",props:{roomName:{default:""},cameraCount:{default:0}},setup(c){const h=c,r=ke(),d=me(),i=b(null),w=b(null),f=b(!1),k=b("youtube"),y=b(""),O=A(()=>r.isLive),p=A(()=>d.destinations.length>0),j=A(()=>d.enabledDestinations.length>0),L=A(()=>O.value?"live":"idle");function B(){O.value?D():H()}async function H(){if(r.setLive(!0),d.enabledDestinations.length>0){const o=await d.startRtmpRelay();o.success?V.success(o.message):V.error(`RTMP relay failed: ${o.message}`)}else V.success("Streaming started (no RTMP destinations configured)")}async function D(){if(r.setLive(!1),d.enabledDestinations.length>0){const o=await d.stopRtmpRelay();o.success||V.warning(`Note: ${o.message}`)}V.info("Streaming stopped")}function M(){Ae(1)?V.success("Program window opened"):V.error("Popup blocked - please allow popups for this site")}async function I(){const l=await ye("https://app.itagenten.no/mixer_program/whip");if(!l){V.error("Failed to build scene output URL");return}window.open(l,"vdo-scene-output","width=1280,height=720,menubar=no,toolbar=no")?V.success("Scene output window opened - streaming to MediaMTX"):V.error("Popup blocked - please allow popups for this site")}async function P(){const o=await Ke(0,{room:h.roomName||re});if(!o){V.error("Failed to build scene view URL");return}await navigator.clipboard.writeText(o),V.success('Scene view link copied! Open this URL, then use "Publishing setup" in the mixer to screen-share it to MediaMTX')}function _(){var o;(o=i.value)==null||o.open()}function U(){f.value=!f.value}function K(){if(!y.value.trim()){V.error("Please enter your stream key");return}if(!N.find($=>$.id===k.value))return;const l=d.destinations.find($=>$.platformId===k.value);if(l)d.updateDestination(l.id,{streamKey:y.value,enabled:!0});else{const $=d.addDestination(k.value);d.updateDestination($.id,{streamKey:y.value,enabled:!0})}d.saveDestinations(),f.value=!1,y.value="",H()}function E(){const o=N.find(l=>l.id===k.value);return(o==null?void 0:o.streamKeyPlaceholder)||"Enter your stream key"}function n(){const o=N.find(l=>l.id===k.value);return(o==null?void 0:o.icon)||"ðŸ“¡"}function t(){switch(L.value){case"live":return"control-bar__dot--live";case"connecting":return"control-bar__dot--connecting";case"error":return"control-bar__dot--error";default:return"control-bar__dot--idle"}}function a(){switch(L.value){case"live":return"LIVE";case"connecting":return"Connecting...";case"error":return"Error";default:return"Offline"}}return(o,l)=>(u(),m("div",so,[e("div",ao,[h.roomName?(u(),m("div",ro,[l[3]||(l[3]=e("span",{class:"control-bar__room-label"},"Room",-1)),e("span",lo,S(h.roomName),1),h.cameraCount>0?(u(),m("span",io,S(h.cameraCount)+" cam"+S(h.cameraCount!==1?"s":""),1)):C("",!0)])):C("",!0),h.roomName?(u(),m("div",uo)):C("",!0),e("div",co,[e("span",{class:W(["control-bar__dot",t()])},null,2),e("span",po,S(a()),1)]),l[12]||(l[12]=e("div",{class:"control-bar__divider"},null,-1)),e("button",{onClick:B,class:W(["control-bar__btn",O.value?"control-bar__btn--stop":"control-bar__btn--start"])},[O.value?(u(),m("svg",mo,[...l[4]||(l[4]=[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"},null,-1)])])):(u(),m("svg",go,[...l[5]||(l[5]=[e("path",{d:"M8 5.14v14l11-7-11-7z"},null,-1)])])),J(" "+S(O.value?"Stop":"Start Streaming"),1)],2),p.value?C("",!0):(u(),m("button",{key:2,onClick:U,class:W(["control-bar__btn control-bar__btn--dashed",f.value?"control-bar__btn--active":""])},[...l[6]||(l[6]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})],-1),J(" Add Stream Key ",-1)])],2)),e("button",{onClick:M,class:"control-bar__btn control-bar__btn--secondary",title:"Open program output in new window"},[...l[7]||(l[7]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),J(" Watch ",-1)])]),e("button",{onClick:I,class:"control-bar__btn control-bar__btn--secondary",title:"Open scene output window - pushes mixed scene to MediaMTX for streaming (uses &whipout parameter)"},[...l[8]||(l[8]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),J(" Scene Output ",-1)])]),e("button",{onClick:P,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Copy scene view link - open this URL, then use 'Publishing setup' to screen-share it to MediaMTX"},[...l[9]||(l[9]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"})],-1)])]),e("button",{onClick:_,class:"control-bar__btn control-bar__btn--secondary control-bar__btn--icon-only",title:"Configure streaming destinations"},[...l[10]||(l[10]=[e("svg",{class:"control-bar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])]),j.value?(u(),m("div",vo,[l[11]||(l[11]=e("span",{class:"control-bar__destinations-label"},"To:",-1)),e("div",fo,[(u(!0),m(Q,null,Z(q(d).enabledDestinations,$=>(u(),m("span",{key:$.id,class:"control-bar__destination",title:$.name},S($.platformId==="youtube"?"â–¶ï¸":$.platformId==="twitch"?"ðŸ“º":"ðŸ”´"),9,bo))),128))])])):C("",!0)]),ee(ie,{name:"slide"},{default:ue(()=>[f.value?(u(),m("div",xo,[e("div",ko,[e("div",ho,[e("span",yo,S(n()),1),Y(e("select",{"onUpdate:modelValue":l[0]||(l[0]=$=>k.value=$),class:"quick-setup__select"},[...l[13]||(l[13]=[e("option",{value:"youtube"},"YouTube",-1),e("option",{value:"twitch"},"Twitch",-1),e("option",{value:"facebook"},"Facebook",-1),e("option",{value:"restream"},"Restream",-1)])],512),[[xe,k.value]])]),e("div",wo,[Y(e("input",{"onUpdate:modelValue":l[1]||(l[1]=$=>y.value=$),type:"password",placeholder:E(),class:"quick-setup__input",onKeyup:Ve(K,["enter"])},null,40,_o),[[ne,y.value]])]),e("button",{onClick:K,class:"quick-setup__go-live"}," ðŸ”´ Go Live "),e("button",{onClick:l[2]||(l[2]=$=>f.value=!1),class:"quick-setup__cancel"},"âœ•")])])):C("",!0)]),_:1}),e("div",So,[ee(no,{ref_key:"programOutputRef",ref:w},null,512)]),ee(qt,{ref_key:"streamingSettingsRef",ref:i},null,512)]))}}),Mo=de(Co,[["__scopeId","data-v-14999ed3"]]),ce="vdo-debug",$o=500,X=[];let ge=typeof localStorage<"u"&&localStorage.getItem(ce)==="true";function be(c){ge=c,typeof localStorage<"u"&&(c?localStorage.setItem(ce,"true"):localStorage.removeItem(ce)),console.log(`[VDO.ninja Debug] ${c?"Enabled":"Disabled"}`)}function oe(c){if(X.push(c),X.length>$o&&X.shift(),ge){const h=new Date(c.timestamp).toISOString().split("T")[1].slice(0,-1),r=c.direction==="outgoing"?"âž¡ï¸ OUT":"â¬…ï¸ IN",d=c.direction==="outgoing"?"color: #3b82f6; font-weight: bold":"color: #22c55e; font-weight: bold";console.groupCollapsed(`%c[VDO.ninja ${r}] %c${c.type}`,d,"color: inherit"),console.log("Time:",h),c.target&&console.log("Target:",c.target),console.log("Data:",c.data),c.raw&&c.raw!==c.data&&console.log("Raw:",c.raw),console.groupEnd()}}function _e(){return[...X]}function Ro(){X.length=0,console.log("[VDO.ninja Debug] Event history cleared")}function Se(){const c={total:X.length,incoming:0,outgoing:0,byType:{},lastActivity:X.length>0?X[X.length-1].timestamp:null};for(const h of X)h.direction==="incoming"?c.incoming++:c.outgoing++,c.byType[h.type]=(c.byType[h.type]||0)+1;return c}typeof window<"u"&&(window.__VDO_DEBUG__={getHistory:_e,clearHistory:Ro,getStats:Se,enable:()=>be(!0),disable:()=>be(!1),isEnabled:()=>ge});function Do(c){const h=b(!1),r=b(new Map),d=b(0),i=b(null),w=b(!1),f=b("disconnected"),k=b(null),y=we(),O=new Map;function p(s,v,g,F){var x;if(!((x=c.value)!=null&&x.contentWindow)){console.warn("[VDO.ninja] Cannot send command - iframe not ready"),k.value="iframe not ready";return}const T={action:s};v&&(T.target=v),g!==void 0&&(T.value=g),F!==void 0&&(T.value2=F),oe({timestamp:Date.now(),direction:"outgoing",type:s,target:v,data:{action:s,target:v,value:g,value2:F},raw:T});try{c.value.contentWindow.postMessage(T,"*")}catch(R){console.error("[VDO.ninja] Failed to send command:",R),k.value=String(R)}}function j(s,v){var F;if(!((F=c.value)!=null&&F.contentWindow)){console.warn("[VDO.ninja] Cannot send DOM command - iframe not ready");return}const g={action:"",target:s,...v};oe({timestamp:Date.now(),direction:"outgoing",type:"dom-manipulation",target:s,data:v,raw:g});try{c.value.contentWindow.postMessage(g,"*")}catch(T){console.error("[VDO.ninja] Failed to send DOM command:",T)}}function L(s,v=1){var T;const g=O.get(s)||s;if(g!==s&&console.log(`[VDO.ninja] Resolved UUID ${s} to stream ID ${g} for addToScene`),!((T=c.value)!=null&&T.contentWindow)){console.warn("[VDO.ninja] Cannot send addToScene - iframe not ready");return}const F={addToScene:v,target:g};oe({timestamp:Date.now(),direction:"outgoing",type:"addToScene",target:g,data:{sceneNumber:v},raw:F});try{c.value.contentWindow.postMessage(F,"*"),i.value=v}catch(x){console.error("[VDO.ninja] Failed to send addToScene:",x)}}function B(s,v=1){var T;const g=O.get(s)||s;if(!((T=c.value)!=null&&T.contentWindow)){console.warn("[VDO.ninja] Cannot send removeFromScene - iframe not ready");return}const F={removeFromScene:v,target:g};oe({timestamp:Date.now(),direction:"outgoing",type:"removeFromScene",target:g,data:{sceneNumber:v},raw:F});try{c.value.contentWindow.postMessage(F,"*")}catch(x){console.error("[VDO.ninja] Failed to send removeFromScene:",x)}}function H(s){j(s,{replace:!0})}function D(s){j(s,{add:!0})}function M(s){j(s,{remove:!0})}function I(s,v){p("mic",s,!v);const g=r.value.get(s);g&&(g.muted=v)}function P(s){p("mic",s,"toggle");const v=r.value.get(s);v&&(v.muted=!v.muted)}function _(s,v){p("volume",s,Math.max(0,Math.min(200,v)))}function U(s){p("soloChat",s)}function K(s){p("soloChatBidirectional",s)}function E(s,v){p("sendChat",s,v)}function n(s,v){p("sendDirectorChat",s,v)}function t(s){p("hangup",s),r.value.delete(s)}function a(s){s?p("togglescreenshare",s):p("togglescreenshare")}function o(s,v){p("forward",s,v)}function l(s="guests"){p("getGuestList",void 0,void 0)}function $(){p("record",void 0,!0),w.value=!0}function te(){p("record",void 0,!1),w.value=!1}function Ce(s){p("layout",void 0,s)}function Me(s){s?p("reload",s):p("reload")}function $e(s,v){p("mixorder",s,v==="up"?-1:1)}function Re(s){p("camera",void 0,s)}function De(s,v){p("camera",s,v)}function Pe(s,v=!1){v?p("zoom",void 0,s,"abs"):p("zoom",void 0,s)}function Oe(s){p("pan",void 0,s)}function Te(s){p("tilt",void 0,s)}function ve(s){const v=s.origin;if(!v.includes(y.split(":")[0])&&!v.includes("vdo.ninja")&&!v.includes("vdo.itagenten")&&!v.includes("localhost"))return;const g=s.data;if(!g||typeof g!="object")return;const F=g.type||g.action||"unknown",T=g.streamID||g.UUID||g.streamId;switch(oe({timestamp:Date.now(),direction:"incoming",type:F,target:T,data:g.data||g.value,raw:g}),F){case"director-ready":case"mixer-ready":case"loaded":case"ready":case"started":case"director":case"joined-room-complete":case"seeding-started":h.value=!0,f.value="connected",k.value=null,console.log("[VDO.ninja] Ready event received:",F);break;case"stream-id-detected":{const x=g.value||g.data,R=g.UUID;if(x){if(R){O.set(R,x),console.log(`[VDO.ninja] Stream ID mapping: ${R} -> ${x}`);const G=r.value.get(R);G&&(r.value.delete(R),G.id=x,r.value.set(x,G),d.value++,console.log(`[VDO.ninja] Updated source ID from UUID to stream ID: ${x}`))}if(!r.value.has(x)){const G={id:x,label:g.label||x,type:"guest",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0};r.value.set(x,G),d.value++,console.log(`[VDO.ninja] Source added via stream-id-detected: ${x}`)}}break}case"new-guest":case"guest-connected":case"push":case"view":case"joined":case"new-push-connection":case"push-connection":case"new-view-connection":case"view-connection":{const x=g.UUID,R=g.streamID,G=R||x||T;if(G){x&&R&&O.set(x,R);const z=g.data,fe={id:G,label:(z==null?void 0:z.label)||g.label||G,type:(z==null?void 0:z.type)||"guest",hasVideo:(z==null?void 0:z.video)!==!1,hasAudio:(z==null?void 0:z.audio)!==!1,muted:!1,audioLevel:0};r.value.set(G,fe),d.value++,console.log(`[VDO.ninja] Source added: ${G} (${fe.label})${x&&!R?" (UUID, awaiting stream ID)":""}`)}break}case"guest-left":case"guest-disconnected":case"left":case"disconnect":T&&(r.value.delete(T),d.value++);break;case"audio-level":case"loudness":{if(T){const x=r.value.get(T);if(x){const R=g.data;x.audioLevel=(R==null?void 0:R.level)||g.value||0}}break}case"mute-state":case"muted":{if(T){const x=r.value.get(T);if(x){const R=g.data;x.muted=(R==null?void 0:R.muted)??g.value??!1}}break}case"scene-changed":case"scene":{const x=g.data,R=(x==null?void 0:x.scene)||g.value;i.value=typeof R=="number"?R:null;break}case"recording-started":w.value=!0;break;case"recording-stopped":w.value=!1;break;case"error":console.error("[VDO.ninja Error]",g.data),k.value=String(g.data);break}}return pe(()=>{f.value="connecting",window.addEventListener("message",ve),setTimeout(()=>{!h.value&&c.value&&(h.value=!0,f.value="connected")},5e3)}),je(()=>{window.removeEventListener("message",ve),f.value="disconnected"}),{isReady:h,sources:r,sourcesVersion:d,activeScene:i,isRecording:w,connectionState:f,lastError:k,addToScene:L,removeFromScene:B,setProgram:H,addSource:D,removeSource:M,setLayout:Ce,changeMixOrder:$e,setMute:I,toggleMute:P,setVolume:_,soloAudio:U,soloChatBidirectional:K,sendToGuest:E,sendDirectorMessage:n,kickGuest:t,toggleScreenShare:a,transferGuest:o,getGuestList:l,refreshSource:Me,setCamera:Re,setGuestCamera:De,zoom:Pe,pan:Oe,tilt:Te,startRecording:$,stopRecording:te,sendCommand:p,sendDomCommand:j,getEventHistory:_e,getEventStats:Se}}const Po={class:"flex items-center justify-between p-3 border-b border-preke-border"},Oo={key:0,class:"text-sm font-semibold text-preke-text"},To=["title"],Uo={key:0,class:"p-3 space-y-4 max-h-[calc(100vh-200px)] overflow-y-auto"},Lo={class:"grid grid-cols-3 gap-2"},Vo=["onClick"],jo={class:"flex items-center justify-center gap-2"},Io={key:0,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},Eo={key:1,class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},Bo={key:0},Ho={class:"space-y-2"},Fo={class:"flex items-center justify-between mb-1"},Ao={class:"text-xs text-preke-text"},Ko=["onClick","title"],Wo={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},qo={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},zo=["value","onInput"],No={key:1},Go={class:"space-y-1"},Xo=["onClick"],Yo={class:"flex items-center justify-between"},Qo={key:1,class:"p-2 space-y-2"},Jo=["title"],Zo=ae({__name:"MixerControlPanel",props:{iframeRef:{}},emits:["close"],setup(c,{emit:h}){const r=c,d=b(null),i=Do(d);he(()=>{var t;return(t=r.iframeRef)==null?void 0:t.value},t=>{t?(console.log("[MixerControlPanel] Iframe ref available, updating:",t),d.value=t):d.value=null},{immediate:!0}),pe(()=>{var t;(t=r.iframeRef)!=null&&t.value&&(console.log("[MixerControlPanel] On mount, iframe ref:",r.iframeRef.value),d.value=r.iframeRef.value)});const w=A(()=>i.sources.value),f=A(()=>i.isRecording.value),k=i.setLayout,y=i.toggleMute,O=i.setVolume,p=i.startRecording,j=i.stopRecording,{cameras:L}=Ge(),B=b(null),H=b(!1),D=b(null),M=b(!1);function I(t){var o,l,$;if(console.log("[MixerControlPanel] Switching to scene",t,"setLayout:",k,"iframeRef:",(o=r.iframeRef)==null?void 0:o.value,"dummyRef:",d.value,"vdo.isReady:",i.isReady.value),!k){console.warn("[MixerControlPanel] setLayout not available");return}if(i.isReady.value||(console.warn("[MixerControlPanel] VDO.ninja not ready yet (isReady:",i.isReady.value,"connectionState:",i.connectionState.value,")"),console.warn("[MixerControlPanel] Attempting anyway - VDO.ninja might queue the command")),!(($=(l=r.iframeRef)==null?void 0:l.value)!=null&&$.contentWindow)){console.error("[MixerControlPanel] Iframe contentWindow not available!");return}const a=t-1;console.log("[MixerControlPanel] Calling setLayout with layout number",a,"for scene",t),console.log("[MixerControlPanel] Iframe:",r.iframeRef.value,"ContentWindow:",r.iframeRef.value.contentWindow);try{k(a),D.value=t,console.log("[MixerControlPanel] setLayout called successfully")}catch(te){console.error("[MixerControlPanel] Error calling setLayout:",te)}}function P(t){console.log("[MixerControlPanel] Toggling mute for",t,"toggleMute:",y),y?y(t):console.warn("[MixerControlPanel] toggleMute not available")}function _(t,a){O&&O(t,a)}function U(){console.log("[MixerControlPanel] Recording toggle, current:",f.value,"startRecording:",p,"stopRecording:",j),f.value?j?j():console.warn("[MixerControlPanel] stopRecording not available"):p?p():console.warn("[MixerControlPanel] startRecording not available")}function K(t){B.value=t,H.value=!0}function E(){H.value=!1,B.value=null}const n=A(()=>Array.from(w.value.values()));return A(()=>L.value.filter(t=>n.value.some(a=>{var o;return((o=a.label)==null?void 0:o.toLowerCase().includes(t.name.toLowerCase()))||a.id===t.name}))),(t,a)=>(u(),m("div",{class:W(["mixer-control-panel fixed top-4 right-4 z-50 bg-preke-bg-surface border border-preke-border rounded-lg shadow-lg transition-all duration-300",M.value?"w-12":"w-80"])},[e("div",Po,[M.value?C("",!0):(u(),m("h3",Oo,"Mixer Controls")),e("button",{onClick:a[0]||(a[0]=o=>M.value=!M.value),class:"p-1 rounded hover:bg-preke-bg-elevated transition-colors",title:M.value?"Expand":"Collapse"},[(u(),m("svg",{class:W(["w-4 h-4 transition-transform",{"rotate-180":M.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...a[2]||(a[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"},null,-1)])],2))],8,To)]),M.value?(u(),m("div",Qo,[e("button",{onClick:a[1]||(a[1]=o=>I(1)),class:"w-full aspect-square flex items-center justify-center text-xs font-bold rounded bg-preke-bg-elevated hover:bg-preke-bg-elevated/80",title:"Scene 1"}," 1 "),e("button",{onClick:U,class:W(["w-full aspect-square flex items-center justify-center rounded",f.value.value?"bg-red-600 text-white":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80"]),title:f.value.value?"Stop Recording":"Start Recording"},[...a[12]||(a[12]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"6"})],-1)])],10,Jo)])):(u(),m("div",Uo,[e("div",null,[a[3]||(a[3]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Scenes",-1)),e("div",Lo,[(u(),m(Q,null,Z(9,o=>e("button",{key:o,onClick:l=>I(o),class:W(["aspect-square flex items-center justify-center text-sm font-bold rounded transition-all",D.value===o?"bg-preke-purple text-white ring-2 ring-preke-purple":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 text-preke-text"])},S(o),11,Vo)),64))])]),e("div",null,[a[6]||(a[6]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Recording",-1)),e("button",{onClick:U,class:W(["w-full px-4 py-2 rounded transition-all",f.value.value?"bg-red-600 hover:bg-red-700 text-white":"bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 text-preke-text"])},[e("span",jo,[f.value.value?(u(),m("svg",Io,[...a[4]||(a[4]=[e("circle",{cx:"12",cy:"12",r:"6"},null,-1)])])):(u(),m("svg",Eo,[...a[5]||(a[5]=[e("circle",{cx:"12",cy:"12",r:"10"},null,-1)])])),J(" "+S(f.value.value?"Stop Recording":"Start Recording"),1)])],2)]),n.value.length>0?(u(),m("div",Bo,[a[9]||(a[9]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Sources",-1)),e("div",Ho,[(u(!0),m(Q,null,Z(n.value,o=>(u(),m("div",{key:o.id,class:"p-2 bg-preke-bg-elevated rounded"},[e("div",Fo,[e("span",Ao,S(o.label||o.id),1),e("button",{onClick:l=>P(o.id),class:W(["p-1 rounded hover:bg-preke-bg-surface transition-colors",o.muted?"text-red-400":"text-preke-text-dim"]),title:o.muted?"Unmute":"Mute"},[o.muted?(u(),m("svg",Wo,[...a[7]||(a[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(u(),m("svg",qo,[...a[8]||(a[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"},null,-1)])]))],10,Ko)]),o.hasAudio?(u(),m("input",{key:0,type:"range",value:o.audioLevel||100,onInput:l=>_(o.id,Number(l.target.value)),min:"0",max:"200",class:"w-full h-1 bg-preke-bg-base rounded-lg appearance-none cursor-pointer accent-preke-gold"},null,40,zo)):C("",!0)]))),128))])])):C("",!0),q(L).length>0?(u(),m("div",No,[a[11]||(a[11]=e("label",{class:"text-xs font-medium text-preke-text-dim mb-2 block"},"Camera Controls",-1)),e("div",Go,[(u(!0),m(Q,null,Z(q(L),o=>(u(),m("button",{key:o.name,onClick:l=>K(o.name),class:"w-full px-3 py-2 text-left text-xs bg-preke-bg-elevated hover:bg-preke-bg-elevated/80 rounded transition-colors"},[e("span",Yo,[e("span",null,S(o.name),1),a[10]||(a[10]=e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])],8,Xo))),128))])])):C("",!0)])),H.value&&B.value?(u(),le(Xe,{key:2,"camera-name":B.value,onClose:E},null,8,["camera-name"])):C("",!0)],2))}}),en=de(Zo,[["__scopeId","data-v-22ba6d1f"]]),tn={class:"h-full flex flex-col bg-preke-bg"},on={class:"flex-1 relative"},nn=["src"],sn={key:0,class:"absolute inset-0 flex items-center justify-center bg-preke-bg"},an=["title"],rn=ae({__name:"MixerView",setup(c){const h=Fe(),r=Ie(),d=Ee();function i(){h.push("/")}const w=b(!0),f=b(!1),k=b(!1),y=b("Starting mixer..."),O=b(null),p=b(!0),j=A(()=>r.inputs.filter(P=>P.hasSignal)),L=b("");async function B(){const P=await We(),_=await qe({mediamtxHost:P||void 0,room:re});if(_)L.value=_,console.log("[Mixer] Mixer URL initialized with API key");else{const U=await we()||"r58-vdo.itagenten.no",K=ze(),E=new URL(`${K}://${U}/mixer.html`);E.searchParams.set("room",re),E.searchParams.set("password",Ne),E.searchParams.set("css",`${K}://${U}/css/preke-colors.css`),L.value=E.toString(),console.warn("[Mixer] Using fallback URL without API key")}}function H(){console.log("[Mixer] VDO.ninja mixer iframe loaded"),f.value=!0,y.value="Waiting for cameras..."}function D(){w.value=!1}async function M(){const P=performance.now();y.value="Starting camera bridge...";for(let _=0;_<40;_++){try{if((await(await fetch(await se("/api/mode/status"))).json()).current_mode==="mixer"){const E=Math.round((performance.now()-P)/1e3);if(E>=5){console.log(`[Mixer] Bridge likely ready after ${E}s`),k.value=!0,y.value="Cameras connecting...";return}}}catch{}await new Promise(U=>setTimeout(U,500)),y.value=`Starting camera bridge... (${Math.round((performance.now()-P)/1e3)}s)`}console.log("[Mixer] Bridge wait timeout - continuing anyway"),k.value=!0}async function I(){var _;if(!Be())return;y.value="Checking mode...",await d.fetchCapabilities();const P=(_=d.capabilities)==null?void 0:_.current_mode;if(P&&P!=="mixer"){console.log("[Mixer] Not in mixer mode, switching..."),y.value="Switching to mixer mode...";try{(await fetch(await se("/api/mode/mixer"),{method:"POST"})).ok&&(await d.fetchCapabilities(),V.success("Switched to Mixer mode"))}catch(U){console.warn("[Mixer] Failed to switch mode:",U)}}}return pe(async()=>{const P=performance.now();await B(),await Promise.all([I(),r.fetchInputs()]),await M(),console.log(`[Mixer] Total load time: ${Math.round(performance.now()-P)}ms`)}),(P,_)=>(u(),m(Q,null,[ee(ie,{name:"fade"},{default:ue(()=>[w.value?(u(),le(Ye,{key:0,mode:"mixer","content-ready":f.value&&k.value,"min-time":2e3,"max-time":2e4,"show-cancel":!0,onReady:D,onCancel:i},null,8,["content-ready"])):C("",!0)]),_:1}),ee(ie,{name:"content-fade"},{default:ue(()=>[Y(e("div",tn,[ee(Mo,{"room-name":q(re),"camera-count":j.value.length},null,8,["room-name","camera-count"]),e("div",on,[e("iframe",{ref_key:"iframeRef",ref:O,src:L.value,onLoad:H,class:"absolute inset-0 w-full h-full border-0",allow:"camera; microphone; autoplay; display-capture",allowfullscreen:""},null,40,nn),f.value?C("",!0):(u(),m("div",sn,[..._[1]||(_[1]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"w-8 h-8 border-2 border-preke-gold border-t-transparent rounded-full animate-spin"}),e("span",{class:"text-preke-text-muted"},"Loading VDO.ninja mixer..."),e("span",{class:"text-xs text-preke-text-subtle"},"Cameras will appear when bridge is running")],-1)])])),f.value?(u(),m("button",{key:1,onClick:_[0]||(_[0]=U=>p.value=!p.value),class:"absolute top-4 left-4 z-40 p-2 bg-preke-bg-surface border border-preke-border rounded-lg shadow-lg hover:bg-preke-bg-elevated transition-colors",title:p.value?"Hide Controls":"Show Controls"},[..._[2]||(_[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)])],8,an)):C("",!0),p.value&&f.value?(u(),le(en,{"iframe-ref":O.value,key:f.value?"ready":"loading"},null,8,["iframe-ref"])):C("",!0)])],512),[[He,!w.value]])]),_:1})],64))}}),dn=de(rn,[["__scopeId","data-v-6a4e56ef"]]);export{dn as default};
