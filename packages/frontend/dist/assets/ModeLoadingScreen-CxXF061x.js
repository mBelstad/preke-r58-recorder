import{a0 as ue,D as re,a1 as ke,a2 as $e,r as x,l as A,J as Z,d as ae,o as q,c as v,e,f as T,y as R,t as b,F as j,z as K,n as B,s as P,k as p,_ as ne,H as le,K as Te,w as ce,q as E,B as G,g as de,R as ze,p as ie,P as Pe,j as D,C as H,a as Ue}from"./index-DxgRH3SN.js";import{A as Se}from"./AnimatedBackground-ByxKnVPb.js";const se={lan:2e3,tailscale:2e3,frp:3e3};async function Ne(o,y,w){const r=performance.now();try{const g=await fetch(`${y}/health`,{method:"GET",signal:w,cache:"no-store"});if(!g.ok)throw new Error(`HTTP ${g.status}`);const C=performance.now()-r;return{method:o,url:y,latency:C,success:!0}}catch(g){throw{method:o,url:y,error:g}}}async function Fe(){const o={},y=n=>{if(n==="localhost"||n==="127.0.0.1"||n.startsWith("192.168.")||n.startsWith("10."))return!0;if(n.startsWith("172.")){const m=parseInt(n.split(".")[1],10);return m>=16&&m<=31}return!1},w=n=>n.startsWith("100.")||n.endsWith(".ts.net"),r=ue();if(r)try{const n=new URL(r);w(n.hostname)?o.tailscaleUrl=r:y(n.hostname)&&(o.lanUrl=r)}catch{console.warn("[ConnectionProbe] Invalid device URL:",r)}const g=ke();g&&!o.tailscaleUrl&&(o.tailscaleUrl=g);const C=await $e();return C?o.frpUrl=C:o.frpUrl="https://app.itagenten.no",o}async function Za(o){const y=await Fe(),w=[],r=[],g=[];if(y.lanUrl&&g.push({method:"lan",url:y.lanUrl,timeout:se.lan}),y.tailscaleUrl&&g.push({method:"tailscale",url:y.tailscaleUrl,timeout:se.tailscale}),y.frpUrl&&g.push({method:"frp",url:y.frpUrl,timeout:se.frp}),g.length===0)return console.warn("[ConnectionProbe] No connection methods available, using HLS fallback"),{method:"hls",url:"https://app.itagenten.no",latency:0,success:!1};for(const m of g){const d=new AbortController;r.push(d),o==null||o(`Testing ${m.method.toUpperCase()} connection...`);const f=setTimeout(()=>d.abort(),m.timeout);w.push(Ne(m.method,m.url,d.signal).then(s=>(clearTimeout(f),s)).catch(s=>{throw clearTimeout(f),s}))}const C=ue(),n=m=>{try{const d=new URL(m);if(d.hostname.startsWith("100.")||d.hostname.endsWith(".ts.net")||d.hostname==="localhost"||d.hostname==="127.0.0.1"||d.hostname.startsWith("192.168.")||d.hostname.startsWith("10."))return!0;if(d.hostname.startsWith("172.")){const f=parseInt(d.hostname.split(".")[1],10);return f>=16&&f<=31}return!1}catch{return!1}};try{const m=await Promise.any(w);return r.forEach(d=>d.abort()),console.log(`[ConnectionProbe] Winner: ${m.method.toUpperCase()} (${Math.round(m.latency)}ms)`),o==null||o("Connection established"),C&&n(C)&&m.method==="frp"?(console.log("[ConnectionProbe] Keeping direct device URL despite FRP winning:",C),{method:m.method,url:C,latency:m.latency,success:!0}):(re(m.url),m)}catch{if(console.warn("[ConnectionProbe] All methods failed"),C){console.log("[ConnectionProbe] Keeping original device URL:",C),o==null||o("Using existing connection");let f="lan";try{const s=new URL(C);s.hostname.startsWith("100.")||s.hostname.endsWith(".ts.net")?f="tailscale":s.hostname.includes("itagenten.no")&&(f="frp")}catch{}return{method:f,url:C,latency:0,success:!1}}o==null||o("Using HLS fallback");const d=y.frpUrl||"https://app.itagenten.no";return re(d),{method:"hls",url:d,latency:0,success:!1}}}function te(){const o=x([]),y=x(!1),w=x(null),r=x(null);async function g(){y.value=!0,w.value=null;try{const u=await Z.cameras.list();o.value=await Promise.all(u.map(async h=>{try{const i=await Z.cameras.getStatus(h);return{name:i.name,type:i.type,connected:i.connected,settings:i.settings}}catch{return{name:h,type:"blackmagic",connected:!1}}}))}catch(u){w.value=u.message||"Failed to load cameras",console.error("[CameraControls] Failed to load cameras:",u)}finally{y.value=!1}}const C=A(()=>u=>o.value.find(h=>h.name===u));function n(u,h){const i=C.value(u);if(!i)return!1;const t=["focus","iris","whiteBalance","gain","iso","shutter","colorCorrection"],l=["focus","exposure","whiteBalance","ptz"],O=["focus","exposure","whiteBalance","iso","shutter","ptz"];return i.type==="blackmagic"?t.includes(h):i.type==="obsbot_tail2"?l.includes(h):i.type==="sony_fx30"?O.includes(h):!1}async function m(u,h,i){try{await Z.cameras.setFocus(u,h,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set focus")}}async function d(u,h,i){try{await Z.cameras.setWhiteBalance(u,h,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set white balance")}}async function f(u,h,i){try{await Z.cameras.setExposure(u,h,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set exposure")}}async function s(u,h){try{await Z.cameras.setISO(u,h),await z(u)}catch(i){throw new Error(i.message||"Failed to set ISO")}}async function c(u,h){try{await Z.cameras.setShutter(u,h),await z(u)}catch(i){throw new Error(i.message||"Failed to set shutter")}}async function k(u,h,i){try{await Z.cameras.setIris(u,h,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set iris")}}async function N(u,h){try{await Z.cameras.setGain(u,h),await z(u)}catch(i){throw new Error(i.message||"Failed to set gain")}}async function F(u,h,i,t){try{await Z.cameras.setPTZ(u,h,i,t)}catch(l){throw new Error(l.message||"Failed to move PTZ")}}async function S(u,h){try{await Z.cameras.recallPTZPreset(u,h)}catch(i){throw new Error(i.message||"Failed to recall preset")}}async function M(u,h){try{await Z.cameras.setColorCorrection(u,h),await z(u)}catch(i){throw new Error(i.message||"Failed to set color correction")}}async function z(u){try{const h=await Z.cameras.getStatus(u),i=o.value.findIndex(t=>t.name===u);i>=0&&(o.value[i]={name:h.name,type:h.type,connected:h.connected,settings:h.settings})}catch(h){console.error(`[CameraControls] Failed to refresh status for ${u}:`,h)}}return{cameras:o,loading:y,error:w,selectedCamera:r,getCamera:C,supportsFeature:n,loadCameras:g,setFocus:m,setWhiteBalance:d,setExposure:f,setISO:s,setShutter:c,setIris:k,setGain:N,setPTZ:F,recallPTZPreset:S,setColorCorrection:M,refreshCameraStatus:z}}const Be={class:"companion-panel"},Me={class:"panel-header"},Ie=["aria-label"],Ze={key:0,class:"help-section"},Ee={class:"help-text"},Ge={class:"camera-list"},Oe={class:"camera-header"},Ve={class:"camera-info"},We={class:"camera-name"},Ae={class:"camera-type"},Le={class:"endpoints-section"},De={class:"endpoint-group"},Re={class:"endpoint-path"},Je=["onClick"],He={class:"quick-actions"},je={class:"action-buttons"},Ke=["onClick"],qe={key:1,class:"empty-state"},Qe=ae({__name:"CompanionIntegrationPanel",setup(o){const{cameras:y,loadCameras:w}=te(),r=x(!1),g=A(()=>typeof window<"u"?window.location.origin:"https://app.itagenten.no");function C(f){return{blackmagic:"Blackmagic Studio 4K Pro",obsbot_tail2:"OBSbot Tail 2",sony_fx30:"Sony FX30"}[f]||f}function n(f){const s=`${g.value}/api/v1/cameras/${f.name}`,c=[];return c.push({method:"PUT",path:`${s}/settings/focus`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${s}/settings/focus`,example:JSON.stringify({mode:"manual",value:.5},null,2)}),c.push({method:"PUT",path:`${s}/settings/whiteBalance`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${s}/settings/whiteBalance`,example:JSON.stringify({mode:"manual",temperature:5600},null,2)}),(f.type==="obsbot_tail2"||f.type==="sony_fx30")&&c.push({method:"PUT",path:`${s}/settings/exposure`,example:JSON.stringify({mode:"auto"},null,2)}),(f.type==="blackmagic"||f.type==="sony_fx30")&&c.push({method:"PUT",path:`${s}/settings/iso`,example:JSON.stringify({value:400},null,2)}),(f.type==="blackmagic"||f.type==="sony_fx30")&&c.push({method:"PUT",path:`${s}/settings/shutter`,example:JSON.stringify({value:.0167},null,2)}),f.type==="blackmagic"&&(c.push({method:"PUT",path:`${s}/settings/iris`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${s}/settings/gain`,example:JSON.stringify({value:0},null,2)})),(f.type==="obsbot_tail2"||f.type==="sony_fx30")&&(c.push({method:"PUT",path:`${s}/settings/ptz`,example:JSON.stringify({pan:.5,tilt:-.3,zoom:.2},null,2)}),c.push({method:"PUT",path:`${s}/settings/ptz/preset/1`,example:JSON.stringify({},null,2)})),c}function m(f){const s=`${g.value}/api/v1/cameras/${f.name}`,c=[];return c.push({label:"Focus Auto",example:`PUT ${s}/settings/focus
Content-Type: application/json

{"mode":"auto"}`}),c.push({label:"WB Auto",example:`PUT ${s}/settings/whiteBalance
Content-Type: application/json

{"mode":"auto"}`}),(f.type==="obsbot_tail2"||f.type==="sony_fx30")&&c.push({label:"PTZ Center",example:`PUT ${s}/settings/ptz
Content-Type: application/json

{"pan":0,"tilt":0,"zoom":0}`}),c}async function d(f){try{await navigator.clipboard.writeText(f)}catch(s){console.error("Failed to copy:",s)}}return q(()=>{w()}),(f,s)=>(p(),v("div",Be,[e("div",Me,[s[2]||(s[2]=e("h3",{class:"panel-title"},[e("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2","stroke-width":"2"}),e("path",{d:"M9 9h6v6H9z","stroke-width":"2"})]),R(" Bitfocus Companion Integration ")],-1)),e("button",{class:"info-btn",onClick:s[0]||(s[0]=c=>r.value=!r.value),"aria-label":r.value?"Hide help":"Show help"},[...s[1]||(s[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4M12 8h.01"})],-1)])],8,Ie)]),r.value?(p(),v("div",Ze,[e("p",Ee,[s[3]||(s[3]=R(" Control cameras via Bitfocus Companion using HTTP requests. Add an HTTP instance in Companion pointing to ",-1)),e("code",null,b(g.value),1),s[4]||(s[4]=R(" and use the endpoints below. ",-1))])])):T("",!0),e("div",Ge,[(p(!0),v(j,null,K(P(y),c=>(p(),v("div",{key:c.name,class:"camera-card"},[e("div",Oe,[e("div",Ve,[e("span",We,b(c.name),1),e("span",Ae,b(C(c.type)),1),e("span",{class:B(["status-indicator",c.connected?"connected":"disconnected"])},b(c.connected?"● Connected":"○ Disconnected"),3)])]),e("div",Le,[s[6]||(s[6]=e("h4",{class:"section-title"},"Available Endpoints",-1)),e("div",De,[(p(!0),v(j,null,K(n(c),k=>(p(),v("div",{class:"endpoint-item",key:k.method+k.path},[e("div",{class:B(["endpoint-method",k.method.toLowerCase()])},b(k.method),3),e("div",Re,[e("code",null,b(k.path),1)]),e("button",{class:"copy-btn",onClick:N=>d(k.example),title:"Copy example to clipboard"},[...s[5]||(s[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Je)]))),128))])]),e("div",He,[s[7]||(s[7]=e("h4",{class:"section-title"},"Quick Actions",-1)),e("div",je,[(p(!0),v(j,null,K(m(c),k=>(p(),v("button",{key:k.label,class:"action-btn",onClick:N=>d(k.example)},b(k.label),9,Ke))),128))])])]))),128))]),P(y).length===0?(p(),v("div",qe,[...s[8]||(s[8]=[e("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e("circle",{cx:"12",cy:"10",r:"3"})],-1),e("p",null,"No external cameras configured",-1),e("p",{class:"empty-hint"},[R("Add cameras in "),e("code",null,"config.yml"),R(" to enable Companion integration")],-1)])])):T("",!0)]))}}),Xe=ne(Qe,[["__scopeId","data-v-34a9c8fa"]]),Ye={class:"flex items-center justify-between w-full"},et={class:"text-lg font-semibold text-preke-text"},tt={key:0,class:"text-sm text-preke-text-muted mt-1"},at={key:0,class:"py-8 text-center text-preke-text-muted"},nt={key:1,class:"py-8 text-center text-red-400"},ot={key:2,class:"py-8 text-center text-preke-text-muted"},st={key:3,class:"camera-controls"},lt={class:"tabs"},it={key:0,class:"tab-content"},rt={key:0,class:"control-group"},ct={class:"control-row"},ut={key:0,class:"control-slider"},dt={class:"slider-value"},mt=["disabled"],pt={key:1,class:"control-group"},vt={class:"control-row"},ft={key:0,class:"control-input"},ht=["disabled"],gt={key:2,class:"control-group"},bt={class:"control-row"},yt={key:0,class:"control-slider"},Ct={class:"slider-value"},_t=["disabled"],wt={key:1,class:"tab-content"},xt={key:0,class:"control-group"},kt={class:"control-input"},$t=["disabled"],Tt={key:1,class:"control-group"},zt={class:"control-input"},Pt=["disabled"],Ut={key:2,class:"control-group"},St={class:"control-row"},Nt={key:0,class:"control-input"},Ft=["disabled"],Bt={key:3,class:"control-group"},Mt={class:"control-input"},It=["disabled"],Zt={key:2,class:"tab-content"},Et={class:"control-group"},Gt={class:"ptz-controls"},Ot={class:"ptz-axis"},Vt={class:"slider-value"},Wt={class:"ptz-axis"},At={class:"slider-value"},Lt={class:"ptz-axis"},Dt={class:"slider-value"},Rt={key:3,class:"tab-content"},Jt={key:4,class:"tab-content"},Ht=ae({__name:"CameraControlModal",props:{cameraName:{}},emits:["close"],setup(o,{expose:y,emit:w}){const r=o,g=w,C=x(null),{loading:n,error:m,supportsFeature:d,loadCameras:f,getCamera:s}=te(),c=x("basic"),k=A(()=>r.cameraName?s.value(r.cameraName):null),N=x("auto"),F=x(.5),S=x("auto"),M=x(5600),z=x("auto"),u=x(.5),h=x(400),i=x(1/60),t=x("auto"),l=x(2.8),O=x(0),I=x(0),W=x(0),L=x(0),$=x(!1);q(async()=>{await f(),r.cameraName&&k.value&&await Q()}),le(()=>r.cameraName,async U=>{U&&k.value&&await Q()});async function Q(){!r.cameraName||k.value}function oe(){var U;(U=C.value)==null||U.open()}function X(){var U;(U=C.value)==null||U.close(),g("close")}const{setFocus:V,setWhiteBalance:J,setExposure:Y,setISO:ee,setShutter:me,setIris:pe,setGain:ve,setPTZ:fe}=te();async function he(){if(r.cameraName){$.value=!0;try{await V(r.cameraName,N.value,N.value==="manual"?F.value:void 0)}catch(U){alert(`Failed to set focus: ${U.message}`)}finally{$.value=!1}}}async function ge(){if(r.cameraName){$.value=!0;try{await J(r.cameraName,S.value,S.value==="manual"?M.value:void 0)}catch(U){alert(`Failed to set white balance: ${U.message}`)}finally{$.value=!1}}}async function be(){if(r.cameraName){$.value=!0;try{await Y(r.cameraName,z.value,z.value==="manual"?u.value:void 0)}catch(U){alert(`Failed to set exposure: ${U.message}`)}finally{$.value=!1}}}async function ye(){if(r.cameraName){$.value=!0;try{await ee(r.cameraName,h.value)}catch(U){alert(`Failed to set ISO: ${U.message}`)}finally{$.value=!1}}}async function Ce(){if(r.cameraName){$.value=!0;try{await me(r.cameraName,i.value)}catch(U){alert(`Failed to set shutter: ${U.message}`)}finally{$.value=!1}}}async function _e(){if(r.cameraName){$.value=!0;try{await pe(r.cameraName,t.value,t.value==="manual"?l.value:void 0)}catch(U){alert(`Failed to set iris: ${U.message}`)}finally{$.value=!1}}}async function we(){if(r.cameraName){$.value=!0;try{await ve(r.cameraName,O.value)}catch(U){alert(`Failed to set gain: ${U.message}`)}finally{$.value=!1}}}async function xe(){if(r.cameraName)try{await fe(r.cameraName,I.value,W.value,L.value)}catch(U){alert(`Failed to move PTZ: ${U.message}`)}}return y({open:oe,close:X}),(U,a)=>(p(),Te(ze,{ref_key:"modalRef",ref:C,title:"Camera Controls",size:"xl",onClose:a[23]||(a[23]=_=>g("close"))},{header:ce(()=>[e("div",Ye,[e("div",null,[e("h2",et,b(o.cameraName||"Camera Controls"),1),k.value?(p(),v("p",tt,[R(b(k.value.type==="blackmagic"?"Blackmagic Design":k.value.type==="sony_fx30"?"Sony FX30":"OBSbot Tail 2")+" ",1),e("span",{class:B([k.value.connected?"text-green-500":"text-red-500","ml-2"])},b(k.value.connected?"● Connected":"○ Disconnected"),3)])):T("",!0)])])]),default:ce(()=>[P(n)?(p(),v("div",at," Loading camera settings... ")):P(m)?(p(),v("div",nt,b(P(m)),1)):k.value?(p(),v("div",st,[e("div",lt,[P(d)(o.cameraName,"focus")||P(d)(o.cameraName,"whiteBalance")||P(d)(o.cameraName,"exposure")?(p(),v("button",{key:0,class:B(["tab",{"tab--active":c.value==="basic"}]),onClick:a[0]||(a[0]=_=>c.value="basic")}," Basic ",2)):T("",!0),P(d)(o.cameraName,"iso")||P(d)(o.cameraName,"shutter")||P(d)(o.cameraName,"iris")||P(d)(o.cameraName,"gain")?(p(),v("button",{key:1,class:B(["tab",{"tab--active":c.value==="advanced"}]),onClick:a[1]||(a[1]=_=>c.value="advanced")}," Advanced ",2)):T("",!0),P(d)(o.cameraName,"ptz")?(p(),v("button",{key:2,class:B(["tab",{"tab--active":c.value==="ptz"}]),onClick:a[2]||(a[2]=_=>c.value="ptz")}," PTZ ",2)):T("",!0),P(d)(o.cameraName,"colorCorrection")?(p(),v("button",{key:3,class:B(["tab",{"tab--active":c.value==="color"}]),onClick:a[3]||(a[3]=_=>c.value="color")}," Color ",2)):T("",!0),e("button",{class:B(["tab",{"tab--active":c.value==="companion"}]),onClick:a[4]||(a[4]=_=>c.value="companion")}," Companion ",2)]),c.value==="basic"?(p(),v("div",it,[P(d)(o.cameraName,"focus")?(p(),v("div",rt,[a[24]||(a[24]=e("label",{class:"control-label"},"Focus",-1)),e("div",ct,[e("button",{class:B(["mode-btn",{"mode-btn--active":N.value==="auto"}]),onClick:a[5]||(a[5]=_=>N.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":N.value==="manual"}]),onClick:a[6]||(a[6]=_=>N.value="manual")}," Manual ",2)]),N.value==="manual"?(p(),v("div",ut,[E(e("input",{"onUpdate:modelValue":a[7]||(a[7]=_=>F.value=_),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[G,F.value,void 0,{number:!0}]]),e("span",dt,b(Math.round(F.value*100))+"%",1)])):T("",!0),e("button",{onClick:he,disabled:$.value,class:"save-btn"},b($.value?"Saving...":"Save Focus"),9,mt)])):T("",!0),P(d)(o.cameraName,"whiteBalance")?(p(),v("div",pt,[a[26]||(a[26]=e("label",{class:"control-label"},"White Balance",-1)),e("div",vt,[e("button",{class:B(["mode-btn",{"mode-btn--active":S.value==="auto"}]),onClick:a[8]||(a[8]=_=>S.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":S.value==="manual"}]),onClick:a[9]||(a[9]=_=>S.value="manual")}," Manual ",2)]),S.value==="manual"?(p(),v("div",ft,[E(e("input",{"onUpdate:modelValue":a[10]||(a[10]=_=>M.value=_),type:"number",min:"2000",max:"10000",step:"100",class:"input"},null,512),[[G,M.value,void 0,{number:!0}]]),a[25]||(a[25]=e("span",{class:"input-unit"},"K",-1))])):T("",!0),e("button",{onClick:ge,disabled:$.value,class:"save-btn"},b($.value?"Saving...":"Save White Balance"),9,ht)])):T("",!0),P(d)(o.cameraName,"exposure")?(p(),v("div",gt,[a[27]||(a[27]=e("label",{class:"control-label"},"Exposure",-1)),e("div",bt,[e("button",{class:B(["mode-btn",{"mode-btn--active":z.value==="auto"}]),onClick:a[11]||(a[11]=_=>z.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":z.value==="manual"}]),onClick:a[12]||(a[12]=_=>z.value="manual")}," Manual ",2)]),z.value==="manual"?(p(),v("div",yt,[E(e("input",{"onUpdate:modelValue":a[13]||(a[13]=_=>u.value=_),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[G,u.value,void 0,{number:!0}]]),e("span",Ct,b(Math.round(u.value*100))+"%",1)])):T("",!0),e("button",{onClick:be,disabled:$.value,class:"save-btn"},b($.value?"Saving...":"Save Exposure"),9,_t)])):T("",!0)])):T("",!0),c.value==="advanced"?(p(),v("div",wt,[P(d)(o.cameraName,"iso")?(p(),v("div",xt,[a[28]||(a[28]=e("label",{class:"control-label"},"ISO",-1)),e("div",kt,[E(e("input",{"onUpdate:modelValue":a[14]||(a[14]=_=>h.value=_),type:"number",min:"100",max:"25600",step:"100",class:"input"},null,512),[[G,h.value,void 0,{number:!0}]])]),e("button",{onClick:ye,disabled:$.value,class:"save-btn"},b($.value?"Saving...":"Save ISO"),9,$t)])):T("",!0),P(d)(o.cameraName,"shutter")?(p(),v("div",Tt,[a[30]||(a[30]=e("label",{class:"control-label"},"Shutter Speed",-1)),e("div",zt,[E(e("input",{"onUpdate:modelValue":a[15]||(a[15]=_=>i.value=_),type:"number",min:"0.0001",max:"1",step:"0.0001",class:"input"},null,512),[[G,i.value,void 0,{number:!0}]]),a[29]||(a[29]=e("span",{class:"input-unit"},"s",-1))]),e("button",{onClick:Ce,disabled:$.value,class:"save-btn"},b($.value?"Saving...":"Save Shutter"),9,Pt)])):T("",!0),P(d)(o.cameraName,"iris")?(p(),v("div",Ut,[a[32]||(a[32]=e("label",{class:"control-label"},"Iris",-1)),e("div",St,[e("button",{class:B(["mode-btn",{"mode-btn--active":t.value==="auto"}]),onClick:a[16]||(a[16]=_=>t.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":t.value==="manual"}]),onClick:a[17]||(a[17]=_=>t.value="manual")}," Manual ",2)]),t.value==="manual"?(p(),v("div",Nt,[E(e("input",{"onUpdate:modelValue":a[18]||(a[18]=_=>l.value=_),type:"number",min:"1.4",max:"22",step:"0.1",class:"input"},null,512),[[G,l.value,void 0,{number:!0}]]),a[31]||(a[31]=e("span",{class:"input-unit"},"f/",-1))])):T("",!0),e("button",{onClick:_e,disabled:$.value,class:"save-btn"},b($.value?"Saving...":"Save Iris"),9,Ft)])):T("",!0),P(d)(o.cameraName,"gain")?(p(),v("div",Bt,[a[34]||(a[34]=e("label",{class:"control-label"},"Gain",-1)),e("div",Mt,[E(e("input",{"onUpdate:modelValue":a[19]||(a[19]=_=>O.value=_),type:"number",min:"-12",max:"36",step:"0.1",class:"input"},null,512),[[G,O.value,void 0,{number:!0}]]),a[33]||(a[33]=e("span",{class:"input-unit"},"dB",-1))]),e("button",{onClick:we,disabled:$.value,class:"save-btn"},b($.value?"Saving...":"Save Gain"),9,It)])):T("",!0)])):T("",!0),c.value==="ptz"?(p(),v("div",Zt,[e("div",Et,[a[38]||(a[38]=e("label",{class:"control-label"},"Pan/Tilt/Zoom",-1)),e("div",Gt,[e("div",Ot,[a[35]||(a[35]=e("label",null,"Pan",-1)),E(e("input",{"onUpdate:modelValue":a[20]||(a[20]=_=>I.value=_),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,I.value,void 0,{number:!0}]]),e("span",Vt,b(I.value.toFixed(1)),1)]),e("div",Wt,[a[36]||(a[36]=e("label",null,"Tilt",-1)),E(e("input",{"onUpdate:modelValue":a[21]||(a[21]=_=>W.value=_),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,W.value,void 0,{number:!0}]]),e("span",At,b(W.value.toFixed(1)),1)]),e("div",Lt,[a[37]||(a[37]=e("label",null,"Zoom",-1)),E(e("input",{"onUpdate:modelValue":a[22]||(a[22]=_=>L.value=_),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,L.value,void 0,{number:!0}]]),e("span",Dt,b(L.value.toFixed(1)),1)])]),e("button",{onClick:xe,class:"save-btn"}," Move PTZ ")])])):T("",!0),c.value==="color"?(p(),v("div",Rt,[...a[39]||(a[39]=[e("div",{class:"control-group"},[e("p",{class:"text-preke-text-muted text-sm"}," Color correction controls coming soon ")],-1)])])):T("",!0),c.value==="companion"?(p(),v("div",Jt,[de(Xe)])):T("",!0)])):(p(),v("div",ot," Camera not found "))]),_:1},512))}}),Ea=ne(Ht,[["__scopeId","data-v-d317ac4a"]]);function jt(o=null){const y=x(!1),w=x(!1),r=x(o),g=x(null),C=x(null);let n=null,m=null,d=0;const f=33;let s=null;async function c(){if((n==null?void 0:n.readyState)!==WebSocket.OPEN)try{const t=await Z.buildApiUrl("/api/v1/ptz-controller/ws");n=new WebSocket(t.replace("http","ws").replace("https","wss")),n.onopen=()=>{y.value=!0,r.value&&N(r.value)},n.onerror=l=>{console.error("[PTZController] WebSocket error:",l),y.value=!1},n.onclose=()=>{y.value=!1}}catch(t){console.error("[PTZController] Failed to connect:",t)}}function k(){n&&(n.close(),n=null),y.value=!1,M()}function N(t){r.value=t,(n==null?void 0:n.readyState)===WebSocket.OPEN&&n.send(JSON.stringify({type:"set_camera",camera_name:t}))}function F(t){if(!y.value||!r.value||!n)return;const l=Date.now();l-d<f||(d=l,n.send(JSON.stringify({type:"ptz_command",pan:t.pan,tilt:t.tilt,zoom:t.zoom,focus:t.focus,speed:t.speed||1})))}function S(t=0){if(m)return;g.value=t,w.value=!0;function l(){var Y,ee;if(!w.value)return;const I=navigator.getGamepads()[g.value];if(!I){console.log("[PTZController] Gamepad disconnected during polling"),M(),u();return}(!C.value||C.value.index!==I.index)&&(C.value={id:I.id,index:I.index,mapping:I.mapping||"standard"});const W=Array.from(I.axes),L=Array.from(I.buttons),$=z(W[0]||0,.1),Q=z(-(W[1]||0),.1),oe=z(W[2]||0,.1),X=W[3]?z(W[3],.1):void 0;let V=.5;(Y=L[6])!=null&&Y.value&&(V+=L[6].value*.5),(ee=L[7])!=null&&ee.value&&(V+=L[7].value*.5),V=Math.min(1,V);const J={pan:$*V,tilt:Q*V,zoom:oe*V,focus:X?X*V:void 0,speed:V};(Math.abs(J.pan)>.01||Math.abs(J.tilt)>.01||Math.abs(J.zoom)>.01)&&F(J),m=requestAnimationFrame(l)}l()}function M(){w.value=!1,g.value=null,m&&(cancelAnimationFrame(m),m=null)}function z(t,l){if(Math.abs(t)<l)return 0;const O=t>=0?1:-1,I=(Math.abs(t)-l)/(1-l);return O*I}function u(){s&&clearTimeout(s),s=window.setTimeout(()=>{const t=navigator.getGamepads();for(let l=0;l<t.length;l++)if(t[l]&&g.value===null){console.log("[PTZController] Gamepad reconnected:",t[l].id),S(l);break}s=null},1e3)}function h(t){const l=t.gamepad,O=l.id.toLowerCase().includes("bluetooth")||l.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${O} gamepad connected:`,l.id,{index:l.index,mapping:l.mapping||"standard",axes:l.axes.length,buttons:l.buttons.length}),g.value===null&&S(l.index)}function i(t){const l=t.gamepad,O=l.id.toLowerCase().includes("bluetooth")||l.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${O} gamepad disconnected:`,l.id),g.value===t.gamepad.index&&(M(),C.value=null,u())}return q(()=>{c(),window.addEventListener("gamepadconnected",h),window.addEventListener("gamepaddisconnected",i);const t=navigator.getGamepads();for(let l=0;l<t.length;l++)if(t[l]){S(l);break}}),ie(()=>{k(),M(),s&&clearTimeout(s),window.removeEventListener("gamepadconnected",h),window.removeEventListener("gamepaddisconnected",i)}),{connected:y,active:w,currentCamera:r,gamepadIndex:g,gamepadInfo:C,connect:c,disconnect:k,setCamera:N,sendPTZCommand:F,startGamepad:S,stopGamepad:M}}const Kt={class:"ptz-controller-panel"},qt={class:"ptz-controller-panel__header"},Qt={class:"ptz-controller-panel__content"},Xt={class:"ptz-controller-panel__section"},Yt=["value"],ea={class:"ptz-controller-panel__section"},ta={class:"ptz-controller-panel__status"},aa={class:"ptz-controller-panel__status-text"},na={class:"ptz-controller-panel__buttons"},oa=["disabled"],sa=["disabled"],la={key:0,class:"ptz-controller-panel__section"},ia={class:"ptz-controller-panel__status"},ra={class:"ptz-controller-panel__status-text"},ca={class:"ptz-controller-panel__section"},ua={class:"ptz-controller-panel__manual-controls"},da={class:"ptz-controller-panel__axis"},ma={class:"ptz-controller-panel__value"},pa={class:"ptz-controller-panel__axis"},va={class:"ptz-controller-panel__value"},fa={class:"ptz-controller-panel__axis"},ha={class:"ptz-controller-panel__value"},ga=["disabled"],ba={class:"ptz-controller-panel__section"},ya={class:"ptz-controller-panel__buttons"},Ca=["disabled"],_a=["disabled"],wa=ae({__name:"PTZControllerPanel",props:{cameraName:{}},emits:["close"],setup(o,{emit:y}){const w=o,r=y,{cameras:g,loadCameras:C}=te(),n=jt(w.cameraName||null),m=x(w.cameraName||null),d=A(()=>n.gamepadInfo.value!==null),f=A(()=>{var i;return((i=n.gamepadInfo.value)==null?void 0:i.id)||""}),s=A(()=>g.value.filter(i=>i.type==="obsbot_tail2"||i.name.toLowerCase().includes("obsbot")));async function c(){if(!m.value){D.error("Please select a camera first");return}await n.connect(),n.connected.value?(n.setCamera(m.value),D.success("PTZ Controller connected")):D.error("Failed to connect PTZ controller")}function k(){n.disconnect(),D.info("PTZ Controller disconnected")}function N(){const i=navigator.getGamepads();let t=null;for(let l=0;l<i.length;l++)if(i[l]){t=l;break}if(t===null){D.error("No gamepad detected. Please connect a gamepad/joystick first.");return}n.startGamepad(t),setTimeout(()=>{n.gamepadInfo.value&&D.success(`Gamepad connected: ${n.gamepadInfo.value.id}`)},100)}function F(){n.stopGamepad(),D.info("Gamepad disconnected")}const S=x(0),M=x(0),z=x(0);function u(){if(!m.value){D.error("Please select a camera first");return}if(!n.connected.value){D.error("PTZ Controller not connected");return}n.sendPTZCommand({pan:S.value,tilt:M.value,zoom:z.value})}function h(){m.value&&n.connected.value&&n.setCamera(m.value)}return q(async()=>{await C(),!m.value&&s.value.length>0&&(m.value=s.value[0].name)}),ie(()=>{k(),F()}),le(()=>w.cameraName,i=>{i&&(m.value=i,n.connected.value&&n.setCamera(i))}),(i,t)=>(p(),v("div",Kt,[e("div",qt,[t[6]||(t[6]=e("h3",{class:"ptz-controller-panel__title"},"PTZ Controller",-1)),e("button",{onClick:t[0]||(t[0]=l=>r("close")),class:"ptz-controller-panel__close",title:"Close"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Qt,[e("div",Xt,[t[8]||(t[8]=e("label",{class:"ptz-controller-panel__label"},"Camera",-1)),E(e("select",{"onUpdate:modelValue":t[1]||(t[1]=l=>m.value=l),class:"ptz-controller-panel__select",onChange:h},[t[7]||(t[7]=e("option",{value:null},"Select camera...",-1)),(p(!0),v(j,null,K(s.value,l=>(p(),v("option",{key:l.name,value:l.name},b(l.name)+" ("+b(l.connected?"Connected":"Disconnected")+") ",9,Yt))),128))],544),[[Pe,m.value]])]),e("div",ea,[e("div",ta,[e("span",{class:B(["ptz-controller-panel__status-dot",{"ptz-controller-panel__status-dot--connected":P(n).connected.value,"ptz-controller-panel__status-dot--disconnected":!P(n).connected.value}])},null,2),e("span",aa,b(P(n).connected.value?"Connected":"Disconnected"),1)]),e("div",na,[e("button",{onClick:c,disabled:!m.value||P(n).connected.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Connect ",8,oa),e("button",{onClick:k,disabled:!P(n).connected.value,class:"ptz-controller-panel__btn"}," Disconnect ",8,sa)])]),d.value?(p(),v("div",la,[e("div",ia,[t[9]||(t[9]=e("span",{class:"ptz-controller-panel__status-dot ptz-controller-panel__status-dot--connected"},null,-1)),e("span",ra," Gamepad: "+b(f.value),1)])])):T("",!0),e("div",ca,[t[13]||(t[13]=e("label",{class:"ptz-controller-panel__label"},"Manual Control (Testing)",-1)),e("div",ua,[e("div",da,[t[10]||(t[10]=e("label",null,"Pan",-1)),E(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>S.value=l),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,S.value,void 0,{number:!0}]]),e("span",ma,b(S.value.toFixed(1)),1)]),e("div",pa,[t[11]||(t[11]=e("label",null,"Tilt",-1)),E(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>M.value=l),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,M.value,void 0,{number:!0}]]),e("span",va,b(M.value.toFixed(1)),1)]),e("div",fa,[t[12]||(t[12]=e("label",null,"Zoom",-1)),E(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>z.value=l),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,z.value,void 0,{number:!0}]]),e("span",ha,b(z.value.toFixed(1)),1)]),e("button",{onClick:u,disabled:!P(n).connected.value||!m.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Send Command ",8,ga)])]),e("div",ba,[e("div",ya,[e("button",{onClick:N,disabled:d.value,class:"ptz-controller-panel__btn"}," Start Gamepad ",8,Ca),e("button",{onClick:F,disabled:!d.value,class:"ptz-controller-panel__btn"}," Stop Gamepad ",8,_a)]),t[14]||(t[14]=e("p",{class:"ptz-controller-panel__hint"}," Connect a gamepad/joystick and use left stick for pan/tilt, triggers for zoom ",-1))])])]))}}),Ga=ne(wa,[["__scopeId","data-v-ebf7148f"]]),xa={class:"loading-screen"},ka={class:"loading-content"},$a={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},Ta={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},za={class:"loading-text"},Pa={class:"loading-tagline"},Ua={class:"loading-dots"},Sa={key:0,class:"loading-status"},Na={key:1,class:"loading-progress"},Fa={key:2,class:"loading-method"},Ba=ae({__name:"ModeLoadingScreen",props:{mode:{},minTime:{default:1500},maxTime:{default:8e3},contentReady:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1},statusText:{default:void 0},progress:{default:void 0},connectionMethod:{default:void 0}},emits:["ready","cancel"],setup(o,{emit:y}){const w=o,r=y;function g(){r("cancel")}const C=x(!1);let n=null,m=null;function d(){C.value&&w.contentReady&&r("ready")}le(()=>w.contentReady,N=>{N&&d()});const f=A(()=>w.mode==="recorder"?"#d45a5a":"#7c3aed"),s=A(()=>w.mode==="recorder"?"Recorder":"Mixer"),c=A(()=>w.mode==="recorder"?"Multi-cam ISO Recording":"Live Switching & Streaming"),k=A(()=>w.mode==="recorder"?"red":"purple");return q(()=>{n=setTimeout(()=>{C.value=!0,d()},w.minTime),m=setTimeout(()=>{r("ready")},w.maxTime)}),ie(()=>{n&&clearTimeout(n),m&&clearTimeout(m)}),(N,F)=>(p(),v("div",xa,[de(Se,{accent:k.value,"show-beams":!0,"show-pattern":!0},null,8,["accent"]),e("div",ka,[e("div",{class:"loading-icon",style:H({color:f.value})},[o.mode==="recorder"?(p(),v("svg",$a,[...F[0]||(F[0]=[e("rect",{x:"2",y:"5",width:"14",height:"12",rx:"2"},null,-1),e("path",{d:"M16 9l4-2v8l-4-2"},null,-1),e("circle",{cx:"6",cy:"8",r:"2",fill:"currentColor",stroke:"none"},null,-1)])])):(p(),v("svg",Ta,[...F[1]||(F[1]=[Ue('<rect x="2" y="2" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="13" y="2" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="2" y="10" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="13" y="10" width="9" height="6" rx="1" data-v-409a3379></rect><circle cx="12" cy="20" r="2" fill="currentColor" data-v-409a3379></circle><path d="M9 19.5a4 4 0 0 1 6 0" stroke-linecap="round" data-v-409a3379></path>',6)])])),e("div",{class:"loading-icon__glow",style:H({background:f.value})},null,4)],4),e("div",za,[e("h2",{class:"loading-title",style:H({color:f.value})},b(s.value),5),e("p",Pa,b(c.value),1)]),e("div",Ua,[(p(),v(j,null,K(3,S=>e("div",{key:S,class:"loading-dot",style:H({backgroundColor:f.value,animationDelay:`${(S-1)*.15}s`})},null,4)),64))]),o.statusText?(p(),v("div",Sa,b(o.statusText),1)):T("",!0),o.progress!==void 0?(p(),v("div",Na,[e("div",{class:"loading-progress__bar",style:H({width:`${o.progress}%`,backgroundColor:f.value})},null,4)])):T("",!0),o.connectionMethod?(p(),v("div",Fa," Connected via "+b(o.connectionMethod),1)):T("",!0),o.showCancel?(p(),v("button",{key:3,onClick:g,class:"loading-cancel"},[...F[2]||(F[2]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),R(" Go back ",-1)])])):T("",!0)])]))}}),Oa=ne(Ba,[["__scopeId","data-v-409a3379"]]);export{Ea as C,Oa as M,Ga as P,Za as p,te as u};
