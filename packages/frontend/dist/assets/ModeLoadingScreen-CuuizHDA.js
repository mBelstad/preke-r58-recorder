import{D as re,a0 as ue,a1 as ke,a2 as $e,r as w,l as L,J as Z,d as ae,o as K,c as m,e,f as T,y as J,t as h,F as j,z as q,n as B,s as P,k as d,_ as ne,H as le,K as Te,w as ce,q as E,B as G,g as de,R as ze,p as ie,P as Pe,j as D,C as H,a as Ue}from"./index-CSAxumLz.js";import{A as Se}from"./AnimatedBackground-BadQ55mU.js";const se={lan:2e3,tailscale:2e3,frp:3e3};async function Ne(o,y,_){const r=performance.now();try{const b=await fetch(`${y}/health`,{method:"GET",signal:_,cache:"no-store"});if(!b.ok)throw new Error(`HTTP ${b.status}`);const $=performance.now()-r;return{method:o,url:y,latency:$,success:!0}}catch(b){throw{method:o,url:y,error:b}}}async function Fe(){const o={},y=n=>{if(n==="localhost"||n==="127.0.0.1"||n.startsWith("192.168.")||n.startsWith("10."))return!0;if(n.startsWith("172.")){const f=parseInt(n.split(".")[1],10);return f>=16&&f<=31}return!1},_=n=>n.startsWith("100.")||n.endsWith(".ts.net"),r=ue();if(r)try{const n=new URL(r);_(n.hostname)?o.tailscaleUrl=r:y(n.hostname)&&(o.lanUrl=r)}catch{console.warn("[ConnectionProbe] Invalid device URL:",r)}const b=ke();b&&!o.tailscaleUrl&&(o.tailscaleUrl=b);const $=await $e();return $?o.frpUrl=$:o.frpUrl="https://app.itagenten.no",o}async function Za(o){const y=await Fe(),_=[],r=[],b=[];if(y.lanUrl&&b.push({method:"lan",url:y.lanUrl,timeout:se.lan}),y.tailscaleUrl&&b.push({method:"tailscale",url:y.tailscaleUrl,timeout:se.tailscale}),y.frpUrl&&b.push({method:"frp",url:y.frpUrl,timeout:se.frp}),b.length===0)return console.warn("[ConnectionProbe] No connection methods available, using HLS fallback"),{method:"hls",url:"https://app.itagenten.no",latency:0,success:!1};for(const n of b){const f=new AbortController;r.push(f),o==null||o(`Testing ${n.method.toUpperCase()} connection...`);const g=setTimeout(()=>f.abort(),n.timeout);_.push(Ne(n.method,n.url,f.signal).then(v=>(clearTimeout(g),v)).catch(v=>{throw clearTimeout(g),v}))}const $=ue();try{const n=await Promise.any(_);return r.forEach(f=>f.abort()),console.log(`[ConnectionProbe] Winner: ${n.method.toUpperCase()} (${Math.round(n.latency)}ms)`),o==null||o(`Connected via ${n.method.toUpperCase()}`),re(n.url),n}catch{if(console.warn("[ConnectionProbe] All methods failed"),$){console.log("[ConnectionProbe] Keeping original device URL:",$),o==null||o("Using existing connection");let g="lan";try{const v=new URL($);v.hostname.startsWith("100.")||v.hostname.endsWith(".ts.net")?g="tailscale":v.hostname.includes("itagenten.no")&&(g="frp")}catch{}return{method:g,url:$,latency:0,success:!1}}o==null||o("Using HLS fallback");const f=y.frpUrl||"https://app.itagenten.no";return re(f),{method:"hls",url:f,latency:0,success:!1}}}function te(){const o=w([]),y=w(!1),_=w(null),r=w(null);async function b(){y.value=!0,_.value=null;try{const u=await Z.cameras.list();o.value=await Promise.all(u.map(async p=>{try{const i=await Z.cameras.getStatus(p);return{name:i.name,type:i.type,connected:i.connected,settings:i.settings}}catch{return{name:p,type:"blackmagic",connected:!1}}}))}catch(u){_.value=u.message||"Failed to load cameras",console.error("[CameraControls] Failed to load cameras:",u)}finally{y.value=!1}}const $=L(()=>u=>o.value.find(p=>p.name===u));function n(u,p){const i=$.value(u);if(!i)return!1;const t=["focus","iris","whiteBalance","gain","iso","shutter","colorCorrection"],s=["focus","exposure","whiteBalance","ptz"],O=["focus","exposure","whiteBalance","iso","shutter","ptz"];return i.type==="blackmagic"?t.includes(p):i.type==="obsbot_tail2"?s.includes(p):i.type==="sony_fx30"?O.includes(p):!1}async function f(u,p,i){try{await Z.cameras.setFocus(u,p,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set focus")}}async function g(u,p,i){try{await Z.cameras.setWhiteBalance(u,p,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set white balance")}}async function v(u,p,i){try{await Z.cameras.setExposure(u,p,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set exposure")}}async function l(u,p){try{await Z.cameras.setISO(u,p),await z(u)}catch(i){throw new Error(i.message||"Failed to set ISO")}}async function c(u,p){try{await Z.cameras.setShutter(u,p),await z(u)}catch(i){throw new Error(i.message||"Failed to set shutter")}}async function x(u,p,i){try{await Z.cameras.setIris(u,p,i),await z(u)}catch(t){throw new Error(t.message||"Failed to set iris")}}async function N(u,p){try{await Z.cameras.setGain(u,p),await z(u)}catch(i){throw new Error(i.message||"Failed to set gain")}}async function F(u,p,i,t){try{await Z.cameras.setPTZ(u,p,i,t)}catch(s){throw new Error(s.message||"Failed to move PTZ")}}async function S(u,p){try{await Z.cameras.recallPTZPreset(u,p)}catch(i){throw new Error(i.message||"Failed to recall preset")}}async function M(u,p){try{await Z.cameras.setColorCorrection(u,p),await z(u)}catch(i){throw new Error(i.message||"Failed to set color correction")}}async function z(u){try{const p=await Z.cameras.getStatus(u),i=o.value.findIndex(t=>t.name===u);i>=0&&(o.value[i]={name:p.name,type:p.type,connected:p.connected,settings:p.settings})}catch(p){console.error(`[CameraControls] Failed to refresh status for ${u}:`,p)}}return{cameras:o,loading:y,error:_,selectedCamera:r,getCamera:$,supportsFeature:n,loadCameras:b,setFocus:f,setWhiteBalance:g,setExposure:v,setISO:l,setShutter:c,setIris:x,setGain:N,setPTZ:F,recallPTZPreset:S,setColorCorrection:M,refreshCameraStatus:z}}const Be={class:"companion-panel"},Me={class:"panel-header"},Ie=["aria-label"],Ze={key:0,class:"help-section"},Ee={class:"help-text"},Ge={class:"camera-list"},Oe={class:"camera-header"},Ve={class:"camera-info"},Ae={class:"camera-name"},Le={class:"camera-type"},We={class:"endpoints-section"},De={class:"endpoint-group"},Je={class:"endpoint-path"},Re=["onClick"],He={class:"quick-actions"},je={class:"action-buttons"},qe=["onClick"],Ke={key:1,class:"empty-state"},Qe=ae({__name:"CompanionIntegrationPanel",setup(o){const{cameras:y,loadCameras:_}=te(),r=w(!1),b=L(()=>typeof window<"u"?window.location.origin:"https://app.itagenten.no");function $(v){return{blackmagic:"Blackmagic Studio 4K Pro",obsbot_tail2:"OBSbot Tail 2",sony_fx30:"Sony FX30"}[v]||v}function n(v){const l=`${b.value}/api/v1/cameras/${v.name}`,c=[];return c.push({method:"PUT",path:`${l}/settings/focus`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${l}/settings/focus`,example:JSON.stringify({mode:"manual",value:.5},null,2)}),c.push({method:"PUT",path:`${l}/settings/whiteBalance`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${l}/settings/whiteBalance`,example:JSON.stringify({mode:"manual",temperature:5600},null,2)}),(v.type==="obsbot_tail2"||v.type==="sony_fx30")&&c.push({method:"PUT",path:`${l}/settings/exposure`,example:JSON.stringify({mode:"auto"},null,2)}),(v.type==="blackmagic"||v.type==="sony_fx30")&&c.push({method:"PUT",path:`${l}/settings/iso`,example:JSON.stringify({value:400},null,2)}),(v.type==="blackmagic"||v.type==="sony_fx30")&&c.push({method:"PUT",path:`${l}/settings/shutter`,example:JSON.stringify({value:.0167},null,2)}),v.type==="blackmagic"&&(c.push({method:"PUT",path:`${l}/settings/iris`,example:JSON.stringify({mode:"auto"},null,2)}),c.push({method:"PUT",path:`${l}/settings/gain`,example:JSON.stringify({value:0},null,2)})),(v.type==="obsbot_tail2"||v.type==="sony_fx30")&&(c.push({method:"PUT",path:`${l}/settings/ptz`,example:JSON.stringify({pan:.5,tilt:-.3,zoom:.2},null,2)}),c.push({method:"PUT",path:`${l}/settings/ptz/preset/1`,example:JSON.stringify({},null,2)})),c}function f(v){const l=`${b.value}/api/v1/cameras/${v.name}`,c=[];return c.push({label:"Focus Auto",example:`PUT ${l}/settings/focus
Content-Type: application/json

{"mode":"auto"}`}),c.push({label:"WB Auto",example:`PUT ${l}/settings/whiteBalance
Content-Type: application/json

{"mode":"auto"}`}),(v.type==="obsbot_tail2"||v.type==="sony_fx30")&&c.push({label:"PTZ Center",example:`PUT ${l}/settings/ptz
Content-Type: application/json

{"pan":0,"tilt":0,"zoom":0}`}),c}async function g(v){try{await navigator.clipboard.writeText(v)}catch(l){console.error("Failed to copy:",l)}}return K(()=>{_()}),(v,l)=>(d(),m("div",Be,[e("div",Me,[l[2]||(l[2]=e("h3",{class:"panel-title"},[e("svg",{class:"icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[e("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2","stroke-width":"2"}),e("path",{d:"M9 9h6v6H9z","stroke-width":"2"})]),J(" Bitfocus Companion Integration ")],-1)),e("button",{class:"info-btn",onClick:l[0]||(l[0]=c=>r.value=!r.value),"aria-label":r.value?"Hide help":"Show help"},[...l[1]||(l[1]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("circle",{cx:"12",cy:"12",r:"10"}),e("path",{d:"M12 16v-4M12 8h.01"})],-1)])],8,Ie)]),r.value?(d(),m("div",Ze,[e("p",Ee,[l[3]||(l[3]=J(" Control cameras via Bitfocus Companion using HTTP requests. Add an HTTP instance in Companion pointing to ",-1)),e("code",null,h(b.value),1),l[4]||(l[4]=J(" and use the endpoints below. ",-1))])])):T("",!0),e("div",Ge,[(d(!0),m(j,null,q(P(y),c=>(d(),m("div",{key:c.name,class:"camera-card"},[e("div",Oe,[e("div",Ve,[e("span",Ae,h(c.name),1),e("span",Le,h($(c.type)),1),e("span",{class:B(["status-indicator",c.connected?"connected":"disconnected"])},h(c.connected?"● Connected":"○ Disconnected"),3)])]),e("div",We,[l[6]||(l[6]=e("h4",{class:"section-title"},"Available Endpoints",-1)),e("div",De,[(d(!0),m(j,null,q(n(c),x=>(d(),m("div",{class:"endpoint-item",key:x.method+x.path},[e("div",{class:B(["endpoint-method",x.method.toLowerCase()])},h(x.method),3),e("div",Je,[e("code",null,h(x.path),1)]),e("button",{class:"copy-btn",onClick:N=>g(x.example),title:"Copy example to clipboard"},[...l[5]||(l[5]=[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("rect",{x:"9",y:"9",width:"13",height:"13",rx:"2",ry:"2"}),e("path",{d:"M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"})],-1)])],8,Re)]))),128))])]),e("div",He,[l[7]||(l[7]=e("h4",{class:"section-title"},"Quick Actions",-1)),e("div",je,[(d(!0),m(j,null,q(f(c),x=>(d(),m("button",{key:x.label,class:"action-btn",onClick:N=>g(x.example)},h(x.label),9,qe))),128))])])]))),128))]),P(y).length===0?(d(),m("div",Ke,[...l[8]||(l[8]=[e("svg",{class:"empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e("circle",{cx:"12",cy:"10",r:"3"})],-1),e("p",null,"No external cameras configured",-1),e("p",{class:"empty-hint"},[J("Add cameras in "),e("code",null,"config.yml"),J(" to enable Companion integration")],-1)])])):T("",!0)]))}}),Xe=ne(Qe,[["__scopeId","data-v-34a9c8fa"]]),Ye={class:"flex items-center justify-between w-full"},et={class:"text-lg font-semibold text-preke-text"},tt={key:0,class:"text-sm text-preke-text-muted mt-1"},at={key:0,class:"py-8 text-center text-preke-text-muted"},nt={key:1,class:"py-8 text-center text-red-400"},ot={key:2,class:"py-8 text-center text-preke-text-muted"},st={key:3,class:"camera-controls"},lt={class:"tabs"},it={key:0,class:"tab-content"},rt={key:0,class:"control-group"},ct={class:"control-row"},ut={key:0,class:"control-slider"},dt={class:"slider-value"},mt=["disabled"],pt={key:1,class:"control-group"},vt={class:"control-row"},ft={key:0,class:"control-input"},gt=["disabled"],bt={key:2,class:"control-group"},ht={class:"control-row"},yt={key:0,class:"control-slider"},Ct={class:"slider-value"},_t=["disabled"],wt={key:1,class:"tab-content"},xt={key:0,class:"control-group"},kt={class:"control-input"},$t=["disabled"],Tt={key:1,class:"control-group"},zt={class:"control-input"},Pt=["disabled"],Ut={key:2,class:"control-group"},St={class:"control-row"},Nt={key:0,class:"control-input"},Ft=["disabled"],Bt={key:3,class:"control-group"},Mt={class:"control-input"},It=["disabled"],Zt={key:2,class:"tab-content"},Et={class:"control-group"},Gt={class:"ptz-controls"},Ot={class:"ptz-axis"},Vt={class:"slider-value"},At={class:"ptz-axis"},Lt={class:"slider-value"},Wt={class:"ptz-axis"},Dt={class:"slider-value"},Jt={key:3,class:"tab-content"},Rt={key:4,class:"tab-content"},Ht=ae({__name:"CameraControlModal",props:{cameraName:{}},emits:["close"],setup(o,{expose:y,emit:_}){const r=o,b=_,$=w(null),{loading:n,error:f,supportsFeature:g,loadCameras:v,getCamera:l}=te(),c=w("basic"),x=L(()=>r.cameraName?l.value(r.cameraName):null),N=w("auto"),F=w(.5),S=w("auto"),M=w(5600),z=w("auto"),u=w(.5),p=w(400),i=w(1/60),t=w("auto"),s=w(2.8),O=w(0),I=w(0),A=w(0),W=w(0),k=w(!1);K(async()=>{await v(),r.cameraName&&x.value&&await Q()}),le(()=>r.cameraName,async U=>{U&&x.value&&await Q()});async function Q(){!r.cameraName||x.value}function oe(){var U;(U=$.value)==null||U.open()}function X(){var U;(U=$.value)==null||U.close(),b("close")}const{setFocus:V,setWhiteBalance:R,setExposure:Y,setISO:ee,setShutter:me,setIris:pe,setGain:ve,setPTZ:fe}=te();async function ge(){if(r.cameraName){k.value=!0;try{await V(r.cameraName,N.value,N.value==="manual"?F.value:void 0)}catch(U){alert(`Failed to set focus: ${U.message}`)}finally{k.value=!1}}}async function be(){if(r.cameraName){k.value=!0;try{await R(r.cameraName,S.value,S.value==="manual"?M.value:void 0)}catch(U){alert(`Failed to set white balance: ${U.message}`)}finally{k.value=!1}}}async function he(){if(r.cameraName){k.value=!0;try{await Y(r.cameraName,z.value,z.value==="manual"?u.value:void 0)}catch(U){alert(`Failed to set exposure: ${U.message}`)}finally{k.value=!1}}}async function ye(){if(r.cameraName){k.value=!0;try{await ee(r.cameraName,p.value)}catch(U){alert(`Failed to set ISO: ${U.message}`)}finally{k.value=!1}}}async function Ce(){if(r.cameraName){k.value=!0;try{await me(r.cameraName,i.value)}catch(U){alert(`Failed to set shutter: ${U.message}`)}finally{k.value=!1}}}async function _e(){if(r.cameraName){k.value=!0;try{await pe(r.cameraName,t.value,t.value==="manual"?s.value:void 0)}catch(U){alert(`Failed to set iris: ${U.message}`)}finally{k.value=!1}}}async function we(){if(r.cameraName){k.value=!0;try{await ve(r.cameraName,O.value)}catch(U){alert(`Failed to set gain: ${U.message}`)}finally{k.value=!1}}}async function xe(){if(r.cameraName)try{await fe(r.cameraName,I.value,A.value,W.value)}catch(U){alert(`Failed to move PTZ: ${U.message}`)}}return y({open:oe,close:X}),(U,a)=>(d(),Te(ze,{ref_key:"modalRef",ref:$,title:"Camera Controls",size:"xl",onClose:a[23]||(a[23]=C=>b("close"))},{header:ce(()=>[e("div",Ye,[e("div",null,[e("h2",et,h(o.cameraName||"Camera Controls"),1),x.value?(d(),m("p",tt,[J(h(x.value.type==="blackmagic"?"Blackmagic Design":x.value.type==="sony_fx30"?"Sony FX30":"OBSbot Tail 2")+" ",1),e("span",{class:B([x.value.connected?"text-green-500":"text-red-500","ml-2"])},h(x.value.connected?"● Connected":"○ Disconnected"),3)])):T("",!0)])])]),default:ce(()=>[P(n)?(d(),m("div",at," Loading camera settings... ")):P(f)?(d(),m("div",nt,h(P(f)),1)):x.value?(d(),m("div",st,[e("div",lt,[P(g)(o.cameraName,"focus")||P(g)(o.cameraName,"whiteBalance")||P(g)(o.cameraName,"exposure")?(d(),m("button",{key:0,class:B(["tab",{"tab--active":c.value==="basic"}]),onClick:a[0]||(a[0]=C=>c.value="basic")}," Basic ",2)):T("",!0),P(g)(o.cameraName,"iso")||P(g)(o.cameraName,"shutter")||P(g)(o.cameraName,"iris")||P(g)(o.cameraName,"gain")?(d(),m("button",{key:1,class:B(["tab",{"tab--active":c.value==="advanced"}]),onClick:a[1]||(a[1]=C=>c.value="advanced")}," Advanced ",2)):T("",!0),P(g)(o.cameraName,"ptz")?(d(),m("button",{key:2,class:B(["tab",{"tab--active":c.value==="ptz"}]),onClick:a[2]||(a[2]=C=>c.value="ptz")}," PTZ ",2)):T("",!0),P(g)(o.cameraName,"colorCorrection")?(d(),m("button",{key:3,class:B(["tab",{"tab--active":c.value==="color"}]),onClick:a[3]||(a[3]=C=>c.value="color")}," Color ",2)):T("",!0),e("button",{class:B(["tab",{"tab--active":c.value==="companion"}]),onClick:a[4]||(a[4]=C=>c.value="companion")}," Companion ",2)]),c.value==="basic"?(d(),m("div",it,[P(g)(o.cameraName,"focus")?(d(),m("div",rt,[a[24]||(a[24]=e("label",{class:"control-label"},"Focus",-1)),e("div",ct,[e("button",{class:B(["mode-btn",{"mode-btn--active":N.value==="auto"}]),onClick:a[5]||(a[5]=C=>N.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":N.value==="manual"}]),onClick:a[6]||(a[6]=C=>N.value="manual")}," Manual ",2)]),N.value==="manual"?(d(),m("div",ut,[E(e("input",{"onUpdate:modelValue":a[7]||(a[7]=C=>F.value=C),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[G,F.value,void 0,{number:!0}]]),e("span",dt,h(Math.round(F.value*100))+"%",1)])):T("",!0),e("button",{onClick:ge,disabled:k.value,class:"save-btn"},h(k.value?"Saving...":"Save Focus"),9,mt)])):T("",!0),P(g)(o.cameraName,"whiteBalance")?(d(),m("div",pt,[a[26]||(a[26]=e("label",{class:"control-label"},"White Balance",-1)),e("div",vt,[e("button",{class:B(["mode-btn",{"mode-btn--active":S.value==="auto"}]),onClick:a[8]||(a[8]=C=>S.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":S.value==="manual"}]),onClick:a[9]||(a[9]=C=>S.value="manual")}," Manual ",2)]),S.value==="manual"?(d(),m("div",ft,[E(e("input",{"onUpdate:modelValue":a[10]||(a[10]=C=>M.value=C),type:"number",min:"2000",max:"10000",step:"100",class:"input"},null,512),[[G,M.value,void 0,{number:!0}]]),a[25]||(a[25]=e("span",{class:"input-unit"},"K",-1))])):T("",!0),e("button",{onClick:be,disabled:k.value,class:"save-btn"},h(k.value?"Saving...":"Save White Balance"),9,gt)])):T("",!0),P(g)(o.cameraName,"exposure")?(d(),m("div",bt,[a[27]||(a[27]=e("label",{class:"control-label"},"Exposure",-1)),e("div",ht,[e("button",{class:B(["mode-btn",{"mode-btn--active":z.value==="auto"}]),onClick:a[11]||(a[11]=C=>z.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":z.value==="manual"}]),onClick:a[12]||(a[12]=C=>z.value="manual")}," Manual ",2)]),z.value==="manual"?(d(),m("div",yt,[E(e("input",{"onUpdate:modelValue":a[13]||(a[13]=C=>u.value=C),type:"range",min:"0",max:"1",step:"0.01",class:"slider"},null,512),[[G,u.value,void 0,{number:!0}]]),e("span",Ct,h(Math.round(u.value*100))+"%",1)])):T("",!0),e("button",{onClick:he,disabled:k.value,class:"save-btn"},h(k.value?"Saving...":"Save Exposure"),9,_t)])):T("",!0)])):T("",!0),c.value==="advanced"?(d(),m("div",wt,[P(g)(o.cameraName,"iso")?(d(),m("div",xt,[a[28]||(a[28]=e("label",{class:"control-label"},"ISO",-1)),e("div",kt,[E(e("input",{"onUpdate:modelValue":a[14]||(a[14]=C=>p.value=C),type:"number",min:"100",max:"25600",step:"100",class:"input"},null,512),[[G,p.value,void 0,{number:!0}]])]),e("button",{onClick:ye,disabled:k.value,class:"save-btn"},h(k.value?"Saving...":"Save ISO"),9,$t)])):T("",!0),P(g)(o.cameraName,"shutter")?(d(),m("div",Tt,[a[30]||(a[30]=e("label",{class:"control-label"},"Shutter Speed",-1)),e("div",zt,[E(e("input",{"onUpdate:modelValue":a[15]||(a[15]=C=>i.value=C),type:"number",min:"0.0001",max:"1",step:"0.0001",class:"input"},null,512),[[G,i.value,void 0,{number:!0}]]),a[29]||(a[29]=e("span",{class:"input-unit"},"s",-1))]),e("button",{onClick:Ce,disabled:k.value,class:"save-btn"},h(k.value?"Saving...":"Save Shutter"),9,Pt)])):T("",!0),P(g)(o.cameraName,"iris")?(d(),m("div",Ut,[a[32]||(a[32]=e("label",{class:"control-label"},"Iris",-1)),e("div",St,[e("button",{class:B(["mode-btn",{"mode-btn--active":t.value==="auto"}]),onClick:a[16]||(a[16]=C=>t.value="auto")}," Auto ",2),e("button",{class:B(["mode-btn",{"mode-btn--active":t.value==="manual"}]),onClick:a[17]||(a[17]=C=>t.value="manual")}," Manual ",2)]),t.value==="manual"?(d(),m("div",Nt,[E(e("input",{"onUpdate:modelValue":a[18]||(a[18]=C=>s.value=C),type:"number",min:"1.4",max:"22",step:"0.1",class:"input"},null,512),[[G,s.value,void 0,{number:!0}]]),a[31]||(a[31]=e("span",{class:"input-unit"},"f/",-1))])):T("",!0),e("button",{onClick:_e,disabled:k.value,class:"save-btn"},h(k.value?"Saving...":"Save Iris"),9,Ft)])):T("",!0),P(g)(o.cameraName,"gain")?(d(),m("div",Bt,[a[34]||(a[34]=e("label",{class:"control-label"},"Gain",-1)),e("div",Mt,[E(e("input",{"onUpdate:modelValue":a[19]||(a[19]=C=>O.value=C),type:"number",min:"-12",max:"36",step:"0.1",class:"input"},null,512),[[G,O.value,void 0,{number:!0}]]),a[33]||(a[33]=e("span",{class:"input-unit"},"dB",-1))]),e("button",{onClick:we,disabled:k.value,class:"save-btn"},h(k.value?"Saving...":"Save Gain"),9,It)])):T("",!0)])):T("",!0),c.value==="ptz"?(d(),m("div",Zt,[e("div",Et,[a[38]||(a[38]=e("label",{class:"control-label"},"Pan/Tilt/Zoom",-1)),e("div",Gt,[e("div",Ot,[a[35]||(a[35]=e("label",null,"Pan",-1)),E(e("input",{"onUpdate:modelValue":a[20]||(a[20]=C=>I.value=C),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,I.value,void 0,{number:!0}]]),e("span",Vt,h(I.value.toFixed(1)),1)]),e("div",At,[a[36]||(a[36]=e("label",null,"Tilt",-1)),E(e("input",{"onUpdate:modelValue":a[21]||(a[21]=C=>A.value=C),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,A.value,void 0,{number:!0}]]),e("span",Lt,h(A.value.toFixed(1)),1)]),e("div",Wt,[a[37]||(a[37]=e("label",null,"Zoom",-1)),E(e("input",{"onUpdate:modelValue":a[22]||(a[22]=C=>W.value=C),type:"range",min:"-1",max:"1",step:"0.1",class:"slider"},null,512),[[G,W.value,void 0,{number:!0}]]),e("span",Dt,h(W.value.toFixed(1)),1)])]),e("button",{onClick:xe,class:"save-btn"}," Move PTZ ")])])):T("",!0),c.value==="color"?(d(),m("div",Jt,[...a[39]||(a[39]=[e("div",{class:"control-group"},[e("p",{class:"text-preke-text-muted text-sm"}," Color correction controls coming soon ")],-1)])])):T("",!0),c.value==="companion"?(d(),m("div",Rt,[de(Xe)])):T("",!0)])):(d(),m("div",ot," Camera not found "))]),_:1},512))}}),Ea=ne(Ht,[["__scopeId","data-v-d317ac4a"]]);function jt(o=null){const y=w(!1),_=w(!1),r=w(o),b=w(null),$=w(null);let n=null,f=null,g=0;const v=33;let l=null;async function c(){if((n==null?void 0:n.readyState)!==WebSocket.OPEN)try{const t=await Z.buildApiUrl("/api/v1/ptz-controller/ws");n=new WebSocket(t.replace("http","ws").replace("https","wss")),n.onopen=()=>{y.value=!0,r.value&&N(r.value)},n.onerror=s=>{console.error("[PTZController] WebSocket error:",s),y.value=!1},n.onclose=()=>{y.value=!1}}catch(t){console.error("[PTZController] Failed to connect:",t)}}function x(){n&&(n.close(),n=null),y.value=!1,M()}function N(t){r.value=t,(n==null?void 0:n.readyState)===WebSocket.OPEN&&n.send(JSON.stringify({type:"set_camera",camera_name:t}))}function F(t){if(!y.value||!r.value||!n)return;const s=Date.now();s-g<v||(g=s,n.send(JSON.stringify({type:"ptz_command",pan:t.pan,tilt:t.tilt,zoom:t.zoom,focus:t.focus,speed:t.speed||1})))}function S(t=0){if(f)return;b.value=t,_.value=!0;function s(){var Y,ee;if(!_.value)return;const I=navigator.getGamepads()[b.value];if(!I){console.log("[PTZController] Gamepad disconnected during polling"),M(),u();return}(!$.value||$.value.index!==I.index)&&($.value={id:I.id,index:I.index,mapping:I.mapping||"standard"});const A=Array.from(I.axes),W=Array.from(I.buttons),k=z(A[0]||0,.1),Q=z(-(A[1]||0),.1),oe=z(A[2]||0,.1),X=A[3]?z(A[3],.1):void 0;let V=.5;(Y=W[6])!=null&&Y.value&&(V+=W[6].value*.5),(ee=W[7])!=null&&ee.value&&(V+=W[7].value*.5),V=Math.min(1,V);const R={pan:k*V,tilt:Q*V,zoom:oe*V,focus:X?X*V:void 0,speed:V};(Math.abs(R.pan)>.01||Math.abs(R.tilt)>.01||Math.abs(R.zoom)>.01)&&F(R),f=requestAnimationFrame(s)}s()}function M(){_.value=!1,b.value=null,f&&(cancelAnimationFrame(f),f=null)}function z(t,s){if(Math.abs(t)<s)return 0;const O=t>=0?1:-1,I=(Math.abs(t)-s)/(1-s);return O*I}function u(){l&&clearTimeout(l),l=window.setTimeout(()=>{const t=navigator.getGamepads();for(let s=0;s<t.length;s++)if(t[s]&&b.value===null){console.log("[PTZController] Gamepad reconnected:",t[s].id),S(s);break}l=null},1e3)}function p(t){const s=t.gamepad,O=s.id.toLowerCase().includes("bluetooth")||s.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${O} gamepad connected:`,s.id,{index:s.index,mapping:s.mapping||"standard",axes:s.axes.length,buttons:s.buttons.length}),b.value===null&&S(s.index)}function i(t){const s=t.gamepad,O=s.id.toLowerCase().includes("bluetooth")||s.id.toLowerCase().includes("wireless")?"Bluetooth":"USB";console.log(`[PTZController] ${O} gamepad disconnected:`,s.id),b.value===t.gamepad.index&&(M(),$.value=null,u())}return K(()=>{c(),window.addEventListener("gamepadconnected",p),window.addEventListener("gamepaddisconnected",i);const t=navigator.getGamepads();for(let s=0;s<t.length;s++)if(t[s]){S(s);break}}),ie(()=>{x(),M(),l&&clearTimeout(l),window.removeEventListener("gamepadconnected",p),window.removeEventListener("gamepaddisconnected",i)}),{connected:y,active:_,currentCamera:r,gamepadIndex:b,gamepadInfo:$,connect:c,disconnect:x,setCamera:N,sendPTZCommand:F,startGamepad:S,stopGamepad:M}}const qt={class:"ptz-controller-panel"},Kt={class:"ptz-controller-panel__header"},Qt={class:"ptz-controller-panel__content"},Xt={class:"ptz-controller-panel__section"},Yt=["value"],ea={class:"ptz-controller-panel__section"},ta={class:"ptz-controller-panel__status"},aa={class:"ptz-controller-panel__status-text"},na={class:"ptz-controller-panel__buttons"},oa=["disabled"],sa=["disabled"],la={key:0,class:"ptz-controller-panel__section"},ia={class:"ptz-controller-panel__status"},ra={class:"ptz-controller-panel__status-text"},ca={class:"ptz-controller-panel__section"},ua={class:"ptz-controller-panel__manual-controls"},da={class:"ptz-controller-panel__axis"},ma={class:"ptz-controller-panel__value"},pa={class:"ptz-controller-panel__axis"},va={class:"ptz-controller-panel__value"},fa={class:"ptz-controller-panel__axis"},ga={class:"ptz-controller-panel__value"},ba=["disabled"],ha={class:"ptz-controller-panel__section"},ya={class:"ptz-controller-panel__buttons"},Ca=["disabled"],_a=["disabled"],wa=ae({__name:"PTZControllerPanel",props:{cameraName:{}},emits:["close"],setup(o,{emit:y}){const _=o,r=y,{cameras:b,loadCameras:$}=te(),n=jt(_.cameraName||null),f=w(_.cameraName||null),g=L(()=>n.gamepadInfo.value!==null),v=L(()=>{var i;return((i=n.gamepadInfo.value)==null?void 0:i.id)||""}),l=L(()=>b.value.filter(i=>i.type==="obsbot_tail2"||i.name.toLowerCase().includes("obsbot")));async function c(){if(!f.value){D.error("Please select a camera first");return}await n.connect(),n.connected.value?(n.setCamera(f.value),D.success("PTZ Controller connected")):D.error("Failed to connect PTZ controller")}function x(){n.disconnect(),D.info("PTZ Controller disconnected")}function N(){const i=navigator.getGamepads();let t=null;for(let s=0;s<i.length;s++)if(i[s]){t=s;break}if(t===null){D.error("No gamepad detected. Please connect a gamepad/joystick first.");return}n.startGamepad(t),setTimeout(()=>{n.gamepadInfo.value&&D.success(`Gamepad connected: ${n.gamepadInfo.value.id}`)},100)}function F(){n.stopGamepad(),D.info("Gamepad disconnected")}const S=w(0),M=w(0),z=w(0);function u(){if(!f.value){D.error("Please select a camera first");return}if(!n.connected.value){D.error("PTZ Controller not connected");return}n.sendPTZCommand({pan:S.value,tilt:M.value,zoom:z.value})}function p(){f.value&&n.connected.value&&n.setCamera(f.value)}return K(async()=>{await $(),!f.value&&l.value.length>0&&(f.value=l.value[0].name)}),ie(()=>{x(),F()}),le(()=>_.cameraName,i=>{i&&(f.value=i,n.connected.value&&n.setCamera(i))}),(i,t)=>(d(),m("div",qt,[e("div",Kt,[t[6]||(t[6]=e("h3",{class:"ptz-controller-panel__title"},"PTZ Controller",-1)),e("button",{onClick:t[0]||(t[0]=s=>r("close")),class:"ptz-controller-panel__close",title:"Close"},[...t[5]||(t[5]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Qt,[e("div",Xt,[t[8]||(t[8]=e("label",{class:"ptz-controller-panel__label"},"Camera",-1)),E(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),class:"ptz-controller-panel__select",onChange:p},[t[7]||(t[7]=e("option",{value:null},"Select camera...",-1)),(d(!0),m(j,null,q(l.value,s=>(d(),m("option",{key:s.name,value:s.name},h(s.name)+" ("+h(s.connected?"Connected":"Disconnected")+") ",9,Yt))),128))],544),[[Pe,f.value]])]),e("div",ea,[e("div",ta,[e("span",{class:B(["ptz-controller-panel__status-dot",{"ptz-controller-panel__status-dot--connected":P(n).connected.value,"ptz-controller-panel__status-dot--disconnected":!P(n).connected.value}])},null,2),e("span",aa,h(P(n).connected.value?"Connected":"Disconnected"),1)]),e("div",na,[e("button",{onClick:c,disabled:!f.value||P(n).connected.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Connect ",8,oa),e("button",{onClick:x,disabled:!P(n).connected.value,class:"ptz-controller-panel__btn"}," Disconnect ",8,sa)])]),g.value?(d(),m("div",la,[e("div",ia,[t[9]||(t[9]=e("span",{class:"ptz-controller-panel__status-dot ptz-controller-panel__status-dot--connected"},null,-1)),e("span",ra," Gamepad: "+h(v.value),1)])])):T("",!0),e("div",ca,[t[13]||(t[13]=e("label",{class:"ptz-controller-panel__label"},"Manual Control (Testing)",-1)),e("div",ua,[e("div",da,[t[10]||(t[10]=e("label",null,"Pan",-1)),E(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>S.value=s),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,S.value,void 0,{number:!0}]]),e("span",ma,h(S.value.toFixed(1)),1)]),e("div",pa,[t[11]||(t[11]=e("label",null,"Tilt",-1)),E(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>M.value=s),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,M.value,void 0,{number:!0}]]),e("span",va,h(M.value.toFixed(1)),1)]),e("div",fa,[t[12]||(t[12]=e("label",null,"Zoom",-1)),E(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>z.value=s),type:"range",min:"-1",max:"1",step:"0.1",class:"ptz-controller-panel__slider"},null,512),[[G,z.value,void 0,{number:!0}]]),e("span",ga,h(z.value.toFixed(1)),1)]),e("button",{onClick:u,disabled:!P(n).connected.value||!f.value,class:"ptz-controller-panel__btn ptz-controller-panel__btn--primary"}," Send Command ",8,ba)])]),e("div",ha,[e("div",ya,[e("button",{onClick:N,disabled:g.value,class:"ptz-controller-panel__btn"}," Start Gamepad ",8,Ca),e("button",{onClick:F,disabled:!g.value,class:"ptz-controller-panel__btn"}," Stop Gamepad ",8,_a)]),t[14]||(t[14]=e("p",{class:"ptz-controller-panel__hint"}," Connect a gamepad/joystick and use left stick for pan/tilt, triggers for zoom ",-1))])])]))}}),Ga=ne(wa,[["__scopeId","data-v-ebf7148f"]]),xa={class:"loading-screen"},ka={class:"loading-content"},$a={key:0,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},Ta={key:1,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"1.8"},za={class:"loading-text"},Pa={class:"loading-tagline"},Ua={class:"loading-dots"},Sa={key:0,class:"loading-status"},Na={key:1,class:"loading-progress"},Fa={key:2,class:"loading-method"},Ba=ae({__name:"ModeLoadingScreen",props:{mode:{},minTime:{default:1500},maxTime:{default:8e3},contentReady:{type:Boolean,default:!1},showCancel:{type:Boolean,default:!1},statusText:{default:void 0},progress:{default:void 0},connectionMethod:{default:void 0}},emits:["ready","cancel"],setup(o,{emit:y}){const _=o,r=y;function b(){r("cancel")}const $=w(!1);let n=null,f=null;function g(){$.value&&_.contentReady&&r("ready")}le(()=>_.contentReady,N=>{N&&g()});const v=L(()=>_.mode==="recorder"?"#d45a5a":"#7c3aed"),l=L(()=>_.mode==="recorder"?"Recorder":"Mixer"),c=L(()=>_.mode==="recorder"?"Multi-cam ISO Recording":"Live Switching & Streaming"),x=L(()=>_.mode==="recorder"?"red":"purple");return K(()=>{n=setTimeout(()=>{$.value=!0,g()},_.minTime),f=setTimeout(()=>{r("ready")},_.maxTime)}),ie(()=>{n&&clearTimeout(n),f&&clearTimeout(f)}),(N,F)=>(d(),m("div",xa,[de(Se,{accent:x.value,"show-beams":!0,"show-pattern":!0},null,8,["accent"]),e("div",ka,[e("div",{class:"loading-icon",style:H({color:v.value})},[o.mode==="recorder"?(d(),m("svg",$a,[...F[0]||(F[0]=[e("rect",{x:"2",y:"5",width:"14",height:"12",rx:"2"},null,-1),e("path",{d:"M16 9l4-2v8l-4-2"},null,-1),e("circle",{cx:"6",cy:"8",r:"2",fill:"currentColor",stroke:"none"},null,-1)])])):(d(),m("svg",Ta,[...F[1]||(F[1]=[Ue('<rect x="2" y="2" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="13" y="2" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="2" y="10" width="9" height="6" rx="1" data-v-409a3379></rect><rect x="13" y="10" width="9" height="6" rx="1" data-v-409a3379></rect><circle cx="12" cy="20" r="2" fill="currentColor" data-v-409a3379></circle><path d="M9 19.5a4 4 0 0 1 6 0" stroke-linecap="round" data-v-409a3379></path>',6)])])),e("div",{class:"loading-icon__glow",style:H({background:v.value})},null,4)],4),e("div",za,[e("h2",{class:"loading-title",style:H({color:v.value})},h(l.value),5),e("p",Pa,h(c.value),1)]),e("div",Ua,[(d(),m(j,null,q(3,S=>e("div",{key:S,class:"loading-dot",style:H({backgroundColor:v.value,animationDelay:`${(S-1)*.15}s`})},null,4)),64))]),o.statusText?(d(),m("div",Sa,h(o.statusText),1)):T("",!0),o.progress!==void 0?(d(),m("div",Na,[e("div",{class:"loading-progress__bar",style:H({width:`${o.progress}%`,backgroundColor:v.value})},null,4)])):T("",!0),o.connectionMethod?(d(),m("div",Fa," Connected via "+h(o.connectionMethod),1)):T("",!0),o.showCancel?(d(),m("button",{key:3,onClick:b,class:"loading-cancel"},[...F[2]||(F[2]=[e("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),J(" Go back ",-1)])])):T("",!0)])]))}}),Oa=ne(Ba,[["__scopeId","data-v-409a3379"]]);export{Ea as C,Oa as M,Ga as P,Za as p,te as u};
