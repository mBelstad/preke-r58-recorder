import{J as Me,r as S,h as I,j as oe,k as ie,d as q,K as se,B as ne,c as a,n as H,b as O,a as e,I as A,t as $,p as te,o as r,_ as de,A as ue,F as K,q as Y,w as re,x as ae,L as fe,y as Ee,g as P,E as me,G as we,M as xe,H as Oe,l as J,m as Te,T as Le}from"./index-BHTfQ4rU.js";import{g as je,b as Ie,a as be,c as Ue,d as Pe}from"./vdoninja-D8mLQF_b.js";import{M as He}from"./ModeLoadingScreen-KrXQ1rOd.js";const ee=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],ge=Me("streaming",()=>{const g=S([]),v=S(!1),s=S(null),d=S({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),l=I(()=>g.value.find(n=>n.id===s.value)),u=I(()=>g.value.filter(n=>n.enabled)),h=I(()=>ee),k=I(()=>{const n=window.location.hostname,c=n==="localhost"||n==="127.0.0.1"?"localhost":n.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${c}:1935/mixer_program`,rtsp:`rtsp://${c}:8554/mixer_program`,srt:`srt://${c}:8890?streamid=read:mixer_program`,hls:`https://${n}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function i(n,o){const c=ee.find(x=>x.id===n);if(!c)throw new Error(`Unknown platform: ${n}`);const E={id:`dest-${Date.now()}`,platformId:n,name:o||c.name,streamKey:"",enabled:!1};return g.value.push(E),E}function D(n,o){const c=g.value.findIndex(E=>E.id===n);c!==-1&&(g.value[c]={...g.value[c],...o})}function j(n){const o=g.value.findIndex(c=>c.id===n);o!==-1&&g.value.splice(o,1),s.value===n&&(s.value=null)}function b(n){s.value=n}function y(n){d.value.enabled=n}function p(n){d.value={...d.value,...n}}function M(){v.value=!0}function R(){v.value=!1}function w(n){const o=ee.find(c=>c.id===n.platformId);return o?n.platformId==="custom"?`${n.name}${n.streamKey}`:`${o.rtmpBaseUrl}${n.streamKey}`:""}function _(){const n=window.location.hostname;return`srt://${n==="localhost"||n==="127.0.0.1"?"localhost":n.replace("r58-api","r58-mediamtx")}:${d.value.port}?streamid=read:${d.value.streamId}`}function f(){try{const n=localStorage.getItem("r58-streaming-destinations");if(n){const o=JSON.parse(n);g.value=o.destinations||[],o.srtOutput&&(d.value={...d.value,...o.srtOutput})}}catch(n){console.warn("Failed to load saved streaming destinations:",n)}}function t(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:g.value,srtOutput:d.value}))}catch(n){console.warn("Failed to save streaming destinations:",n)}}return f(),{destinations:g,isStreaming:v,activeDestinationId:s,srtOutput:d,activeDestination:l,enabledDestinations:u,platforms:h,programOutputUrls:k,addDestination:i,updateDestination:D,removeDestination:j,setActiveDestination:b,toggleSrtOutput:y,updateSrtConfig:p,startStreaming:M,stopStreaming:R,buildRtmpUrl:w,getSrtOutputUrl:_,saveDestinations:t,loadSavedDestinations:f}}),ce="vdo-debug",Ve=500,F=[];let ve=typeof localStorage<"u"&&localStorage.getItem(ce)==="true";function ye(g){ve=g,typeof localStorage<"u"&&(g?localStorage.setItem(ce,"true"):localStorage.removeItem(ce)),console.log(`[VDO.ninja Debug] ${g?"Enabled":"Disabled"}`)}function le(g){if(F.push(g),F.length>Ve&&F.shift(),ve){const v=new Date(g.timestamp).toISOString().split("T")[1].slice(0,-1),s=g.direction==="outgoing"?"âž¡ï¸ OUT":"â¬…ï¸ IN",d=g.direction==="outgoing"?"color: #3b82f6; font-weight: bold":"color: #22c55e; font-weight: bold";console.groupCollapsed(`%c[VDO.ninja ${s}] %c${g.type}`,d,"color: inherit"),console.log("Time:",v),g.target&&console.log("Target:",g.target),console.log("Data:",g.data),g.raw&&g.raw!==g.data&&console.log("Raw:",g.raw),console.groupEnd()}}function _e(){return[...F]}function Be(){F.length=0,console.log("[VDO.ninja Debug] Event history cleared")}function Se(){const g={total:F.length,incoming:0,outgoing:0,byType:{},lastActivity:F.length>0?F[F.length-1].timestamp:null};for(const v of F)v.direction==="incoming"?g.incoming++:g.outgoing++,g.byType[v.type]=(g.byType[v.type]||0)+1;return g}typeof window<"u"&&(window.__VDO_DEBUG__={getHistory:_e,clearHistory:Be,getStats:Se,enable:()=>ye(!0),disable:()=>ye(!1),isEnabled:()=>ve});function Ae(g){const v=S(!1),s=S(new Map),d=S(null),l=S(!1),u=S("disconnected"),h=S(null),k=je();function i(m,C,T,W){var U;if(!((U=g.value)!=null&&U.contentWindow)){console.warn("[VDO.ninja] Cannot send command - iframe not ready"),h.value="iframe not ready";return}const V={action:m};C&&(V.target=C),T!==void 0&&(V.value=T),W!==void 0&&(V.value2=W),le({timestamp:Date.now(),direction:"outgoing",type:m,target:C,data:{action:m,target:C,value:T,value2:W},raw:V});try{g.value.contentWindow.postMessage(V,"*")}catch(N){console.error("[VDO.ninja] Failed to send command:",N),h.value=String(N)}}function D(m,C){var W;if(!((W=g.value)!=null&&W.contentWindow)){console.warn("[VDO.ninja] Cannot send DOM command - iframe not ready");return}const T={action:"",target:m,...C};le({timestamp:Date.now(),direction:"outgoing",type:"dom-manipulation",target:m,data:C,raw:T});try{g.value.contentWindow.postMessage(T,"*")}catch(V){console.error("[VDO.ninja] Failed to send DOM command:",V)}}function j(m,C=1){i("addScene",m,C),d.value=C}function b(m,C=1){i("addScene",m,0)}function y(m){D(m,{replace:!0})}function p(m){D(m,{add:!0})}function M(m){D(m,{remove:!0})}function R(m,C){i("mic",m,!C);const T=s.value.get(m);T&&(T.muted=C)}function w(m){i("mic",m,"toggle");const C=s.value.get(m);C&&(C.muted=!C.muted)}function _(m,C){i("volume",m,Math.max(0,Math.min(200,C)))}function f(m){i("soloChat",m)}function t(m){i("soloChatBidirectional",m)}function n(m,C){i("sendChat",m,C)}function o(m,C){i("sendDirectorChat",m,C)}function c(m){i("hangup",m),s.value.delete(m)}function E(m){m?i("togglescreenshare",m):i("togglescreenshare")}function x(m,C){i("forward",m,C)}function L(m="guests"){i("getGuestList",void 0,void 0)}function B(){i("record",void 0,!0),l.value=!0}function Q(){i("record",void 0,!1),l.value=!1}function z(m){i("layout",void 0,m)}function Z(m){m?i("reload",m):i("reload")}function G(m,C){i("mixorder",m,C==="up"?-1:1)}function X(m){i("camera",void 0,m)}function $e(m,C){i("camera",m,C)}function Ce(m,C=!1){C?i("zoom",void 0,m,"abs"):i("zoom",void 0,m)}function Re(m){i("pan",void 0,m)}function De(m){i("tilt",void 0,m)}function pe(m){const C=m.origin;if(!C.includes(k.split(":")[0])&&!C.includes("vdo.ninja")&&!C.includes("vdo.itagenten")&&!C.includes("localhost"))return;const T=m.data;if(!T||typeof T!="object")return;const W=T.type||T.action||"unknown",V=T.streamID||T.UUID||T.streamId;switch(le({timestamp:Date.now(),direction:"incoming",type:W,target:V,data:T.data||T.value,raw:T}),W){case"director-ready":case"loaded":case"ready":case"started":v.value=!0,u.value="connected",h.value=null;break;case"new-guest":case"guest-connected":case"push":case"view":case"joined":{if(V){const U=T.data,N={id:V,label:(U==null?void 0:U.label)||T.label||V,type:(U==null?void 0:U.type)||"guest",hasVideo:(U==null?void 0:U.video)!==!1,hasAudio:(U==null?void 0:U.audio)!==!1,muted:!1,audioLevel:0};s.value.set(V,N)}break}case"guest-left":case"guest-disconnected":case"left":case"disconnect":V&&s.value.delete(V);break;case"audio-level":case"loudness":{if(V){const U=s.value.get(V);if(U){const N=T.data;U.audioLevel=(N==null?void 0:N.level)||T.value||0}}break}case"mute-state":case"muted":{if(V){const U=s.value.get(V);if(U){const N=T.data;U.muted=(N==null?void 0:N.muted)??T.value??!1}}break}case"scene-changed":case"scene":{const U=T.data,N=(U==null?void 0:U.scene)||T.value;d.value=typeof N=="number"?N:null;break}case"recording-started":l.value=!0;break;case"recording-stopped":l.value=!1;break;case"error":console.error("[VDO.ninja Error]",T.data),h.value=String(T.data);break}}return oe(()=>{u.value="connecting",window.addEventListener("message",pe),setTimeout(()=>{!v.value&&g.value&&(v.value=!0,u.value="connected")},5e3)}),ie(()=>{window.removeEventListener("message",pe),u.value="disconnected"}),{isReady:v,sources:s,activeScene:d,isRecording:l,connectionState:u,lastError:h,addToScene:j,removeFromScene:b,setProgram:y,addSource:p,removeSource:M,setLayout:z,changeMixOrder:G,setMute:R,toggleMute:w,setVolume:_,soloAudio:f,soloChatBidirectional:t,sendToGuest:n,sendDirectorMessage:o,kickGuest:c,toggleScreenShare:E,transferGuest:x,getGuestList:L,refreshSource:Z,setCamera:X,setGuestCamera:$e,zoom:Ce,pan:Re,tilt:De,startRecording:B,stopRecording:Q,sendCommand:i,sendDomCommand:D,getEventHistory:_e,getEventStats:Se}}const Ne={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10","data-testid":"vdo-loading"},ze={class:"text-center"},Ke={class:"text-xs text-r58-text-secondary mt-2"},Fe={key:1,class:"absolute bottom-4 left-4 right-4 bg-red-500/90 text-white px-4 py-2 rounded-lg text-sm z-20"},Ge=["src","title"],We=q({__name:"VdoNinjaEmbed",props:{profile:{},sources:{},room:{},password:{}},setup(g,{expose:v}){const s=g,d=S(null),l=se(),u=Ae(d),{isReady:h,sources:k,addToScene:i,removeFromScene:D,setMute:j,toggleMute:b,setVolume:y,sendCommand:p,sendDomCommand:M,isRecording:R,connectionState:w,lastError:_,startRecording:f,stopRecording:t,kickGuest:n,toggleScreenShare:o,setLayout:c,setProgram:E,addSource:x,removeSource:L,getEventHistory:B,getEventStats:Q}=u,z=I(()=>{const G={};return s.sources&&(G.source_ids=s.sources.join(",")),s.room&&(G.room=s.room),s.password&&(G.password=s.password),Ie(s.profile,G)}),Z=I(()=>s.profile==="mixer");return ne(k,G=>{l.updateSourcesFromVdo(Array.from(G.values()))},{deep:!0}),v({isReady:h,isRecording:R,connectionState:w,lastError:_,addToScene:i,removeFromScene:D,setLayout:c,setProgram:E,addSource:x,removeSource:L,setMute:j,toggleMute:b,setVolume:y,startRecording:f,stopRecording:t,kickGuest:n,toggleScreenShare:o,sendCommand:p,sendDomCommand:M,getEventHistory:B,getEventStats:Q}),(G,X)=>(r(),a("div",{class:H(["vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden",{"mixer-mode":Z.value}]),"data-testid":"vdo-embed-container"},[A(h)?O("",!0):(r(),a("div",Ne,[e("div",ze,[X[0]||(X[0]=e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"},null,-1)),X[1]||(X[1]=e("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja...",-1)),e("p",Ke,$(Z.value?"Loading mixer controls...":"Local mixer on R58"),1)])])),A(_)?(r(),a("div",Fe,[X[2]||(X[2]=e("strong",null,"Error:",-1)),te(" "+$(A(_)),1)])):O("",!0),e("iframe",{ref_key:"iframeRef",ref:d,src:z.value,class:H(["w-full h-full border-0",{"opacity-0":!A(h)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:"","data-testid":"vdo-iframe",title:Z.value?"VDO.ninja Mixer":"VDO.ninja"},null,10,Ge)],2))}}),Je=de(We,[["__scopeId","data-v-4a9e915e"]]),Ye={class:"space-y-4","data-testid":"source-panel"},qe={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide","data-testid":"sources-heading"},Xe={key:0,class:"ml-2 text-r58-accent-primary"},Qe={key:0,class:"px-3 py-2 bg-amber-500/10 border border-amber-500/30 rounded-lg text-xs text-amber-400"},Ze={key:1,class:"text-center py-6 text-r58-text-secondary"},et={key:2,class:"space-y-2"},tt={class:"flex items-center gap-3 min-w-0"},nt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ot={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},st={key:2,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},rt={key:3,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},at={class:"min-w-0"},it={key:0,class:"flex items-center gap-1"},lt=["onDblclick"],ct={class:"text-xs text-r58-text-secondary"},dt={class:"flex items-center gap-2 flex-shrink-0"},ut={key:0,class:"w-12 h-1.5 bg-r58-bg-primary rounded-full overflow-hidden"},mt=["onClick","data-testid","title"],gt={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},vt={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},he="preke-source-names",pt=q({__name:"SourcePanel",props:{vdoEmbed:{}},setup(g){function v(){try{const t=localStorage.getItem(he);return t?JSON.parse(t):{}}catch{return{}}}function s(t,n){const o=v();o[t]=n,localStorage.setItem(he,JSON.stringify(o))}const d=S(v()),l=S(null),u=S(""),h=g,k=se(),i=ue(),D=I(()=>k.sources.map(t=>{let n=t.label,o="VDO.ninja";const c=t.id.match(/cam(\d+)/i)||t.id.match(/hdmi[_-]?(\d+)/i);return c?(n=`HDMI ${parseInt(c[1])+1}`,o="Connected to device"):t.type==="guest"?(o="Remote guest",(!t.label||t.label.length>20||t.label.match(/^[a-z0-9]{8,}$/i))&&(n="Guest")):t.type==="screen"&&(o="Screen share"),{...t,label:n,subtitle:o}})),j={cam0:{name:"HDMI 1",subtitle:"Connected to device"},cam1:{name:"HDMI 2",subtitle:"Connected to device"},cam2:{name:"HDMI 3",subtitle:"Connected to device"},cam3:{name:"HDMI 4",subtitle:"Connected to device"}},b=I(()=>i.inputs.filter(t=>t.hasSignal).map(t=>{const n=j[t.id]||{name:t.label,subtitle:"HDMI Input"};return{id:t.id,label:n.name,subtitle:n.subtitle,type:"camera",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0}})),y=I(()=>D.value.length>0?D.value:b.value),p=I(()=>D.value.length===0&&b.value.length>0);function M(t){h.vdoEmbed&&h.vdoEmbed.toggleMute(t.id),k.setSourceMute(t.id,!t.muted)}function R(t){return d.value[t.id]||t.label}function w(t){l.value=t.id,u.value=d.value[t.id]||t.label}function _(){l.value&&u.value.trim()&&(s(l.value,u.value.trim()),d.value=v()),l.value=null}function f(){l.value=null,u.value=""}return(t,n)=>(r(),a("div",Ye,[e("h3",qe,[n[1]||(n[1]=te(" Sources ",-1)),y.value.length>0?(r(),a("span",Xe,"("+$(y.value.length)+")",1)):O("",!0)]),p.value?(r(),a("div",Qe," Showing HDMI cameras. VDO.ninja sources will appear when guests join. ")):O("",!0),y.value.length===0?(r(),a("div",Ze,[...n[2]||(n[2]=[e("svg",{class:"w-8 h-8 mx-auto mb-2 opacity-50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"text-sm"},"No sources connected",-1),e("p",{class:"text-xs mt-1 opacity-75"},"Connect HDMI sources or have guests join",-1)])])):(r(),a("div",et,[(r(!0),a(K,null,Y(y.value,o=>(r(),a("div",{key:o.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary hover:bg-r58-bg-tertiary/80 transition-colors"},[e("div",tt,[e("div",{class:H(["w-8 h-8 rounded bg-r58-bg-primary flex items-center justify-center flex-shrink-0",{"ring-2 ring-r58-accent-primary":A(k).programSource===o.id}])},[o.type==="camera"?(r(),a("svg",nt,[...n[3]||(n[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):o.type==="guest"?(r(),a("svg",ot,[...n[4]||(n[4]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):o.type==="screen"?(r(),a("svg",st,[...n[5]||(n[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])])):(r(),a("svg",rt,[...n[6]||(n[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z"},null,-1)])]))],2),e("div",at,[l.value===o.id?(r(),a("div",it,[re(e("input",{"onUpdate:modelValue":n[0]||(n[0]=c=>u.value=c),onKeyup:[fe(_,["enter"]),fe(f,["escape"])],onBlur:_,class:"input text-sm py-0.5 px-1 w-24",autofocus:""},null,544),[[ae,u.value]])])):(r(),a("p",{key:1,onDblclick:c=>w(o),class:"font-medium text-sm truncate cursor-pointer hover:text-r58-accent-primary",title:"Double-click to rename"},$(R(o)),41,lt)),e("p",ct,$(o.subtitle||o.type),1)])]),e("div",dt,[o.hasAudio?(r(),a("div",ut,[e("div",{class:H(["h-full rounded-full transition-all duration-100",o.muted?"bg-r58-accent-danger":"bg-r58-accent-success"]),style:Ee({width:`${o.audioLevel||0}%`})},null,6)])):O("",!0),o.hasAudio?(r(),a("button",{key:1,onClick:c=>M(o),class:H(["p-1.5 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":o.muted}]),"data-testid":`mute-button-${o.id}`,title:o.muted?"Unmute "+o.label:"Mute "+o.label},[o.muted?(r(),a("svg",gt,[...n[7]||(n[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(r(),a("svg",vt,[...n[8]||(n[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,mt)):O("",!0)])]))),128))])),n[9]||(n[9]=e("p",{class:"text-xs text-r58-text-secondary text-center pt-2"}," Full guest/source management available in the mixer above ",-1))]))}}),ft={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"camera-push-bar"},xt={class:"flex items-center gap-2"},bt={class:"text-r58-text-secondary"},yt={key:0,class:"px-4 pb-3"},ht={key:0,class:"flex gap-3 flex-wrap"},kt={class:"text-sm font-medium"},wt={class:"text-xs text-r58-text-secondary"},_t=["onClick"],St={key:1,class:"text-sm text-r58-text-secondary py-2"},$t={class:"hidden"},Ct=["src","onLoad","onError"],Rt=q({__name:"CameraPushBar",setup(g){const v=ue(),s=S(new Map),d=S(!0),l=I(()=>v.inputs.filter(b=>b.hasSignal));function u(b){return Ue(b)}ne(l,b=>{for(const p of b)if(!s.value.has(p.id)){const M=u(p.id),R=be(p.id,M,p.label);s.value.set(p.id,{cameraId:p.id,label:p.label,status:"connecting",iframeSrc:R})}const y=new Set(b.map(p=>p.id));for(const[p]of s.value)y.has(p)||s.value.delete(p)},{immediate:!0});function h(b){const y=s.value.get(b);y&&(y.status="connected",console.log(`[CameraPush] ${b} connected to VDO.ninja`))}function k(b){const y=s.value.get(b);y&&(y.status="error",console.error(`[CameraPush] ${b} failed to connect`))}function i(b){const y=v.inputs.find(R=>R.id===b);if(!y||!y.hasSignal)return;const p=u(b),M=be(b,p,y.label);s.value.set(b,{cameraId:b,label:y.label,status:"connecting",iframeSrc:M+`&_t=${Date.now()}`})}function D(b){switch(b){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function j(b){switch(b){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(b,y)=>(r(),a("div",ft,[e("button",{onClick:y[0]||(y[0]=p=>d.value=!d.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors","data-testid":"camera-push-toggle","aria-expanded":"expanded"},[e("div",xt,[y[1]||(y[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",bt,"("+$(l.value.length)+" active)",1)]),(r(),a("svg",{class:H(["w-4 h-4 transition-transform",{"rotate-180":d.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...y[2]||(y[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),d.value?(r(),a("div",yt,[s.value.size>0?(r(),a("div",ht,[(r(!0),a(K,null,Y(s.value,([p,M])=>(r(),a("div",{key:p,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[e("span",{class:H(["w-2 h-2 rounded-full",D(M.status)])},null,2),e("span",kt,$(M.label),1),e("span",wt,$(j(M.status)),1),M.status==="error"?(r(),a("button",{key:0,onClick:R=>i(p),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,_t)):O("",!0)]))),128))])):(r(),a("div",St," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):O("",!0),e("div",$t,[(r(!0),a(K,null,Y(s.value,([p,M])=>(r(),a("iframe",{key:p,src:M.iframeSrc,onLoad:R=>h(p),onError:R=>k(p),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Ct))),128))])]))}}),Dt={class:"program-output space-y-3","data-testid":"program-output"},Mt={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg","data-testid":"program-output-status"},Et={class:"text-sm font-medium","data-testid":"program-output-text"},Ot={key:0,class:"space-y-2"},Tt={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},Lt={class:"flex-1 text-xs truncate text-r58-text-secondary"},jt={key:0,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},It={class:"text-xs text-r58-text-secondary"},Ut={key:1,class:"text-xs text-r58-text-secondary px-3"},Pt={class:"hidden"},Ht=["src"],Vt=q({__name:"ProgramOutput",setup(g){const v=se(),s=ge(),d=S(!1),l=S("idle"),u=S("");function h(){return`${window.location.origin}/api/v1/whip/program/whip`}function k(){d.value||(l.value="connecting",u.value=Pe(h()),d.value=!0,console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function i(){d.value&&(d.value=!1,u.value="",l.value="idle",console.log("[ProgramOutput] Stopped WHIP push"))}function D(){d.value&&(l.value="live",console.log("[ProgramOutput] WHIP push connected"))}function j(){l.value="error",console.error("[ProgramOutput] WHIP push failed")}function b(){i(),setTimeout(()=>k(),500)}ne(()=>v.isLive,R=>{R?k():i()});function y(){switch(l.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function p(){switch(l.value){case"live":return"MediaMTX connected";case"connecting":return"Connecting...";case"error":return"Connection failed";default:return"Inactive"}}function M(){const R=s.programOutputUrls.srt;navigator.clipboard.writeText(R),P.success("SRT URL copied")}return(R,w)=>(r(),a("div",Dt,[e("div",Mt,[e("span",{class:H(["w-2 h-2 rounded-full",y()]),"data-testid":"program-output-indicator"},null,2),e("span",Et,$(p()),1),l.value==="error"?(r(),a("button",{key:0,onClick:w[0]||(w[0]=_=>b()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"}," Retry ")):O("",!0)]),l.value==="live"?(r(),a("div",Ot,[e("div",Tt,[w[1]||(w[1]=e("span",{class:"text-xs text-r58-text-secondary"},"ðŸ”´ SRT:",-1)),e("code",Lt,$(A(s).programOutputUrls.srt),1),e("button",{onClick:M,class:"text-xs text-r58-accent-primary hover:underline"},"Copy")]),A(s).enabledDestinations.length>0?(r(),a("div",jt,[w[2]||(w[2]=e("span",{class:"w-2 h-2 rounded-full bg-emerald-500"},null,-1)),e("span",It,$(A(s).enabledDestinations.length)+" streaming destination"+$(A(s).enabledDestinations.length>1?"s":"")+" active ",1)])):O("",!0)])):O("",!0),l.value==="idle"?(r(),a("p",Ut," Program output will start automatically when you go live. ")):O("",!0),e("div",Pt,[d.value&&u.value?(r(),a("iframe",{key:0,src:u.value,onLoad:D,onError:j,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,Ht)):O("",!0)])]))}}),Bt={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},At={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},Nt={class:"p-6 overflow-y-auto max-h-[60vh]"},zt={class:"mb-8"},Kt={class:"flex items-center justify-between mb-4"},Ft={key:0,class:"mb-4 p-4 bg-r58-bg-tertiary rounded-lg"},Gt={class:"grid grid-cols-2 gap-2"},Wt=["onClick"],Jt={class:"text-xl"},Yt={key:1,class:"space-y-3"},qt=["onClick"],Xt={class:"text-xl"},Qt={class:"flex-1"},Zt={class:"font-medium"},en={class:"text-xs text-r58-text-secondary"},tn=["onClick"],nn=["onClick"],on={key:2,class:"text-r58-text-secondary text-sm"},sn={key:0,class:"mb-8 p-4 bg-r58-bg-tertiary rounded-lg"},rn={class:"text-lg font-medium mb-4"},an={class:"space-y-4"},ln=["placeholder"],cn={key:0},dn={class:"flex gap-2"},un={class:"mb-8"},mn={class:"space-y-3"},gn={class:"p-3 bg-r58-bg-tertiary rounded-lg"},vn={class:"flex items-center justify-between mb-1"},pn={class:"text-xs text-r58-text-secondary break-all"},fn={class:"p-3 bg-r58-bg-tertiary rounded-lg"},xn={class:"flex items-center justify-between mb-1"},bn={class:"text-xs text-r58-text-secondary break-all"},yn={class:"p-3 bg-r58-bg-tertiary rounded-lg"},hn={class:"flex items-center justify-between mb-1"},kn={class:"text-xs text-r58-text-secondary break-all"},wn={class:"p-3 bg-r58-bg-tertiary rounded-lg"},_n={class:"flex items-center justify-between mb-1"},Sn={class:"text-xs text-r58-text-secondary break-all"},$n={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Cn={class:"flex items-center justify-between mb-1"},Rn={class:"text-xs text-r58-text-secondary break-all"},Dn={class:"p-4 bg-r58-bg-tertiary rounded-lg"},Mn={class:"flex items-center gap-3 mb-4"},En=q({__name:"StreamingSettings",setup(g,{expose:v}){const s=ge(),d=S(!1),l=S(null),u=S(!1);S(""),S("");const h=I(()=>s.destinations),k=I(()=>ee),i=I(()=>s.programOutputUrls);function D(){d.value=!0}function j(){d.value=!1,l.value=null,u.value=!1}function b(f){const t=s.addDestination(f);l.value=t,u.value=!1,s.saveDestinations()}function y(){l.value&&(s.updateDestination(l.value.id,l.value),s.saveDestinations(),l.value=null,P.success("Streaming destination saved"))}function p(f){s.removeDestination(f),s.saveDestinations(),P.info("Destination removed")}function M(f){s.updateDestination(f.id,{enabled:!f.enabled}),s.saveDestinations()}function R(f,t){navigator.clipboard.writeText(f),P.success(`${t} copied to clipboard`)}function w(f){const t=ee.find(n=>n.id===f);return(t==null?void 0:t.icon)||"ðŸ“¡"}function _(f){const t=ee.find(n=>n.id===f);return(t==null?void 0:t.name)||"Unknown"}return v({open:D}),(f,t)=>{var n;return r(),me(we,{to:"body"},[d.value?(r(),a("div",Bt,[e("div",{class:"absolute inset-0 bg-black/60",onClick:j}),e("div",At,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[t[11]||(t[11]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:j,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," Ã— ")]),e("div",Nt,[e("section",zt,[e("div",Kt,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:t[0]||(t[0]=o=>u.value=!u.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),u.value?(r(),a("div",Ft,[t[13]||(t[13]=e("p",{class:"text-sm text-r58-text-secondary mb-3"},"Select a streaming platform:",-1)),e("div",Gt,[(r(!0),a(K,null,Y(k.value,o=>(r(),a("button",{key:o.id,onClick:c=>b(o.id),class:"flex items-center gap-2 p-3 bg-r58-bg-secondary hover:bg-r58-accent-primary/20 rounded-lg transition-colors text-left"},[e("span",Jt,$(o.icon),1),e("span",null,$(o.name),1)],8,Wt))),128))])])):O("",!0),h.value.length>0?(r(),a("div",Yt,[(r(!0),a(K,null,Y(h.value,o=>(r(),a("div",{key:o.id,class:"flex items-center gap-3 p-3 bg-r58-bg-tertiary rounded-lg"},[e("button",{onClick:c=>M(o),class:H(["w-10 h-6 rounded-full transition-colors relative",o.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:H(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",o.enabled?"left-5":"left-1"])},null,2)],10,qt),e("span",Xt,$(w(o.platformId)),1),e("div",Qt,[e("div",Zt,$(o.name),1),e("div",en,$(o.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+o.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:c=>l.value={...o},class:"text-r58-accent-primary hover:underline text-sm"}," Edit ",8,tn),e("button",{onClick:c=>p(o.id),class:"text-r58-accent-danger hover:underline text-sm"}," Remove ",8,nn)]))),128))])):(r(),a("p",on," No streaming destinations configured. Add a platform above. "))]),l.value?(r(),a("section",sn,[e("h3",rn," Edit "+$(_(l.value.platformId)),1),e("div",an,[e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Display Name",-1)),re(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>l.value.name=o),type:"text",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none"},null,512),[[ae,l.value.name]])]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Stream Key",-1)),re(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>l.value.streamKey=o),type:"password",placeholder:(n=A(ee).find(o=>o.id===l.value.platformId))==null?void 0:n.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,8,ln),[[ae,l.value.streamKey]]),t[16]||(t[16]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),l.value.platformId==="custom"?(r(),a("div",cn,[t[17]||(t[17]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"RTMP URL",-1)),re(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>l.value.name=o),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,512),[[ae,l.value.name]])])):O("",!0),e("div",dn,[e("button",{onClick:y,class:"btn btn-primary"}," Save "),e("button",{onClick:t[4]||(t[4]=o=>l.value=null),class:"btn"}," Cancel ")])])])):O("",!0),e("section",un,[t[26]||(t[26]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),t[27]||(t[27]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",mn,[e("div",gn,[e("div",vn,[t[18]||(t[18]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:t[5]||(t[5]=o=>R(i.value.srt,"SRT URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",pn,$(i.value.srt),1),t[19]||(t[19]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",fn,[e("div",xn,[t[20]||(t[20]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:t[6]||(t[6]=o=>R(i.value.rtmp,"RTMP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",bn,$(i.value.rtmp),1)]),e("div",yn,[e("div",hn,[t[21]||(t[21]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:t[7]||(t[7]=o=>R(i.value.rtsp,"RTSP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",kn,$(i.value.rtsp),1)]),e("div",wn,[e("div",_n,[t[22]||(t[22]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:t[8]||(t[8]=o=>R(i.value.hls,"HLS URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Sn,$(i.value.hls),1),t[23]||(t[23]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",$n,[e("div",Cn,[t[24]||(t[24]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:t[9]||(t[9]=o=>R(i.value.whep,"WHEP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Rn,$(i.value.whep),1),t[25]||(t[25]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[t[30]||(t[30]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",Dn,[e("div",Mn,[e("button",{onClick:t[10]||(t[10]=o=>A(s).toggleSrtOutput(!A(s).srtOutput.enabled)),class:H(["w-10 h-6 rounded-full transition-colors relative",A(s).srtOutput.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:H(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",A(s).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),t[28]||(t[28]=e("span",null,"Enable SRT Output",-1))]),t[29]||(t[29]=e("div",{class:"text-sm text-r58-text-secondary"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-r58-bg-tertiary"},[e("button",{onClick:j,class:"btn"},"Close")])])])):O("",!0)])}}}),On={class:"recording-controls space-y-3","data-testid":"recording-controls"},Tn={class:"flex items-center gap-3 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},Ln={class:"text-sm font-medium flex-1","data-testid":"recording-status"},jn={key:0,class:"text-lg font-mono font-bold text-r58-accent-danger","data-testid":"recording-duration"},In=["disabled"],Un={key:0,class:"px-3 py-2 bg-r58-accent-success/10 border border-r58-accent-success/30 rounded-lg"},Pn={class:"flex items-center justify-between"},Hn=["href"],Vn=q({__name:"RecordingControls",props:{vdoEmbed:{}},setup(g){const v=g,s=S(!1),d=S(null),l=S(0),u=S(null),h=S(!1);ne(()=>{var w,_;return(_=(w=v.vdoEmbed)==null?void 0:w.isRecording)==null?void 0:_.value},w=>{w!==void 0&&(s.value=w,w&&!d.value?d.value=Date.now():!w&&d.value&&(d.value=null))});let k=null;function i(){k&&clearInterval(k),k=window.setInterval(()=>{d.value&&(l.value=Date.now()-d.value)},100)}function D(){k&&(clearInterval(k),k=null)}oe(()=>{i()}),ie(()=>{D()});const j=I(()=>{const w=Math.floor(l.value/1e3),_=Math.floor(w/3600),f=Math.floor(w%3600/60),t=w%60;return _>0?`${_}:${f.toString().padStart(2,"0")}:${t.toString().padStart(2,"0")}`:`${f}:${t.toString().padStart(2,"0")}`});async function b(){if(!v.vdoEmbed){P.error("VDO.ninja not connected");return}h.value=!0;try{v.vdoEmbed.startRecording(),s.value=!0,d.value=Date.now(),l.value=0,u.value=null,P.success("Recording started")}catch(w){P.error("Failed to start recording"),console.error("[RecordingControls] Start recording error:",w)}finally{h.value=!1}}async function y(){if(!v.vdoEmbed){P.error("VDO.ninja not connected");return}h.value=!0;try{v.vdoEmbed.stopRecording(),s.value=!1,d.value=null,P.success(`Recording stopped (${j.value})`)}catch(w){P.error("Failed to stop recording"),console.error("[RecordingControls] Stop recording error:",w)}finally{h.value=!1}}function p(){s.value?y():b()}function M(){return s.value?"bg-r58-accent-danger animate-pulse":"bg-r58-bg-tertiary"}function R(){return h.value?"Processing...":s.value?`Recording â€¢ ${j.value}`:"Ready to record"}return(w,_)=>(r(),a("div",On,[e("div",Tn,[e("span",{class:H(["w-3 h-3 rounded-full",M()]),"data-testid":"recording-indicator"},null,2),e("span",Ln,$(R()),1),s.value?(r(),a("span",jn,$(j.value),1)):O("",!0)]),e("div",null,[e("button",{onClick:p,disabled:h.value,class:H(["btn w-full justify-center",s.value?"btn-danger":"btn-primary"]),"data-testid":"recording-toggle-button"},[h.value?(r(),a(K,{key:0},[_[0]||(_[0]=e("svg",{class:"animate-spin w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})],-1)),_[1]||(_[1]=te(" Processing... ",-1))],64)):s.value?(r(),a(K,{key:1},[_[2]||(_[2]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("rect",{x:"6",y:"6",width:"12",height:"12",rx:"1"})],-1)),_[3]||(_[3]=te(" Stop Recording ",-1))],64)):(r(),a(K,{key:2},[_[4]||(_[4]=e("svg",{class:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"8"})],-1)),_[5]||(_[5]=te(" Start Recording ",-1))],64))],10,In)]),u.value?(r(),a("div",Un,[e("div",Pn,[_[6]||(_[6]=e("span",{class:"text-sm text-r58-accent-success"},"Recording ready!",-1)),e("a",{href:u.value,download:"",class:"text-sm text-r58-accent-primary hover:underline"}," Download ",8,Hn)])])):O("",!0),_[7]||(_[7]=e("p",{class:"text-xs text-r58-text-secondary px-1"}," Records the mixed output locally in your browser. Recording is saved when stopped. ",-1))]))}}),Bn=de(Vn,[["__scopeId","data-v-14707e66"]]),An={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Nn={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-3xl max-h-[80vh] overflow-hidden shadow-2xl","data-testid":"hotkey-settings-modal"},zn={class:"flex border-b border-r58-bg-tertiary"},Kn=["onClick"],Fn={class:"p-6 overflow-y-auto max-h-[55vh]"},Gn={key:0,class:"text-center py-12 text-r58-text-secondary"},Wn={key:1,class:"space-y-6"},Jn={class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},Yn={class:"space-y-2"},qn={class:"flex-1"},Xn={class:"text-sm"},Qn={key:0,class:"ml-2 text-xs text-r58-accent-primary"},Zn={class:"flex items-center gap-2"},eo={key:0,class:"flex items-center gap-2"},to={key:0,class:"px-3 py-1 bg-r58-accent-primary text-white rounded text-sm font-mono"},no={key:1,class:"text-sm text-r58-text-secondary animate-pulse"},oo={class:"px-3 py-1 bg-r58-bg-secondary border border-r58-bg-tertiary rounded text-sm font-mono"},so=["onClick"],ro=["onClick"],ke="r58-hotkey-customizations",ao=q({__name:"HotkeySettings",setup(g,{expose:v}){const s=[{id:"help",key:"?",modifiers:["shift"],description:"Show keyboard shortcuts",context:"global",category:"Navigation",editable:!1},{id:"goto-recorder",key:"r",description:"Go to Recorder",context:"global",category:"Navigation",editable:!0},{id:"goto-mixer",key:"m",description:"Go to Mixer",context:"global",category:"Navigation",editable:!0},{id:"escape",key:"Escape",description:"Close modal / Cancel",context:"global",category:"Navigation",editable:!1},{id:"scene-1",key:"1",description:"Switch to Scene 1",context:"mixer",category:"Scenes",editable:!0},{id:"scene-2",key:"2",description:"Switch to Scene 2",context:"mixer",category:"Scenes",editable:!0},{id:"scene-3",key:"3",description:"Switch to Scene 3",context:"mixer",category:"Scenes",editable:!0},{id:"scene-4",key:"4",description:"Switch to Scene 4",context:"mixer",category:"Scenes",editable:!0},{id:"scene-5",key:"5",description:"Switch to Scene 5",context:"mixer",category:"Scenes",editable:!0},{id:"scene-6",key:"6",description:"Switch to Scene 6",context:"mixer",category:"Scenes",editable:!0},{id:"scene-7",key:"7",description:"Switch to Scene 7",context:"mixer",category:"Scenes",editable:!0},{id:"scene-8",key:"8",description:"Switch to Scene 8",context:"mixer",category:"Scenes",editable:!0},{id:"scene-9",key:"9",description:"Switch to Scene 9",context:"mixer",category:"Scenes",editable:!0},{id:"cut",key:"t",description:"Cut transition",context:"mixer",category:"Transitions",editable:!0},{id:"fade",key:"a",description:"Auto-transition (fade)",context:"mixer",category:"Transitions",editable:!0},{id:"cycle-sources",key:"Tab",description:"Cycle through sources",context:"mixer",category:"Transitions",editable:!0},{id:"go-live",key:"g",description:"Toggle Go Live",context:"mixer",category:"Control",editable:!0},{id:"toggle-recording",key:"r",modifiers:["ctrl"],description:"Toggle local recording",context:"mixer",category:"Control",editable:!0},{id:"mute-all",key:"m",modifiers:["ctrl"],description:"Mute all sources",context:"mixer",category:"Control",editable:!0},{id:"source-1",key:"F1",description:"Select source 1",context:"mixer",category:"Sources",editable:!0},{id:"source-2",key:"F2",description:"Select source 2",context:"mixer",category:"Sources",editable:!0},{id:"source-3",key:"F3",description:"Select source 3",context:"mixer",category:"Sources",editable:!0},{id:"source-4",key:"F4",description:"Select source 4",context:"mixer",category:"Sources",editable:!0},{id:"start-stop-recording",key:" ",description:"Start/Stop recording",context:"recorder",category:"Recording",editable:!0},{id:"mark-chapter",key:"c",description:"Mark chapter point",context:"recorder",category:"Recording",editable:!0}],d=S(!1),l=S("mixer"),u=S({}),h=S(null),k=S(null);function i(){try{const x=localStorage.getItem(ke);x&&(u.value=JSON.parse(x))}catch(x){console.warn("[HotkeySettings] Failed to load customizations:",x)}}function D(){try{localStorage.setItem(ke,JSON.stringify(u.value))}catch(x){console.warn("[HotkeySettings] Failed to save customizations:",x)}}function j(x){const L=u.value[x.id];return L?{...x,key:L.key,modifiers:L.modifiers}:x}const b=I(()=>{const x={global:{},mixer:{},recorder:{}};for(const L of s){const B=j(L);x[L.context][B.category]||(x[L.context][B.category]=[]),x[L.context][B.category].push(B)}return x}),y=I(()=>b.value[l.value]||{});function p(x){return xe(x.key,x.modifiers)}function M(x){return!!u.value[x]}function R(x){const L=s.find(B=>B.id===x);L!=null&&L.editable&&(h.value=x,k.value=null,document.addEventListener("keydown",w))}function w(x){if(x.preventDefault(),x.stopPropagation(),["Control","Alt","Shift","Meta"].includes(x.key))return;const L=[];x.ctrlKey&&L.push("ctrl"),x.altKey&&L.push("alt"),x.shiftKey&&L.push("shift"),x.metaKey&&L.push("meta"),k.value={key:x.key,modifiers:L},document.removeEventListener("keydown",w)}function _(){!h.value||!k.value||(u.value[h.value]={key:k.value.key,modifiers:k.value.modifiers.length>0?k.value.modifiers:void 0},D(),P.success("Hotkey updated"),h.value=null,k.value=null)}function f(){h.value=null,k.value=null,document.removeEventListener("keydown",w)}function t(x){delete u.value[x],D(),P.info("Hotkey reset to default")}function n(){confirm("Reset all hotkeys to defaults?")&&(u.value={},D(),P.info("All hotkeys reset to defaults"))}function o(){i(),d.value=!0}function c(){f(),d.value=!1}oe(()=>{i()});function E(){return{...u.value}}return v({open:o,getCustomBindings:E}),(x,L)=>(r(),me(we,{to:"body"},[d.value?(r(),a("div",An,[e("div",{class:"absolute inset-0 bg-black/60",onClick:c}),e("div",Nn,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[L[0]||(L[0]=e("h2",{class:"text-xl font-semibold"},"Keyboard Shortcuts",-1)),e("div",{class:"flex items-center gap-4"},[e("button",{onClick:n,class:"text-sm text-r58-text-secondary hover:text-r58-text-primary"}," Reset All "),e("button",{onClick:c,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," Ã— ")])]),e("div",zn,[(r(),a(K,null,Y(["mixer","global","recorder"],B=>e("button",{key:B,onClick:Q=>l.value=B,class:H(["px-6 py-3 text-sm font-medium capitalize transition-colors",l.value===B?"text-r58-accent-primary border-b-2 border-r58-accent-primary":"text-r58-text-secondary hover:text-r58-text-primary"])},$(B),11,Kn)),64))]),e("div",Fn,[Object.keys(y.value).length===0?(r(),a("div",Gn," No shortcuts defined for this context. ")):(r(),a("div",Wn,[(r(!0),a(K,null,Y(y.value,(B,Q)=>(r(),a("div",{key:Q},[e("h3",Jn,$(Q),1),e("div",Yn,[(r(!0),a(K,null,Y(B,z=>(r(),a("div",{key:z.id,class:H(["flex items-center justify-between p-3 bg-r58-bg-tertiary rounded-lg",{"ring-2 ring-r58-accent-primary":h.value===z.id}])},[e("div",qn,[e("span",Xn,$(z.description),1),M(z.id)?(r(),a("span",Qn,"(customized)")):O("",!0)]),e("div",Zn,[h.value===z.id?(r(),a("div",eo,[k.value?(r(),a("kbd",to,$(A(xe)(k.value.key,k.value.modifiers)),1)):(r(),a("span",no," Press a key... ")),k.value?(r(),a("button",{key:2,onClick:_,class:"btn btn-sm btn-primary"}," Save ")):O("",!0),e("button",{onClick:f,class:"btn btn-sm"}," Cancel ")])):(r(),a(K,{key:1},[e("kbd",oo,$(p(z)),1),z.editable?(r(),a("button",{key:0,onClick:Z=>R(z.id),class:"text-xs text-r58-accent-primary hover:underline"}," Edit ",8,so)):O("",!0),M(z.id)?(r(),a("button",{key:1,onClick:Z=>t(z.id),class:"text-xs text-r58-text-secondary hover:text-r58-accent-danger"}," Reset ",8,ro)):O("",!0)],64))])],2))),128))])]))),128))]))]),e("div",{class:"flex items-center justify-between px-6 py-4 border-t border-r58-bg-tertiary"},[L[1]||(L[1]=e("div",{class:"text-sm text-r58-text-secondary"},' Click "Edit" to customize a shortcut. Press any key combination to set. ',-1)),e("button",{onClick:c,class:"btn"},"Close")])])])):O("",!0)]))}}),io={class:"connection-status","data-testid":"connection-status"},lo={class:"text-xs text-r58-text-secondary"},co={key:0,class:"text-xs text-r58-accent-danger",title:"Click for details"},uo={key:0,class:"mt-2 p-3 bg-r58-bg-tertiary rounded-lg text-xs space-y-2"},mo={class:"grid grid-cols-2 gap-2"},go={class:"ml-1 font-medium"},vo={class:"ml-1"},po={class:"ml-1"},fo={key:0,class:"p-2 bg-r58-accent-danger/10 border border-r58-accent-danger/30 rounded text-r58-accent-danger"},xo={class:"flex gap-2 pt-2 border-t border-r58-bg-tertiary"},bo=["disabled"],yo={key:1,class:"text-r58-text-secondary text-center"},ho=q({__name:"ConnectionStatus",props:{vdoEmbed:{}},setup(g){const v=g;se();const s=S(!1),d=S("never"),l=S(0),u=S(!1),h=I(()=>{var f,t;return((t=(f=v.vdoEmbed)==null?void 0:f.connectionState)==null?void 0:t.value)||"disconnected"}),k=I(()=>{var f,t;return((t=(f=v.vdoEmbed)==null?void 0:f.isReady)==null?void 0:t.value)||!1}),i=I(()=>{var f,t;return((t=(f=v.vdoEmbed)==null?void 0:f.lastError)==null?void 0:t.value)||null}),D=I(()=>h.value==="disconnected"||!k.value?"disconnected":i.value?"error":h.value==="connecting"?"degraded":"healthy"),j=I(()=>{switch(D.value){case"healthy":return"bg-r58-accent-success";case"degraded":return"bg-amber-500";case"error":return"bg-r58-accent-danger";case"disconnected":return"bg-r58-text-secondary";default:return"bg-r58-text-secondary"}}),b=I(()=>{switch(D.value){case"healthy":return"Connected";case"degraded":return"Connecting...";case"error":return"Error";case"disconnected":return"Disconnected";default:return"Unknown"}});let y=null;function p(){if(v.vdoEmbed){const f=v.vdoEmbed.getEventStats();if(f.lastActivity){const t=Date.now()-f.lastActivity;t<1e3?d.value="just now":t<6e4?d.value=`${Math.floor(t/1e3)}s ago`:t<36e5?d.value=`${Math.floor(t/6e4)}m ago`:d.value="over 1h ago"}}}oe(()=>{p(),y=window.setInterval(p,1e3)}),ie(()=>{y&&clearInterval(y)});async function M(){if(!u.value){u.value=!0,l.value++,P.info("Attempting to reconnect...");try{v.vdoEmbed&&v.vdoEmbed.sendCommand("ping"),await new Promise(f=>setTimeout(f,2e3)),k.value&&!i.value?(P.success("Reconnected successfully"),l.value=0):P.error("Reconnection failed. Try refreshing the page.")}catch(f){P.error("Reconnection error"),console.error("[ConnectionStatus] Reconnect error:",f)}finally{u.value=!1}}}function R(){confirm("This will refresh the page and may interrupt active streams. Continue?")&&window.location.reload()}function w(){s.value=!s.value}const _=I(()=>v.vdoEmbed?v.vdoEmbed.getEventStats():{total:0,incoming:0,outgoing:0,lastActivity:null});return(f,t)=>(r(),a("div",io,[e("div",{class:"flex items-center gap-2 cursor-pointer",onClick:w},[e("span",{class:H(["w-2 h-2 rounded-full",[j.value,{"animate-pulse":D.value==="degraded"}]]),"data-testid":"status-indicator"},null,2),e("span",lo,$(b.value),1),i.value?(r(),a("span",co," âš ï¸ ")):O("",!0),(r(),a("svg",{class:H(["w-3 h-3 text-r58-text-secondary transition-transform",{"rotate-180":s.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[0]||(t[0]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),s.value?(r(),a("div",uo,[e("div",mo,[e("div",null,[t[1]||(t[1]=e("span",{class:"text-r58-text-secondary"},"VDO.ninja:",-1)),e("span",{class:H(["ml-1 font-medium",k.value?"text-r58-accent-success":"text-r58-accent-danger"])},$(k.value?"Ready":"Not Ready"),3)]),e("div",null,[t[2]||(t[2]=e("span",{class:"text-r58-text-secondary"},"State:",-1)),e("span",go,$(h.value),1)]),e("div",null,[t[3]||(t[3]=e("span",{class:"text-r58-text-secondary"},"Last activity:",-1)),e("span",vo,$(d.value),1)]),e("div",null,[t[4]||(t[4]=e("span",{class:"text-r58-text-secondary"},"Events:",-1)),e("span",po,$(_.value.total),1)])]),i.value?(r(),a("div",fo,[t[5]||(t[5]=e("strong",null,"Error:",-1)),te(" "+$(i.value),1)])):O("",!0),e("div",xo,[e("button",{onClick:M,disabled:u.value,class:H(["btn btn-sm flex-1",{"opacity-50":u.value}])},$(u.value?"Reconnecting...":"ðŸ”„ Reconnect"),11,bo),e("button",{onClick:R,class:"btn btn-sm",title:"Refresh the page (last resort)"}," ðŸ”ƒ Refresh ")]),l.value>0?(r(),a("div",yo," Reconnect attempts: "+$(l.value),1)):O("",!0)])):O("",!0)]))}}),ko={class:"h-full flex flex-col"},wo={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary","data-testid":"mixer-header"},_o={class:"flex items-center gap-4"},So={class:"flex items-center gap-2"},$o={key:0,class:"badge badge-danger","data-testid":"on-air-badge"},Co={key:1,class:"text-xs text-r58-text-secondary"},Ro={class:"flex items-center gap-4"},Do={class:"flex-1 flex overflow-hidden"},Mo={class:"flex-1 p-4"},Eo={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},Oo={class:"mb-6"},To={class:"grid grid-cols-4 gap-2"},Lo=["onClick","data-testid"],jo={class:"mb-6 pt-4 border-t border-r58-bg-tertiary"},Io={class:"mb-6 pt-4 border-t border-r58-bg-tertiary"},Uo={class:"pt-4 border-t border-r58-bg-tertiary"},Po=q({__name:"MixerView",setup(g){const v=se(),s=ue(),d=ge(),{register:l}=Oe(),u=S(null),h=S(null),k=S(null),i=I(()=>v.isLive),D=I(()=>d.enabledDestinations.length),j=S(!0),b=S(!1);function y(){j.value=!1}ne(()=>{var c,E;return(E=(c=u.value)==null?void 0:c.isReady)==null?void 0:E.value},c=>{c&&(console.log("[Mixer] VDO.ninja iframe ready, dismissing loading screen"),b.value=!0)},{immediate:!0});let p=null;function M(){return s.isRecording?1e4:3e4}function R(){p&&clearInterval(p),p=window.setInterval(()=>{s.fetchInputs()},M())}const w=[];ne(()=>s.isRecording,()=>{R()}),oe(async()=>{await s.fetchInputs(),R();for(let c=1;c<=4;c++){const E=l({key:String(c),description:`Switch to scene ${c}`,action:()=>_(c),context:"mixer"});w.push(E)}w.push(l({key:"g",description:"Toggle Go Live",action:()=>t(),context:"mixer"})),w.push(l({key:"r",description:"Toggle recording",action:()=>f(),context:"mixer"}))}),ie(()=>{w.forEach(c=>c()),p&&(clearInterval(p),p=null)});function _(c){u.value&&u.value.sendCommand("addScene","*",c),v.setScene(`scene-${c}`),P.info(`Scene ${c}`)}function f(){var c;u.value&&((c=u.value.isRecording)!=null&&c.value?(u.value.stopRecording(),P.info("Recording stopped")):(u.value.startRecording(),P.success("Recording started")))}function t(){if(v.isLive)v.toggleLive(),d.stopStreaming(),P.info("Session ended");else{v.toggleLive(),d.startStreaming();const c=d.enabledDestinations.length;c>0?P.success(`Live! Streaming to ${c} destination${c>1?"s":""}`):P.info("Live! (No streaming destinations configured)")}}function n(){var c;(c=h.value)==null||c.open()}function o(){var c;(c=k.value)==null||c.open()}return(c,E)=>(r(),a(K,null,[J(Le,{name:"fade"},{default:Te(()=>[j.value?(r(),me(He,{key:0,mode:"mixer","content-ready":b.value,"min-time":2e3,"max-time":15e3,onReady:y},null,8,["content-ready"])):O("",!0)]),_:1}),e("div",ko,[e("header",wo,[e("div",_o,[e("div",So,[e("span",{class:H(["w-3 h-3 rounded-full",i.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"]),"data-testid":"live-indicator"},null,2),E[0]||(E[0]=e("span",{class:"text-xl font-semibold text-r58-mixer","data-testid":"mixer-title"},"Mixer",-1))]),i.value?(r(),a("span",$o,"ON AIR")):O("",!0),i.value&&D.value>0?(r(),a("span",Co," Streaming to "+$(D.value)+" platform"+$(D.value>1?"s":""),1)):O("",!0),J(ho,{"vdo-embed":u.value},null,8,["vdo-embed"])]),e("div",Ro,[e("button",{class:"btn btn-sm",onClick:o,title:"Keyboard Shortcuts (Shift+?)","data-testid":"hotkey-settings-button"},[...E[1]||(E[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)])]),e("button",{class:"btn btn-sm",onClick:n,title:"Streaming Settings","data-testid":"streaming-settings-button"},[...E[2]||(E[2]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1)])]),e("button",{class:H(["btn",i.value?"btn-danger":"btn-primary"]),onClick:t,"data-testid":"go-live-button"},$(i.value?"End Session":"Go Live"),3)])]),e("div",Do,[e("div",Mo,[J(Je,{ref_key:"vdoEmbedRef",ref:u,profile:"director",class:"h-full"},null,512)]),e("aside",Eo,[e("div",Oo,[E[3]||(E[3]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Quick Scenes",-1)),e("div",To,[(r(),a(K,null,Y(4,x=>e("button",{key:x,class:H(["btn btn-sm",A(v).currentScene===`scene-${x}`?"btn-primary":""]),onClick:L=>_(x),"data-testid":`scene-btn-${x}`},$(x),11,Lo)),64))]),E[4]||(E[4]=e("p",{class:"text-xs text-r58-text-secondary mt-2"}," Press 1-4 for quick switch. Full layout control is in the mixer above. ",-1))]),e("div",jo,[J(pt,{"vdo-embed":u.value},null,8,["vdo-embed"])]),e("div",Io,[E[5]||(E[5]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Program Output",-1)),J(Vt)]),e("div",Uo,[E[6]||(E[6]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Local Recording",-1)),J(Bn,{"vdo-embed":u.value},null,8,["vdo-embed"])])])]),J(Rt),J(En,{ref_key:"streamingSettingsRef",ref:h},null,512),J(ao,{ref_key:"hotkeySettingsRef",ref:k},null,512)])],64))}}),Ao=de(Po,[["__scopeId","data-v-bdceed8c"]]);export{Ao as default};
