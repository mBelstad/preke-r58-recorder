import{C as ee,r as h,h as R,e as te,f as se,d as I,w as q,c as m,p as U,a as e,A as $,n as D,o as d,F as A,B as K,t as S,D as re,j as oe,s as z,v as F,m as ae,y as V,k as H,x as ie}from"./index-MXBwyIoC.js";import{u as le}from"./recorder-Da96RyiH.js";const N=ee("mixer",()=>{const x=h(!1),a=h(null),o=h(null),i=h(null),r=h([]),t=R(()=>r.value.filter(u=>u.hasVideo||u.hasAudio));function y(){x.value=!x.value}function k(u){a.value=u}function g(u){o.value=u}function P(u){i.value=u}function v(u){r.value=u}function l(u,w){const _=r.value.find(L=>L.id===u);_&&(_.muted=w)}function p(u,w){const _=r.value.find(L=>L.id===u);_&&(_.audioLevel=w)}return{isLive:x,activeScene:a,programSource:o,previewSource:i,sources:r,activeSources:t,toggleLive:y,setScene:k,setProgram:g,setPreview:P,updateSourcesFromVdo:v,setSourceMute:l,updateAudioLevel:p}});function W(){return"r58-vdo.itagenten.no"}function G(){return"https"}const T="studio",ce={director:{params:{director:T,hidesolo:!0,hideheader:!0,cleanoutput:!0,darkmode:!0,nologo:!0}},scene:{params:{scene:!0,room:T,cover:!0,fadein:500,animated:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0}},multiview:{params:{room:T,scene:!0,grid:!0,autoadd:"*",cleanoutput:!0,hideheader:!0,nologo:!0}},cameraContribution:{params:{room:T,videodevice:0,audiodevice:0,autostart:!0,noaudio:!1}},guestInvite:{params:{room:T,webcam:!0,mic:!0,quality:1,effects:!0}},soloView:{params:{room:T,cover:!0,cleanoutput:!0}},programOutput:{params:{scene:!0,room:T,cover:!0,quality:2,cleanoutput:!0,hideheader:!0,nologo:!0,autostart:!0}}};function X(){return`${window.location.origin}/static/css/vdo-theme.css`}function ue(x,a={}){const o=W(),i=G(),r=ce[x],t=new URL(`${i}://${o}/`);t.searchParams.set("css",X());for(const[y,k]of Object.entries(r.params))if(typeof k=="boolean")k&&t.searchParams.set(y,"");else if(typeof k=="number")t.searchParams.set(y,k.toString());else if(typeof k=="string"){let g=k;for(const[P,v]of Object.entries(a))g=g.replace(`{${P}}`,v);g.includes("{")||t.searchParams.set(y,g)}return a.push_id&&t.searchParams.set("push",a.push_id),a.view_id&&t.searchParams.set("view",a.view_id),a.source_ids&&t.searchParams.set("autoadd",a.source_ids),a.whep_url&&t.searchParams.set("whepshare",encodeURIComponent(a.whep_url)),a.label&&t.searchParams.set("label",a.label),t.toString()}function Z(x,a,o){const i=W(),r=G(),t=new URL(`${r}://${i}/`);return t.searchParams.set("push",x),t.searchParams.set("room",T),t.searchParams.set("whepshare",a),t.searchParams.set("label",o),t.searchParams.set("videodevice","0"),t.searchParams.set("audiodevice","0"),t.searchParams.set("autostart",""),t.searchParams.set("css",X()),t.toString()}function de(x){const a=W(),o=G(),i=new URL(`${o}://${a}/`);return i.searchParams.set("scene",""),i.searchParams.set("room",T),i.searchParams.set("cover",""),i.searchParams.set("quality","2"),i.searchParams.set("cleanoutput",""),i.searchParams.set("hideheader",""),i.searchParams.set("nologo",""),i.searchParams.set("whipout",x),i.searchParams.set("autostart",""),i.searchParams.set("videodevice","0"),i.searchParams.set("audiodevice","0"),i.searchParams.set("css",X()),i.toString()}function me(x){const a=h(!1),o=h(new Map),i=h(null),r=W();function t(s,f,b){var E;if(!((E=x.value)!=null&&E.contentWindow)){console.warn("VDO.ninja iframe not ready");return}const M={action:s};f&&(M.target=f),b!==void 0&&(M.value=b),x.value.contentWindow.postMessage(M,"*")}function y(s){t("changeScene",void 0,s),i.value=s}function k(s){t("soloVideo",s)}function g(s,f){t("pip",s,f?"enable":"disable")}function P(s,f){t("mute",s,f);const b=o.value.get(s);b&&(b.muted=f)}function v(s,f){t("volume",s,Math.max(0,Math.min(100,f)))}function l(s){t("soloChat",s)}function p(s){t("highlight",s)}function u(s,f){t("sendChat",s,f)}function w(s){t("hangup",s),o.value.delete(s)}function _(s){t("requestScreen",s)}function L(){t("record",void 0,!0)}function O(){t("record",void 0,!1)}function C(s){t("layout",void 0,s)}function n(s){t("reload",s)}function c(s){var M,E,J,Y,Q;const f=s.origin;if(!f.includes(r.split(":")[0])&&!f.includes("vdo.ninja")&&!f.includes("localhost"))return;const b=s.data;if(!(!b||typeof b!="object"))switch(b.type){case"director-ready":case"loaded":case"ready":a.value=!0;break;case"new-guest":case"guest-connected":b.streamID&&o.value.set(b.streamID,{id:b.streamID,label:((M=b.data)==null?void 0:M.label)||b.streamID,type:((E=b.data)==null?void 0:E.type)||"guest",hasVideo:!0,hasAudio:!0,muted:!1,audioLevel:0});break;case"guest-left":case"guest-disconnected":b.streamID&&o.value.delete(b.streamID);break;case"audio-level":if(b.streamID){const B=o.value.get(b.streamID);B&&(B.audioLevel=((J=b.data)==null?void 0:J.level)||0)}break;case"mute-state":if(b.streamID){const B=o.value.get(b.streamID);B&&(B.muted=((Y=b.data)==null?void 0:Y.muted)||!1)}break;case"scene-changed":i.value=((Q=b.data)==null?void 0:Q.scene)||null;break;case"error":console.error("[VDO.ninja Error]",b.data);break}}return te(()=>{window.addEventListener("message",c),setTimeout(()=>{!a.value&&x.value&&(a.value=!0)},5e3)}),se(()=>{window.removeEventListener("message",c)}),{isReady:a,sources:o,activeScene:i,setScene:y,setProgram:k,togglePiP:g,setLayout:C,setMute:P,setVolume:v,soloAudio:l,highlightSource:p,sendToGuest:u,kickGuest:w,requestScreenShare:_,refreshSource:n,startRecording:L,stopRecording:O,sendCommand:t}}const pe={class:"vdo-embed-container relative w-full h-full bg-black rounded-lg overflow-hidden"},ve={key:0,class:"absolute inset-0 flex items-center justify-center bg-r58-bg-secondary z-10"},fe=["src"],xe=I({__name:"VdoNinjaEmbed",props:{profile:{},sources:{}},setup(x,{expose:a}){const o=x,i=h(null),r=N(),{isReady:t,sources:y,setScene:k,setMute:g,setVolume:P}=me(i),v=R(()=>{const l={};return o.sources&&(l.source_ids=o.sources.join(",")),ue(o.profile,l)});return q(y,l=>{r.updateSourcesFromVdo(Array.from(l.values()))},{deep:!0}),a({isReady:t,setScene:k,setMute:g,setVolume:P}),(l,p)=>(d(),m("div",pe,[$(t)?U("",!0):(d(),m("div",ve,[...p[0]||(p[0]=[e("div",{class:"text-center"},[e("div",{class:"animate-spin w-8 h-8 border-2 border-r58-accent-primary border-t-transparent rounded-full mx-auto mb-4"}),e("p",{class:"text-r58-text-secondary"},"Connecting to VDO.ninja..."),e("p",{class:"text-xs text-r58-text-secondary mt-2"},"Local mixer on R58")],-1)])])),e("iframe",{ref_key:"iframeRef",ref:i,src:v.value,class:D(["w-full h-full border-0",{"opacity-0":!$(t)}]),allow:"camera; microphone; display-capture; autoplay; clipboard-write",allowfullscreen:""},null,10,fe)]))}}),ge={class:"space-y-6"},be={class:"card"},he={key:0,class:"text-center py-8 text-r58-text-secondary"},ye={key:1,class:"space-y-2"},we={class:"flex items-center gap-3"},_e={key:0,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ke={key:1,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Se={key:2,class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},$e={class:"font-medium"},Ce={class:"text-xs text-r58-text-secondary capitalize"},Pe={class:"flex items-center gap-2"},Oe={class:"w-16 h-2 bg-r58-bg-primary rounded-full overflow-hidden"},Le=["onClick"],De={key:0,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Re={key:1,class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},Ue={class:"card"},Te={class:"grid grid-cols-2 gap-2"},Me=I({__name:"SourcePanel",setup(x){const a=N(),o=R(()=>a.sources);return R(()=>a.activeSources),(i,r)=>(d(),m("div",ge,[e("div",be,[r[10]||(r[10]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Sources",-1)),o.value.length===0?(d(),m("div",he,[...r[4]||(r[4]=[e("p",null,"No sources connected",-1),e("p",{class:"text-sm mt-1"},"Sources will appear when they join the room",-1)])])):(d(),m("div",ye,[(d(!0),m(A,null,K(o.value,t=>(d(),m("div",{key:t.id,class:"flex items-center justify-between p-3 rounded-lg bg-r58-bg-tertiary"},[e("div",we,[e("div",{class:D(["w-10 h-10 rounded bg-r58-bg-primary flex items-center justify-center",{"ring-2 ring-r58-accent-primary":$(a).programSource===t.id}])},[t.type==="camera"?(d(),m("svg",_e,[...r[5]||(r[5]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"},null,-1)])])):t.type==="guest"?(d(),m("svg",ke,[...r[6]||(r[6]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"},null,-1)])])):(d(),m("svg",Se,[...r[7]||(r[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"},null,-1)])]))],2),e("div",null,[e("p",$e,S(t.label),1),e("p",Ce,S(t.type),1)])]),e("div",Pe,[e("div",Oe,[e("div",{class:"h-full bg-r58-accent-success rounded-full transition-all duration-100",style:re({width:`${t.audioLevel}%`})},null,4)]),e("button",{onClick:y=>$(a).setSourceMute(t.id,!t.muted),class:D(["p-2 rounded hover:bg-r58-bg-primary transition-colors",{"text-r58-accent-danger":t.muted}])},[t.muted?(d(),m("svg",De,[...r[8]||(r[8]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2"},null,-1)])])):(d(),m("svg",Re,[...r[9]||(r[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"},null,-1)])]))],10,Le)])]))),128))]))]),r[12]||(r[12]=e("div",{class:"card"},[e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Guest Invite"),e("button",{class:"btn w-full justify-center"}," Generate Invite Link ")],-1)),e("div",Ue,[r[11]||(r[11]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Scenes",-1)),e("div",Te,[e("button",{onClick:r[0]||(r[0]=t=>$(a).setScene("scene1")),class:D(["btn",{"btn-primary":$(a).activeScene==="scene1"}])}," Scene 1 ",2),e("button",{onClick:r[1]||(r[1]=t=>$(a).setScene("scene2")),class:D(["btn",{"btn-primary":$(a).activeScene==="scene2"}])}," Scene 2 ",2),e("button",{onClick:r[2]||(r[2]=t=>$(a).setScene("pip")),class:D(["btn",{"btn-primary":$(a).activeScene==="pip"}])}," PiP ",2),e("button",{onClick:r[3]||(r[3]=t=>$(a).setScene("grid")),class:D(["btn",{"btn-primary":$(a).activeScene==="grid"}])}," Grid ",2)])])]))}}),Ve={class:"camera-push-bar border-t border-r58-bg-tertiary bg-r58-bg-secondary"},je={class:"flex items-center gap-2"},Ie={class:"text-r58-text-secondary"},Ee={key:0,class:"px-4 pb-3"},Be={key:0,class:"flex gap-3 flex-wrap"},He={class:"text-sm font-medium"},Ae={class:"text-xs text-r58-text-secondary"},Ke=["onClick"],Ne={key:1,class:"text-sm text-r58-text-secondary py-2"},We={class:"hidden"},ze=["src","onLoad","onError"],Fe=I({__name:"CameraPushBar",setup(x){const a=le(),o=h(new Map),i=h(!0),r=R(()=>a.inputs.filter(l=>l.hasSignal));function t(l){return`${window.location.origin}/api/v1/whep/${l}/whep`}q(r,l=>{for(const u of l)if(!o.value.has(u.id)){const w=t(u.id),_=Z(u.id,w,u.label);o.value.set(u.id,{cameraId:u.id,label:u.label,status:"connecting",iframeSrc:_})}const p=new Set(l.map(u=>u.id));for(const[u]of o.value)p.has(u)||o.value.delete(u)},{immediate:!0});function y(l){const p=o.value.get(l);p&&(p.status="connected",console.log(`[CameraPush] ${l} connected to VDO.ninja`))}function k(l){const p=o.value.get(l);p&&(p.status="error",console.error(`[CameraPush] ${l} failed to connect`))}function g(l){const p=a.inputs.find(_=>_.id===l);if(!p||!p.hasSignal)return;const u=t(l),w=Z(l,u,p.label);o.value.set(l,{cameraId:l,label:p.label,status:"connecting",iframeSrc:w+`&_t=${Date.now()}`})}function P(l){switch(l){case"connected":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function v(l){switch(l){case"connected":return"Live in VDO.ninja";case"connecting":return"Connecting...";case"error":return"Failed to connect";default:return"Idle"}}return(l,p)=>(d(),m("div",Ve,[e("button",{onClick:p[0]||(p[0]=u=>i.value=!i.value),class:"w-full px-4 py-2 flex items-center justify-between text-sm hover:bg-r58-bg-tertiary/50 transition-colors"},[e("div",je,[p[1]||(p[1]=e("span",{class:"font-medium"},"Camera Sources",-1)),e("span",Ie,"("+S(r.value.length)+" active)",1)]),(d(),m("svg",{class:D(["w-4 h-4 transition-transform",{"rotate-180":i.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...p[2]||(p[2]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),i.value?(d(),m("div",Ee,[o.value.size>0?(d(),m("div",Be,[(d(!0),m(A,null,K(o.value,([u,w])=>(d(),m("div",{key:u,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},[e("span",{class:D(["w-2 h-2 rounded-full",P(w.status)])},null,2),e("span",He,S(w.label),1),e("span",Ae,S(v(w.status)),1),w.status==="error"?(d(),m("button",{key:0,onClick:_=>g(u),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ",8,Ke)):U("",!0)]))),128))])):(d(),m("div",Ne," No cameras connected. Connect HDMI sources to push them to the mixer. "))])):U("",!0),e("div",We,[(d(!0),m(A,null,K(o.value,([u,w])=>(d(),m("iframe",{key:u,src:w.iframeSrc,onLoad:_=>y(u),onError:_=>k(u),allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,ze))),128))])]))}}),j=[{id:"youtube",name:"YouTube Live",icon:"â–¶ï¸",rtmpBaseUrl:"rtmp://a.rtmp.youtube.com/live2/",streamKeyPlaceholder:"xxxx-xxxx-xxxx-xxxx-xxxx",helpUrl:"https://support.google.com/youtube/answer/2907883"},{id:"twitch",name:"Twitch",icon:"ðŸ“º",rtmpBaseUrl:"rtmp://live.twitch.tv/app/",streamKeyPlaceholder:"live_xxxxxxxxxx_xxxxxxxxxxxxxx",helpUrl:"https://help.twitch.tv/s/article/twitch-stream-key-faq"},{id:"facebook",name:"Facebook Live",icon:"ðŸ“˜",rtmpBaseUrl:"rtmps://live-api-s.facebook.com:443/rtmp/",streamKeyPlaceholder:"FB-xxxxxxxxxx-x",helpUrl:"https://www.facebook.com/help/587160588142067"},{id:"restream",name:"Restream",icon:"ðŸ”„",rtmpBaseUrl:"rtmp://live.restream.io/live/",streamKeyPlaceholder:"re_xxxxxx_xxxxxxxxxx",helpUrl:"https://support.restream.io/en/"},{id:"custom",name:"Custom RTMP",icon:"âš™ï¸",rtmpBaseUrl:"",streamKeyPlaceholder:"your-stream-key"}],ne=ee("streaming",()=>{const x=h([]),a=h(!1),o=h(null),i=h({enabled:!1,host:"",port:8890,streamId:"mixer_program"}),r=R(()=>x.value.find(c=>c.id===o.value)),t=R(()=>x.value.filter(c=>c.enabled)),y=R(()=>j),k=R(()=>{const c=window.location.hostname,f=c==="localhost"||c==="127.0.0.1"?"localhost":c.replace("r58-api","r58-mediamtx");return{rtmp:`rtmp://${f}:1935/mixer_program`,rtsp:`rtsp://${f}:8554/mixer_program`,srt:`srt://${f}:8890?streamid=read:mixer_program`,hls:`https://${c}/hls/mixer_program/index.m3u8`,whep:`${window.location.origin}/api/v1/whep/mixer_program/whep`}});function g(c,s){const f=j.find(M=>M.id===c);if(!f)throw new Error(`Unknown platform: ${c}`);const b={id:`dest-${Date.now()}`,platformId:c,name:s||f.name,streamKey:"",enabled:!1};return x.value.push(b),b}function P(c,s){const f=x.value.findIndex(b=>b.id===c);f!==-1&&(x.value[f]={...x.value[f],...s})}function v(c){const s=x.value.findIndex(f=>f.id===c);s!==-1&&x.value.splice(s,1),o.value===c&&(o.value=null)}function l(c){o.value=c}function p(c){i.value.enabled=c}function u(c){i.value={...i.value,...c}}function w(){a.value=!0}function _(){a.value=!1}function L(c){const s=j.find(f=>f.id===c.platformId);return s?c.platformId==="custom"?`${c.name}${c.streamKey}`:`${s.rtmpBaseUrl}${c.streamKey}`:""}function O(){const c=window.location.hostname;return`srt://${c==="localhost"||c==="127.0.0.1"?"localhost":c.replace("r58-api","r58-mediamtx")}:${i.value.port}?streamid=read:${i.value.streamId}`}function C(){try{const c=localStorage.getItem("r58-streaming-destinations");if(c){const s=JSON.parse(c);x.value=s.destinations||[],s.srtOutput&&(i.value={...i.value,...s.srtOutput})}}catch(c){console.warn("Failed to load saved streaming destinations:",c)}}function n(){try{localStorage.setItem("r58-streaming-destinations",JSON.stringify({destinations:x.value,srtOutput:i.value}))}catch(c){console.warn("Failed to save streaming destinations:",c)}}return C(),{destinations:x,isStreaming:a,activeDestinationId:o,srtOutput:i,activeDestination:r,enabledDestinations:t,platforms:y,programOutputUrls:k,addDestination:g,updateDestination:P,removeDestination:v,setActiveDestination:l,toggleSrtOutput:p,updateSrtConfig:u,startStreaming:w,stopStreaming:_,buildRtmpUrl:L,getSrtOutputUrl:O,saveDestinations:n,loadSavedDestinations:C}}),qe={class:"streaming-settings"},Ge={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Xe={class:"relative bg-r58-bg-secondary border border-r58-bg-tertiary rounded-xl w-full max-w-2xl max-h-[80vh] overflow-hidden shadow-2xl"},Je={class:"p-6 overflow-y-auto max-h-[60vh]"},Ye={class:"mb-8"},Qe={class:"flex items-center justify-between mb-4"},Ze={key:0,class:"mb-4 p-4 bg-r58-bg-tertiary rounded-lg"},et={class:"grid grid-cols-2 gap-2"},tt=["onClick"],st={class:"text-xl"},nt={key:1,class:"space-y-3"},rt=["onClick"],ot={class:"text-xl"},at={class:"flex-1"},it={class:"font-medium"},lt={class:"text-xs text-r58-text-secondary"},ct=["onClick"],ut=["onClick"],dt={key:2,class:"text-r58-text-secondary text-sm"},mt={key:0,class:"mb-8 p-4 bg-r58-bg-tertiary rounded-lg"},pt={class:"text-lg font-medium mb-4"},vt={class:"space-y-4"},ft=["placeholder"],xt={key:0},gt={class:"flex gap-2"},bt={class:"mb-8"},ht={class:"space-y-3"},yt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},wt={class:"flex items-center justify-between mb-1"},_t={class:"text-xs text-r58-text-secondary break-all"},kt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},St={class:"flex items-center justify-between mb-1"},$t={class:"text-xs text-r58-text-secondary break-all"},Ct={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Pt={class:"flex items-center justify-between mb-1"},Ot={class:"text-xs text-r58-text-secondary break-all"},Lt={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Dt={class:"flex items-center justify-between mb-1"},Rt={class:"text-xs text-r58-text-secondary break-all"},Ut={class:"p-3 bg-r58-bg-tertiary rounded-lg"},Tt={class:"flex items-center justify-between mb-1"},Mt={class:"text-xs text-r58-text-secondary break-all"},Vt={class:"p-4 bg-r58-bg-tertiary rounded-lg"},jt={class:"flex items-center gap-3 mb-4"},It=I({__name:"StreamingSettings",setup(x,{expose:a}){const o=ne(),i=h(!1),r=h(null),t=h(!1);h(""),h("");const y=R(()=>o.destinations),k=R(()=>j),g=R(()=>o.programOutputUrls);function P(){i.value=!0}function v(){i.value=!1,r.value=null,t.value=!1}function l(C){const n=o.addDestination(C);r.value=n,t.value=!1,o.saveDestinations()}function p(){r.value&&(o.updateDestination(r.value.id,r.value),o.saveDestinations(),r.value=null,V.success("Streaming destination saved"))}function u(C){o.removeDestination(C),o.saveDestinations(),V.info("Destination removed")}function w(C){o.updateDestination(C.id,{enabled:!C.enabled}),o.saveDestinations()}function _(C,n){navigator.clipboard.writeText(C),V.success(`${n} copied to clipboard`)}function L(C){const n=j.find(c=>c.id===C);return(n==null?void 0:n.icon)||"ðŸ“¡"}function O(C){const n=j.find(c=>c.id===C);return(n==null?void 0:n.name)||"Unknown"}return a({open:P}),(C,n)=>{var c;return d(),m("div",qe,[e("button",{onClick:P,class:"btn btn-sm"}," âš™ï¸ Streaming Settings "),(d(),oe(ae,{to:"body"},[i.value?(d(),m("div",Ge,[e("div",{class:"absolute inset-0 bg-black/60",onClick:v}),e("div",Xe,[e("div",{class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary"},[n[11]||(n[11]=e("h2",{class:"text-xl font-semibold"},"Streaming Settings",-1)),e("button",{onClick:v,class:"text-r58-text-secondary hover:text-r58-text-primary text-2xl"}," Ã— ")]),e("div",Je,[e("section",Ye,[e("div",Qe,[n[12]||(n[12]=e("h3",{class:"text-lg font-medium"},"Streaming Destinations",-1)),e("button",{onClick:n[0]||(n[0]=s=>t.value=!t.value),class:"btn btn-sm btn-primary"}," + Add Platform ")]),t.value?(d(),m("div",Ze,[n[13]||(n[13]=e("p",{class:"text-sm text-r58-text-secondary mb-3"},"Select a streaming platform:",-1)),e("div",et,[(d(!0),m(A,null,K(k.value,s=>(d(),m("button",{key:s.id,onClick:f=>l(s.id),class:"flex items-center gap-2 p-3 bg-r58-bg-secondary hover:bg-r58-accent-primary/20 rounded-lg transition-colors text-left"},[e("span",st,S(s.icon),1),e("span",null,S(s.name),1)],8,tt))),128))])])):U("",!0),y.value.length>0?(d(),m("div",nt,[(d(!0),m(A,null,K(y.value,s=>(d(),m("div",{key:s.id,class:"flex items-center gap-3 p-3 bg-r58-bg-tertiary rounded-lg"},[e("button",{onClick:f=>w(s),class:D(["w-10 h-6 rounded-full transition-colors relative",s.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:D(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",s.enabled?"left-5":"left-1"])},null,2)],10,rt),e("span",ot,S(L(s.platformId)),1),e("div",at,[e("div",it,S(s.name),1),e("div",lt,S(s.streamKey?"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"+s.streamKey.slice(-4):"No stream key"),1)]),e("button",{onClick:f=>r.value={...s},class:"text-r58-accent-primary hover:underline text-sm"}," Edit ",8,ct),e("button",{onClick:f=>u(s.id),class:"text-r58-accent-danger hover:underline text-sm"}," Remove ",8,ut)]))),128))])):(d(),m("p",dt," No streaming destinations configured. Add a platform above. "))]),r.value?(d(),m("section",mt,[e("h3",pt," Edit "+S(O(r.value.platformId)),1),e("div",vt,[e("div",null,[n[14]||(n[14]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Display Name",-1)),z(e("input",{"onUpdate:modelValue":n[1]||(n[1]=s=>r.value.name=s),type:"text",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none"},null,512),[[F,r.value.name]])]),e("div",null,[n[15]||(n[15]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"Stream Key",-1)),z(e("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>r.value.streamKey=s),type:"password",placeholder:(c=$(j).find(s=>s.id===r.value.platformId))==null?void 0:c.streamKeyPlaceholder,class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,8,ft),[[F,r.value.streamKey]]),n[16]||(n[16]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Your stream key is stored locally and never sent to our servers. ",-1))]),r.value.platformId==="custom"?(d(),m("div",xt,[n[17]||(n[17]=e("label",{class:"block text-sm text-r58-text-secondary mb-1"},"RTMP URL",-1)),z(e("input",{"onUpdate:modelValue":n[3]||(n[3]=s=>r.value.name=s),type:"text",placeholder:"rtmp://your-server.com/live/",class:"w-full px-3 py-2 bg-r58-bg-secondary border border-r58-bg-tertiary rounded-lg focus:border-r58-accent-primary focus:outline-none font-mono"},null,512),[[F,r.value.name]])])):U("",!0),e("div",gt,[e("button",{onClick:p,class:"btn btn-primary"}," Save "),e("button",{onClick:n[4]||(n[4]=s=>r.value=null),class:"btn"}," Cancel ")])])])):U("",!0),e("section",bt,[n[26]||(n[26]=e("h3",{class:"text-lg font-medium mb-4"},"Program Output URLs",-1)),n[27]||(n[27]=e("p",{class:"text-sm text-r58-text-secondary mb-4"}," Use these URLs to consume the program feed from MediaMTX: ",-1)),e("div",ht,[e("div",yt,[e("div",wt,[n[18]||(n[18]=e("span",{class:"font-medium"},"ðŸ”´ SRT Output",-1)),e("button",{onClick:n[5]||(n[5]=s=>_(g.value.srt,"SRT URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",_t,S(g.value.srt),1),n[19]||(n[19]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Low-latency, reliable transport. Ideal for remote production. ",-1))]),e("div",kt,[e("div",St,[n[20]||(n[20]=e("span",{class:"font-medium"},"ðŸ“º RTMP Output",-1)),e("button",{onClick:n[6]||(n[6]=s=>_(g.value.rtmp,"RTMP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",$t,S(g.value.rtmp),1)]),e("div",Ct,[e("div",Pt,[n[21]||(n[21]=e("span",{class:"font-medium"},"ðŸŽ¬ RTSP Output",-1)),e("button",{onClick:n[7]||(n[7]=s=>_(g.value.rtsp,"RTSP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Ot,S(g.value.rtsp),1)]),e("div",Lt,[e("div",Dt,[n[22]||(n[22]=e("span",{class:"font-medium"},"ðŸŒ HLS Output",-1)),e("button",{onClick:n[8]||(n[8]=s=>_(g.value.hls,"HLS URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Rt,S(g.value.hls),1),n[23]||(n[23]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Browser-compatible streaming. Higher latency. ",-1))]),e("div",Ut,[e("div",Tt,[n[24]||(n[24]=e("span",{class:"font-medium"},"âš¡ WebRTC (WHEP)",-1)),e("button",{onClick:n[9]||(n[9]=s=>_(g.value.whep,"WHEP URL")),class:"text-xs text-r58-accent-primary hover:underline"}," Copy ")]),e("code",Mt,S(g.value.whep),1),n[25]||(n[25]=e("p",{class:"text-xs text-r58-text-secondary mt-1"}," Ultra-low latency WebRTC. Best for interactive use. ",-1))])])]),e("section",null,[n[30]||(n[30]=e("h3",{class:"text-lg font-medium mb-4"},"SRT Configuration",-1)),e("div",Vt,[e("div",jt,[e("button",{onClick:n[10]||(n[10]=s=>$(o).toggleSrtOutput(!$(o).srtOutput.enabled)),class:D(["w-10 h-6 rounded-full transition-colors relative",$(o).srtOutput.enabled?"bg-r58-accent-success":"bg-r58-bg-secondary"])},[e("span",{class:D(["absolute top-1 w-4 h-4 rounded-full bg-white transition-transform",$(o).srtOutput.enabled?"left-5":"left-1"])},null,2)],2),n[28]||(n[28]=e("span",null,"Enable SRT Output",-1))]),n[29]||(n[29]=e("div",{class:"text-sm text-r58-text-secondary"},[e("p",{class:"mb-2"},"SRT (Secure Reliable Transport) provides:"),e("ul",{class:"list-disc list-inside space-y-1"},[e("li",null,"Low latency (typically 1-2 seconds)"),e("li",null,"Error correction for unreliable networks"),e("li",null,"AES encryption support"),e("li",null,"Compatible with OBS, vMix, and professional equipment")])],-1))])])]),e("div",{class:"flex items-center justify-end gap-3 px-6 py-4 border-t border-r58-bg-tertiary"},[e("button",{onClick:v,class:"btn"},"Close")])])])):U("",!0)]))])}}}),Et={class:"program-output space-y-3"},Bt={class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary rounded-lg"},Ht={class:"text-xs text-r58-text-secondary"},At={key:0,class:"text-xs space-y-1 px-3"},Kt={class:"flex items-center gap-2 text-r58-text-secondary"},Nt={class:"flex-1 truncate"},Wt={key:1,class:"flex items-center gap-2 px-3 py-2 bg-r58-bg-tertiary/50 rounded-lg"},zt={class:"text-xs"},Ft={class:"hidden"},qt=["src"],Gt=I({__name:"ProgramOutput",setup(x){const a=N(),o=ne(),i=h(null),r=h(!1),t=h("idle"),y=h("");function k(){return`${window.location.origin}/api/v1/whip/program/whip`}function g(){r.value||(t.value="connecting",y.value=de(k()),r.value=!0,o.startStreaming(),console.log("[ProgramOutput] Starting WHIP push to MediaMTX"))}function P(){r.value&&(r.value=!1,y.value="",t.value="idle",o.stopStreaming(),console.log("[ProgramOutput] Stopped WHIP push"))}function v(){r.value&&(t.value="live",console.log("[ProgramOutput] WHIP push connected"))}function l(){t.value="error",console.error("[ProgramOutput] WHIP push failed")}q(()=>a.isLive,L=>{L?g():P()});function p(){switch(t.value){case"live":return"bg-emerald-500";case"connecting":return"bg-amber-500 animate-pulse";case"error":return"bg-red-500";default:return"bg-gray-500"}}function u(){switch(t.value){case"live":return"Program live on MediaMTX";case"connecting":return"Connecting...";case"error":return"Output failed";default:return"Program output off"}}const w=R(()=>o.enabledDestinations.length);function _(){const L=o.programOutputUrls.srt;navigator.clipboard.writeText(L)}return(L,O)=>(d(),m("div",Et,[e("div",Bt,[e("span",{class:D(["w-2 h-2 rounded-full",p()])},null,2),O[2]||(O[2]=e("span",{class:"text-sm"},"Program Output",-1)),e("span",Ht,S(u()),1),$(a).isLive?U("",!0):(d(),m("button",{key:0,onClick:O[0]||(O[0]=C=>r.value?P():g()),class:"ml-auto text-xs text-r58-accent-primary hover:underline"},S(r.value?"Stop":"Start"),1)),t.value==="error"?(d(),m("button",{key:1,onClick:O[1]||(O[1]=C=>g()),class:"ml-2 text-xs text-r58-accent-primary hover:underline"}," Retry ")):U("",!0)]),t.value==="live"?(d(),m("div",At,[e("div",Kt,[O[3]||(O[3]=e("span",null,"ðŸ”´ SRT:",-1)),e("code",Nt,S($(o).programOutputUrls.srt),1),e("button",{onClick:_,class:"text-r58-accent-primary hover:underline"},"Copy")])])):U("",!0),w.value>0?(d(),m("div",Wt,[O[4]||(O[4]=e("span",{class:"w-2 h-2 rounded-full bg-r58-accent-success"},null,-1)),e("span",zt,S(w.value)+" streaming destination"+S(w.value>1?"s":"")+" enabled",1)])):U("",!0),H(It,{ref_key:"streamingSettingsRef",ref:i},null,512),e("div",Ft,[r.value&&y.value?(d(),m("iframe",{key:0,src:y.value,onLoad:v,onError:l,allow:"camera; microphone; autoplay",class:"w-0 h-0"},null,40,qt)):U("",!0)])]))}}),Xt={class:"h-full flex flex-col"},Jt={class:"flex items-center justify-between px-6 py-4 border-b border-r58-bg-tertiary bg-r58-bg-secondary"},Yt={class:"flex items-center gap-4"},Qt={class:"flex items-center gap-2"},Zt={key:0,class:"badge badge-danger"},es={class:"flex items-center gap-4"},ts={class:"flex-1 flex overflow-hidden"},ss={class:"flex-1 p-4"},ns={class:"w-80 border-l border-r58-bg-tertiary bg-r58-bg-secondary p-4 overflow-y-auto"},rs={class:"mt-6 pt-4 border-t border-r58-bg-tertiary"},is=I({__name:"MixerView",setup(x){const a=N(),{register:o}=ie(),i=h(null),r=R(()=>a.isLive),t=[];te(()=>{for(let v=1;v<=9;v++){const l=o({key:String(v),description:`Switch to scene ${v}`,action:()=>y(v),context:"mixer"});t.push(l)}t.push(o({key:"t",description:"Cut to preview (transition)",action:()=>k(),context:"mixer"})),t.push(o({key:"a",description:"Auto-transition with fade",action:()=>g(),context:"mixer"})),t.push(o({key:"Tab",description:"Cycle through sources",action:()=>P(),context:"mixer"})),t.push(o({key:"g",description:"Toggle Go Live",action:()=>{a.toggleLive(),V.info(a.isLive?"Session started":"Session ended")},context:"mixer"}))}),se(()=>{t.forEach(v=>v())});function y(v){const l=`scene-${v}`;a.setScene(l),i.value&&i.value.sendCommand("changeScene",{scene:v}),V.info(`Scene ${v}`)}function k(){a.previewSource&&(a.setProgram(a.previewSource),V.info("Cut"))}function g(){a.previewSource&&(i.value&&i.value.sendCommand("transition",{type:"fade",duration:500}),a.setProgram(a.previewSource),V.info("Fade"))}function P(){const v=a.activeSources;if(v.length===0)return;const p=(v.findIndex(u=>u.id===a.previewSource)+1)%v.length;a.setPreview(v[p].id)}return(v,l)=>(d(),m("div",Xt,[e("header",Jt,[e("div",Yt,[e("div",Qt,[e("span",{class:D(["w-3 h-3 rounded-full",r.value?"bg-r58-accent-danger animate-recording":"bg-r58-bg-tertiary"])},null,2),l[1]||(l[1]=e("span",{class:"text-xl font-semibold text-r58-mixer"},"Mixer",-1))]),r.value?(d(),m("span",Zt,"ON AIR")):U("",!0)]),e("div",es,[e("button",{class:"btn",onClick:l[0]||(l[0]=(...p)=>$(a).toggleLive&&$(a).toggleLive(...p))},S(r.value?"End Session":"Go Live"),1)])]),e("div",ts,[e("div",ss,[H(xe,{ref_key:"vdoEmbedRef",ref:i,profile:"director",class:"h-full"},null,512)]),e("aside",ns,[H(Me),e("div",rs,[l[2]||(l[2]=e("h3",{class:"text-sm font-semibold text-r58-text-secondary uppercase tracking-wide mb-3"},"Program Output",-1)),H(Gt)])])]),H(Fe)]))}});export{is as default};
