const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-C-UnMYRj.js","assets/index-BtJSUzyN.css"])))=>i.map(i=>d[i]);
import{D as F,E as H,o as K,l as ne,G as We,r as k,j as x,H as He,d as I,I as pe,m as D,T as de,p as fe,c as y,f as E,z as Ne,e as n,w as ge,A as xe,t as $,J as Fe,i as h,_ as Q,K as Ue,h as G,F as N,n as M,x as q,L as Ce,q as ee,M as te,N as Ge,O as Re,u as me,a as Ve,y as ve,B as Se,P as Ie,Q as Oe,g as Te,R as je,b as ze,v as qe}from"./index-C-UnMYRj.js";import{M as Ke}from"./ModeLoadingScreen-Dqx6MVB2.js";const j=k(!1),X=k(!1);let z=null;function Qe(){const o=F();H(()=>o.status,c=>{j.value=c==="recording"},{immediate:!0});function e(c){if(j.value)return c.preventDefault(),c.returnValue="Recording in progress. Are you sure you want to leave?",c.returnValue}K(()=>{window.addEventListener("beforeunload",e)}),ne(()=>{window.removeEventListener("beforeunload",e)}),We((c,u,r)=>{j.value?(z=()=>r(),X.value=!0,r(!1)):r()});function a(){X.value=!1,j.value=!1,o.stopRecording().finally(()=>{z&&(z(),z=null)})}function p(){X.value=!1,z=null}return{isGuardActive:j,showLeaveConfirmation:X,confirmLeave:a,cancelLeave:p}}const T=k(null),ae=k(!1),we=k(null),se=k(null),Ye=10,re=2,Xe=25;function Je(){const o=x(()=>T.value?T.value.available_gb<re?"critical":T.value.available_gb<Ye?"warning":"ok":"unknown"),e=x(()=>T.value?T.value.available_gb>=re:!0),a=x(()=>{if(!T.value)return null;const s=T.value.available_gb*1024*1024*1024,v=Xe*1024*1024,b=s/v,d=Math.floor(b/3600),g=Math.floor(b%3600/60);return d>24?`${Math.floor(d/24)}d ${d%24}h`:d>0?`${d}h ${g}m`:`${g}m`}),p=x(()=>{switch(o.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),c=x(()=>T.value?o.value==="critical"?`Disk space critically low (${T.value.available_gb.toFixed(1)} GB). Cannot start recording.`:o.value==="warning"?`Low disk space (${T.value.available_gb.toFixed(1)} GB). Estimated recording time: ${a.value}`:null:null);async function u(){ae.value=!0,se.value=null;try{const s=await He.getDegradation();if(s.resources&&s.resources.disk_free_gb!==void 0){const v=s.resources.disk_free_gb,b=v*3;T.value={available_gb:v,total_gb:b,used_percent:100-v/b*100,recording_path:"/opt/r58-app/shared/recordings"}}return we.value=new Date,T.value}catch(s){return se.value=s.message||"Failed to check disk space",console.error("Failed to check disk space:",s),null}finally{ae.value=!1}}async function r(){return await u(),T.value?o.value==="critical"?{ok:!1,message:`Insufficient disk space (${T.value.available_gb.toFixed(1)} GB). Need at least ${re} GB to start recording.`}:o.value==="warning"?{ok:!0,message:`Low disk space warning: ${T.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${a.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:T,isLoading:ae,lastCheck:we,error:se,status:o,statusColor:p,canStartRecording:e,estimatedRecordingTime:a,warningMessage:c,checkDiskSpace:u,preflightCheck:r}}const B=k(localStorage.getItem("r58_audio_feedback")!=="false");let ie=null;function Ze(){return ie||(ie=new(window.AudioContext||window.webkitAudioContext)),ie}function L(o,e,a="sine",p=.3){if(B.value)try{const c=Ze();c.state==="suspended"&&c.resume();const u=c.createOscillator(),r=c.createGain();u.connect(r),r.connect(c.destination),u.type=a,u.frequency.value=o;const s=c.currentTime;r.gain.setValueAtTime(0,s),r.gain.linearRampToValueAtTime(p,s+.01),r.gain.linearRampToValueAtTime(0,s+e),u.start(s),u.stop(s+e)}catch(c){console.warn("Audio feedback failed:",c)}}function et(){B.value&&(L(440,.1,"sine",.2),setTimeout(()=>L(554,.1,"sine",.2),100),setTimeout(()=>L(659,.15,"sine",.25),200))}function tt(){B.value&&(L(880,.08,"sine",.3),setTimeout(()=>L(880,.15,"sine",.3),120))}function nt(){B.value&&(L(659,.1,"sine",.25),setTimeout(()=>L(554,.1,"sine",.2),100),setTimeout(()=>L(440,.15,"sine",.2),200))}function ot(){B.value&&(L(200,.15,"square",.15),setTimeout(()=>L(180,.2,"square",.15),180))}function at(){B.value&&(L(1e3,.08,"sine",.2),setTimeout(()=>L(1e3,.08,"sine",.2),150))}function ye(){B.value&&L(1200,.03,"sine",.1)}function st(o=50){if(B.value&&"vibrate"in navigator)try{navigator.vibrate(o)}catch{}}function rt(){function o(a){B.value=a,localStorage.setItem("r58_audio_feedback",String(a))}function e(){o(!B.value),B.value&&ye()}return{enabled:B,setEnabled:o,toggle:e,playSuccess:et,playError:ot,playWarning:at,playClick:ye,playRecordStart:tt,playRecordStop:nt,vibrate:st}}const it={class:"bg-preke-bg-elevated rounded-lg shadow-xl max-w-md w-full p-6"},lt=["placeholder"],ct={class:"text-xs text-preke-text-dim mt-2"},ut=I({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(o,{emit:e}){const a=o,p=e,c=k(""),u=k(null),r=x(()=>{const w=new Date,m=w.toLocaleDateString("en-CA"),f=w.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${m}_${f}`}),s=x(()=>a.suggestedName||r.value);H(()=>a.open,w=>{w&&(c.value=s.value,setTimeout(()=>{var m,f;(m=u.value)==null||m.focus(),(f=u.value)==null||f.select()},100))});function v(){p("confirm",c.value.trim()||s.value)}function b(){p("skip")}function d(){p("cancel")}function g(w){w.key==="Enter"?v():w.key==="Escape"&&d()}return(w,m)=>(h(),pe(Fe,{to:"body"},[D(de,{name:"fade"},{default:fe(()=>[o.open?(h(),y("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:Ne(d,["self"]),onKeydown:g},[n("div",it,[m[1]||(m[1]=n("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),m[2]||(m[2]=n("p",{class:"text-preke-text-dim text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),ge(n("input",{ref_key:"inputRef",ref:u,"onUpdate:modelValue":m[0]||(m[0]=f=>c.value=f),type:"text",placeholder:s.value,class:"w-full px-4 py-2 bg-preke-bg-surface border border-preke-bg-surface rounded-lg text-preke-text placeholder-preke-text-dim focus:outline-none focus:ring-2 focus:ring-preke-gold"},null,8,lt),[[xe,c.value]]),n("p",ct," Suggested: "+$(s.value),1),n("div",{class:"flex justify-between mt-6"},[n("button",{onClick:b,class:"text-sm text-preke-text-dim hover:text-preke-text transition-colors"}," Skip (use default) "),n("div",{class:"flex gap-3"},[n("button",{onClick:d,class:"btn"}," Cancel "),n("button",{onClick:v,class:"btn btn-primary"}," Start Recording ")])])])],32)):E("",!0)]),_:1})]))}}),dt=Q(ut,[["__scopeId","data-v-2eeca4e8"]]),ft={class:"recorder-controls"},vt={key:0,class:"recorder-controls__duration"},pt=["disabled","title"],gt={key:0,class:"recorder-controls__spinner"},mt={key:0,class:"recorder-controls__icon recorder-controls__icon--stop"},_t={key:1,class:"recorder-controls__icon recorder-controls__icon--record"},ht={class:"recorder-controls__hint"},bt=I({__name:"RecorderControls",setup(o){const e=F(),{register:a}=Ue(),{preflightCheck:p,status:c,canStartRecording:u}=Je(),{playRecordStart:r,playRecordStop:s,playError:v,playWarning:b,vibrate:d}=rt(),g=k(null),w=k(!1),m=k(!1),f=k(!1),C=k(!1),S=k(void 0),_=x(()=>e.status==="recording"),t=x(()=>e.status==="starting"),i=x(()=>e.status==="stopping"),l=x(()=>e.formattedDuration),R=x(()=>t.value||i.value||m.value),U=x(()=>t.value?"Starting recording...":i.value?"Stopping recording...":m.value?"Checking disk space...":!_.value&&!u.value?"Insufficient disk space":"");let oe=null;K(()=>{oe=a({key:" ",description:"Toggle Recording",action:Me,context:"recorder",enabled:()=>!t.value&&!i.value})}),ne(()=>{oe&&oe()});async function Me(){_.value?be():await Y()}async function Y(P){m.value=!0;try{const A=await p();if(!A.ok){v(),d(200),G.error("Cannot start recording",A.message||"Preflight check failed");return}if(A.message&&c.value==="warning"&&(b(),G.warning("Low disk space",A.message)),C.value&&!P){S.value=void 0,f.value=!0;return}await he(P||S.value)}finally{m.value=!1}}async function he(P){try{await e.startRecording(P);const A=P||e.sessionId;r(),d([50,30,50]),G.success("Recording started",`Session: ${A}`)}catch(A){v(),d(200),G.error("Failed to start recording",A.message||"Unknown error",{label:"Retry",onClick:()=>Y(P)})}}function Ee(P){f.value=!1,S.value=P,Y(P)}function Pe(){f.value=!1,S.value=void 0,Y()}function Ae(){f.value=!1,m.value=!1}async function Le(){try{await e.stopRecording(),s(),d(100),G.success("Recording stopped",`Duration: ${l.value}`)}catch(P){v(),d(200),G.error("Failed to stop recording",P.message||"Unknown error")}}function be(){var P;w.value=!1,(P=g.value)==null||P.open(),setTimeout(()=>{w.value=!0},500)}function Be(){w.value&&Le()}async function De(){_.value?be():await he()}return(P,A)=>(h(),y(N,null,[n("div",ft,[_.value?(h(),y("div",vt,$(l.value),1)):E("",!0),n("button",{onClick:De,disabled:R.value,class:M(["recorder-controls__btn",_.value?"recorder-controls__btn--stop":"recorder-controls__btn--start"]),title:U.value||(_.value?"Stop Recording (Space)":"Start Recording (Space)")},[t.value||i.value||m.value?(h(),y("span",gt)):(h(),y(N,{key:1},[_.value?(h(),y("span",mt)):(h(),y("span",_t))],64)),n("span",null,$(m.value?"Checking...":_.value?"Stop":"Start Recording"),1)],10,pt),n("span",ht,[A[0]||(A[0]=q(" Press ",-1)),A[1]||(A[1]=n("kbd",null,"Space",-1)),q(" to "+$(_.value?"stop":"start"),1)])]),D(Ce,{ref_key:"stopConfirmDialog",ref:g,title:"Stop Recording?",message:`You have been recording for ${l.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:Be},null,8,["message"]),D(dt,{open:f.value,onConfirm:Ee,onSkip:Pe,onCancel:Ae},null,8,["open"])],64))}}),wt=Q(bt,[["__scopeId","data-v-38c04e0c"]]),J=k(localStorage.getItem("r58_performance_mode")==="true"),le=k(localStorage.getItem("r58_performance_mode_auto")!=="false"),yt=3,kt=100,$t=500;function xt(){const o=F(),e=x(()=>J.value?!0:le.value&&o.isRecording?o.inputs.filter(g=>g.isRecording).length>=yt:!1),a=x(()=>e.value?$t:kt);H(e,d=>{d?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function p(d){J.value=d,localStorage.setItem("r58_performance_mode",String(d))}function c(d){le.value=d,localStorage.setItem("r58_performance_mode_auto",String(d))}function u(){p(!J.value)}function r(d,g){let w=0,m=null;return(...f)=>{const C=Date.now(),S=g??a.value,_=C-w;_>=S?(w=C,d(...f)):m||(m=window.setTimeout(()=>{w=Date.now(),m=null,d(...f)},S-_))}}function s(d,g){let w=null;return(...m)=>{w&&clearTimeout(w),w=window.setTimeout(()=>{d(...m),w=null},g??a.value)}}function v(d){return e.value?window.setTimeout(()=>d(performance.now()),a.value):requestAnimationFrame(d)}function b(d){e.value?clearTimeout(d):cancelAnimationFrame(d)}return{enabled:J,autoEnable:le,isActive:e,updateInterval:a,setEnabled:p,setAutoEnable:c,toggle:u,throttle:r,debounce:s,requestFrame:v,cancelFrame:b}}const Ct=["title"],Rt={class:"flex items-center gap-1.5 text-sm"},St={key:0,class:"flex items-center gap-1.5 text-sm"},Tt={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},Mt={class:"font-mono"},Et=I({__name:"RecordingHealth",setup(o,{expose:e}){const a=F(),{isActive:p}=xt(),c=k({}),u=k(0),r=k(0),s=k(0);let v=null;function b(){const f={};let C=0;a.inputs.forEach(_=>{f[_.id]=_.bytesWritten;const t=c.value[_.id]||0;C+=_.bytesWritten-t});const S=p.value?2:1;u.value=Math.round(C/(1024*1024)/S*10)/10,c.value=f}H(()=>a.isRecording,f=>{if(f){c.value={},u.value=0,r.value=0,s.value=0;const C=p.value?2e3:1e3;v=window.setInterval(b,C)}else v&&(clearInterval(v),v=null)},{immediate:!0}),H(p,f=>{if(a.isRecording&&v){clearInterval(v);const C=f?2e3:1e3;v=window.setInterval(b,C)}}),ne(()=>{v&&clearInterval(v)});const d=x(()=>a.isRecording?s.value>0||r.value>90?"critical":u.value<1||r.value>70?"warning":"healthy":"idle"),g=x(()=>{switch(d.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});x(()=>{switch(d.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const w=x(()=>{if(!a.isRecording)return"Not recording";const f=[`Write speed: ${u.value} MB/s`,`Buffer: ${r.value}%`];return s.value>0&&f.push(`Frames dropped: ${s.value}`),f.join(`
`)});function m(f){f.buffer_percent!==void 0&&(r.value=f.buffer_percent),f.frames_dropped!==void 0&&(s.value=f.frames_dropped)}return e({updateFromMetrics:m}),(f,C)=>ee(a).isRecording?(h(),y("div",{key:0,class:M(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":g.value==="emerald","bg-amber-500/10":g.value==="amber","bg-red-500/10":g.value==="red"}]),title:w.value},[n("span",{class:M(["w-2 h-2 rounded-full",g.value==="emerald"?"bg-emerald-500":"",g.value==="amber"?"bg-amber-500 animate-pulse":"",g.value==="red"?"bg-red-500 animate-pulse":""])},null,2),n("div",Rt,[C[0]||(C[0]=n("svg",{class:"w-3.5 h-3.5 text-preke-text-dim",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),n("span",{class:M(["font-mono",g.value==="emerald"?"text-emerald-400":"",g.value==="amber"?"text-amber-400":"",g.value==="red"?"text-red-400":""])},$(u.value)+" MB/s ",3)]),r.value>0?(h(),y("div",St,[C[1]||(C[1]=n("span",{class:"text-preke-text-dim"},"Buf:",-1)),n("span",{class:M(["font-mono",r.value<50?"text-emerald-400":"",r.value>=50&&r.value<80?"text-amber-400":"",r.value>=80?"text-red-400":""])},$(r.value)+"% ",3)])):E("",!0),s.value>0?(h(),y("div",Tt,[C[2]||(C[2]=n("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),n("span",Mt,$(s.value)+" dropped",1)])):E("",!0)],10,Ct)):E("",!0)}});function ke(o){return o.startsWith("192.168.")||o.startsWith("10.")||o.startsWith("172.")||o.startsWith("100.")||o==="127.0.0.1"||o==="localhost"}const Pt=5,At=1e3,Lt=3e4,Bt=()=>typeof window<"u"&&window.__NETWORK_DEBUG__===!0,$e=new Map,Dt=1e3;function Z(o,e,...a){if(!Bt())return;const p=Date.now(),c=$e.get(o)||0;p-c<Dt||($e.set(o,p),console.log(`[NETWORK DEBUG ${o}] ${e}`,...a))}const W=new Map,O=new Map;async function Wt(o){const e=te(),a=Re();if(e&&!a)try{return`http://${new URL(e).hostname}:8889/${o}/whep`}catch{console.warn("[WHEP Manager] Invalid device URL, falling back to FRP")}if(typeof window<"u"&&window.location.hostname==="app.itagenten.no")return console.log("[WHEP Manager] Browser access from app.itagenten.no, using MediaMTX proxy"),`https://r58-mediamtx.itagenten.no/${o}/whep`;const{getFrpUrl:p}=await Ge(async()=>{const{getFrpUrl:u}=await import("./index-C-UnMYRj.js").then(r=>r.a3);return{getFrpUrl:u}},__vite__mapDeps([0,1])),c=await p();if(c)try{const u=new URL(c);return u.hostname.includes("mediamtx")?`${c}/${o}/whep`:`https://${u.hostname.replace("api","mediamtx")}/${o}/whep`}catch{console.warn("[WHEP Manager] Invalid FRP URL, cannot build WHEP URL")}throw new Error("No device configured and no FRP fallback available")}async function Ht(o,e){const a=W.get(e);if(!a)return"unknown";try{const u=new URL(a.whepUrl).hostname;if(u.includes("itagenten.no"))return console.log(`[WHEP Manager ${e}] Detected relay (FRP URL)`),"relay";if(ke(u))return console.log(`[WHEP Manager ${e}] Detected P2P (private IP: ${u})`),"p2p"}catch(c){console.warn(`[WHEP Manager ${e}] Failed to parse WHEP URL:`,c)}try{const c=await o.getStats();for(const u of c.values())if(u.type==="candidate-pair"&&u.state==="succeeded"){const r=c.get(u.remoteCandidateId);if((r==null?void 0:r.candidateType)==="relay")return console.log(`[WHEP Manager ${e}] Detected relay (TURN candidate)`),"relay";const s=r==null?void 0:r.address;if(s&&!ke(s))return console.log(`[WHEP Manager ${e}] Detected relay (public IP: ${s})`),"relay"}}catch(c){console.warn(`[WHEP Manager ${e}] Failed to get WebRTC stats:`,c)}return te()&&!Re()?(console.log(`[WHEP Manager ${e}] Assuming P2P (direct device URL configured)`),"p2p"):"unknown"}function V(o){const e=W.get(o);if(!e)return;const a=O.get(o);a&&a.forEach(p=>p(e))}function ce(o){const e=W.get(o);if(!e)return;if(e.reconnectAttempts>=Pt){console.error(`[WHEP Manager ${o}] Max reconnect attempts reached`),e.state="failed",V(o);return}e.reconnectAttempts++;const a=Math.min(At*Math.pow(2,e.reconnectAttempts-1),Lt),p=a*.2*(Math.random()*2-1),c=Math.max(100,Math.round(a+p));Z("WHEP",`Camera ${o}: Reconnect #${e.reconnectAttempts} in ${c}ms (base: ${a}ms)`),console.log(`[WHEP Manager ${o}] Scheduling reconnect #${e.reconnectAttempts} in ${c}ms`),e.state="connecting",V(o),e.reconnectTimeout&&clearTimeout(e.reconnectTimeout),e.reconnectTimeout=setTimeout(()=>{_e(o)},c)}async function _e(o){let e=W.get(o);if(e&&(e.state==="connected"||e.state==="connecting"))return console.log(`[WHEP Manager ${o}] Reusing existing connection (state: ${e.state})`),e;if(e!=null&&e.isConnecting){for(Z("WHEP",`Camera ${o}: Connection already in progress, skipping duplicate attempt`),console.log(`[WHEP Manager ${o}] Connection already in progress, waiting...`);e.isConnecting&&e.state==="connecting"&&(await new Promise(s=>setTimeout(s,100)),e=W.get(o),!!e););if(e)return e}const a=typeof window<"u"&&window.location.hostname==="app.itagenten.no";let p=te();if(a)console.log(`[WHEP Manager ${o}] Browser mode - using MediaMTX proxy`);else{let s=0;for(;!p&&s<5;)console.log(`[WHEP Manager ${o}] No device URL yet, waiting... (attempt ${s+1})`),await new Promise(v=>setTimeout(v,100)),p=te(),s++}const c=performance.now(),u=await Wt(o);Z("WHEP",`Camera ${o}: Creating connection to ${u}`),console.log(`[WHEP Manager ${o}] Creating connection to: ${u}`),console.log(`[WHEP Manager ${o}] Device URL was: ${p||"none (browser mode)"}`),e!=null&&e.peerConnection&&e.peerConnection.close(),e!=null&&e.disconnectedTimeout&&(clearTimeout(e.disconnectedTimeout),e.disconnectedTimeout=null),e&&(e.isConnecting=!0);const r=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun1.l.google.com:19302"},{urls:"stun:stun.cloudflare.com:3478"}]});e?(e.peerConnection=r,e.state="connecting",e.whepUrl=u,e.mediaStream=null,e.connectionType="unknown",e.connectionStartTime=c,e.isConnecting=!0):(e={cameraId:o,peerConnection:r,mediaStream:null,state:"connecting",connectionType:"unknown",refCount:0,whepUrl:u,lastConnectedAt:null,reconnectAttempts:0,reconnectTimeout:null,disconnectedTimeout:null,connectionStartTime:c,isConnecting:!0},W.set(o,e)),r.ontrack=s=>{s.streams[0]&&(e.mediaStream=s.streams[0],console.log(`[WHEP Manager ${o}] Received media stream`),V(o))},r.oniceconnectionstatechange=async()=>{const s=r.iceConnectionState;if(Z("WHEP",`Camera ${o}: ICE state changed to ${s}`),console.log(`[WHEP Manager ${o}] ICE state: ${s}`),s==="connected"||s==="completed"){e.state="connected",e.lastConnectedAt=Date.now(),e.reconnectAttempts=0,e.isConnecting=!1,e.connectionType=await Ht(r,o),e.disconnectedTimeout&&(clearTimeout(e.disconnectedTimeout),e.disconnectedTimeout=null);const v=e.connectionStartTime?Math.round(performance.now()-e.connectionStartTime):0;console.log(`[WHEP Manager ${o}] Connected (${e.connectionType}) in ${v}ms`),V(o)}else s==="failed"?(e.state="failed",e.connectionType="unknown",e.isConnecting=!1,V(o),e.refCount>0&&ce(o)):s==="disconnected"&&(e.disconnectedTimeout&&clearTimeout(e.disconnectedTimeout),e.disconnectedTimeout=setTimeout(()=>{(r.iceConnectionState==="disconnected"||r.iceConnectionState==="failed")&&(e.state="disconnected",e.isConnecting=!1,V(o),e.refCount>0&&ce(o)),e.disconnectedTimeout=null},3e3))},r.addTransceiver("video",{direction:"recvonly"}),r.addTransceiver("audio",{direction:"recvonly"});try{const s=await r.createOffer();await r.setLocalDescription(s);const v=await fetch(u,{method:"POST",headers:{"Content-Type":"application/sdp"},body:s.sdp});if(!v.ok)throw new Error(`WHEP request failed: ${v.status}`);const b=await v.text();await r.setRemoteDescription({type:"answer",sdp:b})}catch(s){console.error(`[WHEP Manager ${o}] Connection error:`,s),e.state="failed",e.isConnecting=!1,V(o),e.refCount>0&&ce(o)}return e}async function Nt(o,e){O.has(o)||O.set(o,new Set),O.get(o).add(e);let a=W.get(o);return(!a||a.state==="failed"||a.state==="disconnected")&&(a=await _e(o)),a.refCount++,console.log(`[WHEP Manager ${o}] Acquired connection (refCount: ${a.refCount})`),e(a),a}function Ft(o,e){const a=W.get(o);if(!a)return;const p=O.get(o);p&&(p.delete(e),p.size===0&&O.delete(o)),a.refCount=Math.max(0,a.refCount-1),console.log(`[WHEP Manager ${o}] Released connection (refCount: ${a.refCount})`),a.refCount===0&&(console.log(`[WHEP Manager ${o}] Closing unused connection`),a.reconnectTimeout&&clearTimeout(a.reconnectTimeout),a.disconnectedTimeout&&clearTimeout(a.disconnectedTimeout),a.peerConnection.close(),W.delete(o))}function ue(o){const e=W.get(o);e&&(console.log(`[WHEP Manager ${o}] Force reconnecting...`),e.reconnectAttempts=0,_e(o))}const Ut={class:"relative w-full h-full bg-black"},Gt=["title"],Vt={key:1,class:"absolute inset-0 flex items-center justify-center bg-black/50"},It={key:2,class:"absolute inset-0 flex items-center justify-center bg-black/70"},Ot={class:"text-center"},jt={class:"text-xs text-amber-400"},zt={key:3,class:"absolute inset-0 flex items-center justify-center bg-black/80"},qt={class:"text-center text-preke-text-dim"},Kt={class:"text-sm"},Qt=I({__name:"InputPreview",props:{inputId:{},protocol:{}},emits:["videoReady","aspectRatio"],setup(o,{emit:e}){const a=o,p=e,c=F();let u=!1;const r=x(()=>c.status==="recording"),s=k(null),v=k(!0),b=k(null),d=k("unknown"),g=k(!1),w=k(0);let m=null;function f(t){switch(console.log(`[InputPreview ${a.inputId}] Connection update:`,{state:t.state,type:t.connectionType,hasStream:!!t.mediaStream}),d.value=t.connectionType,w.value=t.reconnectAttempts,t.state){case"connecting":v.value=!0,b.value=null,g.value=t.reconnectAttempts>0;break;case"connected":v.value=!1,b.value=null,g.value=!1,t.mediaStream&&s.value&&s.value.srcObject!==t.mediaStream&&(s.value.srcObject=t.mediaStream,s.value.play().catch(i=>{console.warn(`[InputPreview ${a.inputId}] Autoplay prevented:`,i)}),u||(s.value.onloadeddata=()=>{if(!u&&s.value){u=!0;const i=s.value.videoWidth,l=s.value.videoHeight,R=i&&l?i/l:16/9;console.log(`[InputPreview ${a.inputId}] Video ready (${i}x${l}, ratio: ${R.toFixed(3)})`),p("aspectRatio",R),p("videoReady")}}));break;case"disconnected":g.value=!0,b.value=`Reconnecting... (${t.reconnectAttempts}/5)`;break;case"failed":v.value=!1,g.value=!1,b.value="Connection failed after multiple attempts";break}}async function C(){if(s.value){_(),v.value=!0,b.value=null,m=f;try{await Nt(a.inputId,m)}catch(t){console.error(`[InputPreview ${a.inputId}] Failed to acquire connection:`,t),b.value=t instanceof Error?t.message:"Failed to connect",v.value=!1}}}function S(){ue(a.inputId)}function _(){m&&(Ft(a.inputId,m),m=null)}return K(()=>{C()}),H(()=>a.inputId,()=>{C()}),H(r,(t,i)=>{i&&!t&&b.value?(console.log("[InputPreview] Recording stopped, reconnecting preview..."),ue(a.inputId)):!i&&t&&(console.log("[InputPreview] Recording started, will try to reconnect preview after delay..."),setTimeout(()=>{r.value&&(console.log("[InputPreview] Attempting to reconnect preview during recording..."),ue(a.inputId))},2e3))}),ne(()=>{_()}),(t,i)=>(h(),y("div",Ut,[n("video",{ref_key:"videoRef",ref:s,autoplay:"",muted:"",playsinline:"",class:"w-full h-full object-contain"},null,512),!v.value&&!b.value&&d.value!=="unknown"?(h(),y("div",{key:0,class:M(["absolute top-1 right-1 px-1.5 py-0.5 text-[10px] font-medium rounded",d.value==="p2p"?"bg-emerald-500/80 text-white":"bg-amber-500/80 text-white"]),title:d.value==="p2p"?"Direct P2P connection":"Relay connection (FRP)"},$(d.value==="p2p"?"P2P":"RELAY"),11,Gt)):E("",!0),v.value&&!g.value?(h(),y("div",Vt,[...i[0]||(i[0]=[n("div",{class:"animate-spin w-6 h-6 border-2 border-white border-t-transparent rounded-full"},null,-1)])])):E("",!0),g.value?(h(),y("div",It,[n("div",Ot,[i[1]||(i[1]=n("div",{class:"animate-spin w-5 h-5 border-2 border-amber-400 border-t-transparent rounded-full mx-auto mb-2"},null,-1)),n("p",jt,$(b.value||"Reconnecting..."),1)])])):b.value&&!v.value?(h(),y("div",zt,[n("div",qt,[n("p",Kt,$(b.value),1),n("button",{onClick:S,class:"mt-2 text-xs text-preke-gold hover:underline"}," Retry ")])])):E("",!0)]))}}),Yt={key:0,class:"h-full flex items-center justify-center"},Xt={key:1,class:"input-grid"},Jt={key:0,class:"input-grid__warning"},Zt=["data-count"],en=["title"],tn={key:1,class:"w-full h-full flex items-center justify-center bg-preke-bg-surface"},nn={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},on={class:"flex items-center justify-between"},an={class:"flex items-center gap-2"},sn={class:"font-medium"},rn={key:0,class:"flex items-center gap-2 text-sm"},ln={class:"text-preke-text-dim"},cn={key:0,class:"mt-2 flex items-center justify-between"},un={class:"text-sm font-mono text-preke-text-dim"},dn=I({__name:"InputGrid",emits:["allVideosReady"],setup(o,{emit:e}){const a=F(),p=me(),c=e,u=k(new Set),r=k({});function s(t){u.value.add(t),console.log(`[InputGrid] Video ready: ${t} (${u.value.size}/${g.value.length})`),u.value.size>=g.value.length&&(console.log("[InputGrid] All videos ready!"),c("allVideosReady"))}function v(t,i){r.value[t]=i,console.log(`[InputGrid] Aspect ratio for ${t}: ${i.toFixed(3)}`)}function b(t){return{aspectRatio:`${r.value[t]||1.7777777777777777}`}}H(()=>g.value.length,()=>{u.value.clear()});const d=x(()=>{var t;return((t=p.capabilities)==null?void 0:t.current_mode)==="recorder"}),g=x(()=>a.inputs.filter(t=>t.hasSignal)),w=x(()=>a.framerateMismatch);function m(t){return t.isRecording?"border-preke-red ring-2 ring-preke-red/20":t.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-preke-bg-surface/50 opacity-60"}function f(t){return t.hasSignal?t.framerate>=29?"excellent":t.framerate>=24?"good":"unstable":"none"}function C(t){switch(f(t)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-preke-text-dim"}}function S(t){if(t===0)return"0 B";const i=1024,l=["B","KB","MB","GB"],R=Math.floor(Math.log(t)/Math.log(i));return parseFloat((t/Math.pow(i,R)).toFixed(1))+" "+l[R]}function _(t){if(!t.hasSignal)return`${t.label}: No signal detected`;const i=[`${t.label}`,`Resolution: ${t.resolution}`,`Framerate: ${t.framerate} fps`,`Quality: ${f(t)}`];return t.isRecording&&i.push(`Written: ${S(t.bytesWritten)}`),i.join(`
`)}return(t,i)=>g.value.length===0?(h(),y("div",Yt,[...i[0]||(i[0]=[Ve('<div class="text-center text-preke-text-dim" data-v-2ed3c95b><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-2ed3c95b><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" data-v-2ed3c95b></path></svg><p class="text-lg font-medium" data-v-2ed3c95b>No Video Sources Connected</p><p class="text-sm mt-2" data-v-2ed3c95b>Connect HDMI cables to begin recording</p></div>',1)])])):(h(),y("div",Xt,[w.value?(h(),y("div",Jt,[i[1]||(i[1]=n("svg",{class:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[n("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),n("span",null,$(w.value),1)])):E("",!0),n("div",{class:"input-grid__container","data-count":g.value.length},[(h(!0),y(N,null,ve(g.value,l=>(h(),y("div",{key:l.id,class:M(["input-grid__tile",m(l)]),style:Se(b(l.id)),title:_(l)},[d.value?(h(),pe(Qt,{key:0,"input-id":l.id,class:"w-full h-full",onVideoReady:R=>s(l.id),onAspectRatio:R=>v(l.id,R)},null,8,["input-id","onVideoReady","onAspectRatio"])):(h(),y("div",tn,[...i[2]||(i[2]=[n("div",{class:"text-center"},[n("svg",{class:"w-8 h-8 mx-auto mb-2 text-preke-text-dim/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})]),n("span",{class:"text-xs text-preke-text-dim/70"},"Mixer mode")],-1)])])),n("div",nn,[n("div",on,[n("div",an,[n("span",{class:M(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":f(l)==="excellent"||f(l)==="good","bg-amber-500 animate-pulse":f(l)==="unstable","bg-preke-text-dim":f(l)==="none"}])},null,2),n("span",sn,$(l.label),1)]),l.hasSignal?(h(),y("div",rn,[n("span",ln,$(l.resolution),1),n("span",{class:M(C(l))},$(l.framerate)+"fps",3)])):E("",!0)]),l.isRecording?(h(),y("div",cn,[i[3]||(i[3]=n("div",{class:"flex items-center gap-2 text-preke-red"},[n("span",{class:"w-2 h-2 rounded-full bg-preke-red animate-recording"}),n("span",{class:"text-sm font-medium"},"REC")],-1)),n("span",un,$(S(l.bytesWritten)),1)])):E("",!0)])],14,en))),128))],8,Zt)]))}}),fn=Q(dn,[["__scopeId","data-v-2ed3c95b"]]),vn={class:"sidebar"},pn={class:"sidebar__card sidebar__card--header"},gn={class:"connection-row"},mn={class:"connection-status"},_n={class:"connection-label"},hn={key:0,class:"connection-latency"},bn=["disabled"],wn={class:"sidebar__card sidebar__card--recording"},yn={class:"recording__duration"},kn={class:"recording__meta"},$n={class:"sidebar__card"},xn={class:"stats"},Cn={class:"stats__label"},Rn={class:"stats__value"},Sn={key:0,class:"sidebar__card sidebar__card--warning"},Tn={class:"warning__text"},Mn={class:"sidebar__card"},En={class:"sidebar__hint"},Pn={class:"sidebar__card"},An={class:"cameras"},Ln={class:"camera__header"},Bn={class:"camera__controls"},Dn=["onClick"],Wn={class:"camera__btn-label"},Hn=["onClick"],Nn={class:"camera__btn-label"},Fn=["onClick"],Un={class:"camera__btn-label"},Gn=["onClick"],Vn={class:"camera__btn-label"},In={key:0,class:"sidebar__card"},On={class:"storage"},jn={class:"storage__bar"},zn={class:"storage__info"},qn={class:"storage__estimate"},Kn=I({__name:"SessionInfoV2",setup(o){const e=Te(),a=F(),p=me(),{state:c,latencyMs:u}=Ie(),{connectionMethod:r}=Oe(),s=x(()=>{const _=c.value==="connected",t=c.value==="connecting",i=c.value==="degraded";if(_){let l="";return r.value==="relay"?l="Relay":r.value==="p2p"?l="P2P":r.value==="local"&&(l="Local"),{status:"online",color:"green",label:l||"Connected",latency:u.value,pulse:!1}}return t?{status:"connecting",color:"amber",label:"Connecting...",latency:null,pulse:!0}:i?{status:"degraded",color:"amber",label:"Slow",latency:u.value,pulse:!1}:{status:"offline",color:"red",label:"Offline",latency:null,pulse:!0}});x(()=>a.currentSession);const v=x(()=>a.activeInputs),b=x(()=>a.isRecording),d=x(()=>a.inputs.filter(_=>_.isRecording)),g=k("");K(()=>{const t=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,".");g.value=`Session ${t}`});const w=k([{id:"cam1",name:"CAM 1",focus:"auto",wb:"auto",shutter:"auto",aperture:"auto"},{id:"cam2",name:"CAM 2",focus:"auto",wb:"auto",shutter:"auto",aperture:"auto"},{id:"cam3",name:"CAM 3",focus:"auto",wb:"auto",shutter:"auto",aperture:"auto"},{id:"cam4",name:"CAM 4",focus:"auto",wb:"auto",shutter:"auto",aperture:"auto"}]);function m(_,t){const i=w.value[_];i&&(i[t]=i[t]==="auto"?"manual":"auto")}const f=x(()=>{const _=p.capabilities;if(!_)return null;const t=_.storage_used_gb||0,i=_.storage_total_gb||1,l=i-t,R=Math.round(t/i*100),U=l/10;return{freeGB:Math.round(l),totalGB:Math.round(i),percent:R,hoursRemaining:Math.round(U*10)/10,isLow:R>85,isCritical:R>95}});function C(_){if(_===0)return"0 B";const t=1024,i=["B","KB","MB","GB","TB"],l=Math.floor(Math.log(_)/Math.log(t));return parseFloat((_/Math.pow(t,l)).toFixed(2))+" "+i[l]}function S(){e.push({name:"admin",query:{tab:"settings"}})}return(_,t)=>{var i;return h(),y("div",vn,[n("div",pn,[n("div",gn,[n("div",mn,[n("span",{class:M(["connection-dot",[`connection-dot--${s.value.color}`,{"connection-dot--pulse":s.value.pulse}]])},null,2),n("span",_n,$(s.value.label),1),s.value.latency?(h(),y("span",hn,$(s.value.latency)+"ms ",1)):E("",!0)])]),t[1]||(t[1]=n("div",{class:"sidebar__divider"},null,-1)),t[2]||(t[2]=n("label",{class:"sidebar__label"},"Session Name",-1)),ge(n("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>g.value=l),type:"text",class:"sidebar__input",placeholder:"Session 06.01.2026",disabled:b.value},null,8,bn),[[xe,g.value]])]),b.value?(h(),y(N,{key:0},[n("div",wn,[t[3]||(t[3]=n("div",{class:"recording__header"},[n("span",{class:"recording__dot"}),n("span",{class:"recording__label"},"Recording")],-1)),n("div",yn,$(ee(a).formattedDuration),1),n("div",kn,$(d.value.length)+" camera"+$(d.value.length!==1?"s":"")+" recording ",1)]),n("div",$n,[t[4]||(t[4]=n("div",{class:"sidebar__label"},"Recording Stats",-1)),n("div",xn,[(h(!0),y(N,null,ve(d.value,l=>(h(),y("div",{key:l.id,class:"stats__item"},[n("span",Cn,$(l.label),1),n("span",Rn,$(C(l.bytesWritten)),1)]))),128))])]),(i=f.value)!=null&&i.isLow?(h(),y("div",Sn,[t[6]||(t[6]=n("span",{class:"warning__icon"},"⚠️",-1)),n("div",Tn,[t[5]||(t[5]=n("strong",null,"Low storage",-1)),n("span",null,$(f.value.freeGB)+" GB remaining",1)])])):E("",!0)],64)):(h(),y(N,{key:1},[n("div",Mn,[t[9]||(t[9]=n("div",{class:"sidebar__label"},"Status",-1)),n("p",En,[q($(v.value.length)+" input"+$(v.value.length!==1?"s":"")+" with signal. Press ",1),t[7]||(t[7]=n("kbd",null,"Space",-1)),t[8]||(t[8]=q(" to start recording. ",-1))])]),n("div",Pn,[t[14]||(t[14]=n("div",{class:"sidebar__label"},"Camera Controls",-1)),n("div",An,[(h(!0),y(N,null,ve(w.value,(l,R)=>(h(),y("div",{key:l.id,class:"camera"},[n("div",Ln,$(l.name),1),n("div",Bn,[n("button",{class:M(["camera__btn",{"camera__btn--auto":l.focus==="auto"}]),onClick:U=>m(R,"focus"),title:"Focus"},[t[10]||(t[10]=n("span",{class:"camera__btn-icon"},"◎",-1)),n("span",Wn,$(l.focus==="auto"?"A":"M"),1)],10,Dn),n("button",{class:M(["camera__btn",{"camera__btn--auto":l.wb==="auto"}]),onClick:U=>m(R,"wb"),title:"White Balance"},[t[11]||(t[11]=n("span",{class:"camera__btn-icon"},"☀",-1)),n("span",Nn,$(l.wb==="auto"?"A":"M"),1)],10,Hn),n("button",{class:M(["camera__btn",{"camera__btn--auto":l.shutter==="auto"}]),onClick:U=>m(R,"shutter"),title:"Shutter"},[t[12]||(t[12]=n("span",{class:"camera__btn-icon"},"⏱",-1)),n("span",Un,$(l.shutter==="auto"?"A":"M"),1)],10,Fn),n("button",{class:M(["camera__btn",{"camera__btn--auto":l.aperture==="auto"}]),onClick:U=>m(R,"aperture"),title:"Aperture"},[t[13]||(t[13]=n("span",{class:"camera__btn-icon"},"◐",-1)),n("span",Vn,$(l.aperture==="auto"?"A":"M"),1)],10,Gn)])]))),128))])]),f.value?(h(),y("div",In,[t[15]||(t[15]=n("div",{class:"sidebar__label"},"Storage",-1)),n("div",On,[n("div",jn,[n("div",{class:M(["storage__fill",{"storage__fill--ok":!f.value.isLow,"storage__fill--low":f.value.isLow&&!f.value.isCritical,"storage__fill--critical":f.value.isCritical}]),style:Se({width:`${f.value.percent}%`})},null,6)]),n("div",zn,[n("span",null,$(f.value.freeGB)+" GB free",1),n("span",qn,"~"+$(f.value.hoursRemaining)+"h",1)])])])):E("",!0),n("div",{class:"sidebar__card"},[t[17]||(t[17]=n("div",{class:"sidebar__label"},"Quick Actions",-1)),n("button",{onClick:S,class:"sidebar__btn"},[...t[16]||(t[16]=[n("svg",{class:"sidebar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[n("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),n("circle",{cx:"12",cy:"12",r:"3"})],-1),q(" Configure Inputs ",-1)])])])],64))])}}}),Qn=Q(Kn,[["__scopeId","data-v-dd5d083c"]]),Yn={class:"h-full flex flex-col"},Xn={class:"recorder-header"},Jn={class:"recorder-header__left"},Zn={class:"recorder-header__title"},eo={key:0,class:"recorder-header__badge"},to={class:"flex-1 flex min-h-0 overflow-hidden"},no={class:"flex-1 min-h-0 min-w-0 p-3 overflow-hidden"},oo={class:"w-72 flex-shrink-0 border-l border-preke-surface-border bg-preke-surface/80 backdrop-blur-lg p-4 overflow-y-auto"},ao=I({__name:"RecorderView",setup(o){const e=Te(),a=F(),p=me(),{showLeaveConfirmation:c,confirmLeave:u,cancelLeave:r}=Qe();function s(){e.push("/")}const v=x(()=>a.status==="recording"),b=x(()=>a.formattedDuration),d=k(!0),g=k(!1),w=k(!1),m=x(()=>g.value&&w.value);function f(){d.value=!1}async function C(){var i;if(!je())return;await p.fetchCapabilities();const t=(i=p.capabilities)==null?void 0:i.current_mode;if(t&&t!=="recorder"){console.log("[Recorder] Not in recorder mode, switching...");try{(await fetch(await ze("/api/mode/recorder"),{method:"POST"})).ok&&(await p.fetchCapabilities(),G.success("Switched to Recorder mode"))}catch(l){console.warn("[Recorder] Failed to switch mode:",l)}}}function S(){console.log("[Recorder] All videos ready!"),w.value=!0}K(async()=>{const t=performance.now();await Promise.all([C(),a.fetchInputs(),a.fetchStatus()]);const i=a.inputs.filter(l=>l.hasSignal).length;console.log(`[Recorder] Data loaded: ${a.inputs.length} inputs, ${i} with signal (${Math.round(performance.now()-t)}ms)`),g.value=!0,i===0&&(w.value=!0)});const _=k(null);return H(c,t=>{var i,l;t?(i=_.value)==null||i.open():(l=_.value)==null||l.close()}),(t,i)=>(h(),y(N,null,[D(de,{name:"fade"},{default:fe(()=>[d.value?(h(),pe(Ke,{key:0,mode:"recorder","content-ready":m.value,"min-time":1500,"max-time":5e3,"show-cancel":!0,onReady:f,onCancel:s},null,8,["content-ready"])):E("",!0)]),_:1}),D(de,{name:"content-fade"},{default:fe(()=>[ge(n("div",Yn,[n("header",Xn,[n("div",Jn,[n("div",Zn,[n("span",{class:M(["recorder-header__indicator",{"recorder-header__indicator--active":v.value}])},null,2),i[0]||(i[0]=n("span",{class:"recorder-header__label"},"Recorder",-1))]),v.value?(h(),y("span",eo," REC ")):E("",!0),D(Et)]),D(wt)]),n("div",to,[n("div",no,[D(fn,{onAllVideosReady:S})]),n("aside",oo,[D(Qn)])]),D(Ce,{ref_key:"leaveDialog",ref:_,title:"Recording in Progress",message:`You are currently recording (${b.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:ee(u),onCancel:ee(r)},null,8,["message","onConfirm","onCancel"])],512),[[qe,!d.value]])]),_:1})],64))}}),io=Q(ao,[["__scopeId","data-v-a7fdeea3"]]);export{io as default};
