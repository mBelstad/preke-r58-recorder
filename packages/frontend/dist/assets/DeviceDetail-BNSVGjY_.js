import{d as L,r,j as N,$ as E,o as J,l as O,E as G,c as i,e as t,f as d,x as h,q as K,g as Q,t as o,F as D,n as c,y as V,a as q,w as R,U as W,A as X,H as f,i as a}from"./index-BMV0MFpw.js";const Y={class:"device-detail p-6"},Z={key:0,class:"text-center py-12"},ee={key:1,class:"p-4 bg-red-900/20 border border-red-800 rounded-lg text-red-400"},te={class:"flex items-start justify-between mb-6"},se={class:"flex items-center gap-3"},ne={class:"text-2xl font-semibold text-zinc-100"},oe={class:"text-zinc-500 font-mono text-sm mt-1"},le={class:"flex items-center gap-2"},ie={class:"flex gap-1 mb-6 border-b border-zinc-800"},ae=["onClick"],re={key:0,class:"space-y-6"},de={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},ce={class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},ue={class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},ve={class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},me={class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},pe={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},be={class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},xe={class:"space-y-2"},ge={class:"flex justify-between"},fe={class:"text-zinc-100 font-mono"},ze={class:"flex justify-between"},_e={class:"flex justify-between"},ye={class:"text-zinc-100 capitalize"},he={class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},we={class:"space-y-2"},ke={class:"flex justify-between"},Ce={class:"text-zinc-100"},Se={class:"flex justify-between"},Ue={class:"text-zinc-100"},je={class:"flex justify-between"},De={class:"text-zinc-100"},Be={class:"flex justify-between"},Fe={class:"text-zinc-100"},Me={key:0,class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},$e={class:"flex items-center gap-4"},Ne={key:0,class:"flex items-center gap-2 px-3 py-1.5 bg-red-500/20 text-red-400 rounded-lg"},Ve={key:1,class:"flex items-center gap-2 px-3 py-1.5 bg-emerald-500/20 text-emerald-400 rounded-lg"},qe={key:1,class:"space-y-4"},Re={key:0,class:"text-center py-8 text-zinc-500"},Te={class:"flex items-center justify-between mb-2"},Ae={class:"flex items-center gap-2"},Ie={class:"font-medium text-zinc-100 capitalize"},He={class:"text-sm text-zinc-500"},Pe={key:0,class:"text-sm text-red-400 mt-2"},Le={key:2,class:"space-y-4"},Ee={class:"text-sm text-zinc-500"},Je={key:3,class:"space-y-4"},Oe={class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},Ge={class:"space-y-4"},Ke=["value"],Qe=["value"],We={key:3,class:"fixed inset-0 bg-black/50 flex items-center justify-center z-50"},Xe={class:"bg-zinc-900 border border-zinc-800 rounded-xl p-6 w-full max-w-md"},Ye={class:"space-y-4"},Ze={class:"flex justify-end gap-2 mt-6"},et=["disabled"],ot=L({__name:"DeviceDetail",setup(tt){const T=E(),A=Q(),s=r(null),w=r([]),B=r([]),k=r(!0),z=r(null),u=r("overview"),C=r(null),_=r(!1),v=r(""),b=r(""),y=r(!1),m=N(()=>T.params.deviceId),I=N(()=>{var g;if(!((g=s.value)!=null&&g.uptime_seconds))return"Unknown";const n=s.value.uptime_seconds,e=Math.floor(n/86400),p=Math.floor(n%86400/3600),x=Math.floor(n%3600/60);return e>0?`${e}d ${p}h`:p>0?`${p}h ${x}m`:`${x}m`});async function S(){var n;try{s.value=await((n=f.fleet)==null?void 0:n.device(m.value)),z.value=null}catch(e){z.value="Failed to load device",console.error("Device fetch error:",e)}finally{k.value=!1}}async function U(){var n;try{const e=await((n=f.fleet)==null?void 0:n.deviceCommands(m.value));w.value=(e==null?void 0:e.items)||[]}catch(e){console.error("Commands fetch error:",e)}}async function F(){var n;try{const e=await((n=f.fleet)==null?void 0:n.deviceHeartbeats(m.value));B.value=(e==null?void 0:e.items)||[]}catch(e){console.error("Heartbeats fetch error:",e)}}async function H(){var n;if(v.value){y.value=!0;try{let e={};b.value&&(e=JSON.parse(b.value)),await((n=f.fleet)==null?void 0:n.sendCommand(m.value,{type:v.value,payload:e})),_.value=!1,v.value="",b.value="",await U()}catch(e){console.error("Command send error:",e),alert("Failed to send command")}finally{y.value=!1}}}async function P(){var n;try{await((n=f.fleet)==null?void 0:n.requestBundle(m.value,{include_logs:!0,include_config:!0,include_recordings:!1})),alert("Support bundle requested")}catch(e){console.error("Bundle request error:",e),alert("Failed to request bundle")}}function j(n){return{online:"bg-emerald-500",offline:"bg-zinc-500",updating:"bg-amber-500",error:"bg-red-500",maintenance:"bg-blue-500",pending:"bg-zinc-500",sent:"bg-blue-500",acked:"bg-amber-500",running:"bg-purple-500",completed:"bg-emerald-500",failed:"bg-red-500"}[n]||"bg-zinc-400"}function M(n){return n?new Date(n).toLocaleString():"-"}return J(async()=>{await S(),await Promise.all([U(),F()]),C.value=window.setInterval(S,1e4)}),O(()=>{C.value&&clearInterval(C.value)}),G(m,async()=>{k.value=!0,await S(),await Promise.all([U(),F()])}),(n,e)=>{var p,x,g,$;return a(),i("div",Y,[t("button",{onClick:e[0]||(e[0]=l=>K(A).push("/fleet")),class:"flex items-center gap-2 text-zinc-400 hover:text-zinc-200 transition-colors mb-4"},[...e[5]||(e[5]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1),h(" Back to Fleet ",-1)])]),k.value?(a(),i("div",Z,[...e[6]||(e[6]=[t("div",{class:"animate-spin w-8 h-8 border-2 border-zinc-600 border-t-emerald-500 rounded-full mx-auto"},null,-1),t("p",{class:"text-zinc-400 mt-4"},"Loading device...",-1)])])):z.value?(a(),i("div",ee,o(z.value),1)):s.value?(a(),i(D,{key:2},[t("div",te,[t("div",null,[t("div",se,[t("h1",ne,o(s.value.name),1),t("span",{class:c(["flex items-center gap-1 px-2 py-1 rounded text-sm",j(s.value.status),"bg-opacity-20"])},[t("span",{class:c(["w-2 h-2 rounded-full",j(s.value.status)])},null,2),h(" "+o(s.value.status),1)],2)]),t("p",oe,o(s.value.device_id),1)]),t("div",le,[t("button",{onClick:P,class:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-200 rounded-lg transition-colors"}," Request Bundle "),t("button",{onClick:e[1]||(e[1]=l=>_.value=!0),class:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg transition-colors"}," Send Command ")])]),t("div",ie,[(a(),i(D,null,V(["overview","commands","metrics","settings"],l=>t("button",{key:l,onClick:st=>u.value=l,class:c(["px-4 py-2 text-sm font-medium transition-colors capitalize",u.value===l?"text-emerald-400 border-b-2 border-emerald-400":"text-zinc-400 hover:text-zinc-200"])},o(l),11,ae)),64))]),u.value==="overview"?(a(),i("div",re,[t("div",de,[t("div",ce,[e[7]||(e[7]=t("div",{class:"text-sm text-zinc-500"},"CPU Usage",-1)),t("div",{class:c(["text-2xl font-semibold",s.value.cpu_percent&&s.value.cpu_percent>80?"text-red-400":"text-zinc-100"])},o(((p=s.value.cpu_percent)==null?void 0:p.toFixed(0))||"-")+"% ",3)]),t("div",ue,[e[8]||(e[8]=t("div",{class:"text-sm text-zinc-500"},"Memory Usage",-1)),t("div",{class:c(["text-2xl font-semibold",s.value.mem_percent&&s.value.mem_percent>80?"text-red-400":"text-zinc-100"])},o(((x=s.value.mem_percent)==null?void 0:x.toFixed(0))||"-")+"% ",3)]),t("div",ve,[e[9]||(e[9]=t("div",{class:"text-sm text-zinc-500"},"Disk Free",-1)),t("div",{class:c(["text-2xl font-semibold",s.value.disk_free_gb&&s.value.disk_free_gb<2?"text-red-400":"text-zinc-100"])},o(((g=s.value.disk_free_gb)==null?void 0:g.toFixed(1))||"-")+" GB ",3)]),t("div",me,[e[10]||(e[10]=t("div",{class:"text-sm text-zinc-500"},"Temperature",-1)),t("div",{class:c(["text-2xl font-semibold",s.value.temperature_c&&s.value.temperature_c>70?"text-red-400":"text-zinc-100"])},o((($=s.value.temperature_c)==null?void 0:$.toFixed(0))||"-")+"Â°C ",3)])]),t("div",pe,[t("div",be,[e[14]||(e[14]=t("h3",{class:"text-sm font-medium text-zinc-400 mb-3"},"Version Info",-1)),t("div",xe,[t("div",ge,[e[11]||(e[11]=t("span",{class:"text-zinc-500"},"Current Version",-1)),t("span",fe,"v"+o(s.value.current_version||"unknown"),1)]),t("div",ze,[e[12]||(e[12]=t("span",{class:"text-zinc-500"},"Target Version",-1)),t("span",{class:c([s.value.target_version?"text-amber-400":"text-zinc-400","font-mono"])},o(s.value.target_version?`v${s.value.target_version}`:"None"),3)]),t("div",_e,[e[13]||(e[13]=t("span",{class:"text-zinc-500"},"Update Channel",-1)),t("span",ye,o(s.value.update_channel||"stable"),1)])])]),t("div",he,[e[19]||(e[19]=t("h3",{class:"text-sm font-medium text-zinc-400 mb-3"},"System Info",-1)),t("div",we,[t("div",ke,[e[15]||(e[15]=t("span",{class:"text-zinc-500"},"Platform",-1)),t("span",Ce,o(s.value.platform||"Unknown"),1)]),t("div",Se,[e[16]||(e[16]=t("span",{class:"text-zinc-500"},"Architecture",-1)),t("span",Ue,o(s.value.arch||"arm64"),1)]),t("div",je,[e[17]||(e[17]=t("span",{class:"text-zinc-500"},"Uptime",-1)),t("span",De,o(I.value),1)]),t("div",Be,[e[18]||(e[18]=t("span",{class:"text-zinc-500"},"Last Heartbeat",-1)),t("span",Fe,o(M(s.value.last_heartbeat)),1)])])])]),s.value.recording_active||s.value.mixer_active?(a(),i("div",Me,[e[22]||(e[22]=t("h3",{class:"text-sm font-medium text-zinc-400 mb-3"},"Current Activity",-1)),t("div",$e,[s.value.recording_active?(a(),i("div",Ne,[...e[20]||(e[20]=[t("span",{class:"w-2 h-2 bg-red-500 rounded-full animate-pulse"},null,-1),h(" Recording Active ",-1)])])):d("",!0),s.value.mixer_active?(a(),i("div",Ve,[...e[21]||(e[21]=[t("span",{class:"w-2 h-2 bg-emerald-500 rounded-full"},null,-1),h(" Mixer Active ",-1)])])):d("",!0)])])):d("",!0)])):d("",!0),u.value==="commands"?(a(),i("div",qe,[w.value.length===0?(a(),i("div",Re," No commands sent to this device yet ")):d("",!0),(a(!0),i(D,null,V(w.value,l=>(a(),i("div",{key:l.id,class:"p-4 bg-zinc-900/50 border border-zinc-800 rounded-lg"},[t("div",Te,[t("div",Ae,[t("span",Ie,o(l.type),1),t("span",{class:c(["px-2 py-0.5 text-xs rounded",j(l.status),"bg-opacity-20"])},o(l.status),3)]),t("span",He,o(M(l.created_at)),1)]),l.error?(a(),i("div",Pe," Error: "+o(l.error),1)):d("",!0)]))),128))])):d("",!0),u.value==="metrics"?(a(),i("div",Le,[e[23]||(e[23]=t("p",{class:"text-zinc-400"},"Metrics history visualization coming soon...",-1)),t("div",Ee," Recent heartbeats: "+o(B.value.length),1)])):d("",!0),u.value==="settings"?(a(),i("div",Je,[t("div",Oe,[e[27]||(e[27]=t("h3",{class:"text-sm font-medium text-zinc-400 mb-3"},"Device Settings",-1)),t("div",Ge,[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm text-zinc-500 mb-1"},"Device Name",-1)),t("input",{value:s.value.name,class:"w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200"},null,8,Ke)]),t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm text-zinc-500 mb-1"},"Location",-1)),t("input",{value:s.value.location||"",class:"w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200",placeholder:"e.g., Studio A, Main Hall"},null,8,Qe)]),e[26]||(e[26]=q('<div><label class="block text-sm text-zinc-500 mb-1">Update Channel</label><select class="w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200"><option value="stable">Stable</option><option value="beta">Beta</option><option value="dev">Dev</option></select></div>',1))]),e[28]||(e[28]=t("button",{class:"mt-4 px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg"}," Save Changes ",-1))])])):d("",!0)],64)):d("",!0),_.value?(a(),i("div",We,[t("div",Xe,[e[32]||(e[32]=t("h2",{class:"text-lg font-semibold text-zinc-100 mb-4"},"Send Command",-1)),t("div",Ye,[t("div",null,[e[30]||(e[30]=t("label",{class:"block text-sm text-zinc-400 mb-1"},"Command Type",-1)),R(t("select",{"onUpdate:modelValue":e[2]||(e[2]=l=>v.value=l),class:"w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200"},[...e[29]||(e[29]=[q('<option value="">Select command...</option><option value="reboot">Reboot Device</option><option value="restart_service">Restart Service</option><option value="bundle">Request Support Bundle</option><option value="config">Update Config</option><option value="update">Trigger Update</option>',6)])],512),[[W,v.value]])]),t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm text-zinc-400 mb-1"},"Payload (JSON)",-1)),R(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=l=>b.value=l),class:"w-full px-3 py-2 bg-zinc-800 border border-zinc-700 rounded-lg text-zinc-200 font-mono text-sm h-24",placeholder:"{}"},null,512),[[X,b.value]])])]),t("div",Ze,[t("button",{onClick:e[4]||(e[4]=l=>_.value=!1),class:"px-4 py-2 bg-zinc-800 hover:bg-zinc-700 text-zinc-200 rounded-lg"}," Cancel "),t("button",{onClick:H,disabled:!v.value||y.value,class:"px-4 py-2 bg-emerald-600 hover:bg-emerald-500 text-white rounded-lg disabled:opacity-50"},o(y.value?"Sending...":"Send Command"),9,et)])])])):d("",!0)])}}});export{ot as default};
