import{r as v,G as te,H as ee,m as se,p as ye,I as Le,k as R,J as ce,d as ne,K as ae,f as U,T as de,w as X,c as u,e as V,A as $e,b as e,q as W,B as oe,t as k,L as Se,o as r,_ as le,M as De,j as K,F as q,n as z,y as J,N as Re,s as E,a as Me,z as re,C as Ve,O as Be,P as he,Q as Ae,R as Ne,u as Te,S as Ee,U as Fe,l as Ge,i as Pe,V as xe,h as ze,v as Ue,W as Oe}from"./index--1MZhSDs.js";import{u as He,C as We,P as qe,p as Ke,M as Qe}from"./ModeLoadingScreen-CM_L08gl.js";import{_ as Ce}from"./InputPreview.vue_vue_type_script_setup_true_lang-CzbIJ65S.js";import"./AnimatedBackground-CDAui2dr.js";function Ze(){const m=v(!1),h=v(!1);let a=null;const w=te();ee(()=>w.status,f=>{m.value=f==="recording"},{immediate:!0});function i(f){if(m.value)return f.preventDefault(),f.returnValue="Recording in progress. Are you sure you want to leave?",f.returnValue}se(()=>{window.addEventListener("beforeunload",i)}),ye(()=>{window.removeEventListener("beforeunload",i)}),Le((f,x,C)=>{m.value?(a=()=>C(),h.value=!0,C(!1)):C()});function c(){h.value=!1,m.value=!1,w.stopRecording().finally(()=>{a&&(a(),a=null)})}function y(){h.value=!1,a=null}return{isGuardActive:m,showLeaveConfirmation:h,confirmLeave:c,cancelLeave:y}}let ue=null,ve=null,fe=null,pe=null;function Ye(){return ue||(ue=v(null)),ue}function Je(){return ve||(ve=v(!1)),ve}function Xe(){return fe||(fe=v(null)),fe}function et(){return pe||(pe=v(null)),pe}const tt=10,me=2,nt=25;function at(){const m=Ye(),h=Je(),a=Xe(),w=et(),i=R(()=>m.value?m.value.available_gb<me?"critical":m.value.available_gb<tt?"warning":"ok":"unknown"),c=R(()=>m.value?m.value.available_gb>=me:!0),y=R(()=>{if(!m.value)return null;const S=m.value.available_gb*1024*1024*1024,o=nt*1024*1024,d=S/o,l=Math.floor(d/3600),_=Math.floor(d%3600/60);return l>24?`${Math.floor(l/24)}d ${l%24}h`:l>0?`${l}h ${_}m`:`${_}m`}),f=R(()=>{switch(i.value){case"ok":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}}),x=R(()=>m.value?i.value==="critical"?`Disk space critically low (${m.value.available_gb.toFixed(1)} GB). Cannot start recording.`:i.value==="warning"?`Low disk space (${m.value.available_gb.toFixed(1)} GB). Estimated recording time: ${y.value}`:null:null);async function C(){h.value=!0,w.value=null;try{const S=await ce.getDegradation();if(S.resources&&S.resources.disk_free_gb!==void 0){const o=S.resources.disk_free_gb,d=o*3;m.value={available_gb:o,total_gb:d,used_percent:100-o/d*100,recording_path:"/opt/r58-app/shared/recordings"}}return a.value=new Date,m.value}catch(S){return w.value=S.message||"Failed to check disk space",console.error("Failed to check disk space:",S),null}finally{h.value=!1}}async function $(){return await C(),m.value?i.value==="critical"?{ok:!1,message:`Insufficient disk space (${m.value.available_gb.toFixed(1)} GB). Need at least ${me} GB to start recording.`}:i.value==="warning"?{ok:!0,message:`Low disk space warning: ${m.value.available_gb.toFixed(1)} GB available. Estimated recording time: ${y.value}`}:{ok:!0}:{ok:!0,message:"Could not verify disk space. Proceeding with caution."}}return{diskSpace:m,isLoading:h,lastCheck:a,error:w,status:i,statusColor:f,canStartRecording:c,estimatedRecordingTime:y,warningMessage:x,checkDiskSpace:C,preflightCheck:$}}let ge=null,be=null;function Q(){return ge||(ge=v(localStorage.getItem("r58_audio_feedback")!=="false")),ge}function ot(){return be||(be=new(window.AudioContext||window.webkitAudioContext)),be}function O(m,h,a="sine",w=.3){if(Q().value)try{const i=ot();i.state==="suspended"&&i.resume();const c=i.createOscillator(),y=i.createGain();c.connect(y),y.connect(i.destination),c.type=a,c.frequency.value=m;const f=i.currentTime;y.gain.setValueAtTime(0,f),y.gain.linearRampToValueAtTime(w,f+.01),y.gain.linearRampToValueAtTime(0,f+h),c.start(f),c.stop(f+h)}catch(i){console.warn("Audio feedback failed:",i)}}function st(){Q().value&&(O(440,.1,"sine",.2),setTimeout(()=>O(554,.1,"sine",.2),100),setTimeout(()=>O(659,.15,"sine",.25),200))}function rt(){Q().value&&(O(880,.08,"sine",.3),setTimeout(()=>O(880,.15,"sine",.3),120))}function lt(){Q().value&&(O(659,.1,"sine",.25),setTimeout(()=>O(554,.1,"sine",.2),100),setTimeout(()=>O(440,.15,"sine",.2),200))}function it(){Q().value&&(O(200,.15,"square",.15),setTimeout(()=>O(180,.2,"square",.15),180))}function ct(){Q().value&&(O(1e3,.08,"sine",.2),setTimeout(()=>O(1e3,.08,"sine",.2),150))}function we(){Q().value&&O(1200,.03,"sine",.1)}function dt(m=50){if(Q().value&&"vibrate"in navigator)try{navigator.vibrate(m)}catch{}}function ut(){const m=Q();function h(w){m.value=w,localStorage.setItem("r58_audio_feedback",String(w))}function a(){h(!m.value),m.value&&we()}return{enabled:m,setEnabled:h,toggle:a,playSuccess:st,playError:it,playWarning:ct,playClick:we,playRecordStart:rt,playRecordStop:lt,vibrate:dt}}const vt={class:"bg-preke-bg-elevated rounded-lg shadow-xl max-w-md w-full p-6"},ft=["placeholder"],pt={class:"text-xs text-preke-text-dim mt-2"},mt=ne({__name:"SessionNameDialog",props:{open:{type:Boolean},suggestedName:{}},emits:["confirm","cancel","skip"],setup(m,{emit:h}){const a=m,w=h,i=v(""),c=v(null),y=R(()=>{const o=new Date,d=o.toLocaleDateString("en-CA"),l=o.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1}).replace(":","");return`Recording_${d}_${l}`}),f=R(()=>a.suggestedName||y.value);ee(()=>a.open,o=>{o&&(i.value=f.value,setTimeout(()=>{var d,l;(d=c.value)==null||d.focus(),(l=c.value)==null||l.select()},100))});function x(){w("confirm",i.value.trim()||f.value)}function C(){w("skip")}function $(){w("cancel")}function S(o){o.key==="Enter"?x():o.key==="Escape"&&$()}return(o,d)=>(r(),ae(Se,{to:"body"},[U(de,{name:"fade"},{default:X(()=>[m.open?(r(),u("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",onClick:$e($,["self"]),onKeydown:S},[e("div",vt,[d[1]||(d[1]=e("h2",{class:"text-lg font-semibold mb-2"},"Name This Recording",-1)),d[2]||(d[2]=e("p",{class:"text-preke-text-dim text-sm mb-4"}," Give your recording a name to find it easily later (optional). ",-1)),W(e("input",{ref_key:"inputRef",ref:c,"onUpdate:modelValue":d[0]||(d[0]=l=>i.value=l),type:"text",placeholder:f.value,class:"w-full px-4 py-2 bg-preke-bg-surface border border-preke-bg-surface rounded-lg text-preke-text placeholder-preke-text-dim focus:outline-none focus:ring-2 focus:ring-preke-gold"},null,8,ft),[[oe,i.value]]),e("p",pt," Suggested: "+k(f.value),1),e("div",{class:"flex justify-between mt-6"},[e("button",{onClick:C,class:"text-sm text-preke-text-dim hover:text-preke-text transition-colors"}," Skip (use default) "),e("div",{class:"flex gap-3"},[e("button",{onClick:$,class:"btn"}," Cancel "),e("button",{onClick:x,class:"btn btn-primary"}," Start Recording ")])])])],32)):V("",!0)]),_:1})]))}}),gt=le(mt,[["__scopeId","data-v-2eeca4e8"]]),bt={class:"recorder-controls"},_t={key:0,class:"recorder-controls__duration"},kt=["disabled","title"],ht={key:0,class:"recorder-controls__spinner"},yt={key:0,class:"recorder-controls__icon recorder-controls__icon--stop"},xt={key:1,class:"recorder-controls__icon recorder-controls__icon--record"},Ct={class:"recorder-controls__hint"},wt=ne({__name:"RecorderControls",setup(m){const h=te(),{register:a}=De(),{preflightCheck:w,status:i,canStartRecording:c}=at(),{playRecordStart:y,playRecordStop:f,playError:x,playWarning:C,vibrate:$}=ut(),S=v(null),o=v(!1),d=v(!1),l=v(!1),_=v(!1),B=v(void 0),M=R(()=>h.status==="recording"),N=R(()=>h.status==="starting"),A=R(()=>h.status==="stopping"),g=R(()=>h.formattedDuration),T=R(()=>N.value||A.value||d.value),P=R(()=>N.value?"Starting recording...":A.value?"Stopping recording...":d.value?"Checking disk space...":!M.value&&!c.value?"Insufficient disk space":"");let G=null;se(()=>{G=a({key:" ",description:"Toggle Recording",action:Z,context:"recorder",enabled:()=>!N.value&&!A.value})}),ye(()=>{G&&G()});async function Z(){M.value?I():await H()}async function H(s){d.value=!0;try{const L=await w();if(!L.ok){x(),$(200),K.error("Cannot start recording",L.message||"Preflight check failed");return}if(L.message&&i.value==="warning"&&(C(),K.warning("Low disk space",L.message)),_.value&&!s){B.value=void 0,l.value=!0;return}await Y(s||B.value)}finally{d.value=!1}}async function Y(s){try{await h.startRecording(s);const L=s||h.sessionId;y(),$([50,30,50]),K.success("Recording started",`Session: ${L}`)}catch(L){x(),$(200),K.error("Failed to start recording",L.message||"Unknown error",{label:"Retry",onClick:()=>H(s)})}}function D(s){l.value=!1,B.value=s,H(s)}function b(){l.value=!1,B.value=void 0,H()}function n(){l.value=!1,d.value=!1}async function t(){try{await h.stopRecording(),f(),$(100),K.success("Recording stopped")}catch(s){x(),$(200),K.error("Failed to stop recording",s.message||"Unknown error")}}function I(){var s;o.value=!1,(s=S.value)==null||s.open(),setTimeout(()=>{o.value=!0},500)}function j(){o.value&&t()}async function p(){M.value?I():await Y()}return(s,L)=>(r(),u(q,null,[e("div",bt,[M.value?(r(),u("div",_t,k(g.value),1)):V("",!0),e("button",{onClick:p,disabled:T.value,class:z(["recorder-controls__btn",M.value?"recorder-controls__btn--stop":"recorder-controls__btn--start"]),title:P.value||(M.value?"Stop Recording (Space)":"Start Recording (Space)")},[N.value||A.value||d.value?(r(),u("span",ht)):(r(),u(q,{key:1},[M.value?(r(),u("span",yt)):(r(),u("span",xt))],64)),e("span",null,k(d.value?"Checking...":M.value?"Stop":"Start Recording"),1)],10,kt),e("span",Ct,[L[0]||(L[0]=J(" Press ",-1)),L[1]||(L[1]=e("kbd",null,"Space",-1)),J(" to "+k(M.value?"stop":"start"),1)])]),U(Re,{ref_key:"stopConfirmDialog",ref:S,title:"Stop Recording?",message:`You have been recording for ${g.value}. This will finalize all files.`,"confirm-text":"Stop Recording","cancel-text":"Keep Recording",danger:!0,onConfirm:j},null,8,["message"]),U(gt,{open:l.value,onConfirm:D,onSkip:b,onCancel:n},null,8,["open"])],64))}}),$t=le(wt,[["__scopeId","data-v-1e32920d"]]);let _e=null,ke=null;function St(){return _e||(_e=v(localStorage.getItem("r58_performance_mode")==="true")),_e}function Rt(){return ke||(ke=v(localStorage.getItem("r58_performance_mode_auto")!=="false")),ke}const Mt=3,Bt=100,Tt=500;function Pt(){const m=te(),h=St(),a=Rt(),w=R(()=>h.value?!0:a.value&&m.isRecording?m.inputs.filter(d=>d.isRecording).length>=Mt:!1),i=R(()=>w.value?Tt:Bt);ee(w,o=>{o?document.body.classList.add("performance-mode"):document.body.classList.remove("performance-mode")},{immediate:!0});function c(o){h.value=o,localStorage.setItem("r58_performance_mode",String(o))}function y(o){a.value=o,localStorage.setItem("r58_performance_mode_auto",String(o))}function f(){c(!h.value)}function x(o,d){let l=0,_=null;return(...B)=>{const M=Date.now(),N=d??i.value,A=M-l;A>=N?(l=M,o(...B)):_||(_=window.setTimeout(()=>{l=Date.now(),_=null,o(...B)},N-A))}}function C(o,d){let l=null;return(..._)=>{l&&clearTimeout(l),l=window.setTimeout(()=>{o(..._),l=null},d??i.value)}}function $(o){return w.value?window.setTimeout(()=>o(performance.now()),i.value):requestAnimationFrame(o)}function S(o){w.value?clearTimeout(o):cancelAnimationFrame(o)}return{enabled:h,autoEnable:a,isActive:w,updateInterval:i,setEnabled:c,setAutoEnable:y,toggle:f,throttle:x,debounce:C,requestFrame:$,cancelFrame:S}}const jt=["title"],It={class:"flex items-center gap-1.5 text-sm"},Lt={key:0,class:"flex items-center gap-1.5 text-sm"},Dt={key:1,class:"flex items-center gap-1.5 text-sm text-red-400"},Vt={class:"font-mono"},At=ne({__name:"RecordingHealth",setup(m,{expose:h}){const a=te(),{isActive:w}=Pt(),i=v({}),c=v(0),y=v(0),f=v(0);let x=null;function C(){const l={};let _=0;a.inputs.forEach(M=>{l[M.id]=M.bytesWritten;const N=i.value[M.id]||0;_+=M.bytesWritten-N});const B=w.value?2:1;c.value=Math.round(_/(1024*1024)/B*10)/10,i.value=l}ee(()=>a.isRecording,l=>{if(l){i.value={},c.value=0,y.value=0,f.value=0;const _=w.value?2e3:1e3;x=window.setInterval(C,_)}else x&&(clearInterval(x),x=null)},{immediate:!0}),ee(w,l=>{if(a.isRecording&&x){clearInterval(x);const _=l?2e3:1e3;x=window.setInterval(C,_)}}),ye(()=>{x&&clearInterval(x)});const $=R(()=>a.isRecording?f.value>0||y.value>90?"critical":c.value<1||y.value>70?"warning":"healthy":"idle"),S=R(()=>{switch($.value){case"healthy":return"emerald";case"warning":return"amber";case"critical":return"red";default:return"zinc"}});R(()=>{switch($.value){case"healthy":return"Healthy";case"warning":return"Warning";case"critical":return"Critical";default:return"Idle"}});const o=R(()=>{if(!a.isRecording)return"Not recording";const l=[`Write speed: ${c.value} MB/s`,`Buffer: ${y.value}%`];return f.value>0&&l.push(`Frames dropped: ${f.value}`),l.join(`
`)});function d(l){l.buffer_percent!==void 0&&(y.value=l.buffer_percent),l.frames_dropped!==void 0&&(f.value=l.frames_dropped)}return h({updateFromMetrics:d}),(l,_)=>E(a).isRecording?(r(),u("div",{key:0,class:z(["flex items-center gap-3 px-3 py-1.5 rounded-lg transition-colors cursor-help",{"bg-emerald-500/10":S.value==="emerald","bg-amber-500/10":S.value==="amber","bg-red-500/10":S.value==="red"}]),title:o.value},[e("span",{class:z(["w-2 h-2 rounded-full",S.value==="emerald"?"bg-emerald-500":"",S.value==="amber"?"bg-amber-500 animate-pulse":"",S.value==="red"?"bg-red-500 animate-pulse":""])},null,2),e("div",It,[_[0]||(_[0]=e("svg",{class:"w-3.5 h-3.5 text-preke-text-dim",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})],-1)),e("span",{class:z(["font-mono",S.value==="emerald"?"text-emerald-400":"",S.value==="amber"?"text-amber-400":"",S.value==="red"?"text-red-400":""])},k(c.value)+" MB/s ",3)]),y.value>0?(r(),u("div",Lt,[_[1]||(_[1]=e("span",{class:"text-preke-text-dim"},"Buf:",-1)),e("span",{class:z(["font-mono",y.value<50?"text-emerald-400":"",y.value>=50&&y.value<80?"text-amber-400":"",y.value>=80?"text-red-400":""])},k(y.value)+"% ",3)])):V("",!0),f.value>0?(r(),u("div",Dt,[_[2]||(_[2]=e("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})],-1)),e("span",Vt,k(f.value)+" dropped",1)])):V("",!0)],10,jt)):V("",!0)}}),Nt={key:0,class:"h-full flex items-center justify-center"},Et={key:1,class:"input-grid"},Ft={key:0,class:"input-grid__warning"},Gt=["data-count"],zt=["title","onClick"],Ut={key:1,class:"w-full h-full flex items-center justify-center bg-preke-bg-surface"},Ot={class:"absolute inset-x-0 bottom-0 bg-gradient-to-t from-black/80 to-transparent p-4"},Ht={class:"flex items-center justify-between"},Wt={class:"flex items-center gap-2"},qt={class:"font-medium"},Kt={key:0,class:"flex items-center gap-2 text-sm"},Qt={class:"text-preke-text-dim"},Zt={class:"enlarged-modal__info"},Yt={class:"flex items-center gap-3"},Jt={class:"font-semibold text-lg"},Xt={key:0,class:"px-2 py-0.5 text-xs font-bold bg-preke-red/20 text-preke-red rounded"},en={class:"flex items-center gap-4 text-sm"},tn={class:"text-preke-text-dim"},nn=ne({__name:"InputGrid",emits:["allVideosReady"],setup(m,{emit:h}){const a=te(),w=h,i=v(new Set),c=v(null);function y(g){c.value=g}function f(){c.value=null}const x=v({});function C(g){i.value.add(g),console.log(`[InputGrid] Video ready: ${g} (${i.value.size}/${d.value.length})`),i.value.size>=d.value.length&&(console.log("[InputGrid] All videos ready!"),w("allVideosReady"))}function $(g,T){x.value[g]=T,console.log(`[InputGrid] Aspect ratio for ${g}: ${T.toFixed(3)}`)}function S(g){return{aspectRatio:`${x.value[g]||1.7777777777777777}`}}ee(()=>d.value.length,()=>{i.value.clear()});const o=R(()=>!0),d=R(()=>a.inputs.filter(g=>g.hasSignal)),l=R(()=>a.framerateMismatch);function _(g){return g.isRecording?"border-preke-red ring-2 ring-preke-red/20":g.hasSignal?"border-emerald-500/50 hover:border-emerald-500":"border-preke-bg-surface/50 opacity-60"}function B(g){return g.hasSignal?g.framerate>=29?"excellent":g.framerate>=24?"good":"unstable":"none"}function M(g){switch(B(g)){case"excellent":return"text-emerald-400";case"good":return"text-emerald-400";case"unstable":return"text-amber-400";case"none":return"text-preke-text-dim"}}function N(g){if(g===0)return"0 B";const T=1024,P=["B","KB","MB","GB"],G=Math.floor(Math.log(g)/Math.log(T));return parseFloat((g/Math.pow(T,G)).toFixed(1))+" "+P[G]}function A(g){if(!g.hasSignal)return`${g.label}: No signal detected`;const T=[`${g.label}`,`Resolution: ${g.resolution}`,`Framerate: ${g.framerate} fps`,`Quality: ${B(g)}`];return g.isRecording&&T.push(`Written: ${N(g.bytesWritten)}`),T.join(`
`)}return(g,T)=>d.value.length===0?(r(),u("div",Nt,[...T[1]||(T[1]=[Me('<div class="text-center text-preke-text-dim" data-v-b3c31fb3><svg class="w-16 h-16 mx-auto mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-b3c31fb3><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" data-v-b3c31fb3></path></svg><p class="text-lg font-medium" data-v-b3c31fb3>No Video Sources Connected</p><p class="text-sm mt-2" data-v-b3c31fb3>Connect HDMI cables to begin recording</p></div>',1)])])):(r(),u("div",Et,[l.value?(r(),u("div",Ft,[T[2]||(T[2]=e("svg",{class:"w-4 h-4 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})],-1)),e("span",null,k(l.value),1)])):V("",!0),e("div",{class:"input-grid__container","data-count":d.value.length},[(r(!0),u(q,null,re(d.value,P=>(r(),u("div",{key:P.id,class:z(["input-grid__tile",_(P)]),style:Ve(S(P.id)),title:A(P),onClick:G=>y(P)},[o.value?(r(),ae(Ce,{key:0,"input-id":P.id,class:"w-full h-full",onVideoReady:G=>C(P.id),onAspectRatio:G=>$(P.id,G)},null,8,["input-id","onVideoReady","onAspectRatio"])):(r(),u("div",Ut,[...T[3]||(T[3]=[e("div",{class:"text-center"},[e("svg",{class:"w-8 h-8 mx-auto mb-2 text-preke-text-dim/50",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})]),e("span",{class:"text-xs text-preke-text-dim/70"},"Mixer mode")],-1)])])),e("div",Ot,[e("div",Ht,[e("div",Wt,[e("span",{class:z(["w-2 h-2 rounded-full transition-colors",{"bg-emerald-500":B(P)==="excellent"||B(P)==="good","bg-amber-500 animate-pulse":B(P)==="unstable","bg-preke-text-dim":B(P)==="none"}])},null,2),e("span",qt,k(P.label),1)]),P.hasSignal?(r(),u("div",Kt,[e("span",Qt,k(P.resolution),1),e("span",{class:z(M(P))},k(P.framerate)+"fps",3)])):V("",!0)])])],14,zt))),128))],8,Gt),(r(),ae(Se,{to:"body"},[U(de,{name:"enlarged"},{default:X(()=>[c.value?(r(),u("div",{key:0,class:"enlarged-modal",onClick:f},[e("div",{class:"enlarged-modal__content",onClick:T[0]||(T[0]=$e(()=>{},["stop"]))},[o.value?(r(),ae(Ce,{key:0,"input-id":c.value.id,class:"w-full h-full"},null,8,["input-id"])):V("",!0),e("div",Zt,[e("div",Yt,[e("span",{class:z(["w-2.5 h-2.5 rounded-full",{"bg-emerald-500":B(c.value)==="excellent"||B(c.value)==="good","bg-amber-500 animate-pulse":B(c.value)==="unstable","bg-preke-text-dim":B(c.value)==="none"}])},null,2),e("span",Jt,k(c.value.label),1),c.value.isRecording?(r(),u("span",Xt," REC ")):V("",!0)]),e("div",en,[e("span",tn,k(c.value.resolution),1),e("span",{class:z(M(c.value))},k(c.value.framerate)+"fps",3)])]),e("button",{class:"enlarged-modal__close",onClick:f,title:"Close (or click outside)"},[...T[4]||(T[4]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])])):V("",!0)]),_:1})]))]))}}),an=le(nn,[["__scopeId","data-v-b3c31fb3"]]),on={key:0,class:"py-8 text-center text-preke-text-muted"},sn={key:1,class:"camera-setup"},rn={class:"camera-list"},ln={class:"list-header"},cn=["disabled"],dn={key:0,class:"empty-state"},un={key:1,class:"camera-items"},vn={class:"camera-item__info"},fn={class:"camera-item__header"},pn={class:"camera-item__name"},mn={class:"camera-item__details"},gn={class:"camera-item__type"},bn={class:"camera-item__ip"},_n={class:"camera-item__actions"},kn=["onClick","disabled"],hn={key:0,class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},yn={key:1,class:"spinner"},xn=["onClick","disabled"],Cn=["onClick","disabled"],wn={key:0,class:"camera-form"},$n={class:"form-header"},Sn={class:"form-title"},Rn={class:"form-content"},Mn={class:"form-group"},Bn={class:"form-group"},Tn=["value"],Pn={class:"form-group"},jn={class:"form-group"},In=["placeholder"],Ln={class:"form-hint"},Dn={class:"form-group"},Vn={class:"form-checkbox"},An={class:"form-actions"},Nn={class:"flex items-center justify-between w-full"},En={key:0,class:"text-sm text-amber-400"},Fn={key:1,class:"text-sm text-preke-text-muted"},Gn={class:"flex gap-3"},zn=["disabled"],Un=ne({__name:"CameraSetupModal",emits:["close","updated"],setup(m,{expose:h,emit:a}){const w=a,i=v(null),c=Be(),y=v(!1),f=v(!1),x=v(null),C=v([]),$=v(null),S=[{value:"blackmagic",label:"Blackmagic Design Studio Camera 4K Pro"},{value:"obsbot_tail2",label:"OBSbot Tail 2"}],o=v({name:"",type:"blackmagic",ip:"",port:void 0,enabled:!0}),d={blackmagic:80,obsbot_tail2:52381},l=R(()=>$.value!==null),_=v(!1);async function B(){y.value=!0;try{const b=await ce.cameras.getConfig();C.value=b.cameras.map(n=>({name:n.name,type:n.type,ip:n.ip,port:n.port,enabled:n.enabled??!0})),_.value=!1}catch(b){console.error("[CameraSetup] Failed to load config:",b),c.error("Failed to load camera configuration")}finally{y.value=!1}}function M(){o.value={name:"",type:"blackmagic",ip:"",port:void 0,enabled:!0},$.value=null}function N(b){$.value=b,o.value={...C.value[b]}}function A(){M()}function g(){M(),$.value=-1}async function T(b){confirm(`Delete camera "${C.value[b].name}"?`)&&(C.value.splice(b,1),_.value=!0,await H())}async function P(b){x.value=b.name;try{(await ce.cameras.getStatus(b.name)).connected?c.success(`${b.name} is connected!`):c.warning(`${b.name} is not connected`)}catch{try{const t=await fetch(`http://${b.ip}:${b.port||d[b.type]}/`,{method:"HEAD",mode:"no-cors",signal:AbortSignal.timeout(3e3)});c.info(`${b.name}: IP ${b.ip} is reachable`)}catch{c.error(`${b.name}: Cannot reach ${b.ip}`)}}finally{x.value=null}}function G(){return o.value.name.trim()?o.value.ip.trim()?/^(\d{1,3}\.){3}\d{1,3}$/.test(o.value.ip)?C.value.findIndex((t,I)=>t.name===o.value.name&&I!==$.value)>=0?(c.error("Camera name already exists"),!1):!0:(c.error("Invalid IP address format"),!1):(c.error("Camera IP address is required"),!1):(c.error("Camera name is required"),!1)}function Z(){G()&&(o.value.port||(o.value.port=d[o.value.type]),$.value===-1?C.value.push({...o.value}):$.value!==null&&$.value>=0&&(C.value[$.value]={...o.value}),_.value=!0,M())}async function H(){f.value=!0;try{await ce.cameras.updateConfig(C.value),c.success("Camera configuration saved!"),_.value=!1,w("updated")}catch(b){console.error("[CameraSetup] Failed to save config:",b),c.error("Failed to save configuration: "+(b.message||"Unknown error"))}finally{f.value=!1}}function Y(){var b;(b=i.value)==null||b.open(),B()}function D(){var b;_.value&&!confirm("You have unsaved changes. Close anyway?")||((b=i.value)==null||b.close(),M(),_.value=!1,w("close"))}return h({open:Y,close:D}),se(()=>{B()}),(b,n)=>(r(),ae(Ne,{ref_key:"modalRef",ref:i,title:"Camera Setup",size:"xl",onClose:D},{header:X(()=>[...n[5]||(n[5]=[e("div",{class:"flex items-center justify-between w-full"},[e("div",null,[e("h2",{class:"text-lg font-semibold text-preke-text"},"Camera Setup"),e("p",{class:"text-sm text-preke-text-muted mt-1"}," Configure external cameras for control ")])],-1)])]),footer:X(()=>[e("div",Nn,[_.value?(r(),u("div",En," You have unsaved changes ")):(r(),u("div",Fn,k(C.value.length)+" camera"+k(C.value.length!==1?"s":"")+" configured ",1)),e("div",Gn,[e("button",{onClick:D,class:"btn-secondary"}," Close "),e("button",{onClick:H,disabled:!_.value||f.value,class:"btn-primary"},k(f.value?"Saving...":"Save Configuration"),9,zn)])])]),default:X(()=>[y.value?(r(),u("div",on," Loading camera configuration... ")):(r(),u("div",sn,[e("div",rn,[e("div",ln,[n[7]||(n[7]=e("h3",{class:"list-title"},"Configured Cameras",-1)),e("button",{onClick:g,class:"btn-add",disabled:l.value},[...n[6]||(n[6]=[e("svg",{class:"btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),J(" Add Camera ",-1)])],8,cn)]),C.value.length===0&&!l.value?(r(),u("div",dn,[...n[8]||(n[8]=[e("svg",{class:"empty-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"})],-1),e("p",{class:"empty-text"},"No cameras configured",-1),e("p",{class:"empty-hint"},'Click "Add Camera" to get started',-1)])])):(r(),u("div",un,[(r(!0),u(q,null,re(C.value,(t,I)=>{var j;return r(),u("div",{key:I,class:z(["camera-item",{"camera-item--disabled":!t.enabled}])},[e("div",vn,[e("div",fn,[e("span",pn,k(t.name),1),e("span",{class:z(["camera-item__badge",t.enabled?"camera-item__badge--enabled":"camera-item__badge--disabled"])},k(t.enabled?"Enabled":"Disabled"),3)]),e("div",mn,[e("span",gn,k(((j=S.find(p=>p.value===t.type))==null?void 0:j.label)||t.type),1),e("span",bn,k(t.ip)+":"+k(t.port||d[t.type]),1)])]),e("div",_n,[e("button",{onClick:p=>P(t),disabled:x.value===t.name,class:"btn-test",title:"Test Connection"},[x.value!==t.name?(r(),u("svg",hn,[...n[9]||(n[9]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M13 10V3L4 14h7v7l9-11h-7z"},null,-1)])])):(r(),u("span",yn))],8,kn),e("button",{onClick:p=>N(I),disabled:l.value,class:"btn-edit",title:"Edit"},[...n[10]||(n[10]=[e("svg",{class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])],8,xn),e("button",{onClick:p=>T(I),disabled:l.value,class:"btn-delete",title:"Delete"},[...n[11]||(n[11]=[e("svg",{class:"btn-icon-sm",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Cn)])],2)}),128))]))]),l.value?(r(),u("div",wn,[e("div",$n,[e("h3",Sn,k($.value===-1?"Add Camera":"Edit Camera"),1),e("button",{onClick:A,class:"btn-cancel-form"},"Cancel")]),e("div",Rn,[e("div",Mn,[n[12]||(n[12]=e("label",{class:"form-label"},"Camera Name *",-1)),W(e("input",{"onUpdate:modelValue":n[0]||(n[0]=t=>o.value.name=t),type:"text",class:"form-input",placeholder:"e.g., BMD Cam 1"},null,512),[[oe,o.value.name]])]),e("div",Bn,[n[13]||(n[13]=e("label",{class:"form-label"},"Camera Type *",-1)),W(e("select",{"onUpdate:modelValue":n[1]||(n[1]=t=>o.value.type=t),class:"form-input"},[(r(),u(q,null,re(S,t=>e("option",{key:t.value,value:t.value},k(t.label),9,Tn)),64))],512),[[he,o.value.type]])]),e("div",Pn,[n[14]||(n[14]=e("label",{class:"form-label"},"IP Address *",-1)),W(e("input",{"onUpdate:modelValue":n[2]||(n[2]=t=>o.value.ip=t),type:"text",class:"form-input",placeholder:"192.168.1.101"},null,512),[[oe,o.value.ip]]),n[15]||(n[15]=e("p",{class:"form-hint"},"Camera's network IP address",-1))]),e("div",jn,[n[16]||(n[16]=e("label",{class:"form-label"},"Port",-1)),W(e("input",{"onUpdate:modelValue":n[3]||(n[3]=t=>o.value.port=t),type:"number",class:"form-input",placeholder:String(d[o.value.type])},null,8,In),[[oe,o.value.port,void 0,{number:!0}]]),e("p",Ln,"Default: "+k(d[o.value.type])+" for "+k(o.value.type),1)]),e("div",Dn,[e("label",Vn,[W(e("input",{"onUpdate:modelValue":n[4]||(n[4]=t=>o.value.enabled=t),type:"checkbox",class:"checkbox"},null,512),[[Ae,o.value.enabled]]),n[17]||(n[17]=e("span",null,"Enabled",-1))]),n[18]||(n[18]=e("p",{class:"form-hint"},"Disable to keep configuration but not use the camera",-1))]),e("div",An,[e("button",{onClick:Z,class:"btn-save-form"},k($.value===-1?"Add Camera":"Update Camera"),1),e("button",{onClick:A,class:"btn-cancel-form"}," Cancel ")])])])):V("",!0)]))]),_:1},512))}}),On=le(Un,[["__scopeId","data-v-d42e0adf"]]),Hn={class:"sidebar"},Wn={class:"sidebar__card sidebar__card--header"},qn={class:"connection-row"},Kn={class:"connection-status"},Qn={class:"connection-label"},Zn={key:0,class:"connection-latency"},Yn=["disabled"],Jn={class:"sidebar__card sidebar__card--recording"},Xn={class:"recording__duration"},ea={class:"recording__meta"},ta={key:0,class:"sidebar__card sidebar__card--warning"},na={class:"warning__text"},aa={key:1,class:"sidebar__card sidebar__card--davinci"},oa={class:"davinci__buttons"},sa=["disabled"],ra=["disabled"],la=["disabled"],ia={class:"sidebar__card"},ca={key:0,class:"cameras"},da={class:"camera__header"},ua=["onClick","disabled"],va={key:1,class:"cameras-empty"},fa={key:0,class:"sidebar__card"},pa={key:1,class:"sidebar__card"},ma=ne({__name:"SessionInfoV2",setup(m){const h=Pe(),a=te(),w=Te(),i=Be(),{state:c,latencyMs:y}=Ee(),{connectionMethod:f}=Fe(),x=R(()=>{const p=c.value==="connected",s=c.value==="connecting",L=c.value==="degraded";if(p){let F="";return f.value==="relay"?F="Relay":f.value==="p2p"?F="P2P":f.value==="local"&&(F="Local"),{status:"online",color:"green",label:F||"Connected",latency:y.value,pulse:!1}}return s?{status:"connecting",color:"amber",label:"Connecting...",latency:null,pulse:!0}:L?{status:"degraded",color:"amber",label:"Slow",latency:y.value,pulse:!1}:{status:"offline",color:"red",label:"Offline",latency:null,pulse:!0}}),C=R(()=>a.currentSession),$=R(()=>a.activeInputs),S=R(()=>a.isRecording),o=R(()=>a.inputs.filter(p=>p.isRecording)),d=v("");se(()=>{const s=new Date().toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}).replace(/\//g,".");d.value=`Session ${s}`});const{cameras:l,loadCameras:_}=He(),B=v(null),M=v(null),N=v(null),A=v(!1);se(async()=>{await _()});function g(p){var s;B.value=p,(s=M.value)==null||s.open()}function T(){B.value=null}function P(){var p;(p=N.value)==null||p.open()}function G(){_()}const Z=R(()=>{const p=w.capabilities;if(!p)return null;const s=p.storage_total_gb||1,L=p.storage_available_gb||0,F=s-L,ie=Math.round(F/s*100),je=($.value.length||1)*8,Ie=L/je;return{freeGB:Math.round(L),totalGB:Math.round(s),percent:ie,hoursRemaining:Math.round(Ie*10)/10,isLow:ie>85,isCritical:ie>95}});function H(){h.push({name:"admin",query:{tab:"settings"}})}const Y=R(()=>Ge()),D=v(!1),b=R(()=>{const p=C.value;return p!=null&&p.id?`Preke_${p.id}`:`Preke_${d.value.replace(/\s+/g,"_")}`}),n=window.electronAPI;async function t(){if(n!=null&&n.davinciOpenProject){D.value=!0,i.info("Opening DaVinci Resolve...");try{const p=await n.davinciOpenProject(b.value);p.success?i.success(`Opened project: ${p.projectName}`):i.error(p.error||"Failed to open DaVinci project")}catch(p){console.error("DaVinci error:",p),i.error("Failed to connect to DaVinci Resolve")}finally{D.value=!1}}}async function I(){if(n!=null&&n.davinciCreateMulticam){D.value=!0;try{n.davinciOpenProject&&await n.davinciOpenProject(b.value);const p=await n.davinciCreateMulticam({projectName:b.value,clipName:`Multicam_${d.value.replace(/\s+/g,"_")}`,syncMethod:"timecode"});p.success?i.success(`Created timeline: ${p.timelineName}`):i.error(p.error||"Failed to create multicam timeline")}catch(p){console.error("DaVinci error:",p),i.error("Failed to create multicam timeline")}finally{D.value=!1}}}async function j(){if(n!=null&&n.davinciRefreshClips){D.value=!0,i.info("Refreshing growing clips...");try{const p=await n.davinciRefreshClips();if(p.success){const s=p.clipsRefreshed||0;i.success(`Refreshed ${s} clip${s!==1?"s":""}`)}else i.error(p.error||"Failed to refresh clips")}catch(p){console.error("DaVinci refresh error:",p),i.error("Failed to refresh clips")}finally{D.value=!1}}}return(p,s)=>{var L;return r(),u("div",Hn,[e("div",Wn,[e("div",qn,[e("div",Kn,[e("span",{class:z(["connection-dot",[`connection-dot--${x.value.color}`,{"connection-dot--pulse":x.value.pulse}]])},null,2),e("span",Qn,k(x.value.label),1),x.value.latency?(r(),u("span",Zn,k(x.value.latency)+"ms ",1)):V("",!0)])]),s[3]||(s[3]=e("div",{class:"sidebar__divider"},null,-1)),s[4]||(s[4]=e("label",{class:"sidebar__label"},"Session Name",-1)),W(e("input",{"onUpdate:modelValue":s[0]||(s[0]=F=>d.value=F),type:"text",class:"sidebar__input",placeholder:"Session 06.01.2026",disabled:S.value},null,8,Yn),[[oe,d.value]])]),S.value?(r(),u(q,{key:0},[e("div",Jn,[s[5]||(s[5]=e("div",{class:"recording__header"},[e("span",{class:"recording__dot"}),e("span",{class:"recording__label"},"Recording")],-1)),e("div",Xn,k(E(a).formattedDuration),1),e("div",ea,k(o.value.length)+" camera"+k(o.value.length!==1?"s":"")+" recording ",1)]),(L=Z.value)!=null&&L.isLow?(r(),u("div",ta,[s[7]||(s[7]=e("span",{class:"warning__icon"},"⚠️",-1)),e("div",na,[s[6]||(s[6]=e("strong",null,"Low storage",-1)),e("span",null,k(Z.value.freeGB)+" GB remaining",1)])])):V("",!0),Y.value?(r(),u("div",aa,[s[8]||(s[8]=Me('<div class="davinci__header" data-v-9c962cbb><svg class="davinci__icon" viewBox="0 0 24 24" fill="currentColor" data-v-9c962cbb><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" data-v-9c962cbb></path></svg><span class="davinci__label" data-v-9c962cbb>DaVinci Resolve</span></div><p class="davinci__hint" data-v-9c962cbb>Edit while recording (mount R58 recordings via SMB)</p>',2)),e("div",oa,[e("button",{onClick:t,disabled:D.value,class:"davinci__btn"},k(D.value?"Opening...":"Open Project"),9,sa),e("button",{onClick:I,disabled:D.value,class:"davinci__btn davinci__btn--secondary"}," Create Multicam ",8,ra),e("button",{onClick:j,disabled:D.value,class:"davinci__btn davinci__btn--secondary",title:"Refresh growing clips to update duration"},k(D.value?"Refreshing...":"Refresh Clips"),9,la)])])):V("",!0)],64)):(r(),u(q,{key:1},[e("div",ia,[e("div",{class:"sidebar__label"},[s[10]||(s[10]=J(" Camera Controls ",-1)),e("button",{onClick:P,class:"camera-setup-btn",title:"Setup Cameras"},[...s[9]||(s[9]=[e("svg",{class:"camera-setup-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1)])])]),E(l).length>0?(r(),u("div",ca,[(r(!0),u(q,null,re(E(l),F=>(r(),u("div",{key:F.name,class:"camera"},[e("div",da,[J(k(F.name)+" ",1),e("span",{class:z(["camera__status",F.connected?"camera__status--connected":"camera__status--disconnected"])},k(F.connected?"●":"○"),3)]),e("button",{class:"camera__control-btn",onClick:ie=>g(F.name),disabled:!F.connected},[...s[11]||(s[11]=[e("svg",{class:"camera__control-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),e("span",null,"Controls",-1)])],8,ua)]))),128))])):(r(),u("div",va,[s[12]||(s[12]=e("p",{class:"cameras-empty__text"},"No cameras configured",-1)),e("button",{onClick:P,class:"cameras-empty__btn"}," Setup Cameras ")]))]),U(We,{ref_key:"cameraModalRef",ref:M,"camera-name":B.value,onClose:T},null,8,["camera-name"]),U(On,{ref_key:"cameraSetupModalRef",ref:N,onUpdated:G},null,512),A.value?(r(),u("div",fa,[U(qe,{"camera-name":B.value,onClose:s[1]||(s[1]=F=>A.value=!1)},null,8,["camera-name"])])):(r(),u("div",pa,[s[14]||(s[14]=e("div",{class:"sidebar__label"},"PTZ Controller",-1)),e("button",{onClick:s[2]||(s[2]=F=>A.value=!0),class:"sidebar__btn",title:"Open PTZ Controller (Gamepad/Joystick)"},[...s[13]||(s[13]=[e("svg",{class:"sidebar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1),J(" Open PTZ Controller ",-1)])])])),e("div",{class:"sidebar__card"},[s[16]||(s[16]=e("div",{class:"sidebar__label"},"Quick Actions",-1)),e("button",{onClick:H,class:"sidebar__btn"},[...s[15]||(s[15]=[e("svg",{class:"sidebar__btn-icon",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","stroke-width":"1.8"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("circle",{cx:"12",cy:"12",r:"3"})],-1),J(" Configure Inputs ",-1)])])])],64))])}}}),ga=le(ma,[["__scopeId","data-v-9c962cbb"]]),ba={class:"h-full flex flex-col"},_a={class:"recorder-header"},ka={class:"recorder-header__left"},ha={class:"recorder-header__title"},ya={key:0,class:"recorder-header__badge"},xa={class:"flex-1 flex min-h-0 overflow-hidden"},Ca={class:"flex-1 min-h-0 min-w-0 p-3 overflow-hidden"},wa={class:"w-72 flex-shrink-0 border-l border-preke-surface-border bg-preke-surface/80 backdrop-blur-lg p-4 overflow-y-auto"},$a={class:"mb-4"},Sa={key:0,class:"mt-2 space-y-3 p-3 bg-preke-bg-base border border-preke-border rounded-lg"},Ra=["value"],Ma={key:0},Ba=["value"],Ta=["value"],Pa={key:1,class:"p-3 bg-preke-bg-elevated border border-preke-border-gold rounded"},ja={class:"flex gap-2"},Ia=["disabled"],La={key:2,class:"text-xs text-preke-text-muted"},Da={class:"font-mono"},Va=ne({__name:"RecorderView",setup(m){const h=Pe(),a=te(),w=Te(),{showLeaveConfirmation:i,confirmLeave:c,cancelLeave:y}=Ze(),f=v(!1),x=v(!1),C=v(""),$=v(!1);function S(){h.push("/")}const o=R(()=>a.status==="recording"),d=R(()=>a.formattedDuration),l=v(!0),_=v(!1),B=v(!1),M=v("Starting recorder..."),N=v(void 0),A=v(void 0),g=R(()=>_.value&&B.value);function T(){l.value=!1}async function P(){var t;if(!xe())return;await w.fetchCapabilities();const n=(t=w.capabilities)==null?void 0:t.current_mode;if(n&&n!=="recorder"){console.log("[Recorder] Not in recorder mode, switching...");try{(await fetch(await ze("/api/mode/recorder"),{method:"POST"})).ok&&(await w.fetchCapabilities(),K.success("Switched to Recorder mode"))}catch(I){console.warn("[Recorder] Failed to switch mode:",I)}}}async function G(){if(!xe()){M.value="No device configured";return}M.value="Finding best connection...";const n=await Ke(t=>{M.value=t});A.value=n.method.toUpperCase()}function Z(){console.log("[Recorder] All videos ready!"),B.value=!0}async function H(){a.selectedClient?await a.loadProjects(a.selectedClient.id):a.projects=[],a.setProject(null)}async function Y(n){const t=n.target.value;if(t==="new")x.value=!0;else if(t){const I=a.projects.find(j=>j.id===parseInt(t));a.setProject(I)}else a.setProject(null)}async function D(){if(!a.selectedClient||!C.value.trim()){K.error("Please enter a project name");return}$.value=!0;try{const n=await a.createProject(a.selectedClient.id,C.value.trim(),a.recordingType||"podcast");await a.loadProjects(a.selectedClient.id),a.setProject(n),x.value=!1,C.value="",K.success("Project created")}catch(n){K.error(n.message||"Failed to create project")}finally{$.value=!1}}se(async()=>{const n=performance.now(),t=G();await Promise.all([t,P(),a.fetchInputs(),a.fetchStatus(),a.loadClients()]);const I=a.inputs.filter(j=>j.hasSignal).length;console.log(`[Recorder] Data loaded: ${a.inputs.length} inputs, ${I} with signal (${Math.round(performance.now()-n)}ms)`),_.value=!0,I===0&&(B.value=!0)});const b=v(null);return ee(i,n=>{var t,I;n?(t=b.value)==null||t.open():(I=b.value)==null||I.close()}),(n,t)=>(r(),u(q,null,[U(de,{name:"fade"},{default:X(()=>[l.value?(r(),ae(Qe,{key:0,mode:"recorder","content-ready":g.value,"min-time":1500,"max-time":12e3,"show-cancel":!0,"status-text":M.value,progress:N.value,"connection-method":A.value,onReady:T,onCancel:S},null,8,["content-ready","status-text","progress","connection-method"])):V("",!0)]),_:1}),U(de,{name:"content-fade"},{default:X(()=>{var I;return[W(e("div",ba,[e("header",_a,[e("div",ka,[e("div",ha,[e("span",{class:z(["recorder-header__indicator",{"recorder-header__indicator--active":o.value}])},null,2),t[6]||(t[6]=e("span",{class:"recorder-header__label"},"Recorder",-1))]),o.value?(r(),u("span",ya," REC ")):V("",!0),U(At)]),U($t)]),e("div",xa,[e("div",Ca,[U(an,{onAllVideosReady:Z})]),e("aside",wa,[e("div",$a,[e("button",{onClick:t[0]||(t[0]=j=>f.value=!f.value),class:"w-full flex items-center justify-between p-3 bg-preke-bg-elevated border border-preke-border rounded-lg hover:border-preke-border-gold transition-colors"},[t[8]||(t[8]=e("span",{class:"text-sm font-medium text-preke-text-dim"},"Project (Optional)",-1)),(r(),u("svg",{class:z(["w-4 h-4 text-preke-text-muted transition-transform",{"rotate-180":f.value}]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...t[7]||(t[7]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2))]),f.value?(r(),u("div",Sa,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Recording Type",-1)),W(e("select",{"onUpdate:modelValue":t[1]||(t[1]=j=>E(a).recordingType=j),onChange:t[2]||(t[2]=j=>E(a).setRecordingType(j.target.value)),class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[...t[9]||(t[9]=[e("option",{value:null},"Select type...",-1),e("option",{value:"podcast"},"Podcast",-1),e("option",{value:"recording"},"Talking Head",-1),e("option",{value:"course"},"Course",-1),e("option",{value:"webinar"},"Webinar",-1)])],544),[[he,E(a).recordingType]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Client",-1)),W(e("select",{"onUpdate:modelValue":t[3]||(t[3]=j=>E(a).selectedClient=j),onChange:H,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[t[11]||(t[11]=e("option",{value:null},"Select client...",-1)),(r(!0),u(q,null,re(E(a).clients,j=>(r(),u("option",{key:j.id,value:j},k(j.name),9,Ra))),128))],544),[[he,E(a).selectedClient]])]),E(a).selectedClient?(r(),u("div",Ma,[t[15]||(t[15]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"Project",-1)),e("select",{value:((I=E(a).selectedProject)==null?void 0:I.id)||"",onChange:Y,class:"w-full px-3 py-2 bg-preke-bg-elevated border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold"},[t[13]||(t[13]=e("option",{value:""},"Select project...",-1)),(r(!0),u(q,null,re(E(a).projects,j=>(r(),u("option",{key:j.id,value:j.id},k(j.name),9,Ta))),128)),t[14]||(t[14]=e("option",{value:"new"},"+ Create New Project",-1))],40,Ba)])):V("",!0),x.value?(r(),u("div",Pa,[t[16]||(t[16]=e("label",{class:"block text-xs font-medium text-preke-text-subtle mb-1"},"New Project Name",-1)),W(e("input",{"onUpdate:modelValue":t[4]||(t[4]=j=>C.value=j),type:"text",placeholder:"Project name",class:"w-full px-3 py-2 bg-preke-bg-base border border-preke-border rounded text-sm text-preke-text-primary focus:outline-none focus:ring-2 focus:ring-preke-gold mb-2",onKeyup:Oe(D,["enter"])},null,544),[[oe,C.value]]),e("div",ja,[e("button",{onClick:D,disabled:$.value||!C.value.trim(),class:"flex-1 px-3 py-1.5 bg-preke-gold text-preke-bg-base rounded text-xs font-medium hover:bg-preke-gold-hover disabled:opacity-50 disabled:cursor-not-allowed"},k($.value?"Creating...":"Create"),9,Ia),e("button",{onClick:t[5]||(t[5]=j=>{x.value=!1,C.value=""}),class:"flex-1 px-3 py-1.5 bg-preke-bg-base border border-preke-border rounded text-xs font-medium hover:bg-preke-bg-elevated"}," Cancel ")])])):V("",!0),E(a).selectedClient&&E(a).selectedProject?(r(),u("div",La,[e("span",Da,k(E(a).recordingPath),1)])):V("",!0)])):V("",!0)]),U(ga)])]),U(Re,{ref_key:"leaveDialog",ref:b,title:"Recording in Progress",message:`You are currently recording (${d.value}). Leaving will stop the recording and save all files.`,"confirm-text":"Leave and Stop Recording","cancel-text":"Stay",danger:!0,onConfirm:E(c),onCancel:E(y)},null,8,["message","onConfirm","onCancel"])],512),[[Ue,!l.value]])]}),_:1})],64))}}),za=le(Va,[["__scopeId","data-v-1db0a7b9"]]);export{za as default};
