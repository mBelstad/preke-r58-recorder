import{d as W,r as m,o as q,c as i,e,K as E,g as Q,w as X,h as Z,f as w,t as r,y as ee,a as te,F as j,z as M,A as g,L as F,b as _,C as se,n as D,s as B,$ as y,q as oe,B as ne,W as H,k as l}from"./index-51tLXJEQ.js";const le={class:"h-full flex flex-col"},re={class:"flex items-center justify-between px-6 py-4 border-b border-preke-surface-border bg-preke-surface/50 backdrop-blur-sm"},ae={class:"flex items-center gap-4"},ie={class:"flex items-center gap-4"},de=["disabled"],ce={key:0,class:"animate-spin w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ue={class:"flex-1 p-6 overflow-y-auto"},me={key:0,class:"flex items-center justify-center h-64"},pe={key:1,class:"flex flex-col items-center justify-center h-64 text-center"},fe={class:"glass-card p-8 rounded-2xl max-w-md"},xe={class:"text-preke-text-muted text-sm mb-6"},ve={key:2,class:"flex flex-col items-center justify-center h-64 text-center"},he={key:3,class:"grid gap-4"},ke={class:"flex items-center gap-4 min-w-0"},be={class:"flex -space-x-2 shrink-0"},we={key:0,class:"w-10 h-10 rounded-lg bg-preke-bg-surface flex items-center justify-center text-xs font-medium text-preke-text-dim border-2 border-preke-bg-elevated"},ge={class:"flex-1 min-w-0"},_e={key:0,class:"flex items-center gap-2 flex-wrap"},ye=["onKeyup"],Ce=["onClick"],je={key:1,class:"flex items-center gap-2 min-w-0"},Me={class:"font-medium text-preke-text truncate"},Be=["onClick"],Le={class:"text-sm text-preke-text-muted truncate"},Se={class:"flex items-center gap-2 md:gap-4 text-sm text-preke-text-muted flex-wrap md:flex-nowrap shrink-0"},$e={class:"px-2 py-1 bg-preke-surface rounded text-xs whitespace-nowrap"},ze={class:"px-2 py-1 bg-preke-surface rounded text-xs whitespace-nowrap"},Ne=["onClick"],Re=["onClick"],Ve={class:"bg-preke-bg-elevated rounded-xl w-full max-w-2xl max-h-[90vh] overflow-hidden flex flex-col"},Ee={class:"px-6 py-4 border-b border-preke-bg-surface flex items-center justify-between"},Fe={class:"text-lg font-semibold"},De={class:"text-sm text-preke-text-dim"},He={class:"flex-1 overflow-y-auto p-6"},Ae={class:"space-y-2"},Te={class:"flex items-center gap-3"},Ue={class:"font-medium text-sm"},Ie={class:"text-xs text-preke-text-dim"},Ke={class:"flex items-center gap-3"},Oe={class:"text-sm text-preke-text-dim"},Ge=["onClick"],Ye=["onClick"],Je={class:"relative w-full h-full max-w-6xl max-h-[90vh] flex flex-col"},Pe={class:"flex items-center justify-between mb-3 px-1"},We={class:"text-white/80 font-medium text-sm md:text-base truncate pr-4"},qe={class:"flex-1 min-h-0 flex items-center justify-center"},Qe=["src"],A="preke-session-names",et=W({__name:"LibraryView",setup(Xe){function L(){try{const s=localStorage.getItem(A);return s?JSON.parse(s):{}}catch{return{}}}function T(s,t){const a=L();a[s]=t,localStorage.setItem(A,JSON.stringify(a))}const x=m([]),p=m(!0),k=m(null),d=m(null),v=m(null),f=m(""),h=m(null);function S(s){return{cam0:"bg-blue-500/20 text-blue-400",cam1:"bg-green-500/20 text-green-400",cam2:"bg-purple-500/20 text-purple-400",cam3:"bg-amber-500/20 text-amber-400"}[s]||"bg-preke-bg-surface text-preke-text-dim"}async function U(s){const t=await _(s.url);h.value={url:t,label:`${y(s.cam_id)} - ${s.filename}`}}function $(){h.value=null}function I(s){if(s===0)return"0 B";const t=1024,a=["B","KB","MB","GB","TB"],o=Math.floor(Math.log(s)/Math.log(t));return parseFloat((s/Math.pow(t,o)).toFixed(2))+" "+a[o]}function K(s,t){return`${s} - ${t}`}async function C(){p.value=!0,k.value=null;try{const s=await _("/api/recordings"),t=`${s}${s.includes("?")?"&":"?"}_t=${Date.now()}`,a=await fetch(t,{cache:"no-cache",headers:{"Cache-Control":"no-cache"}});if(!a.ok)throw new Error(`Failed to fetch sessions: ${a.status}`);const o=await a.json(),n=[],c=L();for(const V of o.sessions||[])for(const u of V.date_sessions){const P=c[u.session_id]||u.name;n.push({id:u.session_id,name:P,date:V.date,duration:K(u.start_time,u.end_time),file_count:u.count,total_size:I(u.total_size),files:u.recordings.map(b=>({...b,size_bytes:b.size,camera_id:b.cam_id,created_at:b.time}))})}x.value=n}catch(s){console.error("Failed to fetch sessions:",s),k.value=s instanceof Error?s.message:"Failed to load recordings"}finally{p.value=!1}}function O(s){d.value=s}function z(){d.value=null}async function G(s,t){const a=await _(t.url);try{const o=await fetch(a);if(!o.ok)throw new Error(`Download failed: ${o.status}`);const n=await o.blob(),c=document.createElement("a");c.href=URL.createObjectURL(n),c.download=t.filename,c.click(),URL.revokeObjectURL(c.href)}catch(o){console.error("Failed to download file:",o),window.open(a,"_blank")}}function Y(s){v.value=s.id,f.value=s.name||""}async function N(s){if(!f.value.trim()){v.value=null;return}const t=f.value.trim();T(s.id,t),s.name=t,v.value=null}function R(){v.value=null,f.value=""}async function J(s){var t;if(confirm(`Delete "${s.name||s.id}"? This will permanently delete ${s.file_count} recording files (${s.total_size}).`))try{const a=await _(`/api/sessions/${s.id}`);(await fetch(a,{method:"DELETE"})).ok&&(x.value=x.value.filter(n=>n.id!==s.id),((t=d.value)==null?void 0:t.id)===s.id&&(d.value=null))}catch(a){console.error("Failed to delete session:",a)}}return q(()=>{C()}),(s,t)=>{const a=Z("router-link");return l(),i("div",le,[e("header",re,[e("div",ae,[Q(a,{to:"/",class:"btn-v2 btn-v2--ghost"},{default:X(()=>[...t[1]||(t[1]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1)])]),_:1}),t[2]||(t[2]=e("h1",{class:"text-xl font-semibold text-preke-text"},"Recording Library",-1))]),e("div",ie,[e("button",{onClick:C,class:"btn-v2 btn-v2--primary",disabled:p.value},[p.value?(l(),i("svg",ce,[...t[3]||(t[3]=[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"},null,-1)])])):w("",!0),e("span",null,r(p.value?"Loading...":"Refresh"),1)],8,de)])]),e("div",ue,[p.value?(l(),i("div",me,[...t[4]||(t[4]=[e("div",{class:"flex flex-col items-center gap-4"},[e("div",{class:"animate-spin w-10 h-10 border-3 border-preke-gold border-t-transparent rounded-full"}),e("span",{class:"text-preke-text-muted text-sm"},"Loading recordings...")],-1)])])):k.value?(l(),i("div",pe,[e("div",fe,[t[6]||(t[6]=e("div",{class:"w-16 h-16 mx-auto mb-4 rounded-full bg-preke-red/10 flex items-center justify-center"},[e("svg",{class:"w-8 h-8 text-preke-red",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])],-1)),t[7]||(t[7]=e("h3",{class:"text-lg font-semibold text-preke-text mb-2"},"Connection Error",-1)),e("p",xe,r(k.value),1),e("button",{onClick:C,class:"btn-v2 btn-v2--primary"},[...t[5]||(t[5]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),ee(" Try Again ",-1)])])])])):x.value.length===0?(l(),i("div",ve,[...t[8]||(t[8]=[te('<div class="glass-card p-8 rounded-2xl max-w-md"><div class="w-20 h-20 mx-auto mb-4 rounded-full bg-preke-gold/10 flex items-center justify-center"><svg class="w-10 h-10 text-preke-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg></div><h3 class="text-lg font-semibold text-preke-text mb-2">No Recordings Yet</h3><p class="text-preke-text-muted text-sm">Recordings will appear here after you record from the Recorder page.</p></div>',1)])])):(l(),i("div",he,[(l(!0),i(j,null,M(x.value,o=>(l(),i("div",{key:o.id,class:"glass-card p-4 rounded-xl flex flex-col md:flex-row md:items-center justify-between gap-4 hover:border-preke-gold/30 transition-all duration-200"},[e("div",ke,[e("div",be,[(l(!0),i(j,null,M(o.files.slice(0,3),(n,c)=>(l(),i("div",{key:n.filename,class:D(["w-10 h-10 rounded-lg flex items-center justify-center text-xs font-bold border-2 border-preke-bg-elevated",S(n.cam_id)]),style:se({zIndex:3-c})},r(B(y)(n.cam_id).replace("HDMI ","")),7))),128)),o.files.length>3?(l(),i("div",we," +"+r(o.files.length-3),1)):w("",!0)]),e("div",ge,[v.value===o.id?(l(),i("div",_e,[oe(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>f.value=n),onKeyup:[H(n=>N(o),["enter"]),H(R,["escape"])],class:"input text-sm py-1 min-w-0 flex-1",placeholder:"Session name...",autofocus:""},null,40,ye),[[ne,f.value]]),e("button",{onClick:n=>N(o),class:"text-preke-gold text-sm"},"Save",8,Ce),e("button",{onClick:R,class:"text-preke-text-dim text-sm"},"Cancel")])):(l(),i("div",je,[e("h3",Me,r(o.name||o.id.substring(0,8)),1),e("button",{onClick:g(n=>Y(o),["stop"]),class:"text-preke-text-muted hover:text-preke-gold transition-colors shrink-0",title:"Rename session"},[...t[9]||(t[9]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])],8,Be)])),e("p",Le,r(o.date)+" · "+r(o.duration),1)])]),e("div",Se,[e("span",$e,r(o.file_count)+" files",1),e("span",ze,r(o.total_size),1),e("button",{onClick:n=>O(o),class:"btn-v2 btn-v2--secondary text-sm whitespace-nowrap"},"Open",8,Ne),e("button",{onClick:g(n=>J(o),["stop"]),class:"btn-v2 btn-v2--ghost text-preke-red hover:bg-preke-red/10",title:"Delete session"},[...t[10]||(t[10]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,Re)])]))),128))]))]),(l(),E(F,{to:"body"},[d.value?(l(),i("div",{key:0,class:"fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4 md:p-8",onClick:g(z,["self"])},[e("div",Ve,[e("div",Ee,[e("div",null,[e("h2",Fe,r(d.value.name||d.value.id.substring(0,8)),1),e("p",De,r(d.value.date)+" · "+r(d.value.file_count)+" files · "+r(d.value.total_size),1)]),e("button",{onClick:z,class:"text-preke-text-dim hover:text-preke-text"},[...t[11]||(t[11]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",He,[t[14]||(t[14]=e("h3",{class:"text-sm font-semibold text-preke-text-dim uppercase tracking-wide mb-3"},"Recording Files",-1)),e("div",Ae,[(l(!0),i(j,null,M(d.value.files,o=>(l(),i("div",{key:o.filename,class:"flex items-center justify-between p-3 bg-preke-bg-surface rounded-lg"},[e("div",Te,[e("div",{class:D(["w-10 h-10 rounded-lg flex items-center justify-center text-sm font-bold",S(o.cam_id)])},r(B(y)(o.cam_id).replace("HDMI ","")),3),e("div",null,[e("p",Ue,r(B(y)(o.cam_id)),1),e("p",Ie,r(o.filename),1)])]),e("div",Ke,[e("span",Oe,r((o.size_bytes/(1024*1024*1024)).toFixed(2))+" GB",1),e("button",{onClick:n=>U(o),class:"btn-v2 btn-v2--primary",title:"Play video"},[...t[12]||(t[12]=[e("svg",{class:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24"},[e("path",{d:"M8 5v14l11-7z"})],-1)])],8,Ge),e("button",{onClick:n=>G(d.value,o),class:"btn-v2 btn-v2--secondary",title:"Download"},[...t[13]||(t[13]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1)])],8,Ye)])]))),128))])])])])):w("",!0)])),(l(),E(F,{to:"body"},[h.value?(l(),i("div",{key:0,class:"fixed inset-0 bg-black/90 flex items-center justify-center z-[60] p-4 md:p-8",onClick:g($,["self"])},[e("div",Je,[e("div",Pe,[e("p",We,r(h.value.label),1),e("button",{onClick:$,class:"text-white/80 hover:text-white shrink-0"},[...t[15]||(t[15]=[e("svg",{class:"w-6 h-6 md:w-8 md:h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",qe,[e("video",{src:h.value.url,controls:"",autoplay:"",class:"max-w-full max-h-full w-auto h-auto rounded-lg shadow-2xl bg-black",style:{"object-fit":"contain"}}," Your browser does not support video playback. ",8,Qe)])])])):w("",!0)]))])}}});export{et as default};
