<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cairo Graphics Control - R58 Recorder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .panel {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
        }
        
        .panel h2 {
            color: #fff;
            font-size: 18px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #333;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            color: #aaa;
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 4px;
            color: #fff;
            font-size: 14px;
        }
        
        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        button {
            flex: 1;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .btn-show {
            background: #4CAF50;
            color: white;
        }
        
        .btn-show:hover {
            background: #45a049;
        }
        
        .btn-hide {
            background: #f44336;
            color: white;
        }
        
        .btn-hide:hover {
            background: #da190b;
        }
        
        .btn-update {
            background: #2196F3;
            color: white;
        }
        
        .btn-update:hover {
            background: #0b7dda;
        }
        
        .btn-start {
            background: #4CAF50;
            color: white;
        }
        
        .btn-pause {
            background: #FF9800;
            color: white;
        }
        
        .btn-reset {
            background: #9E9E9E;
            color: white;
        }
        
        .btn-clear {
            background: #f44336;
            color: white;
        }
        
        .status-panel {
            grid-column: 1 / -1;
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 20px;
        }
        
        .status-content {
            background: #0a0a0a;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #0f0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .connection-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .connected {
            background: #4CAF50;
            color: white;
        }
        
        .disconnected {
            background: #f44336;
            color: white;
        }
        
        .info-box {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            color: #888;
            margin-top: 10px;
        }
        
        .row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            Cairo Graphics Control
            <span id="ws-status" class="connection-status disconnected">Disconnected</span>
        </h1>
        <div class="subtitle">Real-time broadcast graphics with zero latency</div>
        
        <div class="grid">
            <!-- Lower Third Control -->
            <div class="panel">
                <h2>Lower Third</h2>
                <div class="form-group">
                    <label>Element ID</label>
                    <input type="text" id="lt-id" value="lt1" placeholder="lt1">
                </div>
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="lt-name" value="John Doe" placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="lt-title" value="CEO" placeholder="CEO">
                </div>
                <div class="button-group">
                    <button class="btn-show" onclick="createLowerThird()">Create</button>
                    <button class="btn-update" onclick="updateLowerThird()">Update</button>
                </div>
                <div class="button-group">
                    <button class="btn-show" onclick="showLowerThird()">Show</button>
                    <button class="btn-hide" onclick="hideLowerThird()">Hide</button>
                </div>
                <div class="info-box">
                    Slide-in/out animation: 0.5s<br>
                    CPU usage: ~5-8%
                </div>
            </div>
            
            <!-- Scoreboard Control -->
            <div class="panel">
                <h2>Scoreboard</h2>
                <div class="form-group">
                    <label>Element ID</label>
                    <input type="text" id="sb-id" value="scoreboard1" placeholder="scoreboard1">
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Team 1 Name</label>
                        <input type="text" id="sb-team1-name" value="Home" placeholder="Home">
                    </div>
                    <div class="form-group">
                        <label>Team 2 Name</label>
                        <input type="text" id="sb-team2-name" value="Away" placeholder="Away">
                    </div>
                </div>
                <div class="row">
                    <div class="form-group">
                        <label>Team 1 Score</label>
                        <input type="number" id="sb-team1-score" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>Team 2 Score</label>
                        <input type="number" id="sb-team2-score" value="0" min="0">
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-show" onclick="createScoreboard()">Create</button>
                    <button class="btn-update" onclick="updateScoreboard()">Update Score</button>
                </div>
                <div class="button-group">
                    <button class="btn-show" onclick="showScoreboard()">Show</button>
                    <button class="btn-hide" onclick="hideScoreboard()">Hide</button>
                </div>
                <div class="info-box">
                    2-second highlight on score change<br>
                    CPU usage: ~5-8%
                </div>
            </div>
            
            <!-- Ticker Control -->
            <div class="panel">
                <h2>Scrolling Ticker</h2>
                <div class="form-group">
                    <label>Element ID</label>
                    <input type="text" id="ticker-id" value="ticker1" placeholder="ticker1">
                </div>
                <div class="form-group">
                    <label>Text</label>
                    <input type="text" id="ticker-text" value="Breaking News: This is a scrolling ticker message" placeholder="Ticker text">
                </div>
                <div class="form-group">
                    <label>Scroll Speed (px/s)</label>
                    <input type="number" id="ticker-speed" value="100" min="10" max="500">
                </div>
                <div class="button-group">
                    <button class="btn-show" onclick="createTicker()">Create</button>
                    <button class="btn-update" onclick="updateTicker()">Update Text</button>
                </div>
                <div class="button-group">
                    <button class="btn-show" onclick="showTicker()">Show</button>
                    <button class="btn-hide" onclick="hideTicker()">Hide</button>
                </div>
                <div class="info-box">
                    Continuous scrolling animation<br>
                    CPU usage: ~6-10%
                </div>
            </div>
            
            <!-- Timer Control -->
            <div class="panel">
                <h2>Timer</h2>
                <div class="form-group">
                    <label>Element ID</label>
                    <input type="text" id="timer-id" value="timer1" placeholder="timer1">
                </div>
                <div class="form-group">
                    <label>Duration (seconds)</label>
                    <input type="number" id="timer-duration" value="60" min="1">
                </div>
                <div class="form-group">
                    <label>Mode</label>
                    <select id="timer-mode">
                        <option value="countdown">Countdown</option>
                        <option value="countup">Count Up</option>
                    </select>
                </div>
                <div class="button-group">
                    <button class="btn-show" onclick="createTimer()">Create</button>
                    <button class="btn-start" onclick="startTimer()">Start</button>
                </div>
                <div class="button-group">
                    <button class="btn-pause" onclick="pauseTimer()">Pause</button>
                    <button class="btn-start" onclick="resumeTimer()">Resume</button>
                    <button class="btn-reset" onclick="resetTimer()">Reset</button>
                </div>
                <div class="button-group">
                    <button class="btn-show" onclick="showTimer()">Show</button>
                    <button class="btn-hide" onclick="hideTimer()">Hide</button>
                </div>
                <div class="info-box">
                    Red text when < 10s remaining<br>
                    CPU usage: ~3-5%
                </div>
            </div>
        </div>
        
        <!-- Status Panel -->
        <div class="status-panel">
            <h2>Status & Elements</h2>
            <pre id="status" class="status-content">Connecting...</pre>
            <div class="button-group" style="margin-top: 15px;">
                <button class="btn-update" onclick="refreshStatus()">Refresh Status</button>
                <button class="btn-clear" onclick="clearAll()">Clear All Elements</button>
            </div>
        </div>
    </div>
    
    <script>
        const API_BASE = window.location.origin;
        let ws = null;
        let reconnectInterval = null;
        
        // WebSocket connection
        function connectWebSocket() {
            const wsProtocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${wsProtocol}//${window.location.host}/ws/cairo`;
            
            ws = new WebSocket(wsUrl);
            
            ws.onopen = () => {
                console.log('WebSocket connected');
                document.getElementById('ws-status').textContent = 'Connected';
                document.getElementById('ws-status').className = 'connection-status connected';
                
                if (reconnectInterval) {
                    clearInterval(reconnectInterval);
                    reconnectInterval = null;
                }
                
                // Request initial status
                ws.send(JSON.stringify({ type: 'get_status' }));
            };
            
            ws.onmessage = (event) => {
                const response = JSON.parse(event.data);
                console.log('WebSocket response:', response);
                
                if (response.status === 'success' && response.data) {
                    updateStatus(response.data);
                }
            };
            
            ws.onclose = () => {
                console.log('WebSocket disconnected');
                document.getElementById('ws-status').textContent = 'Disconnected';
                document.getElementById('ws-status').className = 'connection-status disconnected';
                
                // Attempt reconnect
                if (!reconnectInterval) {
                    reconnectInterval = setInterval(() => {
                        console.log('Attempting to reconnect...');
                        connectWebSocket();
                    }, 3000);
                }
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
        }
        
        // Send WebSocket message
        function sendWS(message) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify(message));
                return true;
            } else {
                console.error('WebSocket not connected');
                alert('WebSocket not connected. Using REST API fallback.');
                return false;
            }
        }
        
        // Lower Third functions
        async function createLowerThird() {
            const elementId = document.getElementById('lt-id').value;
            const name = document.getElementById('lt-name').value;
            const title = document.getElementById('lt-title').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/cairo/lower_third`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        element_id: elementId,
                        name: name,
                        title: title
                    })
                });
                
                if (response.ok) {
                    console.log('Lower third created');
                    refreshStatus();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.detail}`);
                }
            } catch (error) {
                console.error('Failed to create lower third:', error);
                alert('Failed to create lower third');
            }
        }
        
        function showLowerThird() {
            const elementId = document.getElementById('lt-id').value;
            sendWS({ type: 'lower_third_show', element_id: elementId });
        }
        
        function hideLowerThird() {
            const elementId = document.getElementById('lt-id').value;
            sendWS({ type: 'lower_third_hide', element_id: elementId });
        }
        
        function updateLowerThird() {
            const elementId = document.getElementById('lt-id').value;
            const name = document.getElementById('lt-name').value;
            const title = document.getElementById('lt-title').value;
            
            sendWS({
                type: 'lower_third_update',
                element_id: elementId,
                name: name,
                title: title
            });
        }
        
        // Scoreboard functions
        async function createScoreboard() {
            const elementId = document.getElementById('sb-id').value;
            const team1Name = document.getElementById('sb-team1-name').value;
            const team2Name = document.getElementById('sb-team2-name').value;
            const team1Score = parseInt(document.getElementById('sb-team1-score').value);
            const team2Score = parseInt(document.getElementById('sb-team2-score').value);
            
            try {
                const response = await fetch(`${API_BASE}/api/cairo/scoreboard`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        element_id: elementId,
                        team1_name: team1Name,
                        team2_name: team2Name,
                        team1_score: team1Score,
                        team2_score: team2Score
                    })
                });
                
                if (response.ok) {
                    console.log('Scoreboard created');
                    refreshStatus();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.detail}`);
                }
            } catch (error) {
                console.error('Failed to create scoreboard:', error);
                alert('Failed to create scoreboard');
            }
        }
        
        function showScoreboard() {
            const elementId = document.getElementById('sb-id').value;
            sendWS({ type: 'lower_third_show', element_id: elementId });
        }
        
        function hideScoreboard() {
            const elementId = document.getElementById('sb-id').value;
            sendWS({ type: 'lower_third_hide', element_id: elementId });
        }
        
        function updateScoreboard() {
            const elementId = document.getElementById('sb-id').value;
            const team1Score = parseInt(document.getElementById('sb-team1-score').value);
            const team2Score = parseInt(document.getElementById('sb-team2-score').value);
            
            sendWS({
                type: 'scoreboard_update',
                element_id: elementId,
                team1_score: team1Score,
                team2_score: team2Score
            });
        }
        
        // Ticker functions
        async function createTicker() {
            const elementId = document.getElementById('ticker-id').value;
            const text = document.getElementById('ticker-text').value;
            const speed = parseFloat(document.getElementById('ticker-speed').value);
            
            try {
                const response = await fetch(`${API_BASE}/api/cairo/ticker`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        element_id: elementId,
                        text: text,
                        scroll_speed: speed
                    })
                });
                
                if (response.ok) {
                    console.log('Ticker created');
                    refreshStatus();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.detail}`);
                }
            } catch (error) {
                console.error('Failed to create ticker:', error);
                alert('Failed to create ticker');
            }
        }
        
        function showTicker() {
            const elementId = document.getElementById('ticker-id').value;
            sendWS({ type: 'lower_third_show', element_id: elementId });
        }
        
        function hideTicker() {
            const elementId = document.getElementById('ticker-id').value;
            sendWS({ type: 'lower_third_hide', element_id: elementId });
        }
        
        function updateTicker() {
            const elementId = document.getElementById('ticker-id').value;
            const text = document.getElementById('ticker-text').value;
            
            sendWS({
                type: 'ticker_update',
                element_id: elementId,
                text: text
            });
        }
        
        // Timer functions
        async function createTimer() {
            const elementId = document.getElementById('timer-id').value;
            const duration = parseInt(document.getElementById('timer-duration').value);
            const mode = document.getElementById('timer-mode').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/cairo/timer`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        element_id: elementId,
                        duration: duration,
                        mode: mode
                    })
                });
                
                if (response.ok) {
                    console.log('Timer created');
                    refreshStatus();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.detail}`);
                }
            } catch (error) {
                console.error('Failed to create timer:', error);
                alert('Failed to create timer');
            }
        }
        
        function startTimer() {
            const elementId = document.getElementById('timer-id').value;
            sendWS({ type: 'timer_start', element_id: elementId });
        }
        
        function pauseTimer() {
            const elementId = document.getElementById('timer-id').value;
            sendWS({ type: 'timer_pause', element_id: elementId });
        }
        
        function resumeTimer() {
            const elementId = document.getElementById('timer-id').value;
            sendWS({ type: 'timer_resume', element_id: elementId });
        }
        
        async function resetTimer() {
            const elementId = document.getElementById('timer-id').value;
            
            try {
                const response = await fetch(`${API_BASE}/api/cairo/timer/${elementId}/reset`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    console.log('Timer reset');
                }
            } catch (error) {
                console.error('Failed to reset timer:', error);
            }
        }
        
        function showTimer() {
            const elementId = document.getElementById('timer-id').value;
            sendWS({ type: 'lower_third_show', element_id: elementId });
        }
        
        function hideTimer() {
            const elementId = document.getElementById('timer-id').value;
            sendWS({ type: 'lower_third_hide', element_id: elementId });
        }
        
        // Status functions
        async function refreshStatus() {
            try {
                const response = await fetch(`${API_BASE}/api/cairo/status`);
                const status = await response.json();
                updateStatus(status);
            } catch (error) {
                console.error('Failed to get status:', error);
                document.getElementById('status').textContent = 'Error: Failed to get status';
            }
        }
        
        function updateStatus(status) {
            document.getElementById('status').textContent = JSON.stringify(status, null, 2);
        }
        
        async function clearAll() {
            if (!confirm('Clear all Cairo graphics elements?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_BASE}/api/cairo/clear`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    console.log('All elements cleared');
                    refreshStatus();
                }
            } catch (error) {
                console.error('Failed to clear elements:', error);
            }
        }
        
        // Initialize
        connectWebSocket();
        refreshStatus();
        
        // Refresh status every 2 seconds
        setInterval(refreshStatus, 2000);
    </script>
</body>
</html>
